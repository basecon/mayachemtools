<html>
<head>
<title>MayaChemTools:Code:Molecule.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-Molecule-"></a>   1 <span class="k">package </span><span class="i">Molecule</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># File: Molecule.pm</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2020 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">Storable</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Scalar::Util</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">ObjectProperty</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">MathUtil</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">PeriodicTable</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">TextUtil</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">FileUtil</span><span class="sc">;</span>
  37 <span class="k">use</span> <span class="w">Graph</span><span class="sc">;</span>
  38 <span class="k">use</span> <span class="w">Atom</span><span class="sc">;</span>
  39 <span class="k">use</span> <span class="w">Bond</span><span class="sc">;</span>
  40 <span class="k">use</span> <span class="w">MolecularFormula</span><span class="sc">;</span>
  41 
  42 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  43 
  44 <span class="i">@ISA</span> = <span class="q">qw(Graph ObjectProperty Exporter)</span><span class="sc">;</span>
  45 <span class="i">@EXPORT</span> = <span class="q">qw(IsMolecule)</span><span class="sc">;</span>
  46 <span class="i">@EXPORT_OK</span> = <span class="q">qw(FormatElementalCompositionInformation GetSupportedAromaticityModels IsSupportedAromaticityModel)</span><span class="sc">;</span>
  47 
  48 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  49 
  50 <span class="c"># Setup class variables...</span>
  51 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="cm">,</span> <span class="i">$ObjectID</span><span class="cm">,</span> <span class="i">%AromaticityModelsDataMap</span><span class="cm">,</span> <span class="i">%CanonicalAromaticityModelNamesMap</span><span class="s">)</span><span class="sc">;</span>
  52 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  53 
  54 <span class="c"># Overload Perl functions...</span>
  55 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyMolecule&#39;</span><span class="sc">;</span>
  56 
  57 <span class="c"># Class constructor...</span>
<a name="new-"></a>  58 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  59   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  60 
  61   <span class="c"># Initialize object...</span>
  62   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  63   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  64   <span class="i">$This</span><span class="i">-&gt;_InitializeMolecule</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  65 
  66   <span class="k">if</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span> <span class="i">$This</span><span class="i">-&gt;_InitializeMoleculeProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span> <span class="s">}</span>
  67 
  68   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  69 <span class="s">}</span>
  70 
  71 <span class="c"># Initialize object data...</span>
<a name="_InitializeMolecule-"></a>  72 <span class="k">sub </span><span class="m">_InitializeMolecule</span> <span class="s">{</span>
  73   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  74   <span class="k">my</span><span class="s">(</span><span class="i">$ObjectID</span><span class="s">)</span> = <span class="i">_GetNewObjectID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  75 
  76   <span class="c"># All other property names and values along with all Set/Get&lt;PropertyName&gt; methods</span>
  77   <span class="c"># are implemented on-demand using ObjectProperty class.</span>
  78   <span class="i">$This</span>-&gt;{<span class="w">ID</span>} = <span class="i">$ObjectID</span><span class="sc">;</span>
  79   <span class="i">$This</span>-&gt;{<span class="w">Name</span>} = <span class="q">&quot;Molecule ${ObjectID}&quot;</span><span class="sc">;</span>
  80 <span class="s">}</span>
  81 
  82 <span class="c"># Initialize molecule properties...</span>
<a name="_InitializeMoleculeProperties-"></a>  83 <span class="k">sub </span><span class="m">_InitializeMoleculeProperties</span> <span class="s">{</span>
  84   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  85 
  86   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
  87   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
  88     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
  89     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
  90   <span class="s">}</span>
  91 <span class="s">}</span>
  92 
  93 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a>  94 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
  95   <span class="c">#Class name...</span>
  96   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
  97 
  98   <span class="c"># ID to keep track of objects...</span>
  99   <span class="i">$ObjectID</span> = <span class="n">0</span><span class="sc">;</span>
 100 
 101   <span class="c"># Load molecule class data...</span>
 102   <span class="i">_LoadMoleculeClassData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 103 <span class="s">}</span>
 104 
 105 <span class="c"># Setup an explicit SetID method to block setting of ID by AUTOLOAD function...</span>
<a name="SetID-"></a> 106 <span class="k">sub </span><span class="m">SetID</span> <span class="s">{</span>
 107   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 108 
 109   <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetID: Object ID can&#39;t be changed: it&#39;s used for internal tracking...&quot;</span><span class="sc">;</span>
 110 
 111   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 112 <span class="s">}</span>
 113 
 114 <span class="c"># Add an atom...</span>
<a name="AddAtom-"></a> 115 <span class="k">sub </span><span class="m">AddAtom</span> <span class="s">{</span>
 116   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 117 
 118   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Atom</span><span class="s">)</span> <span class="s">{</span>
 119     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddAtom: No atom added: Atom must be specified...&quot;</span><span class="sc">;</span>
 120     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 121   <span class="s">}</span>
 122   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 123     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddAtom: No atom added: Atom already exists...&quot;</span><span class="sc">;</span>
 124     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 125   <span class="s">}</span>
 126   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_AddAtom</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 127 <span class="s">}</span>
 128 
 129 <span class="c"># Add an atom...</span>
<a name="_AddAtom-"></a> 130 <span class="k">sub </span><span class="m">_AddAtom</span> <span class="s">{</span>
 131   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 132 
 133   <span class="c"># Assign atom to this molecule...</span>
 134   <span class="i">$Atom</span><span class="i">-&gt;_SetMolecule</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
 135 
 136   <span class="c"># Add it to the graph as a vertex...</span>
 137   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 138   <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 139   <span class="i">$This</span><span class="i">-&gt;AddVertex</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 140   <span class="i">$This</span><span class="i">-&gt;SetVertexProperty</span><span class="s">(</span><span class="q">&#39;Atom&#39;</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 141 
 142   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 143 <span class="s">}</span>
 144 
 145 <span class="c"># Add atoms...</span>
<a name="AddAtoms-"></a> 146 <span class="k">sub </span><span class="m">AddAtoms</span> <span class="s">{</span>
 147   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 148 
 149   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 150     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddAtoms: No atoms added: Atoms list must be specified...&quot;</span><span class="sc">;</span>
 151     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 152   <span class="s">}</span>
 153   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 154   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 155     <span class="i">$This</span><span class="i">-&gt;AddAtom</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 156   <span class="s">}</span>
 157   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 158 <span class="s">}</span>
 159 
 160 <span class="c"># Create an atom and add it to molecule...</span>
<a name="NewAtom-"></a> 161 <span class="k">sub </span><span class="m">NewAtom</span> <span class="s">{</span>
 162   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 163   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 164 
 165   <span class="i">$Atom</span> = <span class="i">new</span> <span class="i">Atom</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
 166   <span class="i">$This</span><span class="i">-&gt;AddAtom</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 167 
 168   <span class="k">return</span> <span class="i">$Atom</span><span class="sc">;</span>
 169 <span class="s">}</span>
 170 
 171 <span class="c"># Delete an atom...</span>
<a name="DeleteAtom-"></a> 172 <span class="k">sub </span><span class="m">DeleteAtom</span> <span class="s">{</span>
 173   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 174 
 175   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Atom</span><span class="s">)</span> <span class="s">{</span>
 176     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DeleteAtom: No atom deleted: Atom must be specified...&quot;</span><span class="sc">;</span>
 177     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 178   <span class="s">}</span>
 179   <span class="c"># Does the atom exist in  molecule?</span>
 180   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 181     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DeleteAtom: No atom deleted: Atom doesn&#39;t exist...&quot;</span><span class="sc">;</span>
 182     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 183   <span class="s">}</span>
 184   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_DeleteAtom</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 185 <span class="s">}</span>
 186 
 187 <span class="c"># Delete atom...</span>
<a name="_DeleteAtom-"></a> 188 <span class="k">sub </span><span class="m">_DeleteAtom</span> <span class="s">{</span>
 189   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 190 
 191   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 192   <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 193   <span class="i">$This</span><span class="i">-&gt;DeleteVertex</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 194 
 195   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 196 <span class="s">}</span>
 197 
 198 <span class="c"># Delete atoms...</span>
<a name="DeleteAtoms-"></a> 199 <span class="k">sub </span><span class="m">DeleteAtoms</span> <span class="s">{</span>
 200   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 201 
 202   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 203     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DeleteAtoms: No atoms added: Atoms list must be specified...&quot;</span><span class="sc">;</span>
 204     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 205   <span class="s">}</span>
 206   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 207   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 208     <span class="i">$This</span><span class="i">-&gt;DeleteAtom</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 209   <span class="s">}</span>
 210 
 211   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 212 <span class="s">}</span>
 213 
 214 <span class="c"># Is this atom present?</span>
<a name="HasAtom-"></a> 215 <span class="k">sub </span><span class="m">HasAtom</span> <span class="s">{</span>
 216   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 217 
 218   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Atom</span><span class="s">)</span> <span class="s">{</span>
 219     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 220   <span class="s">}</span>
 221   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 222     <span class="c"># It&#39;s not in molecule...</span>
 223     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 224   <span class="s">}</span>
 225   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 226   <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 227   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasVertex</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 228     <span class="c"># It&#39;s not in molecule...</span>
 229     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 230   <span class="s">}</span>
 231   <span class="k">my</span><span class="s">(</span><span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
 232   <span class="i">$Molecule</span> = <span class="i">$Atom</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="sc">;</span>
 233 
 234   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasVertex</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Molecule</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 235 <span class="s">}</span>
 236 
 237 <span class="c"># Return an array of atoms. In scalar context,  it returns number of atoms. Additionally,</span>
 238 <span class="c"># atoms array can be filtered by any user specifiable Atom class method...</span>
 239 <span class="c">#</span>
<a name="GetAtoms-"></a> 240 <span class="k">sub </span><span class="m">GetAtoms</span> <span class="s">{</span>
 241   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomCheckMethodName</span><span class="cm">,</span> <span class="i">$NegateMethodResult</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 242   <span class="k">my</span><span class="s">(</span><span class="i">@Atoms</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
 243 
 244   <span class="i">@Atoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 245 
 246   <span class="i">@AtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 247   <span class="k">if</span> <span class="s">(</span>!<span class="i">@AtomIDs</span><span class="s">)</span> <span class="s">{</span>
 248     <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@Atoms</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@Atoms</span><span class="sc">;</span>
 249   <span class="s">}</span>
 250 
 251   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetVerticesProperty</span><span class="s">(</span><span class="q">&#39;Atom&#39;</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
 252 
 253   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$AtomCheckMethodName</span><span class="s">)</span> <span class="s">{</span>
 254     <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@Atoms</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@Atoms</span><span class="sc">;</span>
 255   <span class="s">}</span>
 256   <span class="i">$NegateMethodResult</span> = <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$NegateMethodResult</span><span class="s">)</span> &amp;&amp;  <span class="i">$NegateMethodResult</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 257 
 258   <span class="c"># Filter out atoms...</span>
 259   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$KeepAtom</span><span class="cm">,</span> <span class="i">@FilteredAtoms</span><span class="s">)</span><span class="sc">;</span>
 260   <span class="i">@FilteredAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 261   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 262     <span class="i">$KeepAtom</span> = <span class="i">$NegateMethodResult</span> ? <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;$AtomCheckMethodName</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="co">:</span> <span class="i">$Atom</span><span class="i">-&gt;$AtomCheckMethodName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 263     <span class="k">if</span> <span class="s">(</span><span class="i">$KeepAtom</span><span class="s">)</span> <span class="s">{</span>
 264       <span class="k">push</span> <span class="i">@FilteredAtoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="sc">;</span>
 265     <span class="s">}</span>
 266   <span class="s">}</span>
 267   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@FilteredAtoms</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@FilteredAtoms</span><span class="sc">;</span>
 268 <span class="s">}</span>
 269 
 270 <span class="c"># Return an array of bonds. In scalar context, it returns number of bonds...</span>
<a name="GetBonds-"></a> 271 <span class="k">sub </span><span class="m">GetBonds</span> <span class="s">{</span>
 272   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 273   <span class="k">my</span><span class="s">(</span><span class="i">@Bonds</span><span class="cm">,</span> <span class="i">@EdgesAtomsIDs</span><span class="s">)</span><span class="sc">;</span>
 274 
 275   <span class="i">@Bonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@EdgesAtomsIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 276 
 277   <span class="i">@EdgesAtomsIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetEdges</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 278   <span class="k">if</span> <span class="s">(</span><span class="i">@EdgesAtomsIDs</span><span class="s">)</span> <span class="s">{</span>
 279     <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetEdgesProperty</span><span class="s">(</span><span class="q">&#39;Bond&#39;</span><span class="cm">,</span> <span class="i">@EdgesAtomsIDs</span><span class="s">)</span><span class="sc">;</span>
 280   <span class="s">}</span>
 281   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@Bonds</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@Bonds</span><span class="sc">;</span>
 282 <span class="s">}</span>
 283 
 284 <span class="c"># Get number of atoms in molecule...</span>
<a name="GetNumOfAtoms-"></a> 285 <span class="k">sub </span><span class="m">GetNumOfAtoms</span> <span class="s">{</span>
 286   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 287   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfAtoms</span><span class="s">)</span><span class="sc">;</span>
 288 
 289   <span class="i">$NumOfAtoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 290 
 291   <span class="k">return</span> <span class="i">$NumOfAtoms</span><span class="sc">;</span>
 292 <span class="s">}</span>
 293 
 294 <span class="c"># Get number of bonds in molecule...</span>
<a name="GetNumOfBonds-"></a> 295 <span class="k">sub </span><span class="m">GetNumOfBonds</span> <span class="s">{</span>
 296   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 297   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfBonds</span><span class="s">)</span><span class="sc">;</span>
 298 
 299   <span class="i">$NumOfBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 300 
 301   <span class="k">return</span> <span class="i">$NumOfBonds</span><span class="sc">;</span>
 302 <span class="s">}</span>
 303 
 304 <span class="c"># Get number of heavy atoms in molecule...</span>
<a name="GetNumOfHeavyAtoms-"></a> 305 <span class="k">sub </span><span class="m">GetNumOfHeavyAtoms</span> <span class="s">{</span>
 306   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 307 
 308   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 309 <span class="s">}</span>
 310 
 311 <span class="c"># Get number of non-hydrogen atoms in molecule...</span>
<a name="GetNumOfNonHydrogenAtoms-"></a> 312 <span class="k">sub </span><span class="m">GetNumOfNonHydrogenAtoms</span> <span class="s">{</span>
 313   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 314   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfNonHydrogenAtoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span><span class="sc">;</span>
 315 
 316   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 317   <span class="i">$NumOfNonHydrogenAtoms</span> = <span class="n">0</span><span class="sc">;</span>
 318   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 319     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 320       <span class="i">$NumOfNonHydrogenAtoms</span>++<span class="sc">;</span>
 321     <span class="s">}</span>
 322   <span class="s">}</span>
 323   <span class="k">return</span> <span class="i">$NumOfNonHydrogenAtoms</span><span class="sc">;</span>
 324 <span class="s">}</span>
 325 
 326 <span class="c"># Get number of hydrogen atoms in molecule...</span>
<a name="GetNumOfHydrogenAtoms-"></a> 327 <span class="k">sub </span><span class="m">GetNumOfHydrogenAtoms</span> <span class="s">{</span>
 328   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 329   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfHydrogenAtoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span><span class="sc">;</span>
 330 
 331   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 332   <span class="i">$NumOfHydrogenAtoms</span> = <span class="n">0</span><span class="sc">;</span>
 333   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 334     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 335       <span class="i">$NumOfHydrogenAtoms</span>++<span class="sc">;</span>
 336     <span class="s">}</span>
 337   <span class="s">}</span>
 338   <span class="k">return</span> <span class="i">$NumOfHydrogenAtoms</span><span class="sc">;</span>
 339 <span class="s">}</span>
 340 
 341 <span class="c"># Get number of missing hydrogen atoms in molecule...</span>
<a name="GetNumOfMissingHydrogenAtoms-"></a> 342 <span class="k">sub </span><span class="m">GetNumOfMissingHydrogenAtoms</span> <span class="s">{</span>
 343   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 344   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfMissingHydrogenAtoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span><span class="sc">;</span>
 345 
 346   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 347   <span class="i">$NumOfMissingHydrogenAtoms</span> = <span class="n">0</span><span class="sc">;</span>
 348   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 349     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 350       <span class="i">$NumOfMissingHydrogenAtoms</span> += <span class="i">$Atom</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 351     <span class="s">}</span>
 352   <span class="s">}</span>
 353   <span class="k">return</span> <span class="i">$NumOfMissingHydrogenAtoms</span><span class="sc">;</span>
 354 <span class="s">}</span>
 355 
 356 <span class="c"># Add bond...</span>
<a name="AddBond-"></a> 357 <span class="k">sub </span><span class="m">AddBond</span> <span class="s">{</span>
 358   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 359   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
 360 
 361   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 362   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Atom1</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$Atom2</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 363     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddBond: No bond added: Both atoms must be specified...&quot;</span><span class="sc">;</span>
 364     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 365   <span class="s">}</span>
 366   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$Atom1</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$Atom2</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 367     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddBond: No bond added: Both atoms must be present...&quot;</span><span class="sc">;</span>
 368     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 369   <span class="s">}</span>
 370   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasBond</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 371     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddBond: No bond added: Bond already exists...&quot;</span><span class="sc">;</span>
 372     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 373   <span class="s">}</span>
 374   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_AddBond</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
 375 <span class="s">}</span>
 376 
 377 <span class="c"># Add bond...</span>
<a name="_AddBond-"></a> 378 <span class="k">sub </span><span class="m">_AddBond</span> <span class="s">{</span>
 379   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 380 
 381   <span class="c"># Assign bond to this molecule...</span>
 382   <span class="i">$Bond</span><span class="i">-&gt;_SetMolecule</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
 383 
 384   <span class="c"># Add it to the graph as an edge...</span>
 385   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 386   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 387   <span class="i">$AtomID1</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">$AtomID2</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 388   <span class="i">$This</span><span class="i">-&gt;AddEdge</span><span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 389   <span class="i">$This</span><span class="i">-&gt;SetEdgeProperty</span><span class="s">(</span><span class="q">&#39;Bond&#39;</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 390 
 391   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 392 <span class="s">}</span>
 393 
 394 <span class="c"># Add Bonds...</span>
<a name="AddBonds-"></a> 395 <span class="k">sub </span><span class="m">AddBonds</span> <span class="s">{</span>
 396   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 397 
 398   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
 399     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;AddBonds: No bonds added: Bonds list must be specified...&quot;</span><span class="sc">;</span>
 400     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 401   <span class="s">}</span>
 402   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
 403   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
 404     <span class="i">$This</span><span class="i">-&gt;AddBond</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
 405   <span class="s">}</span>
 406   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 407 <span class="s">}</span>
 408 
 409 <span class="c"># Create a bond and add it to molecule...</span>
<a name="NewBond-"></a> 410 <span class="k">sub </span><span class="m">NewBond</span> <span class="s">{</span>
 411   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 412   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
 413 
 414   <span class="i">$Bond</span> = <span class="i">new</span> <span class="i">Bond</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
 415   <span class="i">$This</span><span class="i">-&gt;AddBond</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
 416 
 417   <span class="k">return</span> <span class="i">$Bond</span><span class="sc">;</span>
 418 <span class="s">}</span>
 419 
 420 <span class="c"># Delete a bond...</span>
<a name="DeleteBond-"></a> 421 <span class="k">sub </span><span class="m">DeleteBond</span> <span class="s">{</span>
 422   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 423 
 424   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Bond</span><span class="s">)</span> <span class="s">{</span>
 425     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DeleteBond: No bond deleted: Bond must be specified...&quot;</span><span class="sc">;</span>
 426     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 427   <span class="s">}</span>
 428   <span class="c"># Does the bond exist in molecule?</span>
 429   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasBond</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 430     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DeleteBond: No bond deleted: Bond doesn&#39;t exist...&quot;</span><span class="sc">;</span>
 431     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 432   <span class="s">}</span>
 433   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_DeleteBond</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
 434 <span class="s">}</span>
 435 
 436 <span class="c"># Delete bond...</span>
<a name="_DeleteBond-"></a> 437 <span class="k">sub </span><span class="m">_DeleteBond</span> <span class="s">{</span>
 438   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 439 
 440   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 441   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 442   <span class="i">$AtomID1</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">$AtomID2</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 443   <span class="i">$This</span><span class="i">-&gt;DeleteEdge</span><span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 444 
 445   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 446 <span class="s">}</span>
 447 
 448 <span class="c"># Delete bonds...</span>
<a name="DeleteBonds-"></a> 449 <span class="k">sub </span><span class="m">DeleteBonds</span> <span class="s">{</span>
 450   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 451 
 452   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
 453     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;DeleteBonds: No bonds added: Bonds list must be specified...&quot;</span><span class="sc">;</span>
 454     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 455   <span class="s">}</span>
 456   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
 457   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span> <span class="s">{</span>
 458     <span class="i">$This</span><span class="i">-&gt;DeleteBond</span><span class="s">(</span><span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
 459   <span class="s">}</span>
 460 
 461   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 462 <span class="s">}</span>
 463 
 464 <span class="c"># Has bond...</span>
<a name="HasBond-"></a> 465 <span class="k">sub </span><span class="m">HasBond</span> <span class="s">{</span>
 466   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 467   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
 468 
 469   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 470   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$Atom1</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$Atom2</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 471     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 472   <span class="s">}</span>
 473   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Bond</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 474     <span class="c"># It&#39;s not in molecule...</span>
 475     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 476   <span class="s">}</span>
 477   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$Molecule</span><span class="s">)</span><span class="sc">;</span>
 478   <span class="i">$AtomID1</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">$AtomID2</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 479   <span class="i">$Molecule</span> = <span class="i">$Bond</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 480 
 481   <span class="k">return</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasEdge</span><span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span> == <span class="i">$Molecule</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 482 <span class="s">}</span>
 483 
 484 <span class="c"># Get atom neighbors...</span>
<a name="_GetAtomNeighbors-"></a> 485 <span class="k">sub </span><span class="m">_GetAtomNeighbors</span> <span class="s">{</span>
 486   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 487 
 488   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
 489 
 490   <span class="i">@Atoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 491   <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 492   <span class="i">@AtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 493   <span class="k">if</span> <span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span> <span class="s">{</span>
 494     <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetVerticesProperty</span><span class="s">(</span><span class="q">&#39;Atom&#39;</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
 495   <span class="s">}</span>
 496   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@Atoms</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@Atoms</span><span class="sc">;</span>
 497 <span class="s">}</span>
 498 
 499 <span class="c"># Get atom bonds...</span>
<a name="_GetAtomBonds-"></a> 500 <span class="k">sub </span><span class="m">_GetAtomBonds</span> <span class="s">{</span>
 501   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 502   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
 503 
 504   <span class="i">@Bonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 505   <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 506   <span class="i">@AtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetEdges</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
 507   <span class="k">if</span> <span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span> <span class="s">{</span>
 508     <span class="i">@Bonds</span> = <span class="i">$This</span><span class="i">-&gt;GetEdgesProperty</span><span class="s">(</span><span class="q">&#39;Bond&#39;</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
 509   <span class="s">}</span>
 510   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@Bonds</span> <span class="co">:</span> <span class="k">scalar</span> <span class="i">@Bonds</span><span class="sc">;</span>
 511 <span class="s">}</span>
 512 
 513 <span class="c"># Get bond to specified atom...</span>
<a name="_GetBondToAtom-"></a> 514 <span class="k">sub </span><span class="m">_GetBondToAtom</span> <span class="s">{</span>
 515   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 516   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 517 
 518   <span class="i">$AtomID1</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 519   <span class="i">$AtomID2</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 520 
 521   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetEdgeProperty</span><span class="s">(</span><span class="q">&#39;Bond&#39;</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 522 <span class="s">}</span>
 523 
 524 <span class="c"># Are two specified atoms bonded?</span>
<a name="_IsBondedToAtom-"></a> 525 <span class="k">sub </span><span class="m">_IsBondedToAtom</span> <span class="s">{</span>
 526   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 527   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 528 
 529   <span class="i">$AtomID1</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 530   <span class="i">$AtomID2</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 531 
 532   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;HasEdgeProperty</span><span class="s">(</span><span class="q">&#39;Bond&#39;</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
 533 <span class="s">}</span>
 534 
 535 <span class="c"># Add hydrogens to each atoms in molecule and return total number of hydrogens added...</span>
<a name="AddHydrogens-"></a> 536 <span class="k">sub </span><span class="m">AddHydrogens</span> <span class="s">{</span>
 537   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 538 
 539   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_AddHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 540 <span class="s">}</span>
 541 
 542 <span class="c"># Add hydrogens to polar atoms (N, O, P, S) in molecule and return total number of hydrogens added...</span>
<a name="AddPolarHydrogens-"></a> 543 <span class="k">sub </span><span class="m">AddPolarHydrogens</span> <span class="s">{</span>
 544   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 545   <span class="k">my</span><span class="s">(</span><span class="i">$PolarHydrogensOnly</span><span class="s">)</span> = <span class="n">1</span><span class="sc">;</span>
 546 
 547   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_AddHydrogens</span><span class="s">(</span><span class="i">$PolarHydrogensOnly</span><span class="s">)</span><span class="sc">;</span>
 548 <span class="s">}</span>
 549 
 550 <span class="c"># Add all the hydrogens or hydrogens for polar atoms only...</span>
 551 <span class="c">#</span>
 552 <span class="c"># Note:</span>
 553 <span class="c">#   . The current release of MayaChemTools doesn&#39;t assign any hydrogen positions.</span>
 554 <span class="c">#</span>
<a name="_AddHydrogens-"></a> 555 <span class="k">sub </span><span class="m">_AddHydrogens</span> <span class="s">{</span>
 556   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PolarHydrogensOnly</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 557   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$NumOfHydrogensAdded</span><span class="cm">,</span> <span class="i">$HydrogenPositionsWarning</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span><span class="sc">;</span>
 558 
 559   <span class="k">if</span> <span class="s">(</span>! <span class="k">defined</span> <span class="i">$PolarHydrogensOnly</span><span class="s">)</span> <span class="s">{</span>
 560     <span class="i">$PolarHydrogensOnly</span> = <span class="n">0</span><span class="sc">;</span>
 561   <span class="s">}</span>
 562 
 563   <span class="i">$NumOfHydrogensAdded</span> = <span class="n">0</span><span class="sc">;</span>
 564   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 565   <span class="i">$HydrogenPositionsWarning</span> = <span class="n">0</span><span class="sc">;</span>
 566 
 567   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 568     <span class="k">if</span> <span class="s">(</span><span class="i">$PolarHydrogensOnly</span><span class="s">)</span> <span class="s">{</span>
 569       <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsPolarAtom</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 570         <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 571       <span class="s">}</span>
 572     <span class="s">}</span>
 573     <span class="i">$NumOfHydrogensAdded</span> += <span class="i">$Atom</span><span class="i">-&gt;AddHydrogens</span><span class="s">(</span><span class="i">$HydrogenPositionsWarning</span><span class="s">)</span><span class="sc">;</span>
 574   <span class="s">}</span>
 575   <span class="k">return</span> <span class="i">$NumOfHydrogensAdded</span><span class="sc">;</span>
 576 <span class="s">}</span>
 577 
 578 <span class="c"># Delete all hydrogens atoms in molecule and return total number of hydrogens removed...</span>
<a name="DeleteHydrogens-"></a> 579 <span class="k">sub </span><span class="m">DeleteHydrogens</span> <span class="s">{</span>
 580   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 581 
 582   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_DeleteHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 583 <span class="s">}</span>
 584 
 585 <span class="c"># Delete hydrogens to polar atoms (N, O, P, S) in molecule and return total number of hydrogens removed...</span>
<a name="DeletePolarHydrogens-"></a> 586 <span class="k">sub </span><span class="m">DeletePolarHydrogens</span> <span class="s">{</span>
 587   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 588   <span class="k">my</span><span class="s">(</span><span class="i">$PolarHydrogensOnly</span><span class="s">)</span> = <span class="n">1</span><span class="sc">;</span>
 589 
 590   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_DeleteHydrogens</span><span class="s">(</span><span class="i">$PolarHydrogensOnly</span><span class="s">)</span><span class="sc">;</span>
 591 <span class="s">}</span>
 592 
 593 <span class="c"># Delete all hydrogens atoms in molecule and return total number of hydrogens removed...</span>
<a name="_DeleteHydrogens-"></a> 594 <span class="k">sub </span><span class="m">_DeleteHydrogens</span> <span class="s">{</span>
 595   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PolarHydrogensOnly</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 596   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$NumOfHydrogensRemoved</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span><span class="sc">;</span>
 597 
 598   <span class="k">if</span> <span class="s">(</span>! <span class="k">defined</span> <span class="i">$PolarHydrogensOnly</span><span class="s">)</span> <span class="s">{</span>
 599     <span class="i">$PolarHydrogensOnly</span> = <span class="n">0</span><span class="sc">;</span>
 600   <span class="s">}</span>
 601 
 602   <span class="i">$NumOfHydrogensRemoved</span> = <span class="n">0</span><span class="sc">;</span>
 603   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 604 
 605   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 606     <span class="k">if</span> <span class="s">(</span><span class="i">$PolarHydrogensOnly</span><span class="s">)</span> <span class="s">{</span>
 607       <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsPolarHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 608         <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 609       <span class="s">}</span>
 610     <span class="s">}</span>
 611     <span class="k">elsif</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 612       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 613     <span class="s">}</span>
 614     <span class="i">$This</span><span class="i">-&gt;_DeleteAtom</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 615     <span class="i">$NumOfHydrogensRemoved</span>++<span class="sc">;</span>
 616   <span class="s">}</span>
 617   <span class="k">return</span> <span class="i">$NumOfHydrogensRemoved</span><span class="sc">;</span>
 618 <span class="s">}</span>
 619 
 620 <span class="c"># Get molecular weight by summing up atomic weights of all the atoms...</span>
<a name="GetMolecularWeight-"></a> 621 <span class="k">sub </span><span class="m">GetMolecularWeight</span> <span class="s">{</span>
 622   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 623   <span class="k">my</span><span class="s">(</span><span class="i">$MolecularWeight</span><span class="cm">,</span> <span class="i">$AtomicWeight</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 624 
 625   <span class="i">$IncludeMissingHydrogens</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> ? <span class="i">$IncludeMissingHydrogens</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
 626 
 627   <span class="i">$MolecularWeight</span> = <span class="n">0</span><span class="sc">;</span>
 628   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 629   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 630     <span class="i">$AtomicWeight</span> = <span class="i">$Atom</span><span class="i">-&gt;GetAtomicWeight</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 631     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AtomicWeight</span><span class="s">)</span> <span class="s">{</span>
 632       <span class="i">$MolecularWeight</span> += <span class="i">$AtomicWeight</span><span class="sc">;</span>
 633     <span class="s">}</span>
 634   <span class="s">}</span>
 635 
 636   <span class="k">if</span> <span class="s">(</span>!<span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> <span class="s">{</span>
 637     <span class="k">return</span> <span class="i">$MolecularWeight</span><span class="sc">;</span>
 638   <span class="s">}</span>
 639 
 640   <span class="c"># Account for missing hydrogen atoms...</span>
 641   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfMissingHydrogenAtoms</span><span class="s">)</span><span class="sc">;</span>
 642 
 643   <span class="i">$NumOfMissingHydrogenAtoms</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfMissingHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 644   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfMissingHydrogenAtoms</span><span class="s">)</span> <span class="s">{</span>
 645     <span class="i">$MolecularWeight</span> += <span class="i">$NumOfMissingHydrogenAtoms</span> * <span class="i">PeriodicTable::GetElementAtomicWeight</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 646   <span class="s">}</span>
 647 
 648   <span class="k">return</span> <span class="i">$MolecularWeight</span><span class="sc">;</span>
 649 <span class="s">}</span>
 650 
 651 <span class="c"># Get exact mass by summing up exact masses of all the atoms...</span>
<a name="GetExactMass-"></a> 652 <span class="k">sub </span><span class="m">GetExactMass</span> <span class="s">{</span>
 653   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 654   <span class="k">my</span><span class="s">(</span><span class="i">$ExactMass</span><span class="cm">,</span> <span class="i">$AtomicMass</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 655 
 656   <span class="i">$IncludeMissingHydrogens</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> ? <span class="i">$IncludeMissingHydrogens</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
 657 
 658   <span class="i">$ExactMass</span> = <span class="n">0</span><span class="sc">;</span>
 659   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 660   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 661     <span class="i">$AtomicMass</span> = <span class="i">$Atom</span><span class="i">-&gt;GetExactMass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 662     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AtomicMass</span><span class="s">)</span> <span class="s">{</span>
 663       <span class="i">$ExactMass</span> += <span class="i">$AtomicMass</span><span class="sc">;</span>
 664     <span class="s">}</span>
 665   <span class="s">}</span>
 666 
 667   <span class="k">if</span> <span class="s">(</span>!<span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> <span class="s">{</span>
 668     <span class="k">return</span> <span class="i">$ExactMass</span><span class="sc">;</span>
 669   <span class="s">}</span>
 670 
 671   <span class="c"># Account for missing hydrogen atoms...</span>
 672   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfMissingHydrogenAtoms</span><span class="s">)</span><span class="sc">;</span>
 673 
 674   <span class="i">$NumOfMissingHydrogenAtoms</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfMissingHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 675   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfMissingHydrogenAtoms</span><span class="s">)</span> <span class="s">{</span>
 676     <span class="i">$ExactMass</span> += <span class="i">$NumOfMissingHydrogenAtoms</span> * <span class="i">PeriodicTable::GetElementMostAbundantNaturalIsotopeMass</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 677   <span class="s">}</span>
 678 
 679   <span class="k">return</span> <span class="i">$ExactMass</span><span class="sc">;</span>
 680 <span class="s">}</span>
 681 
 682 <span class="c"># Get net formal charge on the molecule using one of the following two methods:</span>
 683 <span class="c">#   . Using explicitly set FormalCharge property</span>
 684 <span class="c">#   . Adding up formal charge on each atom in the molecule</span>
 685 <span class="c">#</span>
 686 <span class="c"># Caveats:</span>
 687 <span class="c">#   . FormalCharge is different from Charge property of the molecule which corresponds to</span>
 688 <span class="c">#     sum of partial atomic charges explicitly set for each atom using a specific methodology.</span>
 689 <span class="c">#</span>
<a name="GetFormalCharge-"></a> 690 <span class="k">sub </span><span class="m">GetFormalCharge</span> <span class="s">{</span>
 691   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 692 
 693   <span class="c"># Is FormalCharge property explicitly set?</span>
 694   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;FormalCharge&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 695     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;FormalCharge&#39;</span><span class="s">)</span><span class="sc">;</span>
 696   <span class="s">}</span>
 697   <span class="k">my</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$AtomicFormalCharge</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 698 
 699   <span class="i">$FormalCharge</span> = <span class="n">0</span><span class="sc">;</span>
 700   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 701   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 702     <span class="i">$AtomicFormalCharge</span> = <span class="i">$Atom</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 703     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AtomicFormalCharge</span><span class="s">)</span> <span class="s">{</span>
 704       <span class="i">$FormalCharge</span> += <span class="i">$AtomicFormalCharge</span><span class="sc">;</span>
 705     <span class="s">}</span>
 706   <span class="s">}</span>
 707   <span class="k">return</span> <span class="i">$FormalCharge</span><span class="sc">;</span>
 708 <span class="s">}</span>
 709 
 710 <span class="c"># Get net charge on the molecule using one of the following two methods:</span>
 711 <span class="c">#   . Using explicitly set Charge property</span>
 712 <span class="c">#   . Adding up charge on each atom in the molecule</span>
 713 <span class="c">#</span>
 714 <span class="c"># Caveats:</span>
 715 <span class="c">#   . FormalCharge is different from Charge property of the molecule which corresponds to</span>
 716 <span class="c">#     sum of partial atomic charges explicitly set for each atom using a specific methodology.</span>
 717 <span class="c">#</span>
<a name="GetCharge-"></a> 718 <span class="k">sub </span><span class="m">GetCharge</span> <span class="s">{</span>
 719   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 720 
 721   <span class="c"># Is Charge property explicitly set?</span>
 722   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Charge&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 723     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Charge&#39;</span><span class="s">)</span><span class="sc">;</span>
 724   <span class="s">}</span>
 725   <span class="k">my</span><span class="s">(</span><span class="i">$Charge</span><span class="cm">,</span> <span class="i">$AtomicCharge</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 726 
 727   <span class="i">$Charge</span> = <span class="n">0</span><span class="sc">;</span>
 728   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 729   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 730     <span class="i">$AtomicCharge</span> = <span class="i">$Atom</span><span class="i">-&gt;GetCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 731     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AtomicCharge</span><span class="s">)</span> <span class="s">{</span>
 732       <span class="i">$Charge</span> += <span class="i">$AtomicCharge</span><span class="sc">;</span>
 733     <span class="s">}</span>
 734   <span class="s">}</span>
 735   <span class="k">return</span> <span class="i">$Charge</span><span class="sc">;</span>
 736 <span class="s">}</span>
 737 
 738 <span class="c"># Get total SpinMultiplicity for the molecule using one of the following two methods:</span>
 739 <span class="c">#   . Using explicitly set SpinMultiplicity property</span>
 740 <span class="c">#   . Adding up SpinMultiplicity on each atom in the molecule</span>
 741 <span class="c">#</span>
 742 <span class="c">#</span>
<a name="GetSpinMultiplicity-"></a> 743 <span class="k">sub </span><span class="m">GetSpinMultiplicity</span> <span class="s">{</span>
 744   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 745 
 746   <span class="c"># Is SpinMultiplicity property explicitly set?</span>
 747   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;SpinMultiplicity&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 748     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;SpinMultiplicity&#39;</span><span class="s">)</span><span class="sc">;</span>
 749   <span class="s">}</span>
 750   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicSpinMultiplicity</span><span class="cm">,</span> <span class="i">$SpinMultiplicity</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 751 
 752   <span class="i">$SpinMultiplicity</span> = <span class="n">0</span><span class="sc">;</span>
 753   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 754   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 755     <span class="i">$AtomicSpinMultiplicity</span> = <span class="i">$Atom</span><span class="i">-&gt;GetSpinMultiplicity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 756     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AtomicSpinMultiplicity</span><span class="s">)</span> <span class="s">{</span>
 757       <span class="i">$SpinMultiplicity</span> += <span class="i">$AtomicSpinMultiplicity</span><span class="sc">;</span>
 758     <span class="s">}</span>
 759   <span class="s">}</span>
 760   <span class="k">return</span> <span class="i">$SpinMultiplicity</span><span class="sc">;</span>
 761 <span class="s">}</span>
 762 
 763 <span class="c"># Get total FreeRadicalElectrons for the molecule using one of the following two methods:</span>
 764 <span class="c">#   . Using explicitly set FreeRadicalElectrons property</span>
 765 <span class="c">#   . Adding up FreeRadicalElectrons on each atom in the molecule</span>
 766 <span class="c">#</span>
 767 <span class="c">#</span>
<a name="GetFreeRadicalElectrons-"></a> 768 <span class="k">sub </span><span class="m">GetFreeRadicalElectrons</span> <span class="s">{</span>
 769   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 770 
 771   <span class="c"># Is FreeRadicalElectrons property explicitly set?</span>
 772   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;FreeRadicalElectrons&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 773     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;FreeRadicalElectrons&#39;</span><span class="s">)</span><span class="sc">;</span>
 774   <span class="s">}</span>
 775   <span class="k">my</span><span class="s">(</span><span class="i">$AtomicFreeRadicalElectrons</span><span class="cm">,</span> <span class="i">$FreeRadicalElectrons</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 776 
 777   <span class="i">$FreeRadicalElectrons</span> = <span class="n">0</span><span class="sc">;</span>
 778   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 779   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 780     <span class="i">$AtomicFreeRadicalElectrons</span> = <span class="i">$Atom</span><span class="i">-&gt;GetFreeRadicalElectrons</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 781     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AtomicFreeRadicalElectrons</span><span class="s">)</span> <span class="s">{</span>
 782       <span class="i">$FreeRadicalElectrons</span> += <span class="i">$AtomicFreeRadicalElectrons</span><span class="sc">;</span>
 783     <span class="s">}</span>
 784   <span class="s">}</span>
 785   <span class="k">return</span> <span class="i">$FreeRadicalElectrons</span><span class="sc">;</span>
 786 <span class="s">}</span>
 787 
 788 <span class="c"># Set valence model...</span>
 789 <span class="c">#</span>
<a name="SetValenceModel-"></a> 790 <span class="k">sub </span><span class="m">SetValenceModel</span> <span class="s">{</span>
 791   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ValenceModel</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 792 
 793   <span class="k">if</span> <span class="s">(</span><span class="i">$ValenceModel</span> !~ <span class="q">/^(MDLValenceModel|DaylightValenceModel|InternalValenceModel|MayaChemToolsValenceModel)$/i</span><span class="s">)</span> <span class="s">{</span>
 794     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetValenceModel: The current release of MayaChemTools doesn&#39;t support the specified valence model $ValenceModel. Supported valence models: MDLValenceModel, DaylightValenceModel, InternalValenceModel or MayaChemToolsValenceModel. Using internal valence model...&quot;</span><span class="sc">;</span>
 795     <span class="i">$ValenceModel</span> = <span class="q">&#39;InternalValenceModel&#39;</span><span class="sc">;</span>
 796   <span class="s">}</span>
 797 
 798   <span class="i">$This</span><span class="i">-&gt;SetProperty</span><span class="s">(</span><span class="q">&#39;ValenceModel&#39;</span><span class="cm">,</span> <span class="i">$ValenceModel</span><span class="s">)</span><span class="sc">;</span>
 799 
 800   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 801 <span class="s">}</span>
 802 
 803 <span class="c"># Get valence model...</span>
 804 <span class="c">#</span>
<a name="GetValenceModel-"></a> 805 <span class="k">sub </span><span class="m">GetValenceModel</span> <span class="s">{</span>
 806   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 807 
 808   <span class="c"># Is ValenceModel property explicitly set?</span>
 809   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;ValenceModel&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 810     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;ValenceModel&#39;</span><span class="s">)</span><span class="sc">;</span>
 811   <span class="s">}</span>
 812 
 813   <span class="c"># Used internal valence model as default model...</span>
 814   <span class="k">return</span> <span class="q">&#39;InternalValenceModel&#39;</span><span class="sc">;</span>
 815 <span class="s">}</span>
 816 
 817 <span class="c"># Get molecular formula by collecting information about all atoms in the molecule and</span>
 818 <span class="c"># composing the formula using Hills ordering system:</span>
 819 <span class="c">#   . C shows up first and H follows assuming C is present</span>
 820 <span class="c">#   . All other standard elements are sorted alphanumerically</span>
 821 <span class="c">#   . All other non-stanard atom symbols are also sorted alphanumerically and follow standard elements</span>
 822 <span class="c">#</span>
 823 <span class="c"># Caveats:</span>
 824 <span class="c">#   . By default, missing hydrogens and nonelements are also included</span>
 825 <span class="c">#   . Elements for disconnected fragments are combined into the same formula</span>
 826 <span class="c">#</span>
 827 <span class="c"># Handle formula generation for disconnected structures. e.g: molecule generated by</span>
 828 <span class="c"># [Na+].[O-]c1ccccc1</span>
 829 <span class="c">#</span>
<a name="GetMolecularFormula-"></a> 830 <span class="k">sub </span><span class="m">GetMolecularFormula</span> <span class="s">{</span>
 831   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IncludeMissingHydrogens</span><span class="cm">,</span> <span class="i">$IncludeNonElements</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 832   <span class="k">my</span><span class="s">(</span><span class="i">$MolecularFormula</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$ElementsCountRef</span><span class="cm">,</span> <span class="i">$NonElementsCountRef</span><span class="s">)</span><span class="sc">;</span>
 833 
 834   <span class="i">$IncludeMissingHydrogens</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> ? <span class="i">$IncludeMissingHydrogens</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
 835   <span class="i">$IncludeNonElements</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$IncludeNonElements</span><span class="s">)</span> ? <span class="i">$IncludeNonElements</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
 836 
 837   <span class="c"># Get elements count and setup molecular formula...</span>
 838   <span class="s">(</span><span class="i">$ElementsCountRef</span><span class="cm">,</span> <span class="i">$NonElementsCountRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetElementsAndNonElements</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span><span class="sc">;</span>
 839   <span class="i">$MolecularFormula</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 840 
 841   <span class="c"># Count C and H first...</span>
 842   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ElementsCountRef</span>-&gt;{<span class="w">C</span>} <span class="s">)</span> <span class="s">{</span>
 843     <span class="i">$MolecularFormula</span> .= <span class="q">&#39;C&#39;</span> . <span class="s">(</span><span class="i">$ElementsCountRef</span>-&gt;{<span class="w">C</span>} &gt; <span class="n">1</span> ? <span class="i">$ElementsCountRef</span>-&gt;{<span class="w">C</span>} <span class="co">:</span> <span class="q">&#39;&#39;</span><span class="s">)</span><span class="sc">;</span>
 844     <span class="k">delete</span> <span class="i">$ElementsCountRef</span>-&gt;{<span class="w">C</span>}<span class="sc">;</span>
 845 
 846     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ElementsCountRef</span>-&gt;{<span class="w">H</span>} <span class="s">)</span> <span class="s">{</span>
 847       <span class="i">$MolecularFormula</span> .= <span class="q">&#39;H&#39;</span> . <span class="s">(</span><span class="i">$ElementsCountRef</span>-&gt;{<span class="w">H</span>} &gt; <span class="n">1</span> ? <span class="i">$ElementsCountRef</span>-&gt;{<span class="w">H</span>} <span class="co">:</span> <span class="q">&#39;&#39;</span><span class="s">)</span><span class="sc">;</span>
 848       <span class="k">delete</span> <span class="i">$ElementsCountRef</span>-&gt;{<span class="w">H</span>}<span class="sc">;</span>
 849     <span class="s">}</span>
 850   <span class="s">}</span>
 851 
 852   <span class="c"># Sort elements...</span>
 853   <span class="k">for</span> <span class="i">$AtomSymbol</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span><span class="i">$a</span> <span class="k">cmp</span> <span class="i">$b</span><span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$ElementsCountRef</span>}<span class="s">)</span> <span class="s">{</span>
 854     <span class="i">$MolecularFormula</span> .= <span class="i">$AtomSymbol</span> . <span class="s">(</span><span class="i">$ElementsCountRef</span>-&gt;{<span class="i">$AtomSymbol</span>} &gt; <span class="n">1</span> ? <span class="i">$ElementsCountRef</span>-&gt;{<span class="i">$AtomSymbol</span>} <span class="co">:</span> <span class="q">&#39;&#39;</span><span class="s">)</span><span class="sc">;</span>
 855   <span class="s">}</span>
 856 
 857   <span class="c"># Sort non-elements...</span>
 858   <span class="k">if</span> <span class="s">(</span><span class="i">$IncludeNonElements</span><span class="s">)</span> <span class="s">{</span>
 859     <span class="k">for</span> <span class="i">$AtomSymbol</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span><span class="i">$a</span> <span class="k">cmp</span> <span class="i">$b</span><span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$NonElementsCountRef</span>}<span class="s">)</span> <span class="s">{</span>
 860       <span class="i">$MolecularFormula</span> .= <span class="i">$AtomSymbol</span> . <span class="s">(</span><span class="i">$NonElementsCountRef</span>-&gt;{<span class="i">$AtomSymbol</span>} &gt; <span class="n">1</span> ? <span class="i">$NonElementsCountRef</span>-&gt;{<span class="i">$AtomSymbol</span>} <span class="co">:</span> <span class="q">&#39;&#39;</span><span class="s">)</span><span class="sc">;</span>
 861     <span class="s">}</span>
 862   <span class="s">}</span>
 863 
 864   <span class="c"># Check formal charge...</span>
 865   <span class="k">my</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span><span class="sc">;</span>
 866   <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 867   <span class="k">if</span> <span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span> <span class="s">{</span>
 868     <span class="c"># Setup formal charge string...</span>
 869     <span class="k">my</span><span class="s">(</span><span class="i">$FormalChargeString</span><span class="s">)</span><span class="sc">;</span>
 870     <span class="k">if</span> <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">1</span> <span class="s">)</span> <span class="s">{</span>
 871       <span class="i">$FormalChargeString</span> =  <span class="q">&quot;+&quot;</span><span class="sc">;</span>
 872     <span class="s">}</span>
 873     <span class="k">elsif</span> <span class="s">(</span><span class="i">$FormalCharge</span> == <span class="n">-1</span> <span class="s">)</span> <span class="s">{</span>
 874       <span class="i">$FormalChargeString</span> =  <span class="q">&quot;-&quot;</span><span class="sc">;</span>
 875     <span class="s">}</span>
 876     <span class="k">else</span> <span class="s">{</span>
 877       <span class="i">$FormalChargeString</span> = <span class="s">(</span><span class="i">$FormalCharge</span> &gt; <span class="n">0</span><span class="s">)</span> ? <span class="s">(</span><span class="q">&quot;+&quot;</span> . <span class="k">abs</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span><span class="s">)</span> <span class="co">:</span> <span class="s">(</span><span class="q">&quot;-&quot;</span> . <span class="k">abs</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
 878     <span class="s">}</span>
 879     <span class="i">$MolecularFormula</span> = <span class="q">&quot;${MolecularFormula}${FormalChargeString}&quot;</span><span class="sc">;</span>
 880   <span class="s">}</span>
 881 
 882   <span class="k">return</span> <span class="i">$MolecularFormula</span><span class="sc">;</span>
 883 <span class="s">}</span>
 884 
 885 <span class="c"># Count elements and non-elements in molecule and return references to hashes</span>
 886 <span class="c"># containing count of elements and non-elements respectively. By default, missing</span>
 887 <span class="c"># hydrogens are not added to the element hash.</span>
 888 <span class="c">#</span>
 889 <span class="c">#</span>
<a name="GetElementsAndNonElements-"></a> 890 <span class="k">sub </span><span class="m">GetElementsAndNonElements</span> <span class="s">{</span>
 891   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 892   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomicNumber</span><span class="cm">,</span> <span class="i">$AtomSymbol</span><span class="cm">,</span> <span class="i">$NumOfMissingHydrogens</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">%ElementsCount</span><span class="cm">,</span> <span class="i">%NonElementsCount</span><span class="s">)</span><span class="sc">;</span>
 893 
 894   <span class="i">$IncludeMissingHydrogens</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> ? <span class="i">$IncludeMissingHydrogens</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 895 
 896   <span class="i">%ElementsCount</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">%NonElementsCount</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 897   <span class="i">$NumOfMissingHydrogens</span> = <span class="n">0</span><span class="sc">;</span>
 898 
 899   <span class="c"># Count elements and non elements...</span>
 900   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 901   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
 902     <span class="i">$AtomicNumber</span> = <span class="i">$Atom</span><span class="i">-&gt;GetAtomicNumber</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 903     <span class="i">$AtomSymbol</span> = <span class="i">$Atom</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 904     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomicNumber</span><span class="s">)</span> <span class="s">{</span>
 905       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ElementsCount</span>{<span class="i">$AtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
 906         <span class="i">$ElementsCount</span>{<span class="i">$AtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
 907       <span class="s">}</span>
 908       <span class="k">else</span> <span class="s">{</span>
 909         <span class="i">$ElementsCount</span>{<span class="i">$AtomSymbol</span>} = <span class="n">1</span><span class="sc">;</span>
 910       <span class="s">}</span>
 911       <span class="k">if</span> <span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> <span class="s">{</span>
 912         <span class="i">$NumOfMissingHydrogens</span> += <span class="i">$Atom</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 913       <span class="s">}</span>
 914     <span class="s">}</span>
 915     <span class="k">else</span> <span class="s">{</span>
 916       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$NonElementsCount</span>{<span class="i">$AtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
 917         <span class="i">$NonElementsCount</span>{<span class="i">$AtomSymbol</span>} += <span class="n">1</span><span class="sc">;</span>
 918       <span class="s">}</span>
 919       <span class="k">else</span> <span class="s">{</span>
 920         <span class="i">$NonElementsCount</span>{<span class="i">$AtomSymbol</span>} = <span class="n">1</span><span class="sc">;</span>
 921       <span class="s">}</span>
 922     <span class="s">}</span>
 923   <span class="s">}</span>
 924   <span class="k">if</span> <span class="s">(</span><span class="i">$IncludeMissingHydrogens</span> &amp;&amp; <span class="i">$NumOfMissingHydrogens</span><span class="s">)</span> <span class="s">{</span>
 925     <span class="i">$AtomSymbol</span> = <span class="q">&#39;H&#39;</span><span class="sc">;</span>
 926     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ElementsCount</span>{<span class="i">$AtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
 927       <span class="i">$ElementsCount</span>{<span class="i">$AtomSymbol</span>} += <span class="i">$NumOfMissingHydrogens</span><span class="sc">;</span>
 928     <span class="s">}</span>
 929     <span class="k">else</span> <span class="s">{</span>
 930       <span class="i">$ElementsCount</span>{<span class="i">$AtomSymbol</span>} = <span class="i">$NumOfMissingHydrogens</span><span class="sc">;</span>
 931     <span class="s">}</span>
 932   <span class="s">}</span>
 933 
 934   <span class="k">return</span> <span class="s">(</span>\<span class="i">%ElementsCount</span><span class="cm">,</span> \<span class="i">%NonElementsCount</span><span class="s">)</span><span class="sc">;</span>
 935 <span class="s">}</span>
 936 
 937 <span class="c"># Get number of element and non-elements in molecule. By default, missing</span>
 938 <span class="c"># hydrogens are not added to element count.</span>
 939 <span class="c">#</span>
<a name="GetNumOfElementsAndNonElements-"></a> 940 <span class="k">sub </span><span class="m">GetNumOfElementsAndNonElements</span> <span class="s">{</span>
 941   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 942   <span class="k">my</span><span class="s">(</span><span class="i">$ElementCount</span><span class="cm">,</span> <span class="i">$NonElementCount</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 943 
 944   <span class="i">$IncludeMissingHydrogens</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> ? <span class="i">$IncludeMissingHydrogens</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 945 
 946   <span class="s">(</span><span class="i">$ElementCount</span><span class="cm">,</span> <span class="i">$NonElementCount</span><span class="s">)</span> = <span class="s">(</span><span class="n">0</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 947 
 948   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 949     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;GetAtomicNumber</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 950       <span class="i">$NonElementCount</span>++<span class="sc">;</span>
 951       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 952     <span class="s">}</span>
 953     <span class="c"># Process element...</span>
 954     <span class="i">$ElementCount</span>++<span class="sc">;</span>
 955     <span class="k">if</span> <span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> <span class="s">{</span>
 956       <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 957         <span class="i">$ElementCount</span> += <span class="i">$Atom</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 958       <span class="s">}</span>
 959     <span class="s">}</span>
 960   <span class="s">}</span>
 961 
 962   <span class="k">return</span> <span class="s">(</span><span class="i">$ElementCount</span><span class="cm">,</span> <span class="i">$NonElementCount</span><span class="s">)</span><span class="sc">;</span>
 963 <span class="s">}</span>
 964 
 965 <span class="c"># Calculate elemental composition and return reference to arrays</span>
 966 <span class="c"># containing elements and their percent composition.</span>
 967 <span class="c">#</span>
 968 <span class="c"># Caveats:</span>
 969 <span class="c">#   . By default, missing hydrogens are included</span>
 970 <span class="c">#   . Non elemnents are ignored</span>
 971 <span class="c">#   . Mass number are ignored</span>
 972 <span class="c">#</span>
<a name="GetElementalComposition-"></a> 973 <span class="k">sub </span><span class="m">GetElementalComposition</span> <span class="s">{</span>
 974   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 975   <span class="k">my</span><span class="s">(</span><span class="i">$MolecularFormula</span><span class="cm">,</span> <span class="i">$IncludeNonElements</span><span class="cm">,</span> <span class="i">$ElementsCountRef</span><span class="cm">,</span> <span class="i">$NonElementsCountRef</span><span class="cm">,</span> <span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementsCompositionRef</span><span class="s">)</span><span class="sc">;</span>
 976 
 977   <span class="i">$IncludeMissingHydrogens</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span> ? <span class="i">$IncludeMissingHydrogens</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
 978 
 979   <span class="i">$IncludeNonElements</span> = <span class="n">0</span><span class="sc">;</span>
 980   <span class="s">(</span><span class="i">$ElementsCountRef</span><span class="cm">,</span> <span class="i">$NonElementsCountRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetElementsAndNonElements</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="s">)</span><span class="sc">;</span>
 981 
 982   <span class="i">$MolecularFormula</span> = <span class="i">$This</span><span class="i">-&gt;GetMolecularFormula</span><span class="s">(</span><span class="i">$IncludeMissingHydrogens</span><span class="cm">,</span> <span class="i">$IncludeNonElements</span><span class="s">)</span><span class="sc">;</span>
 983 
 984   <span class="s">(</span><span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementsCompositionRef</span><span class="s">)</span> = <span class="i">MolecularFormula::CalculateElementalComposition</span><span class="s">(</span><span class="i">$MolecularFormula</span><span class="s">)</span><span class="sc">;</span>
 985 
 986   <span class="k">return</span> <span class="s">(</span><span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementsCompositionRef</span><span class="s">)</span><span class="sc">;</span>
 987 <span class="s">}</span>
 988 
 989 <span class="c"># Using refernece to element and its composition arrays, format composition information</span>
 990 <span class="c"># as: Element: Composition;...</span>
 991 <span class="c">#</span>
<a name="FormatElementalCompositionInformation-"></a> 992 <span class="k">sub </span><span class="m">FormatElementalCompositionInformation</span> <span class="s">{</span>
 993   <span class="k">my</span><span class="s">(</span><span class="i">$FirstParameter</span><span class="cm">,</span> <span class="i">$SecondParameter</span><span class="cm">,</span> <span class="i">$ThirdParameter</span><span class="cm">,</span> <span class="i">$FourthParameter</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 994   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementCompositionRef</span><span class="cm">,</span> <span class="i">$Precision</span><span class="s">)</span><span class="sc">;</span>
 995 
 996   <span class="k">if</span> <span class="s">(</span><span class="i">_IsMolecule</span><span class="s">(</span><span class="i">$FirstParameter</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 997     <span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementCompositionRef</span><span class="cm">,</span> <span class="i">$Precision</span><span class="s">)</span> = <span class="s">(</span><span class="i">$FirstParameter</span><span class="cm">,</span> <span class="i">$SecondParameter</span><span class="cm">,</span> <span class="i">$ThirdParameter</span><span class="cm">,</span> <span class="i">$FourthParameter</span><span class="s">)</span><span class="sc">;</span>
 998   <span class="s">}</span>
 999   <span class="k">else</span> <span class="s">{</span>
1000     <span class="s">(</span><span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementCompositionRef</span><span class="cm">,</span> <span class="i">$Precision</span><span class="s">)</span> = <span class="s">(</span><span class="i">$FirstParameter</span><span class="cm">,</span> <span class="i">$SecondParameter</span><span class="cm">,</span> <span class="i">$ThirdParameter</span><span class="s">)</span><span class="sc">;</span>
1001   <span class="s">}</span>
1002   <span class="k">my</span><span class="s">(</span><span class="i">$FormattedInfo</span><span class="s">)</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
1003 
1004   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$ElementsRef</span><span class="s">)</span> &amp;&amp; <span class="i">@</span>{<span class="i">$ElementsRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1005     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;FormatElementalCompositionInformation: Elements list is not defined or empty...&quot;</span><span class="sc">;</span>
1006     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1007   <span class="s">}</span>
1008   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$ElementCompositionRef</span><span class="s">)</span> &amp;&amp; <span class="i">@</span>{<span class="i">$ElementCompositionRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1009     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;FormatElementalCompositionInformation: Elements composition list is not defined or empty...&quot;</span><span class="sc">;</span>
1010     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1011   <span class="s">}</span>
1012 
1013   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Precision</span><span class="s">)</span> <span class="s">{</span>
1014     <span class="i">$Precision</span> = <span class="n">2</span><span class="sc">;</span>
1015   <span class="s">}</span>
1016 
1017   <span class="i">$FormattedInfo</span> = <span class="i">MolecularFormula::FormatCompositionInfomation</span><span class="s">(</span><span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementCompositionRef</span><span class="cm">,</span> <span class="i">$Precision</span><span class="s">)</span><span class="sc">;</span>
1018 
1019   <span class="k">return</span> <span class="i">$FormattedInfo</span><span class="sc">;</span>
1020 <span class="s">}</span>
1021 
1022 <span class="c"># Copy molecule and its associated data using Storable::dclone and update:</span>
1023 <span class="c">#</span>
1024 <span class="c">#   o Atom references corresponding atoms and bonds objects</span>
1025 <span class="c">#   o Bond object references</span>
1026 <span class="c">#</span>
1027 <span class="c"># Object IDs for Atoms and Bonds don&#39;t get changed. So there is no need to clear</span>
1028 <span class="c"># up any exisiting ring data attached to molecule via graph as vertex IDs.</span>
1029 <span class="c">#</span>
<a name="Copy-"></a>1030 <span class="k">sub </span><span class="m">Copy</span> <span class="s">{</span>
1031   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1032   <span class="k">my</span><span class="s">(</span><span class="i">$NewMolecule</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$NewAtom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="cm">,</span> <span class="i">%AtomsIDsToNewAtoms</span><span class="s">)</span><span class="sc">;</span>
1033 
1034   <span class="i">$NewMolecule</span> = <span class="i">Storable::dclone</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span><span class="sc">;</span>
1035 
1036   <span class="c"># Update atom references stored as vertex property...</span>
1037 
1038   <span class="i">@Atoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1039   <span class="i">%AtomsIDsToNewAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1040 
1041   <span class="i">@AtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1042   <span class="k">if</span> <span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span> <span class="s">{</span>
1043     <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetVerticesProperty</span><span class="s">(</span><span class="q">&#39;Atom&#39;</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
1044   <span class="s">}</span>
1045 
1046   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
1047     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1048 
1049     <span class="c"># Setup a reference to copied atom object...</span>
1050     <span class="i">$NewAtom</span> = <span class="i">$Atom</span><span class="i">-&gt;Copy</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1051     <span class="i">$AtomsIDsToNewAtoms</span>{<span class="i">$AtomID</span>} = <span class="i">$NewAtom</span><span class="sc">;</span>
1052 
1053     <span class="c"># Update atom reference to new atom object...</span>
1054     <span class="i">$NewMolecule</span><span class="i">-&gt;UpdateVertexProperty</span><span class="s">(</span><span class="q">&#39;Atom&#39;</span><span class="cm">,</span> <span class="i">$NewAtom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
1055   <span class="s">}</span>
1056 
1057   <span class="c"># Update bond object and bond atom references stored as edge property...</span>
1058   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$NewBond</span><span class="cm">,</span> <span class="i">$NewAtom1</span><span class="cm">,</span> <span class="i">$NewAtom2</span><span class="cm">,</span> <span class="i">@EdgesAtomsIDs</span><span class="s">)</span><span class="sc">;</span>
1059   <span class="i">@EdgesAtomsIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1060   <span class="i">@EdgesAtomsIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetEdges</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1061   <span class="k">for</span> <span class="s">(</span><span class="i">$Index</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$Index</span> &lt; <span class="i">$#EdgesAtomsIDs</span><span class="sc">;</span> <span class="i">$Index</span> += <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1062     <span class="i">$AtomID1</span> = <span class="i">$EdgesAtomsIDs</span>[<span class="i">$Index</span>]<span class="sc">;</span> <span class="i">$AtomID2</span> = <span class="i">$EdgesAtomsIDs</span>[<span class="i">$Index</span> + <span class="n">1</span>]<span class="sc">;</span>
1063 
1064     <span class="c"># Get reference to bond object...</span>
1065     <span class="i">$Bond</span> = <span class="i">$This</span><span class="i">-&gt;GetEdgeProperty</span><span class="s">(</span><span class="q">&#39;Bond&#39;</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
1066 
1067     <span class="c"># Make a new bond object and update its atom references...</span>
1068     <span class="i">$NewBond</span> = <span class="i">$Bond</span><span class="i">-&gt;Copy</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1069     <span class="i">$NewAtom1</span> = <span class="i">$AtomsIDsToNewAtoms</span>{<span class="i">$AtomID1</span>}<span class="sc">;</span>
1070     <span class="i">$NewAtom2</span> = <span class="i">$AtomsIDsToNewAtoms</span>{<span class="i">$AtomID2</span>}<span class="sc">;</span>
1071     <span class="i">$NewBond</span><span class="i">-&gt;SetAtoms</span><span class="s">(</span><span class="i">$NewAtom1</span><span class="cm">,</span> <span class="i">$NewAtom2</span><span class="s">)</span><span class="sc">;</span>
1072 
1073     <span class="c"># Update bond object reference in the new molecule...</span>
1074     <span class="i">$NewMolecule</span><span class="i">-&gt;UpdateEdgeProperty</span><span class="s">(</span><span class="q">&#39;Bond&#39;</span><span class="cm">,</span> <span class="i">$NewBond</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
1075   <span class="s">}</span>
1076 
1077   <span class="k">return</span> <span class="i">$NewMolecule</span><span class="sc">;</span>
1078 <span class="s">}</span>
1079 
1080 <span class="c"># Get number of connected components...</span>
1081 <span class="c">#</span>
<a name="GetNumOfConnectedComponents-"></a>1082 <span class="k">sub </span><span class="m">GetNumOfConnectedComponents</span> <span class="s">{</span>
1083   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1084   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfComponents</span><span class="s">)</span><span class="sc">;</span>
1085 
1086   <span class="i">$NumOfComponents</span> = <span class="i">$This</span><span class="i">-&gt;GetConnectedComponentsVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1087 
1088   <span class="k">return</span> <span class="i">$NumOfComponents</span><span class="sc">;</span>
1089 <span class="s">}</span>
1090 
1091 <span class="c"># Return a reference to an array containing molecules corresponding</span>
1092 <span class="c"># to connected components sorted in decreasing order of component size...</span>
1093 <span class="c">#</span>
<a name="GetConnectedComponents-"></a>1094 <span class="k">sub </span><span class="m">GetConnectedComponents</span> <span class="s">{</span>
1095   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1096   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">@ComponentMolecules</span><span class="cm">,</span> <span class="i">@ConnectedComponents</span><span class="s">)</span><span class="sc">;</span>
1097 
1098   <span class="i">@ConnectedComponents</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1099   <span class="i">@ConnectedComponents</span> = <span class="i">$This</span><span class="i">-&gt;GetConnectedComponentsVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1100   <span class="i">@ComponentMolecules</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1101 
1102   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#ConnectedComponents</span><span class="s">)</span> <span class="s">{</span>
1103     <span class="k">push</span> <span class="i">@ComponentMolecules</span><span class="cm">,</span> <span class="i">$This</span><span class="i">-&gt;_GetConnectedComponent</span><span class="s">(</span>\<span class="i">@ConnectedComponents</span><span class="cm">,</span> <span class="i">$Index</span><span class="s">)</span><span class="sc">;</span>
1104   <span class="s">}</span>
1105   <span class="k">return</span> <span class="i">@ComponentMolecules</span><span class="sc">;</span>
1106 <span class="s">}</span>
1107 
1108 <span class="c"># Return a reference to largest connected component as a molecule object...</span>
1109 <span class="c">#</span>
<a name="GetLargestConnectedComponent-"></a>1110 <span class="k">sub </span><span class="m">GetLargestConnectedComponent</span> <span class="s">{</span>
1111   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1112   <span class="k">my</span><span class="s">(</span><span class="i">$LargestComponentIndex</span><span class="cm">,</span> <span class="i">@ConnectedComponents</span><span class="s">)</span><span class="sc">;</span>
1113 
1114   <span class="i">$LargestComponentIndex</span> = <span class="n">0</span><span class="sc">;</span>
1115   <span class="i">@ConnectedComponents</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1116   <span class="i">@ConnectedComponents</span> = <span class="i">$This</span><span class="i">-&gt;GetConnectedComponentsVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1117 
1118   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetConnectedComponent</span><span class="s">(</span>\<span class="i">@ConnectedComponents</span><span class="cm">,</span> <span class="i">$LargestComponentIndex</span><span class="s">)</span><span class="sc">;</span>
1119 <span class="s">}</span>
1120 
1121 <span class="c"># Return connected component as a molecule...</span>
1122 <span class="c">#</span>
<a name="_GetConnectedComponent-"></a>1123 <span class="k">sub </span><span class="m">_GetConnectedComponent</span> <span class="s">{</span>
1124   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ConnectedComponentsRef</span><span class="cm">,</span> <span class="i">$ComponentIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1125   <span class="k">my</span><span class="s">(</span><span class="i">$ComponentMolecule</span><span class="s">)</span><span class="sc">;</span>
1126 
1127   <span class="c"># Copy existing molecule...</span>
1128   <span class="i">$ComponentMolecule</span> = <span class="i">$This</span><span class="i">-&gt;Copy</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1129 
1130   <span class="c"># Delete all atoms besides the ones in specified component...</span>
1131   <span class="i">$ComponentMolecule</span><span class="i">-&gt;_DeleteConnectedComponents</span><span class="s">(</span><span class="i">$ConnectedComponentsRef</span><span class="cm">,</span> <span class="i">$ComponentIndex</span><span class="s">)</span><span class="sc">;</span>
1132 
1133   <span class="c"># Clear any deteced rings...</span>
1134   <span class="k">if</span> <span class="s">(</span><span class="i">$ComponentMolecule</span><span class="i">-&gt;HasRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1135     <span class="i">$ComponentMolecule</span><span class="i">-&gt;ClearRings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1136   <span class="s">}</span>
1137   <span class="k">return</span> <span class="i">$ComponentMolecule</span><span class="sc">;</span>
1138 <span class="s">}</span>
1139 
1140 <span class="c"># Delete atoms corresponding to all connected components except the one specified...</span>
1141 <span class="c">#</span>
<a name="_DeleteConnectedComponents-"></a>1142 <span class="k">sub </span><span class="m">_DeleteConnectedComponents</span> <span class="s">{</span>
1143   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ConnectedComponentsRef</span><span class="cm">,</span> <span class="i">$KeepComponentIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1144   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
1145 
1146   <span class="j">INDEX:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$ConnectedComponentsRef</span>}<span class="s">)</span> <span class="s">{</span>
1147     <span class="k">if</span> <span class="s">(</span><span class="i">$Index</span> == <span class="i">$KeepComponentIndex</span><span class="s">)</span> <span class="s">{</span>
1148       <span class="k">next</span> <span class="j">INDEX</span><span class="sc">;</span>
1149     <span class="s">}</span>
1150     <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ConnectedComponentsRef</span>-&gt;[<span class="i">$Index</span>]}<span class="s">)</span> <span class="s">{</span>
1151       <span class="i">$This</span><span class="i">-&gt;DeleteVertex</span><span class="s">(</span><span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
1152     <span class="s">}</span>
1153   <span class="s">}</span>
1154   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1155 <span class="s">}</span>
1156 
1157 <span class="c"># Return an array containing references to atom arrays corresponding to atoms of</span>
1158 <span class="c"># connected components sorted in order of their decreasing size...</span>
1159 <span class="c">#</span>
<a name="GetConnectedComponentsAtoms-"></a>1160 <span class="k">sub </span><span class="m">GetConnectedComponentsAtoms</span> <span class="s">{</span>
1161   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1162   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">@ComponentsAtoms</span><span class="cm">,</span> <span class="i">@ConnectedComponents</span><span class="s">)</span><span class="sc">;</span>
1163 
1164   <span class="i">@ConnectedComponents</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1165   <span class="i">@ConnectedComponents</span> = <span class="i">$This</span><span class="i">-&gt;GetConnectedComponentsVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1166 
1167   <span class="i">@ComponentsAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1168   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#ConnectedComponents</span><span class="s">)</span> <span class="s">{</span>
1169     <span class="k">my</span><span class="s">(</span><span class="i">@ComponentAtoms</span><span class="s">)</span><span class="sc">;</span>
1170 
1171     <span class="i">@ComponentAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1172     <span class="i">@ComponentAtoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetConnectedComponentAtoms</span><span class="s">(</span>\<span class="i">@ConnectedComponents</span><span class="cm">,</span> <span class="i">$Index</span><span class="s">)</span><span class="sc">;</span>
1173     <span class="k">push</span> <span class="i">@ComponentsAtoms</span><span class="cm">,</span> \<span class="i">@ComponentAtoms</span><span class="sc">;</span>
1174   <span class="s">}</span>
1175   <span class="k">return</span> <span class="i">@ComponentsAtoms</span><span class="sc">;</span>
1176 <span class="s">}</span>
1177 
1178 <span class="c"># Return an array containing atoms correspondig to largest connected component...</span>
1179 <span class="c">#</span>
<a name="GetLargestConnectedComponentAtoms-"></a>1180 <span class="k">sub </span><span class="m">GetLargestConnectedComponentAtoms</span> <span class="s">{</span>
1181   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1182   <span class="k">my</span><span class="s">(</span><span class="i">$LargestComponentIndex</span><span class="cm">,</span> <span class="i">@ConnectedComponents</span><span class="s">)</span><span class="sc">;</span>
1183 
1184   <span class="i">$LargestComponentIndex</span> = <span class="n">0</span><span class="sc">;</span>
1185   <span class="i">@ConnectedComponents</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1186   <span class="i">@ConnectedComponents</span> = <span class="i">$This</span><span class="i">-&gt;GetConnectedComponentsVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1187 
1188   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetConnectedComponentAtoms</span><span class="s">(</span>\<span class="i">@ConnectedComponents</span><span class="cm">,</span> <span class="i">$LargestComponentIndex</span><span class="s">)</span><span class="sc">;</span>
1189 <span class="s">}</span>
1190 
1191 <span class="c"># Return an array containing atoms corresponding to specified connected component...</span>
1192 <span class="c">#</span>
<a name="_GetConnectedComponentAtoms-"></a>1193 <span class="k">sub </span><span class="m">_GetConnectedComponentAtoms</span> <span class="s">{</span>
1194   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ConnectedComponentsRef</span><span class="cm">,</span> <span class="i">$ComponentIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1195   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="cm">,</span> <span class="i">@ComponentAtoms</span><span class="s">)</span><span class="sc">;</span>
1196 
1197   <span class="i">@ComponentAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1198   <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1199 
1200   <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ConnectedComponentsRef</span>-&gt;[<span class="i">$ComponentIndex</span>]}<span class="s">)</span> <span class="s">{</span>
1201     <span class="k">push</span> <span class="i">@AtomIDs</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="sc">;</span>
1202   <span class="s">}</span>
1203   <span class="i">@ComponentAtoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsFromAtomIDs</span><span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
1204 
1205   <span class="k">return</span> <span class="i">@ComponentAtoms</span><span class="sc">;</span>
1206 <span class="s">}</span>
1207 
1208 <span class="c"># Except for the largest connected component, delete atoms corresponding to all other</span>
1209 <span class="c"># connected components...</span>
1210 <span class="c">#</span>
<a name="KeepLargestComponent-"></a>1211 <span class="k">sub </span><span class="m">KeepLargestComponent</span> <span class="s">{</span>
1212   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1213   <span class="k">my</span><span class="s">(</span><span class="i">$LargestComponentIndex</span><span class="cm">,</span> <span class="i">@ConnectedComponents</span><span class="s">)</span><span class="sc">;</span>
1214 
1215   <span class="i">@ConnectedComponents</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1216   <span class="i">@ConnectedComponents</span> = <span class="i">$This</span><span class="i">-&gt;GetConnectedComponentsVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1217   <span class="k">if</span> <span class="s">(</span><span class="i">@ConnectedComponents</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1218     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1219   <span class="s">}</span>
1220   <span class="i">$LargestComponentIndex</span> = <span class="n">0</span><span class="sc">;</span>
1221   <span class="i">$This</span><span class="i">-&gt;_DeleteConnectedComponents</span><span class="s">(</span>\<span class="i">@ConnectedComponents</span><span class="cm">,</span> <span class="i">$LargestComponentIndex</span><span class="s">)</span><span class="sc">;</span>
1222 
1223   <span class="c"># Clear any deteced rings...</span>
1224   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1225     <span class="i">$This</span><span class="i">-&gt;ClearRings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1226   <span class="s">}</span>
1227 
1228   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1229 <span class="s">}</span>
1230 
1231 <span class="c"># Get an array of topologically sorted atoms starting from a specified atom or</span>
1232 <span class="c"># an arbitrary atom in the molecule...</span>
1233 <span class="c">#</span>
<a name="GetTopologicallySortedAtoms-"></a>1234 <span class="k">sub </span><span class="m">GetTopologicallySortedAtoms</span> <span class="s">{</span>
1235   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1236   <span class="k">my</span><span class="s">(</span><span class="i">@SortedAtoms</span><span class="s">)</span><span class="sc">;</span>
1237 
1238   <span class="i">@SortedAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1239   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$StartAtom</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$StartAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1240     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetTopologicallySortedAtoms: No atoms retrieved: Start atom doesn&#39;t exist...&quot;</span><span class="sc">;</span>
1241     <span class="k">return</span> <span class="i">@SortedAtoms</span><span class="sc">;</span>
1242   <span class="s">}</span>
1243   <span class="k">my</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
1244 
1245   <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1246   <span class="i">$StartAtomID</span> = <span class="k">defined</span><span class="s">(</span><span class="i">$StartAtom</span><span class="s">)</span> ? <span class="i">$StartAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span> <span class="co">:</span> <span class="k">undef</span><span class="sc">;</span>
1247 
1248   <span class="i">@AtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetTopologicallySortedVertices</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="s">)</span><span class="sc">;</span>
1249   <span class="i">@SortedAtoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsFromAtomIDs</span><span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
1250 
1251   <span class="k">return</span> <span class="i">@SortedAtoms</span><span class="sc">;</span>
1252 <span class="s">}</span>
1253 
1254 <span class="c"># Detect rings in molecule...</span>
1255 <span class="c">#</span>
<a name="DetectRings-"></a>1256 <span class="k">sub </span><span class="m">DetectRings</span> <span class="s">{</span>
1257   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1258 
1259   <span class="c"># Use graph method to detect all cycles and associate &#39;em to graph as graph</span>
1260   <span class="c"># and vertex properties...</span>
1261   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;DetectCycles</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1262 <span class="s">}</span>
1263 
1264 <span class="c"># Clear rings in molecule...</span>
1265 <span class="c">#</span>
<a name="ClearRings-"></a>1266 <span class="k">sub </span><span class="m">ClearRings</span> <span class="s">{</span>
1267   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1268 
1269   <span class="c"># Use graph method to clear all cycles...</span>
1270   <span class="i">$This</span><span class="i">-&gt;ClearCycles</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1271 
1272   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1273 <span class="s">}</span>
1274 
1275 <span class="c"># Setup rings type paths to use during all ring related methods. Possible values:</span>
1276 <span class="c"># Independent or All. Default is to use Independent rings.</span>
1277 <span class="c">#</span>
<a name="SetActiveRings-"></a>1278 <span class="k">sub </span><span class="m">SetActiveRings</span> <span class="s">{</span>
1279   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingsType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1280 
1281   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$This</span><span class="i">-&gt;SetActiveCyclicPaths</span><span class="s">(</span><span class="i">$RingsType</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1282     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
1283   <span class="s">}</span>
1284   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1285 <span class="s">}</span>
1286 
1287 <span class="c"># Is it a supported aromaticity model?</span>
1288 <span class="c">#</span>
<a name="IsSupportedAromaticityModel-"></a>1289 <span class="k">sub </span><span class="m">IsSupportedAromaticityModel</span> <span class="s">{</span>
1290   <span class="k">my</span><span class="s">(</span><span class="i">$FirstParameter</span><span class="cm">,</span> <span class="i">$SecondParameter</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1291   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AromaticityModel</span><span class="s">)</span><span class="sc">;</span>
1292 
1293   <span class="k">if</span> <span class="s">(</span><span class="i">_IsMolecule</span><span class="s">(</span><span class="i">$FirstParameter</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1294     <span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AromaticityModel</span><span class="s">)</span> = <span class="s">(</span><span class="i">$FirstParameter</span><span class="cm">,</span> <span class="i">$SecondParameter</span><span class="s">)</span><span class="sc">;</span>
1295   <span class="s">}</span>
1296   <span class="k">else</span> <span class="s">{</span>
1297     <span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AromaticityModel</span><span class="s">)</span> = <span class="s">(</span><span class="k">undef</span><span class="cm">,</span> <span class="i">$FirstParameter</span><span class="s">)</span><span class="sc">;</span>
1298   <span class="s">}</span>
1299 
1300   <span class="k">return</span> <span class="k">exists</span> <span class="i">$CanonicalAromaticityModelNamesMap</span>{<span class="k">lc</span><span class="s">(</span><span class="i">$AromaticityModel</span><span class="s">)</span>} ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1301 <span class="s">}</span>
1302 
1303 <span class="c"># Get a list of supported aromaticity model names...</span>
1304 <span class="c">#</span>
<a name="GetSupportedAromaticityModels-"></a>1305 <span class="k">sub </span><span class="m">GetSupportedAromaticityModels</span> <span class="s">{</span>
1306   <span class="k">return</span> <span class="s">(</span><span class="k">sort</span> <span class="k">values</span> <span class="i">%CanonicalAromaticityModelNamesMap</span><span class="s">)</span><span class="sc">;</span>
1307 <span class="s">}</span>
1308 
1309 <span class="c"># Set aromaticity model...</span>
1310 <span class="c">#</span>
<a name="SetAromaticityModel-"></a>1311 <span class="k">sub </span><span class="m">SetAromaticityModel</span> <span class="s">{</span>
1312   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AromaticityModel</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1313 
1314   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsSupportedAromaticityModel</span><span class="s">(</span><span class="i">$AromaticityModel</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1315     <span class="k">my</span><span class="s">(</span><span class="i">@SupportedModels</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetSupportedAromaticityModels</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1316 
1317     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetAromaticityModel: The current release of MayaChemTools doesn&#39;t support the specified aromaticity model $AromaticityModel. Supported aromaticity models defined in AromaticityModelsData.csv file are: @SupportedModels . Using MayaChemToolsAromaticityModel...&quot;</span><span class="sc">;</span>
1318     <span class="i">$AromaticityModel</span> = <span class="q">&#39;MayaChemToolsAromaticityModel&#39;</span><span class="sc">;</span>
1319   <span class="s">}</span>
1320 
1321   <span class="i">$This</span><span class="i">-&gt;SetProperty</span><span class="s">(</span><span class="q">&#39;AromaticityModel&#39;</span><span class="cm">,</span> <span class="i">$AromaticityModel</span><span class="s">)</span><span class="sc">;</span>
1322 
1323   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1324 <span class="s">}</span>
1325 
1326 <span class="c"># Get aromaticity model...</span>
1327 <span class="c">#</span>
<a name="GetAromaticityModel-"></a>1328 <span class="k">sub </span><span class="m">GetAromaticityModel</span> <span class="s">{</span>
1329   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1330 
1331   <span class="c"># Is ValenceModel property explicitly set?</span>
1332   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;AromaticityModel&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1333     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;AromaticityModel&#39;</span><span class="s">)</span><span class="sc">;</span>
1334   <span class="s">}</span>
1335 
1336   <span class="c"># Used internal aromaticity model as default model...</span>
1337   <span class="k">return</span> <span class="q">&#39;MayaChemToolsAromaticityModel&#39;</span><span class="sc">;</span>
1338 <span class="s">}</span>
1339 
1340 <span class="c"># Identify aromatic rings and ring systems in a molecule and set aromaticity for</span>
1341 <span class="c"># corresponding atoms and bonds.</span>
1342 <span class="c">#</span>
1343 <span class="c"># What is aromaticity? [ Ref 124 ] It&#39;s in the code of the implementer, did you</span>
1344 <span class="c"># say? Agree. The implementation of aromaticity varies widely across different</span>
1345 <span class="c"># packages [ Ref 125 ]; additionally, the implementation details are not always</span>
1346 <span class="c"># completely available, and it&#39;s not possible to figure out the exact implementation</span>
1347 <span class="c"># of aromaticity across various packages. Using the publicly available information,</span>
1348 <span class="c"># however, one can try to reproduce the available results to the extent possible,</span>
1349 <span class="c"># along with parameterizing all the control parameters used to implement different</span>
1350 <span class="c"># aromaticity models, and that&#39;s exactly what the current release of MayaChemTools</span>
1351 <span class="c"># does.</span>
1352 <span class="c">#</span>
1353 <span class="c"># The implementation of aromaticity corresponding to various aromaticity models in</span>
1354 <span class="c"># MayaChemTools package is driven by an external CSV file AromaticityModelsData.csv,</span>
1355 <span class="c"># which is distributed with the package and is available in lib/data directory. The CSV</span>
1356 <span class="c"># files contains names of supported aromaticity models, along with various control</span>
1357 <span class="c"># parameters and their values. This file is loaded and processed during instantiation</span>
1358 <span class="c"># of Molecule class and data corresponding to specific aromaticity model are used</span>
1359 <span class="c"># to detect aromaticity for that model. Any new aromaticity model added to the</span>
1360 <span class="c"># aromaticity data file, using different combinations of values for existing control</span>
1361 <span class="c"># parameters would work without any changes to the code; the addition of any new</span>
1362 <span class="c"># control parameters, however, requires its implementation in the code used to</span>
1363 <span class="c"># calculate number of pi electrons available towards delocalization in a ring or ring</span>
1364 <span class="c"># systems.</span>
1365 <span class="c">#</span>
1366 <span class="c"># The current release of MayaChemTools package supports these aromaticity</span>
1367 <span class="c"># models: MDLAromaticityModel, TriposAromaticityModel, MMFFAromaticityModel,</span>
1368 <span class="c"># ChemAxonBasicAromaticityModel, ChemAxonGeneralAromaticityModel,</span>
1369 <span class="c"># DaylightAromaticityModel, MayaChemToolsAromaticityModel.</span>
1370 <span class="c">#</span>
1371 <span class="c"># The current list of control parameters available to detect aromaticity corresponding</span>
1372 <span class="c"># to different aromaticity models are: AllowHeteroRingAtoms, HeteroRingAtomsList,</span>
1373 <span class="c"># AllowExocyclicDoubleBonds, AllowHomoNuclearExocyclicDoubleBonds,</span>
1374 <span class="c"># AllowElectronegativeRingAtomExocyclicDoubleBonds, AllowRingAtomFormalCharge,</span>
1375 <span class="c"># AllowHeteroRingAtomFormalCharge, MinimumRingSize. The values for these control</span>
1376 <span class="c"># parameters are specified in AromaticityModelsData.csv file.</span>
1377 <span class="c">#</span>
1378 <span class="c"># Although definition of aromaticity differs across various aromaticity models, a ring</span>
1379 <span class="c"># or a ring system containing 4n + 2 pi electrons (Huckel&#39;s rule) corresponding to</span>
1380 <span class="c"># alternate single and double bonds, in general, is considered aromatic.</span>
1381 <span class="c">#</span>
1382 <span class="c"># The available valence free electrons on heterocyclic ring atoms, involved in two single</span>
1383 <span class="c"># ring bonds, are also allowed to participate in pi electron delocalizaiton for most of</span>
1384 <span class="c"># the supported aromaticity models.</span>
1385 <span class="c">#</span>
1386 <span class="c"># The presence of exocyclic terminal double bond on ring atoms involved in pi electron</span>
1387 <span class="c"># delocalization is only allowed for some of the aromaticity models. Additionally, the type</span>
1388 <span class="c"># atoms involved in exocyclic terminal double bonds may result in making a ring or ring</span>
1389 <span class="c"># system non-aromatic.</span>
1390 <span class="c">#</span>
<a name="DetectAromaticity-"></a>1391 <span class="k">sub </span><span class="m">DetectAromaticity</span> <span class="s">{</span>
1392   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1393 
1394   <span class="c"># Delete aromaticity property for atoms and bonds...</span>
1395   <span class="i">$This</span><span class="i">-&gt;DeleteAromaticity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1396 
1397   <span class="c"># Any ring out there...</span>
1398   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1399     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1400   <span class="s">}</span>
1401 
1402   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasFusedRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1403     <span class="i">$This</span><span class="i">-&gt;_DetectAromaticityUsingFusedRingSets</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1404   <span class="s">}</span>
1405   <span class="k">else</span> <span class="s">{</span>
1406     <span class="i">$This</span><span class="i">-&gt;_DetectAromaticityUsingIndividualRings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1407   <span class="s">}</span>
1408   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1409 <span class="s">}</span>
1410 
1411 <span class="c"># Go over all rings and set aromaticity property for corresponding ring atoms</span>
1412 <span class="c"># and bonds involved in aromatic rings...</span>
1413 <span class="c">#</span>
<a name="_DetectAromaticityUsingIndividualRings-"></a>1414 <span class="k">sub </span><span class="m">_DetectAromaticityUsingIndividualRings</span> <span class="s">{</span>
1415   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1416 
1417   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_DetectRingsAromaticity</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
1418 <span class="s">}</span>
1419 
1420 <span class="c"># For each fused ring set, detect aromaticity by treating all of its ring as one aromatic</span>
1421 <span class="c"># system for counting pi electrons to satisfy Huckel&#39;s rule; In case of a failure, rings in</span>
1422 <span class="c"># fused set are treated individually for aromaticity detection. Additionally, non-fused</span>
1423 <span class="c"># rings are handled on their own during aromaticity detection.</span>
1424 <span class="c">#</span>
1425 <span class="c"># Note:</span>
1426 <span class="c">#   . pi electrons in common bonds involved in fused ring sets are only counted once.</span>
1427 <span class="c">#</span>
1428 <span class="c">#</span>
<a name="_DetectAromaticityUsingFusedRingSets-"></a>1429 <span class="k">sub </span><span class="m">_DetectAromaticityUsingFusedRingSets</span> <span class="s">{</span>
1430   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1431   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$FusedRingSetRef</span><span class="cm">,</span> <span class="i">$FusedRingSetsRef</span><span class="cm">,</span> <span class="i">$NonFusedRingsRef</span><span class="cm">,</span> <span class="i">@FusedRingSetIsAromatic</span><span class="s">)</span><span class="sc">;</span>
1432 
1433   <span class="s">(</span><span class="i">$FusedRingSetsRef</span><span class="cm">,</span> <span class="i">$NonFusedRingsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetFusedAndNonFusedRings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1434 
1435   <span class="i">@FusedRingSetIsAromatic</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1436   <span class="j">RINGSET:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$FusedRingSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
1437     <span class="i">$FusedRingSetRef</span> = <span class="i">$FusedRingSetsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1438     <span class="i">$FusedRingSetIsAromatic</span>[<span class="i">$Index</span>] = <span class="n">0</span><span class="sc">;</span>
1439 
1440     <span class="k">my</span><span class="s">(</span><span class="i">$NumOfPiElectronsInRingSet</span><span class="cm">,</span> <span class="i">$NumOfPiElectronsInRing</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondID</span><span class="cm">,</span> <span class="i">%FusedRingSetsBondsMap</span><span class="cm">,</span> <span class="i">%FusedRingSetsBondsVisitedMap</span><span class="cm">,</span> <span class="i">%FusedRingBondsMap</span><span class="s">)</span><span class="sc">;</span>
1441 
1442     <span class="i">$NumOfPiElectronsInRingSet</span> = <span class="n">0</span><span class="sc">;</span>
1443 
1444     <span class="i">%FusedRingSetsBondsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1445     <span class="i">%FusedRingSetsBondsVisitedMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1446     <span class="i">%FusedRingBondsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1447 
1448     <span class="c"># Setup a bond ID map for all bonds in fused ring set and another one</span>
1449     <span class="c"># for bonds involved in more than one ring...</span>
1450     <span class="c">#</span>
1451     <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FusedRingSetRef</span>}<span class="s">)</span> <span class="s">{</span>
1452       <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetRingBonds</span><span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1453         <span class="i">$BondID</span> = <span class="i">$Bond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1454         <span class="i">$FusedRingSetsBondsMap</span>{<span class="i">$BondID</span>} = <span class="i">$BondID</span><span class="sc">;</span>
1455 
1456         <span class="k">if</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;GetNumOfRings</span><span class="s">(</span><span class="s">)</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1457           <span class="i">$FusedRingBondsMap</span>{<span class="i">$BondID</span>} = <span class="i">$BondID</span><span class="sc">;</span>
1458         <span class="s">}</span>
1459       <span class="s">}</span>
1460     <span class="s">}</span>
1461 
1462     <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FusedRingSetRef</span>}<span class="s">)</span> <span class="s">{</span>
1463       <span class="k">my</span><span class="s">(</span><span class="i">@RingBonds</span><span class="s">)</span><span class="sc">;</span>
1464 
1465       <span class="i">@RingBonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1466       <span class="i">@RingBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetRingBonds</span><span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span><span class="sc">;</span>
1467       <span class="i">$NumOfPiElectronsInRing</span> = <span class="i">$This</span><span class="i">-&gt;_GetNumOfPiElectronsAvailableForDelocalization</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> \<span class="i">@RingBonds</span><span class="cm">,</span> \<span class="i">%FusedRingSetsBondsMap</span><span class="cm">,</span> \<span class="i">%FusedRingSetsBondsVisitedMap</span><span class="cm">,</span> \<span class="i">%FusedRingBondsMap</span><span class="s">)</span><span class="sc">;</span>
1468 
1469       <span class="k">if</span> <span class="s">(</span>!<span class="i">$NumOfPiElectronsInRing</span><span class="s">)</span> <span class="s">{</span>
1470         <span class="k">next</span> <span class="j">RINGSET</span><span class="sc">;</span>
1471       <span class="s">}</span>
1472       <span class="i">$NumOfPiElectronsInRingSet</span> += <span class="i">$NumOfPiElectronsInRing</span><span class="sc">;</span>
1473     <span class="s">}</span>
1474     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_DoPiElectronSatifyHuckelsRule</span><span class="s">(</span><span class="i">$NumOfPiElectronsInRingSet</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1475       <span class="i">$FusedRingSetIsAromatic</span>[<span class="i">$Index</span>] = <span class="n">1</span><span class="sc">;</span>
1476     <span class="s">}</span>
1477   <span class="s">}</span>
1478 
1479   <span class="c"># Set atom and bond aromatic flags for ring sets whose pi electrons satisfy Huckel&#39;s rule; otherwise,</span>
1480   <span class="c"># treat rings in a ring set as individual rings for detecting aromaticity...</span>
1481   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$FusedRingSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
1482     <span class="i">$FusedRingSetRef</span> = <span class="i">$FusedRingSetsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1483     <span class="k">if</span> <span class="s">(</span><span class="i">$FusedRingSetIsAromatic</span>[<span class="i">$Index</span>]<span class="s">)</span> <span class="s">{</span>
1484       <span class="i">$This</span><span class="i">-&gt;_SetRingsAromaticity</span><span class="s">(</span><span class="i">@</span>{<span class="i">$FusedRingSetRef</span>}<span class="s">)</span><span class="sc">;</span>
1485     <span class="s">}</span>
1486     <span class="k">else</span> <span class="s">{</span>
1487       <span class="i">$This</span><span class="i">-&gt;_DetectRingsAromaticity</span><span class="s">(</span><span class="i">@</span>{<span class="i">$FusedRingSetRef</span>}<span class="s">)</span><span class="sc">;</span>
1488     <span class="s">}</span>
1489   <span class="s">}</span>
1490 
1491   <span class="i">$This</span><span class="i">-&gt;_DetectRingsAromaticity</span><span class="s">(</span><span class="i">@</span>{<span class="i">$NonFusedRingsRef</span>}<span class="s">)</span><span class="sc">;</span>
1492 
1493   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1494 <span class="s">}</span>
1495 
1496 <span class="c"># Detect and set aromaticity for rings...</span>
1497 <span class="c">#</span>
<a name="_DetectRingsAromaticity-"></a>1498 <span class="k">sub </span><span class="m">_DetectRingsAromaticity</span> <span class="s">{</span>
1499   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Rings</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1500   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingBond</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="s">)</span><span class="sc">;</span>
1501 
1502   <span class="j">RING:</span> <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@Rings</span><span class="s">)</span> <span class="s">{</span>
1503     <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CheckRingAromaticity</span><span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1504       <span class="k">next</span> <span class="j">RING</span><span class="sc">;</span>
1505     <span class="s">}</span>
1506     <span class="i">$This</span><span class="i">-&gt;_SetRingAromaticity</span><span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span><span class="sc">;</span>
1507   <span class="s">}</span>
1508   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1509 <span class="s">}</span>
1510 
1511 <span class="c"># Set aromatic property for all all atoms and bonds involved in all specified rings..</span>
1512 <span class="c">#</span>
<a name="_SetRingsAromaticity-"></a>1513 <span class="k">sub </span><span class="m">_SetRingsAromaticity</span> <span class="s">{</span>
1514   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Rings</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1515   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span> <span class="s">)</span><span class="sc">;</span>
1516 
1517   <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@Rings</span><span class="s">)</span> <span class="s">{</span>
1518     <span class="i">$This</span><span class="i">-&gt;_SetRingAromaticity</span><span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span><span class="sc">;</span>
1519   <span class="s">}</span>
1520   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1521 <span class="s">}</span>
1522 
1523 <span class="c"># Set aromatic property for all all atoms and bonds involved in ring..</span>
1524 <span class="c">#</span>
<a name="_SetRingAromaticity-"></a>1525 <span class="k">sub </span><span class="m">_SetRingAromaticity</span> <span class="s">{</span>
1526   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@RingAtoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1527   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingBond</span><span class="s">)</span><span class="sc">;</span>
1528 
1529   <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span> <span class="s">{</span>
1530     <span class="i">$RingAtom</span><span class="i">-&gt;SetAromatic</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
1531   <span class="s">}</span>
1532   <span class="k">for</span> <span class="i">$RingBond</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetRingBonds</span><span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1533     <span class="i">$RingBond</span><span class="i">-&gt;SetAromatic</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
1534   <span class="s">}</span>
1535   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1536 <span class="s">}</span>
1537 
1538 
1539 <span class="c"># For a ring to be an aromatic ring, all of its atoms must have aromatic property</span>
1540 <span class="c"># set.</span>
1541 <span class="c">#</span>
<a name="IsRingAromatic-"></a>1542 <span class="k">sub </span><span class="m">IsRingAromatic</span> <span class="s">{</span>
1543   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@RingAtoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1544   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtom</span><span class="s">)</span><span class="sc">;</span>
1545 
1546   <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span> <span class="s">{</span>
1547     <span class="k">if</span> <span class="s">(</span>!<span class="i">$RingAtom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1548       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1549     <span class="s">}</span>
1550   <span class="s">}</span>
1551   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1552 <span class="s">}</span>
1553 
1554 <span class="c"># Delete aromatic property for all atoms and bonds...</span>
1555 <span class="c">#</span>
<a name="DeleteAromaticity-"></a>1556 <span class="k">sub </span><span class="m">DeleteAromaticity</span> <span class="s">{</span>
1557   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1558 
1559   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_DeleteAtomsAndBondsAromaticity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1560 <span class="s">}</span>
1561 
1562 <span class="c"># Check ring aromaticity...</span>
1563 <span class="c">#</span>
<a name="_CheckRingAromaticity-"></a>1564 <span class="k">sub </span><span class="m">_CheckRingAromaticity</span> <span class="s">{</span>
1565   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@RingAtoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1566   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfPiElectrons</span><span class="cm">,</span> <span class="i">$BondID</span><span class="cm">,</span> <span class="i">@RingBonds</span><span class="s">)</span><span class="sc">;</span>
1567 
1568   <span class="i">@RingBonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1569   <span class="i">@RingBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetRingBonds</span><span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span><span class="sc">;</span>
1570 
1571   <span class="i">$NumOfPiElectrons</span> = <span class="i">$This</span><span class="i">-&gt;_GetNumOfPiElectronsAvailableForDelocalization</span><span class="s">(</span>\<span class="i">@RingAtoms</span><span class="cm">,</span> \<span class="i">@RingBonds</span><span class="s">)</span><span class="sc">;</span>
1572 
1573   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_DoPiElectronSatifyHuckelsRule</span><span class="s">(</span><span class="i">$NumOfPiElectrons</span><span class="s">)</span><span class="sc">;</span>
1574 <span class="s">}</span>
1575 
1576 <span class="c"># Get number of pi electrons available for delocalizaiton in a ring or ring system...</span>
1577 <span class="c">#</span>
<a name="_GetNumOfPiElectronsAvailableForDelocalization-"></a>1578 <span class="k">sub </span><span class="m">_GetNumOfPiElectronsAvailableForDelocalization</span> <span class="s">{</span>
1579   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingBondsRef</span><span class="cm">,</span> <span class="i">$FusedRingSetsBondsMapRef</span><span class="cm">,</span> <span class="i">$FusedRingSetsBondsVisitedMapRef</span><span class="cm">,</span> <span class="i">$FusedRingBondsMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1580   <span class="k">my</span><span class="s">(</span><span class="i">$AromaticityModelName</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="cm">,</span> <span class="i">$ExocyclicDoubleBondsDataMapRef</span><span class="cm">,</span> <span class="i">$NumOfConjugatedDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfExplicitAromaticBonds</span><span class="cm">,</span> <span class="i">$NumOfRingAtomElectronPairs</span><span class="cm">,</span> <span class="i">$NumOfRingBondsProcessed</span><span class="cm">,</span> <span class="i">$NumOfPiElectrons</span><span class="cm">,</span> <span class="i">$Index</span><span class="cm">,</span> <span class="i">$RingBond</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingAtomSymbol</span><span class="cm">,</span> <span class="i">$BondOrder</span><span class="cm">,</span> <span class="i">$RingAtomID</span><span class="cm">,</span> <span class="i">$RingBondID</span><span class="cm">,</span> <span class="i">$PreviousIndex</span><span class="cm">,</span> <span class="i">$PreviousRingBond</span><span class="cm">,</span> <span class="i">$ExcludeFreeRadicalElectrons</span><span class="cm">,</span> <span class="i">%ElectronPairContributionProcessedMap</span><span class="s">)</span><span class="sc">;</span>
1581 
1582   <span class="i">$AromaticityModelName</span> = <span class="i">$CanonicalAromaticityModelNamesMap</span>{<span class="k">lc</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetAromaticityModel</span><span class="s">(</span><span class="s">)</span><span class="s">)</span>}<span class="sc">;</span>
1583   <span class="i">$AromaticityModelDataRef</span> = \<span class="i">%</span>{<span class="i">$AromaticityModelsDataMap</span>{<span class="i">$AromaticityModelName</span>}}<span class="sc">;</span>
1584 
1585   <span class="c"># Perform an intial check for potential atomatic ring atoms..</span>
1586   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CheckRingAtomsForPotentialAromaticity</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingBondsRef</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1587     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1588   <span class="s">}</span>
1589 
1590   <span class="i">$ExocyclicDoubleBondsDataMapRef</span> = <span class="k">undef</span><span class="sc">;</span>
1591   <span class="i">$ExcludeFreeRadicalElectrons</span> = <span class="n">1</span><span class="sc">;</span>
1592 
1593   <span class="i">%ElectronPairContributionProcessedMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1594 
1595   <span class="s">(</span><span class="i">$NumOfPiElectrons</span><span class="cm">,</span> <span class="i">$NumOfRingBondsProcessed</span><span class="cm">,</span> <span class="i">$NumOfConjugatedDoubleBonds</span><span class="cm">,</span> <span class="i">$NumOfExplicitAromaticBonds</span><span class="cm">,</span> <span class="i">$NumOfRingAtomElectronPairs</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">5</span><span class="sc">;</span>
1596 
1597   <span class="c"># Go over ring atoms and bonds to check their participation in aromaticity and count</span>
1598   <span class="c"># pi electrons available for delocalization corresponding to various aromaticity models...</span>
1599   <span class="c">#</span>
1600   <span class="j">RINGBOND:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$RingBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
1601     <span class="i">$RingBond</span> = <span class="i">$RingBondsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1602     <span class="i">$RingAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1603     <span class="i">$BondOrder</span> = <span class="i">$RingBond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1604 
1605     <span class="c"># Is this ring bond part of a fused ring system which has been already processed?</span>
1606     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$FusedRingSetsBondsVisitedMapRef</span><span class="s">)</span> &amp;&amp; <span class="i">$RingBond</span><span class="i">-&gt;GetNumOfRings</span><span class="s">(</span><span class="s">)</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1607       <span class="i">$RingBondID</span> = <span class="i">$RingBond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1608       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$FusedRingSetsBondsVisitedMapRef</span>-&gt;{<span class="i">$RingBondID</span>}<span class="s">)</span> <span class="s">{</span>
1609         <span class="k">next</span> <span class="j">RINGBOND</span><span class="sc">;</span>
1610       <span class="s">}</span>
1611       <span class="i">$FusedRingSetsBondsVisitedMapRef</span>-&gt;{<span class="i">$RingBondID</span>} = <span class="i">$RingBondID</span><span class="sc">;</span>
1612     <span class="s">}</span>
1613     <span class="i">$NumOfRingBondsProcessed</span>++<span class="sc">;</span>
1614 
1615     <span class="c"># For first ring, previous ring bond corrresponds to last ring bond...</span>
1616     <span class="i">$PreviousIndex</span> = <span class="i">$Index</span> ? <span class="s">(</span><span class="i">$Index</span> -<span class="n">1</span><span class="s">)</span> <span class="co">:</span> <span class="i">$#</span>{<span class="i">$RingBondsRef</span>}<span class="sc">;</span>
1617     <span class="i">$PreviousRingBond</span> = <span class="i">$RingBondsRef</span>-&gt;[<span class="i">$PreviousIndex</span>]<span class="sc">;</span>
1618 
1619     <span class="c"># Check for presence of alternate single/double bond configuration, and pesence of</span>
1620     <span class="c"># hetero atoms with two single ring bonds along with any exocyclic double bonds...</span>
1621     <span class="c">#</span>
1622     <span class="j">BONDORDER:</span> <span class="s">{</span>
1623       <span class="c"># Is current ring double bond in an alternate single/double bond configuration?</span>
1624       <span class="k">if</span> <span class="s">(</span><span class="i">$BondOrder</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1625         <span class="k">if</span> <span class="s">(</span><span class="i">$PreviousRingBond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span> != <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1626           <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1627         <span class="s">}</span>
1628         <span class="i">$NumOfConjugatedDoubleBonds</span> += <span class="n">1</span><span class="sc">;</span>
1629         <span class="k">last</span> <span class="j">BONDORDER</span><span class="sc">;</span>
1630       <span class="s">}</span>
1631 
1632       <span class="c"># Is current ring bond order correspond to an explicit aromatic bond?</span>
1633       <span class="k">if</span> <span class="s">(</span><span class="i">$BondOrder</span> == <span class="n">1.5</span><span class="s">)</span> <span class="s">{</span>
1634         <span class="k">if</span> <span class="s">(</span><span class="i">$PreviousRingBond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span> != <span class="n">1.5</span><span class="s">)</span> <span class="s">{</span>
1635           <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1636         <span class="s">}</span>
1637         <span class="i">$NumOfExplicitAromaticBonds</span> += <span class="n">1</span><span class="sc">;</span>
1638         <span class="k">last</span> <span class="j">BONDORDER</span><span class="sc">;</span>
1639       <span class="s">}</span>
1640 
1641       <span class="c"># Check for potential hetero atoms involved in two single ring bonds along</span>
1642       <span class="c"># with any terminal exocyclic bonds...</span>
1643       <span class="k">if</span> <span class="s">(</span><span class="i">$BondOrder</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1644         <span class="k">if</span> <span class="s">(</span><span class="i">$PreviousRingBond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span> != <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1645           <span class="c"># Part of a conjugated system...</span>
1646           <span class="k">last</span> <span class="j">BONDORDER</span><span class="sc">;</span>
1647         <span class="s">}</span>
1648 
1649         <span class="c"># Identify any exocylic bonds on rings atoms...</span>
1650         <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$ExocyclicDoubleBondsDataMapRef</span><span class="s">)</span> <span class="s">{</span>
1651           <span class="i">$ExocyclicDoubleBondsDataMapRef</span> = <span class="i">$This</span><span class="i">-&gt;_IdentifyRingAtomsInvolvedInExocyclicDoubleBonds</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingBondsRef</span><span class="cm">,</span> <span class="i">$FusedRingSetsBondsMapRef</span><span class="s">)</span><span class="sc">;</span>
1652         <span class="s">}</span>
1653 
1654         <span class="c"># Is current ring atom part of an allowed exocyclic terminal bond?</span>
1655         <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CheckPotentialAromaticRingAtomForExocylicDoubleBonds</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="cm">,</span> <span class="i">$ExocyclicDoubleBondsDataMapRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1656           <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1657         <span class="s">}</span>
1658 
1659         <span class="c"># Is it allowed to have any formal charge?</span>
1660         <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CheckPotentialAromaticRingAtomForFormalCharge</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1661           <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1662         <span class="s">}</span>
1663 
1664         <span class="c"># It it an allowed hetero ring atom or a carbon atom?</span>
1665         <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CheckPotentialAromaticRingAtomForAllowedHeteroAtoms</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1666           <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1667         <span class="s">}</span>
1668 
1669         <span class="i">$RingAtomID</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1670         <span class="i">$ElectronPairContributionProcessedMap</span>{<span class="i">$RingAtomID</span>} = <span class="i">$RingAtomID</span><span class="sc">;</span>
1671 
1672         <span class="c"># Is it able to donate a pair for electrons towards pi electron delocalization?</span>
1673         <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetValenceFreeElectrons</span><span class="s">(</span><span class="i">$ExcludeFreeRadicalElectrons</span><span class="s">)</span> &gt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1674           <span class="c"># Possibilites:</span>
1675           <span class="c">#   . Hetero atom with or without formal charge and an available electron pair</span>
1676           <span class="c">#   . Carbon atom with -ve formal charge and with an available electron pair</span>
1677           <span class="c">#</span>
1678           <span class="i">$NumOfRingAtomElectronPairs</span> += <span class="n">1</span><span class="sc">;</span>
1679         <span class="s">}</span>
1680         <span class="k">else</span> <span class="s">{</span>
1681           <span class="c"># Is ring atom involved in two single bonds without any electron pair allowed?</span>
1682           <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_AllowRingAtomInTwoSingleBondsWithoutElectronPair</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingBond</span><span class="cm">,</span> <span class="i">$PreviousRingBond</span><span class="cm">,</span> <span class="i">$ExocyclicDoubleBondsDataMapRef</span><span class="cm">,</span> <span class="i">$FusedRingBondsMapRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1683             <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1684           <span class="s">}</span>
1685         <span class="s">}</span>
1686         <span class="k">last</span> <span class="j">BONDORDER</span><span class="sc">;</span>
1687       <span class="s">}</span>
1688 
1689       <span class="c"># Any other type of ring atom/bond is not allowed to contribute towards pi electron count</span>
1690       <span class="c"># and caused loss of aromaticity...</span>
1691       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1692     <span class="s">}</span>
1693   <span class="s">}</span>
1694 
1695   <span class="c"># Check for any electron pair contributions towards pi electron delocalization due to</span>
1696   <span class="c"># -ve formal charge on ring atoms which haven&#39;t been already processed and part of</span>
1697   <span class="c"># conjugated single/double bond system...</span>
1698   <span class="c">#</span>
1699   <span class="i">$NumOfRingAtomElectronPairs</span> += <span class="i">$This</span><span class="i">-&gt;_GetElectronPairsContributionFromConjugatedRingAtoms</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingBondsRef</span><span class="cm">,</span> <span class="i">$ExcludeFreeRadicalElectrons</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="cm">,</span> \<span class="i">%ElectronPairContributionProcessedMap</span><span class="s">)</span><span class="sc">;</span>
1700 
1701   <span class="c"># Setup pi electron count available for delocalization...</span>
1702   <span class="j">COUNT:</span> <span class="s">{</span>
1703     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfExplicitAromaticBonds</span> == <span class="i">$NumOfRingBondsProcessed</span><span class="s">)</span> <span class="s">{</span>
1704       <span class="c"># Each aromatic bond contribute one electron towards pi electron delocalization...</span>
1705       <span class="i">$NumOfPiElectrons</span> = <span class="i">$NumOfExplicitAromaticBonds</span><span class="sc">;</span>
1706       <span class="k">last</span> <span class="j">COUNT</span><span class="sc">;</span>
1707     <span class="s">}</span>
1708 
1709     <span class="c"># Each conjugated double bond contribute two electrons towards pi electron delocalization...</span>
1710     <span class="i">$NumOfPiElectrons</span> = <span class="n">2</span>*<span class="i">$NumOfConjugatedDoubleBonds</span> + <span class="n">2</span>*<span class="i">$NumOfRingAtomElectronPairs</span><span class="sc">;</span>
1711   <span class="s">}</span>
1712 
1713   <span class="k">return</span> <span class="i">$NumOfPiElectrons</span><span class="sc">;</span>
1714 <span class="s">}</span>
1715 
1716 <span class="c"># Check ring atoms for their potential participation in aromatic systems..</span>
1717 <span class="c">#</span>
<a name="_CheckRingAtomsForPotentialAromaticity-"></a>1718 <span class="k">sub </span><span class="m">_CheckRingAtomsForPotentialAromaticity</span> <span class="s">{</span>
1719   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingBondsRef</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1720   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$RingBond</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="s">)</span><span class="sc">;</span>
1721 
1722   <span class="c"># Check availability of ring atoms and bonds...</span>
1723   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="s">)</span> &amp;&amp; <span class="i">@</span>{<span class="i">$RingBondsRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1724     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1725   <span class="s">}</span>
1726 
1727   <span class="c"># Is there any minimum ring size limit?</span>
1728   <span class="k">if</span> <span class="s">(</span><span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">MinimumRingSize</span>}<span class="s">)</span> <span class="s">{</span>
1729     <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>} &lt; <span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">MinimumRingSize</span>}<span class="s">)</span> <span class="s">{</span>
1730       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1731     <span class="s">}</span>
1732   <span class="s">}</span>
1733 
1734   <span class="c"># Make sure ring bond order is not greater than 2 and ring atom is not connected to more</span>
1735   <span class="c"># than 3 other atoms to eliminate any non sp2 carbon atoms and still allow for hetero atoms</span>
1736   <span class="c"># to contrbute towards electron delocalization...</span>
1737   <span class="c">#</span>
1738   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$RingBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
1739     <span class="i">$RingBond</span> = <span class="i">$RingBondsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1740     <span class="i">$RingAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1741 
1742     <span class="k">if</span> <span class="s">(</span><span class="s">(</span><span class="i">$RingBond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span> &gt; <span class="n">2</span><span class="s">)</span> || <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetNumOfBonds</span><span class="s">(</span><span class="s">)</span> + <span class="i">$RingAtom</span><span class="i">-&gt;GetNumOfMissingHydrogens</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> &gt; <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
1743       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1744     <span class="s">}</span>
1745   <span class="s">}</span>
1746 
1747   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1748 <span class="s">}</span>
1749 
1750 <span class="c"># Identify any exocylic double bonds on ring atoms...</span>
1751 <span class="c">#</span>
<a name="_IdentifyRingAtomsInvolvedInExocyclicDoubleBonds-"></a>1752 <span class="k">sub </span><span class="m">_IdentifyRingAtomsInvolvedInExocyclicDoubleBonds</span> <span class="s">{</span>
1753   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingBondsRef</span><span class="cm">,</span> <span class="i">$FusedRingSetsBondsMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1754   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingBond</span><span class="cm">,</span> <span class="i">$RingAtomID</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondID</span><span class="cm">,</span> <span class="i">$BondedAtom</span><span class="cm">,</span> <span class="i">$RingBondsMapRef</span><span class="cm">,</span> <span class="i">%RingBondsMap</span><span class="cm">,</span> <span class="i">%ExocyclicDoubleBondsDataMap</span><span class="s">)</span><span class="sc">;</span>
1755 
1756   <span class="c"># Setup a ring bond map to process exocyclic bonds...</span>
1757   <span class="i">$RingBondsMapRef</span> = <span class="k">undef</span><span class="sc">;</span>
1758   <span class="i">%RingBondsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1759 
1760   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$FusedRingSetsBondsMapRef</span><span class="s">)</span> <span class="s">{</span>
1761     <span class="i">$RingBondsMapRef</span> = <span class="i">$FusedRingSetsBondsMapRef</span><span class="sc">;</span>
1762   <span class="s">}</span>
1763   <span class="k">else</span> <span class="s">{</span>
1764     <span class="k">for</span> <span class="i">$BondID</span> <span class="s">(</span><span class="k">map</span> <span class="s">{</span> <span class="i">$_</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span> <span class="i">@</span>{<span class="i">$RingBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
1765       <span class="i">$RingBondsMap</span>{<span class="i">$BondID</span>} = <span class="i">$BondID</span><span class="sc">;</span>
1766     <span class="s">}</span>
1767     <span class="i">$RingBondsMapRef</span> = \<span class="i">%RingBondsMap</span><span class="sc">;</span>
1768   <span class="s">}</span>
1769 
1770   <span class="c"># Intialize exocyclic terminal double bond data...</span>
1771   <span class="i">%ExocyclicDoubleBondsDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1772   <span class="i">%</span>{<span class="i">$ExocyclicDoubleBondsDataMap</span>{<span class="w">RingAtomID</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1773 
1774   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$RingBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
1775     <span class="i">$RingBond</span> = <span class="i">$RingBondsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1776     <span class="i">$RingAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1777 
1778     <span class="i">$RingAtomID</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1779 
1780     <span class="j">BOND:</span> <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1781       <span class="k">if</span> <span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;GetBondOrder</span> != <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1782         <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
1783       <span class="s">}</span>
1784 
1785       <span class="c"># Is it part of ring or ring system under consideration?</span>
1786       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$RingBondsMapRef</span>-&gt;{<span class="i">$Bond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span>}<span class="s">)</span> <span class="s">{</span>
1787         <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
1788       <span class="s">}</span>
1789 
1790       <span class="c"># Is bonded atom in a ring or a non-terminal atom?</span>
1791       <span class="i">$BondedAtom</span> = <span class="i">$Bond</span><span class="i">-&gt;GetBondedAtom</span><span class="s">(</span><span class="i">$RingAtom</span><span class="s">)</span><span class="sc">;</span>
1792       <span class="k">if</span> <span class="s">(</span><span class="i">$BondedAtom</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span> || !<span class="i">$BondedAtom</span><span class="i">-&gt;IsTerminal</span><span class="s">(</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
1793         <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
1794       <span class="s">}</span>
1795 
1796       <span class="c"># Track exocyclic terminal double bond information...</span>
1797       <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$ExocyclicDoubleBondsDataMap</span>{<span class="w">RingAtomID</span>}{<span class="i">$RingAtomID</span>}<span class="s">)</span> <span class="s">{</span>
1798         <span class="i">@</span>{<span class="i">$ExocyclicDoubleBondsDataMap</span>{<span class="w">RingAtomID</span>}{<span class="i">$RingAtomID</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1799       <span class="s">}</span>
1800       <span class="k">push</span> <span class="i">@</span>{<span class="i">$ExocyclicDoubleBondsDataMap</span>{<span class="w">RingAtomID</span>}{<span class="i">$RingAtomID</span>}}<span class="cm">,</span> <span class="i">$BondedAtom</span><span class="sc">;</span>
1801     <span class="s">}</span>
1802   <span class="s">}</span>
1803 
1804   <span class="k">return</span> \<span class="i">%ExocyclicDoubleBondsDataMap</span><span class="sc">;</span>
1805 <span class="s">}</span>
1806 
1807 <span class="c"># Check to see whether ring atoms are allowed to participate in exocyclic terminal double</span>
1808 <span class="c"># bonds...</span>
1809 <span class="c">#</span>
<a name="_CheckPotentialAromaticRingAtomForExocylicDoubleBonds-"></a>1810 <span class="k">sub </span><span class="m">_CheckPotentialAromaticRingAtomForExocylicDoubleBonds</span> <span class="s">{</span>
1811   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="cm">,</span> <span class="i">$ExocyclicDoubleBondsDataMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1812   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomID</span><span class="cm">,</span> <span class="i">$ExocyclicTerminalAtom</span><span class="cm">,</span> <span class="i">$RingAtomElectronegativity</span><span class="cm">,</span> <span class="i">$TerminalAtomElectronagativity</span><span class="s">)</span><span class="sc">;</span>
1813 
1814   <span class="i">$RingAtomID</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1815 
1816   <span class="c"># Is it part of an exocyclic terminal double bond?</span>
1817   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$ExocyclicDoubleBondsDataMapRef</span>-&gt;{<span class="w">RingAtomID</span>}{<span class="i">$RingAtomID</span>}<span class="s">)</span> <span class="s">{</span>
1818     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1819   <span class="s">}</span>
1820 
1821   <span class="c"># Are exocyclic terminal double bonds allowed?</span>
1822   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">AllowExocyclicDoubleBonds</span>}<span class="s">)</span> <span class="s">{</span>
1823     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1824   <span class="s">}</span>
1825 
1826   <span class="c"># Are there multiple exocyclic double bonds?</span>
1827   <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ExocyclicDoubleBondsDataMapRef</span>-&gt;{<span class="w">RingAtomID</span>}{<span class="i">$RingAtomID</span>}} &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1828     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1829   <span class="s">}</span>
1830   <span class="s">(</span><span class="i">$ExocyclicTerminalAtom</span><span class="s">)</span> = <span class="i">@</span>{<span class="i">$ExocyclicDoubleBondsDataMapRef</span>-&gt;{<span class="w">RingAtomID</span>}{<span class="i">$RingAtomID</span>}}<span class="sc">;</span>
1831 
1832   <span class="c"># Are homo nuclear exocyclic terminal double bonds allowed?</span>
1833   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">AllowHomoNuclearExocyclicDoubleBonds</span>}<span class="s">)</span> <span class="s">{</span>
1834     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetAtomicNumber</span><span class="s">(</span><span class="s">)</span> == <span class="i">$ExocyclicTerminalAtom</span><span class="i">-&gt;GetAtomicNumber</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1835       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1836     <span class="s">}</span>
1837   <span class="s">}</span>
1838 
1839   <span class="c"># Are ring atoms with higher electronegativity allowed in exocyclic double bonds?</span>
1840   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">AllowElectronegativeRingAtomExocyclicDoubleBonds</span>}<span class="s">)</span> <span class="s">{</span>
1841     <span class="i">$RingAtomElectronegativity</span> = <span class="i">PeriodicTable::GetElementPaulingElectronegativity</span><span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetAtomicNumber</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
1842     <span class="i">$TerminalAtomElectronagativity</span> = <span class="i">PeriodicTable::GetElementPaulingElectronegativity</span><span class="s">(</span><span class="i">$ExocyclicTerminalAtom</span><span class="i">-&gt;GetAtomicNumber</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
1843 
1844     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtomElectronegativity</span> &amp;&amp; <span class="i">$TerminalAtomElectronagativity</span><span class="s">)</span> <span class="s">{</span>
1845       <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtomElectronegativity</span> &gt; <span class="i">$TerminalAtomElectronagativity</span><span class="s">)</span> <span class="s">{</span>
1846         <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1847       <span class="s">}</span>
1848     <span class="s">}</span>
1849   <span class="s">}</span>
1850 
1851   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1852 <span class="s">}</span>
1853 
1854 <span class="c">#</span>
1855 <span class="c"># Check for any formal charge participation into electron delocalization...</span>
1856 <span class="c">#</span>
<a name="_CheckPotentialAromaticRingAtomForFormalCharge-"></a>1857 <span class="k">sub </span><span class="m">_CheckPotentialAromaticRingAtomForFormalCharge</span> <span class="s">{</span>
1858   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1859   <span class="k">my</span><span class="s">(</span><span class="i">$FormalCharge</span><span class="s">)</span><span class="sc">;</span>
1860 
1861   <span class="c"># Does atom has any formal charge?</span>
1862   <span class="i">$FormalCharge</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1863   <span class="k">if</span> <span class="s">(</span>!<span class="i">$FormalCharge</span><span class="s">)</span> <span class="s">{</span>
1864     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1865   <span class="s">}</span>
1866 
1867   <span class="c"># Are ring atoms with formal charge allowed to participate in electron delocalization?</span>
1868   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">AllowRingAtomFormalCharge</span>}<span class="s">)</span> <span class="s">{</span>
1869     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1870   <span class="s">}</span>
1871 
1872   <span class="c"># Are hetero ring atoms with formal charge allowed to participate in electron delocalization?</span>
1873   <span class="k">if</span> <span class="s">(</span>!<span class="i">$RingAtom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1874     <span class="k">if</span> <span class="s">(</span>!<span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">AllowHeteroRingAtomFormalCharge</span>}<span class="s">)</span> <span class="s">{</span>
1875       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1876     <span class="s">}</span>
1877   <span class="s">}</span>
1878 
1879   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1880 <span class="s">}</span>
1881 
1882 <span class="c">#</span>
1883 <span class="c"># Check ring atoms for allowed hetero atoms...</span>
1884 <span class="c">#</span>
<a name="_CheckPotentialAromaticRingAtomForAllowedHeteroAtoms-"></a>1885 <span class="k">sub </span><span class="m">_CheckPotentialAromaticRingAtomForAllowedHeteroAtoms</span> <span class="s">{</span>
1886   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1887   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomSymbol</span><span class="s">)</span><span class="sc">;</span>
1888 
1889   <span class="c"># Is it a Carbon atom?</span>
1890   <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;IsCarbon</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1891     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1892   <span class="s">}</span>
1893 
1894   <span class="c"># Are heteroatoms allowed?</span>
1895   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">AllowHeteroRingAtoms</span>}<span class="s">)</span> <span class="s">{</span>
1896     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1897   <span class="s">}</span>
1898 
1899   <span class="c"># Is it an allowed hetero atom?</span>
1900   <span class="i">$RingAtomSymbol</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetAtomSymbol</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1901   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">HeteroRingAtomsListMapRef</span>}-&gt;{<span class="i">$RingAtomSymbol</span>}<span class="s">)</span> <span class="s">{</span>
1902     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1903   <span class="s">}</span>
1904 
1905   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1906 <span class="s">}</span>
1907 
1908 <span class="c"># Check for any electron pair contributions toward pi electron delocalization due to</span>
1909 <span class="c"># -ve formal charge on ring atoms which haven&#39;t been already processed and part of</span>
1910 <span class="c"># conjugated single/double bond system...</span>
1911 <span class="c">#</span>
<a name="_GetElectronPairsContributionFromConjugatedRingAtoms-"></a>1912 <span class="k">sub </span><span class="m">_GetElectronPairsContributionFromConjugatedRingAtoms</span> <span class="s">{</span>
1913   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingBondsRef</span><span class="cm">,</span> <span class="i">$ExcludeFreeRadicalElectrons</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="cm">,</span> <span class="i">$ElectronPairContributionProcessedMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1914   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$RingBond</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$NumOfRingAtomElectronPairs</span><span class="cm">,</span> <span class="i">$RingAtomID</span><span class="s">)</span><span class="sc">;</span>
1915 
1916   <span class="c"># Is formal charge allowed on ring atoms?</span>
1917   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AromaticityModelDataRef</span>-&gt;{<span class="w">AllowRingAtomFormalCharge</span>}<span class="s">)</span> <span class="s">{</span>
1918     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1919   <span class="s">}</span>
1920 
1921   <span class="i">$NumOfRingAtomElectronPairs</span> = <span class="n">0</span><span class="sc">;</span>
1922 
1923   <span class="c"># Process ring atoms...</span>
1924   <span class="j">RINGBOND:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$RingBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
1925     <span class="i">$RingBond</span> = <span class="i">$RingBondsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1926     <span class="i">$RingAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
1927     <span class="i">$RingAtomID</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1928 
1929     <span class="c"># Is is already processed?</span>
1930     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ElectronPairContributionProcessedMapRef</span>-&gt;{<span class="i">$RingAtomID</span>}<span class="s">)</span> <span class="s">{</span>
1931       <span class="k">next</span> <span class="j">RINGBOND</span><span class="sc">;</span>
1932     <span class="s">}</span>
1933     <span class="i">$ElectronPairContributionProcessedMapRef</span>-&gt;{<span class="i">$RingAtomID</span>} = <span class="i">$RingAtomID</span><span class="sc">;</span>
1934 
1935     <span class="c"># Is it allowed to have any formal charge?</span>
1936     <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CheckPotentialAromaticRingAtomForFormalCharge</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1937       <span class="k">next</span> <span class="j">RINGBOND</span><span class="sc">;</span>
1938     <span class="s">}</span>
1939 
1940     <span class="c"># It it an allowed hetero ring atom or a carbon atom?</span>
1941     <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CheckPotentialAromaticRingAtomForAllowedHeteroAtoms</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$AromaticityModelDataRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1942       <span class="k">next</span> <span class="j">RINGBOND</span><span class="sc">;</span>
1943     <span class="s">}</span>
1944 
1945     <span class="c"># It is an atom with -ve formal charge?</span>
1946     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span> &gt;= <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
1947       <span class="k">next</span> <span class="j">RINGBOND</span><span class="sc">;</span>
1948     <span class="s">}</span>
1949 
1950     <span class="c"># Is it able to donate a pair for electrons towards pi electron delocalization?</span>
1951     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetValenceFreeElectrons</span><span class="s">(</span><span class="i">$ExcludeFreeRadicalElectrons</span><span class="s">)</span> &lt; <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
1952       <span class="k">next</span> <span class="j">RINGBOND</span><span class="sc">;</span>
1953     <span class="s">}</span>
1954     <span class="i">$NumOfRingAtomElectronPairs</span> += <span class="n">1</span><span class="sc">;</span>
1955   <span class="s">}</span>
1956 
1957   <span class="k">return</span> <span class="i">$NumOfRingAtomElectronPairs</span><span class="sc">;</span>
1958 <span class="s">}</span>
1959 
1960 <span class="c"># Check for ring atoms involved in two single ring bonds without any available electron</span>
1961 <span class="c"># pair which are allowed to participate in aromatic system, after all other checks</span>
1962 <span class="c"># corresponding to specified aromaticity models have already been performed...</span>
1963 <span class="c">#</span>
<a name="_AllowRingAtomInTwoSingleBondsWithoutElectronPair-"></a>1964 <span class="k">sub </span><span class="m">_AllowRingAtomInTwoSingleBondsWithoutElectronPair</span> <span class="s">{</span>
1965   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingBond</span><span class="cm">,</span> <span class="i">$PreviousRingBond</span><span class="cm">,</span> <span class="i">$ExocyclicDoubleBondsDataMapRef</span><span class="cm">,</span> <span class="i">$FusedRingBondsMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1966 
1967   <span class="j">ALLOWRINGATOM:</span> <span class="s">{</span>
1968     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ExocyclicDoubleBondsDataMapRef</span>-&gt;{<span class="w">RingAtomID</span>}{<span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span>}<span class="s">)</span> <span class="s">{</span>
1969       <span class="c"># Ring atom in an exocylic terminal double bond without any available electron pair...</span>
1970       <span class="k">last</span> <span class="j">ALLOWRINGATOM</span><span class="sc">;</span>
1971     <span class="s">}</span>
1972 
1973     <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span> &gt; <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
1974       <span class="c"># Ring atom with positive formal charge without any available electron pair...</span>
1975       <span class="k">last</span> <span class="j">ALLOWRINGATOM</span><span class="sc">;</span>
1976     <span class="s">}</span>
1977 
1978     <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$FusedRingBondsMapRef</span> &amp;&amp; <span class="s">(</span><span class="k">exists</span> <span class="i">$FusedRingBondsMapRef</span>-&gt;{<span class="i">$RingBond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span>} || <span class="k">exists</span> <span class="i">$FusedRingBondsMapRef</span>-&gt;{<span class="i">$PreviousRingBond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1979       <span class="c"># Ring atom involved in fused ring bond, which might end up being part of a conjugated</span>
1980       <span class="c"># system in another fused ring...</span>
1981       <span class="k">last</span> <span class="j">ALLOWRINGATOM</span><span class="sc">;</span>
1982     <span class="s">}</span>
1983 
1984     <span class="c"># Ring atom in any other environment is not allowed...</span>
1985     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1986   <span class="s">}</span>
1987 
1988   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1989 <span class="s">}</span>
1990 
1991 <span class="c"># Do pi electrons satify huckel&#39;s rule: Number of pi electrons correspond to 4n + 2 where</span>
1992 <span class="c"># n is a positive integer...</span>
1993 <span class="c">#</span>
<a name="_DoPiElectronSatifyHuckelsRule-"></a>1994 <span class="k">sub </span><span class="m">_DoPiElectronSatifyHuckelsRule</span> <span class="s">{</span>
1995   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NumOfPiElectrons</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1996 
1997   <span class="i">$NumOfPiElectrons</span> = <span class="i">$NumOfPiElectrons</span> - <span class="n">2</span><span class="sc">;</span>
1998 
1999   <span class="k">return</span> <span class="s">(</span><span class="i">$NumOfPiElectrons</span> &gt; <span class="n">0</span><span class="s">)</span> ? <span class="s">(</span><span class="s">(</span><span class="i">$NumOfPiElectrons</span> % <span class="n">4</span><span class="s">)</span> ? <span class="n">0</span> <span class="co">:</span> <span class="n">1</span><span class="s">)</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
2000 <span class="s">}</span>
2001 
2002 <span class="c"># Delete aromatic property for all atoms and bonds...</span>
2003 <span class="c">#</span>
<a name="_DeleteAtomsAndBondsAromaticity-"></a>2004 <span class="k">sub </span><span class="m">_DeleteAtomsAndBondsAromaticity</span> <span class="s">{</span>
2005   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2006   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span><span class="sc">;</span>
2007 
2008   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2009     <span class="i">$Atom</span><span class="i">-&gt;DeleteAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2010   <span class="s">}</span>
2011   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2012     <span class="i">$Bond</span><span class="i">-&gt;DeleteAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2013   <span class="s">}</span>
2014   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
2015 <span class="s">}</span>
2016 
2017 <span class="c"># Kekulize marked ring and non-ring aromatic atoms in a molecule...</span>
2018 <span class="c">#</span>
<a name="KekulizeAromaticAtoms-"></a>2019 <span class="k">sub </span><span class="m">KekulizeAromaticAtoms</span> <span class="s">{</span>
2020   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2021 
2022   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_KekulizeAromaticAtomsInRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2023     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2024   <span class="s">}</span>
2025 
2026   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_KekulizeAromaticAtomsNotInRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2027     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2028   <span class="s">}</span>
2029 
2030   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2031 <span class="s">}</span>
2032 
2033 <span class="c"># Kekulize marked aromatic atoms in rings and fused ring sets...</span>
2034 <span class="c">#</span>
<a name="_KekulizeAromaticAtomsInRings-"></a>2035 <span class="k">sub </span><span class="m">_KekulizeAromaticAtomsInRings</span> <span class="s">{</span>
2036   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2037 
2038   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2039     <span class="c"># Nothing to do...</span>
2040     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2041   <span class="s">}</span>
2042 
2043   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasAromaticAtomsInRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2044     <span class="c"># Nothing to do...</span>
2045     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2046   <span class="s">}</span>
2047 
2048   <span class="c"># Identify fully aromatic fused and individual rings along with any partially aromatic ring components</span>
2049   <span class="c"># using marked aromatic atoms in a molecule and kekulize them as individual stes...</span>
2050   <span class="c">#</span>
2051   <span class="k">my</span><span class="s">(</span><span class="i">$AromaticFusedRingSetsRef</span><span class="cm">,</span> <span class="i">$AromaticRingsRef</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="s">)</span> = <span class="s">(</span><span class="k">undef</span><span class="s">)</span> x <span class="n">3</span><span class="sc">;</span>
2052   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasFusedRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2053     <span class="s">(</span><span class="i">$AromaticFusedRingSetsRef</span><span class="cm">,</span> <span class="i">$AromaticRingsRef</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetFusedAndNonFusedRingsContainingAromaticAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2054   <span class="s">}</span>
2055   <span class="k">else</span> <span class="s">{</span>
2056     <span class="s">(</span><span class="i">$AromaticRingsRef</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetIndividualRingsContainingAromaticAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2057   <span class="s">}</span>
2058 
2059   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_KekulizeCompleteAndPartialAromaticRings</span><span class="s">(</span><span class="i">$AromaticFusedRingSetsRef</span><span class="cm">,</span> <span class="i">$AromaticRingsRef</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="s">)</span><span class="sc">;</span>
2060 <span class="s">}</span>
2061 
2062 <span class="c"># Identify fully aromatic fused and individual rings along with any partially aromatic ring components</span>
2063 <span class="c"># using marked aromatic atoms in a molecule...</span>
2064 <span class="c">#</span>
<a name="_GetFusedAndNonFusedRingsContainingAromaticAtoms-"></a>2065 <span class="k">sub </span><span class="m">_GetFusedAndNonFusedRingsContainingAromaticAtoms</span> <span class="s">{</span>
2066   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span>  = <span class="i">@_</span><span class="sc">;</span>
2067   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$SetAtomsCount</span><span class="cm">,</span> <span class="i">$SetAromaticAtomsCount</span><span class="cm">,</span> <span class="i">$FusedRingSetRef</span><span class="cm">,</span> <span class="i">$FusedRingSetsRef</span><span class="cm">,</span> <span class="i">$NonFusedRingsRef</span><span class="cm">,</span> <span class="i">$IndividualRingsRef</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingAtomsCount</span><span class="cm">,</span> <span class="i">$AromaticAtomsCount</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$NonFusedFullyAromaticRingsRef</span><span class="cm">,</span> <span class="i">$NonFusedPartiallyAromaticRingComponentsRef</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="cm">,</span> <span class="i">@FullyAromaticFusedRingSets</span><span class="cm">,</span> <span class="i">@PotentialFullyAromaticRings</span><span class="cm">,</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">@PotentialPartiallyAromaticRings</span><span class="cm">,</span> <span class="i">@PartiallyAromaticRingComponents</span><span class="s">)</span><span class="sc">;</span>
2068 
2069   <span class="i">@FullyAromaticFusedRingSets</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2070 
2071   <span class="i">@PotentialFullyAromaticRings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2072   <span class="i">@FullyAromaticRings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2073 
2074   <span class="i">@PotentialPartiallyAromaticRings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2075   <span class="i">@PartiallyAromaticRingComponents</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2076 
2077   <span class="s">(</span><span class="i">$FusedRingSetsRef</span><span class="cm">,</span> <span class="i">$NonFusedRingsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetFusedAndNonFusedRings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2078 
2079   <span class="c"># Go over fused ring sets...</span>
2080   <span class="j">RINGSET:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$FusedRingSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2081     <span class="i">$FusedRingSetRef</span> = <span class="i">$FusedRingSetsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
2082 
2083     <span class="i">$SetAtomsCount</span> = <span class="n">0</span><span class="sc">;</span>
2084     <span class="i">$SetAromaticAtomsCount</span> = <span class="n">0</span><span class="sc">;</span>
2085 
2086     <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FusedRingSetRef</span>}<span class="s">)</span> <span class="s">{</span>
2087       <span class="i">$SetAtomsCount</span> += <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="sc">;</span>
2088 
2089       <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2090         <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2091           <span class="i">$SetAromaticAtomsCount</span> += <span class="n">1</span><span class="sc">;</span>
2092         <span class="s">}</span>
2093       <span class="s">}</span>
2094     <span class="s">}</span>
2095 
2096     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$SetAtomsCount</span> &amp;&amp; <span class="i">$SetAromaticAtomsCount</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2097       <span class="k">next</span> <span class="j">RINGSET</span><span class="sc">;</span>
2098     <span class="s">}</span>
2099 
2100     <span class="k">if</span> <span class="s">(</span><span class="i">$SetAromaticAtomsCount</span> == <span class="i">$SetAtomsCount</span><span class="s">)</span> <span class="s">{</span>
2101       <span class="k">push</span> <span class="i">@FullyAromaticFusedRingSets</span><span class="cm">,</span> <span class="i">$FusedRingSetRef</span><span class="sc">;</span>
2102     <span class="s">}</span>
2103     <span class="k">else</span> <span class="s">{</span>
2104       <span class="c"># Identify any individual rings in partial aromatic fused ring sets which might be</span>
2105       <span class="c"># fully or partially aromatic...</span>
2106       <span class="c">#</span>
2107       <span class="j">RING:</span> <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FusedRingSetRef</span>}<span class="s">)</span> <span class="s">{</span>
2108         <span class="i">$RingAtomsCount</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="sc">;</span>
2109         <span class="i">$AromaticAtomsCount</span> = <span class="n">0</span><span class="sc">;</span>
2110 
2111         <span class="j">RINGATOM:</span> <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2112           <span class="k">if</span> <span class="s">(</span>!<span class="i">$RingAtom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2113             <span class="k">next</span> <span class="j">RINGATOM</span><span class="sc">;</span>
2114           <span class="s">}</span>
2115           <span class="i">$AromaticAtomsCount</span> += <span class="n">1</span><span class="sc">;</span>
2116         <span class="s">}</span>
2117 
2118         <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$RingAtomsCount</span> &amp;&amp; <span class="i">$AromaticAtomsCount</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2119           <span class="k">next</span> <span class="j">RING</span><span class="sc">;</span>
2120         <span class="s">}</span>
2121 
2122         <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtomsCount</span> == <span class="i">$AromaticAtomsCount</span><span class="s">)</span> <span class="s">{</span>
2123           <span class="k">push</span> <span class="i">@PotentialFullyAromaticRings</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="sc">;</span>
2124         <span class="s">}</span>
2125         <span class="k">else</span> <span class="s">{</span>
2126           <span class="c">#  Track partially aromatic rings in an different list before removing them for</span>
2127           <span class="c">#  any overlap with other rings and then add to fully aromatic rings...</span>
2128           <span class="k">push</span> <span class="i">@PotentialPartiallyAromaticRings</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="sc">;</span>
2129         <span class="s">}</span>
2130       <span class="s">}</span>
2131     <span class="s">}</span>
2132   <span class="s">}</span>
2133 
2134   <span class="k">if</span> <span class="s">(</span><span class="i">@PotentialFullyAromaticRings</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2135     <span class="c"># Get any fully aromatic fused ring subsets from potentially fully aromatic rings...</span>
2136     <span class="k">my</span><span class="s">(</span><span class="i">$FullyAromaticFusedRingSetsRefs</span><span class="cm">,</span> <span class="i">$FullyAromaticNonFusedRingsRef</span><span class="s">)</span><span class="sc">;</span>
2137     <span class="s">(</span><span class="i">$FullyAromaticFusedRingSetsRefs</span><span class="cm">,</span> <span class="i">$FullyAromaticNonFusedRingsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetFullyAromaticFusedAndNonFusedRingsInFusedSubset</span><span class="s">(</span>\<span class="i">@PotentialFullyAromaticRings</span><span class="s">)</span><span class="sc">;</span>
2138 
2139     <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FullyAromaticFusedRingSetsRefs</span>}<span class="s">)</span> <span class="s">{</span>
2140       <span class="k">push</span> <span class="i">@FullyAromaticFusedRingSets</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FullyAromaticFusedRingSetsRefs</span>}<span class="sc">;</span>
2141     <span class="s">}</span>
2142     <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FullyAromaticNonFusedRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2143       <span class="k">push</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FullyAromaticNonFusedRingsRef</span>}<span class="sc">;</span>
2144     <span class="s">}</span>
2145   <span class="s">}</span>
2146   <span class="k">else</span> <span class="s">{</span>
2147     <span class="k">push</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">@PotentialFullyAromaticRings</span><span class="sc">;</span>
2148   <span class="s">}</span>
2149 
2150   <span class="c"># Go over partial aromatic ring components...</span>
2151   <span class="k">if</span> <span class="s">(</span><span class="i">@PotentialPartiallyAromaticRings</span><span class="s">)</span> <span class="s">{</span>
2152     <span class="i">$PartiallyAromaticRingComponentsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GetPartiallyAromaticRingComponents</span><span class="s">(</span>\<span class="i">@PotentialPartiallyAromaticRings</span><span class="cm">,</span> \<span class="i">@PotentialFullyAromaticRings</span><span class="s">)</span><span class="sc">;</span>
2153     <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponentsRef</span>}<span class="s">)</span> <span class="s">{</span>
2154       <span class="k">push</span> <span class="i">@PartiallyAromaticRingComponents</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponentsRef</span>}<span class="sc">;</span>
2155     <span class="s">}</span>
2156   <span class="s">}</span>
2157 
2158   <span class="c"># Go over non-fused rings...</span>
2159   <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NonFusedRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2160     <span class="s">(</span><span class="i">$NonFusedFullyAromaticRingsRef</span><span class="cm">,</span> <span class="i">$NonFusedPartiallyAromaticRingComponentsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetRingsContainingAromaticAtoms</span><span class="s">(</span><span class="i">@</span>{<span class="i">$NonFusedRingsRef</span>}<span class="s">)</span><span class="sc">;</span>
2161 
2162     <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NonFusedFullyAromaticRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2163       <span class="k">push</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$NonFusedFullyAromaticRingsRef</span>}<span class="sc">;</span>
2164     <span class="s">}</span>
2165     <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NonFusedPartiallyAromaticRingComponentsRef</span>}<span class="s">)</span> <span class="s">{</span>
2166       <span class="k">push</span> <span class="i">@PartiallyAromaticRingComponents</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$NonFusedPartiallyAromaticRingComponentsRef</span>}<span class="sc">;</span>
2167     <span class="s">}</span>
2168   <span class="s">}</span>
2169 
2170   <span class="k">return</span> <span class="s">(</span>\<span class="i">@FullyAromaticFusedRingSets</span><span class="cm">,</span> \<span class="i">@FullyAromaticRings</span><span class="cm">,</span> \<span class="i">@PartiallyAromaticRingComponents</span><span class="s">)</span><span class="sc">;</span>
2171 <span class="s">}</span>
2172 
2173 <span class="c"># Identify fully aromatic fused sets and non-fused rings in potentially fully aromatic</span>
2174 <span class="c"># rings in fused ring sets...</span>
2175 <span class="c">#</span>
2176 <span class="c"># Fully aromatic rings in fused ring sets might contain fully aromatic fused subsets. These</span>
2177 <span class="c"># fused subets need to be tracked and treated as fused sets.</span>
2178 <span class="c">#</span>
2179 <span class="c"># Note:</span>
2180 <span class="c">#   . Fused ring sets share at least one common bond, which could be used to identify</span>
2181 <span class="c">#     any multiple fully aromatic fused rings sets; absence of a shared ring bond implies</span>
2182 <span class="c">#     there are no fused ring sets.</span>
2183 <span class="c">#</span>
2184 <span class="c">#</span>
<a name="_GetFullyAromaticFusedAndNonFusedRingsInFusedSubset-"></a>2185 <span class="k">sub </span><span class="m">_GetFullyAromaticFusedAndNonFusedRingsInFusedSubset</span> <span class="s">{</span>
2186   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PotentialFullyAromaticFusedRingsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2187   <span class="k">my</span><span class="s">(</span><span class="i">$RingIndex</span><span class="cm">,</span> <span class="i">$RingIndex1</span><span class="cm">,</span> <span class="i">$RingIndex2</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingAtomID</span><span class="cm">,</span> <span class="i">$RingIsFuesd</span><span class="cm">,</span> <span class="i">$RingIndicesGraph</span><span class="cm">,</span> <span class="i">$FusedRingSetIndicesRef</span><span class="cm">,</span> <span class="i">@RingIndices</span><span class="cm">,</span> <span class="i">@FusedRingPairIndices</span><span class="cm">,</span> <span class="i">@FusedRingSetIndicesRefs</span><span class="cm">,</span> <span class="i">@FullyAromaticFusedRingSets</span><span class="cm">,</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">%RingIndexToAtomIDMap</span><span class="cm">,</span> <span class="i">%FullyAromaticFusedRingIndexMap</span><span class="s">)</span><span class="sc">;</span>
2188 
2189   <span class="i">@FullyAromaticFusedRingSets</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2190   <span class="i">@FullyAromaticRings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2191 
2192   <span class="c"># Setup a ring index map for ring atoms...</span>
2193   <span class="c">#</span>
2194   <span class="i">%RingIndexToAtomIDMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2195   <span class="k">for</span> <span class="i">$RingIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$PotentialFullyAromaticFusedRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2196     <span class="i">%</span>{<span class="i">$RingIndexToAtomIDMap</span>{<span class="i">$RingIndex</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2197     <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PotentialFullyAromaticFusedRingsRef</span>-&gt;[<span class="i">$RingIndex</span>]}<span class="s">)</span> <span class="s">{</span>
2198       <span class="i">$RingAtomID</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2199       <span class="i">$RingIndexToAtomIDMap</span>{<span class="i">$RingIndex</span>}{<span class="i">$RingAtomID</span>} = <span class="i">$RingAtomID</span><span class="sc">;</span>
2200     <span class="s">}</span>
2201   <span class="s">}</span>
2202 
2203   <span class="c"># Identify fused ring pairs...</span>
2204   <span class="c">#</span>
2205   <span class="i">@RingIndices</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2206   <span class="i">@FusedRingPairIndices</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2207 
2208   <span class="k">for</span> <span class="i">$RingIndex1</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$PotentialFullyAromaticFusedRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2209     <span class="k">push</span> <span class="i">@RingIndices</span><span class="cm">,</span> <span class="i">$RingIndex1</span><span class="sc">;</span>
2210     <span class="k">for</span> <span class="i">$RingIndex2</span> <span class="s">(</span><span class="s">(</span><span class="i">$RingIndex1</span> + <span class="n">1</span><span class="s">)</span> .. <span class="i">$#</span>{<span class="i">$PotentialFullyAromaticFusedRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2211       <span class="i">$RingIsFuesd</span> = <span class="n">0</span><span class="sc">;</span>
2212       <span class="j">RINGATOM:</span> <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PotentialFullyAromaticFusedRingsRef</span>-&gt;[<span class="i">$RingIndex2</span>]}<span class="s">)</span> <span class="s">{</span>
2213         <span class="i">$RingAtomID</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2214         <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$RingIndexToAtomIDMap</span>{<span class="i">$RingIndex1</span>}{<span class="i">$RingAtomID</span>}<span class="s">)</span> <span class="s">{</span>
2215           <span class="i">$RingIsFuesd</span> = <span class="n">1</span><span class="sc">;</span>
2216           <span class="k">last</span> <span class="j">RINGATOM</span><span class="sc">;</span>
2217         <span class="s">}</span>
2218       <span class="s">}</span>
2219       <span class="k">if</span> <span class="s">(</span><span class="i">$RingIsFuesd</span><span class="s">)</span> <span class="s">{</span>
2220         <span class="k">push</span> <span class="i">@FusedRingPairIndices</span><span class="cm">,</span> <span class="s">(</span><span class="i">$RingIndex1</span><span class="cm">,</span> <span class="i">$RingIndex2</span><span class="s">)</span><span class="sc">;</span>
2221       <span class="s">}</span>
2222     <span class="s">}</span>
2223   <span class="s">}</span>
2224 
2225   <span class="k">if</span> <span class="s">(</span>!<span class="i">@FusedRingPairIndices</span><span class="s">)</span> <span class="s">{</span>
2226     <span class="c"># No fused ring subset out there...</span>
2227     <span class="k">push</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$PotentialFullyAromaticFusedRingsRef</span>}<span class="sc">;</span>
2228 
2229     <span class="k">return</span> <span class="s">(</span>\<span class="i">@FullyAromaticFusedRingSets</span><span class="cm">,</span> \<span class="i">@FullyAromaticRings</span><span class="s">)</span><span class="sc">;</span>
2230   <span class="s">}</span>
2231 
2232   <span class="c"># Identify fused ring sets...</span>
2233   <span class="c">#</span>
2234   <span class="i">$RingIndicesGraph</span> = <span class="i">new</span> <span class="i">Graph</span><span class="s">(</span><span class="i">@RingIndices</span><span class="s">)</span><span class="sc">;</span>
2235   <span class="i">$RingIndicesGraph</span><span class="i">-&gt;AddEdges</span><span class="s">(</span><span class="i">@FusedRingPairIndices</span><span class="s">)</span><span class="sc">;</span>
2236   <span class="i">@FusedRingSetIndicesRefs</span> = <span class="i">$RingIndicesGraph</span><span class="i">-&gt;GetConnectedComponentsVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2237 
2238   <span class="c"># Collect fully aromatic fused ring sets...</span>
2239   <span class="c">#</span>
2240   <span class="i">%FullyAromaticFusedRingIndexMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2241   <span class="k">for</span> <span class="i">$FusedRingSetIndicesRef</span> <span class="s">(</span><span class="i">@FusedRingSetIndicesRefs</span><span class="s">)</span> <span class="s">{</span>
2242     <span class="k">my</span><span class="s">(</span><span class="i">@FullyAromaticFusedRingSet</span><span class="s">)</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2243     <span class="k">for</span> <span class="i">$RingIndex</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FusedRingSetIndicesRef</span>}<span class="s">)</span> <span class="s">{</span>
2244       <span class="i">$FullyAromaticFusedRingIndexMap</span>{<span class="i">$RingIndex</span>} = <span class="i">$RingIndex</span><span class="sc">;</span>
2245       <span class="k">push</span> <span class="i">@FullyAromaticFusedRingSet</span><span class="cm">,</span> <span class="i">$PotentialFullyAromaticFusedRingsRef</span>-&gt;[<span class="i">$RingIndex</span>]<span class="sc">;</span>
2246     <span class="s">}</span>
2247     <span class="k">if</span> <span class="s">(</span><span class="i">@FullyAromaticFusedRingSet</span><span class="s">)</span> <span class="s">{</span>
2248       <span class="c"># Sort rings by size with in the fused ring set...</span>
2249       <span class="i">@FullyAromaticFusedRingSet</span> = <span class="k">sort</span> <span class="s">{</span> <span class="k">scalar</span> <span class="i">@$a</span> &lt;=&gt; <span class="k">scalar</span> <span class="i">@$b</span> <span class="s">}</span> <span class="i">@FullyAromaticFusedRingSet</span><span class="sc">;</span>
2250       <span class="k">push</span> <span class="i">@FullyAromaticFusedRingSets</span><span class="cm">,</span> \<span class="i">@FullyAromaticFusedRingSet</span><span class="sc">;</span>
2251     <span class="s">}</span>
2252   <span class="s">}</span>
2253 
2254   <span class="c"># Collect fully aromatic non-fused rings...</span>
2255   <span class="c">#</span>
2256   <span class="j">RINGINDEX:</span> <span class="k">for</span> <span class="i">$RingIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$PotentialFullyAromaticFusedRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2257     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$FullyAromaticFusedRingIndexMap</span>{<span class="i">$RingIndex</span>}<span class="s">)</span> <span class="s">{</span>
2258       <span class="k">next</span> <span class="j">RINGINDEX</span><span class="sc">;</span>
2259     <span class="s">}</span>
2260     <span class="k">push</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">$PotentialFullyAromaticFusedRingsRef</span>-&gt;[<span class="i">$RingIndex</span>]<span class="sc">;</span>
2261   <span class="s">}</span>
2262 
2263   <span class="k">return</span> <span class="s">(</span>\<span class="i">@FullyAromaticFusedRingSets</span><span class="cm">,</span> \<span class="i">@FullyAromaticRings</span><span class="s">)</span><span class="sc">;</span>
2264 <span class="s">}</span>
2265 
2266 <span class="c"># Identify individual non-fused rings containing aromatic atoms...</span>
2267 <span class="c">#</span>
<a name="_GetIndividualRingsContainingAromaticAtoms-"></a>2268 <span class="k">sub </span><span class="m">_GetIndividualRingsContainingAromaticAtoms</span> <span class="s">{</span>
2269   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span>  = <span class="i">@_</span><span class="sc">;</span>
2270 
2271   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRingsContainingAromaticAtoms</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
2272 <span class="s">}</span>
2273 
2274 <span class="c"># Identify individual non-fused rings containing aromatic atoms...</span>
2275 <span class="c">#</span>
<a name="_GetRingsContainingAromaticAtoms-"></a>2276 <span class="k">sub </span><span class="m">_GetRingsContainingAromaticAtoms</span> <span class="s">{</span>
2277   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Rings</span><span class="s">)</span>  = <span class="i">@_</span><span class="sc">;</span>
2278   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingAtomsCount</span><span class="cm">,</span> <span class="i">$AromaticAtomsCount</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="cm">,</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">@PartiallyAromaticRings</span><span class="s">)</span><span class="sc">;</span>
2279 
2280   <span class="i">@FullyAromaticRings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2281   <span class="i">@PartiallyAromaticRings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2282 
2283   <span class="j">RING:</span> <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@Rings</span><span class="s">)</span> <span class="s">{</span>
2284     <span class="i">$RingAtomsCount</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="sc">;</span>
2285     <span class="i">$AromaticAtomsCount</span> = <span class="n">0</span><span class="sc">;</span>
2286 
2287     <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2288       <span class="k">if</span> <span class="s">(</span><span class="i">$RingAtom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2289         <span class="i">$AromaticAtomsCount</span> += <span class="n">1</span><span class="sc">;</span>
2290       <span class="s">}</span>
2291     <span class="s">}</span>
2292 
2293     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$AromaticAtomsCount</span> &amp;&amp; <span class="i">$RingAtomsCount</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2294       <span class="k">next</span> <span class="j">RING</span><span class="sc">;</span>
2295     <span class="s">}</span>
2296 
2297     <span class="k">if</span> <span class="s">(</span><span class="i">$AromaticAtomsCount</span> == <span class="i">$RingAtomsCount</span><span class="s">)</span> <span class="s">{</span>
2298       <span class="k">push</span> <span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="sc">;</span>
2299     <span class="s">}</span>
2300     <span class="k">else</span> <span class="s">{</span>
2301       <span class="k">push</span> <span class="i">@PartiallyAromaticRings</span><span class="cm">,</span> <span class="i">$RingAtomsRef</span><span class="sc">;</span>
2302     <span class="s">}</span>
2303   <span class="s">}</span>
2304 
2305   <span class="i">$PartiallyAromaticRingComponentsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GetPartiallyAromaticRingComponents</span><span class="s">(</span>\<span class="i">@PartiallyAromaticRings</span><span class="s">)</span><span class="sc">;</span>
2306 
2307   <span class="k">return</span> <span class="s">(</span>\<span class="i">@FullyAromaticRings</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="s">)</span><span class="sc">;</span>
2308 <span class="s">}</span>
2309 
2310 <span class="c"># Get connected aromatic components with in partially aromatic rings...</span>
2311 <span class="c">#</span>
<a name="_GetPartiallyAromaticRingComponents-"></a>2312 <span class="k">sub </span><span class="m">_GetPartiallyAromaticRingComponents</span> <span class="s">{</span>
2313   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PotentialPartiallyAromaticRingsRef</span><span class="cm">,</span> <span class="i">$FullyAromaticRingsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2314   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="cm">,</span> <span class="i">$RingAtomID</span><span class="cm">,</span> <span class="i">$Index</span><span class="cm">,</span> <span class="i">@PartiallyAromaticRingComponents</span><span class="cm">,</span> <span class="i">%FullyAromaticRingAtomsMap</span><span class="s">)</span><span class="sc">;</span>
2315 
2316   <span class="i">@PartiallyAromaticRingComponents</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2317 
2318   <span class="c"># Setup a map for atoms involve in fully aromatic rings to remove remove partial rings</span>
2319   <span class="c"># containing only those atoms which are already part of some other fully aromatic ring</span>
2320   <span class="c"># in fused ring scenarios or some other partially aromatic ring...</span>
2321   <span class="c">#</span>
2322   <span class="i">%FullyAromaticRingAtomsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2323   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$FullyAromaticRingsRef</span><span class="s">)</span> <span class="s">{</span>
2324     <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FullyAromaticRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2325       <span class="k">for</span> <span class="i">$RingAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2326         <span class="i">$RingAtomID</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2327         <span class="i">$FullyAromaticRingAtomsMap</span>{<span class="i">$RingAtomID</span>} = <span class="i">$RingAtomID</span><span class="sc">;</span>
2328       <span class="s">}</span>
2329     <span class="s">}</span>
2330   <span class="s">}</span>
2331 
2332   <span class="c"># . Identify any connected components with in each partially aromatic ring.</span>
2333   <span class="c"># . Use ring atom indices to figure out connnected components in rings: All ring atoms</span>
2334   <span class="c">#   in a connected component have sequential indices and a difference by more than</span>
2335   <span class="c">#   1 indicates a new component in the list.</span>
2336   <span class="c">#</span>
2337   <span class="j">RING:</span> <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PotentialPartiallyAromaticRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2338     <span class="k">my</span><span class="s">(</span><span class="i">@AromaticRingAtoms</span><span class="cm">,</span> <span class="i">@AromaticRingAtomsIndices</span><span class="s">)</span><span class="sc">;</span>
2339 
2340     <span class="i">@AromaticRingAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2341     <span class="i">@AromaticRingAtomsIndices</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2342 
2343     <span class="j">RINGATOM:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2344       <span class="i">$RingAtom</span> = <span class="i">$RingAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
2345       <span class="i">$RingAtomID</span> = <span class="i">$RingAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2346 
2347       <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$FullyAromaticRingsRef</span> &amp;&amp; <span class="k">exists</span> <span class="i">$FullyAromaticRingAtomsMap</span>{<span class="i">$RingAtomID</span>}<span class="s">)</span> <span class="s">{</span>
2348         <span class="k">next</span> <span class="j">RINGATOM</span><span class="sc">;</span>
2349       <span class="s">}</span>
2350       <span class="k">if</span> <span class="s">(</span>!<span class="i">$RingAtom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2351         <span class="k">next</span> <span class="j">RINGATOM</span><span class="sc">;</span>
2352       <span class="s">}</span>
2353       <span class="k">push</span> <span class="i">@AromaticRingAtoms</span><span class="cm">,</span> <span class="i">$RingAtom</span><span class="sc">;</span>
2354       <span class="k">push</span> <span class="i">@AromaticRingAtomsIndices</span><span class="cm">,</span> <span class="i">$Index</span><span class="sc">;</span>
2355 
2356     <span class="s">}</span>
2357     <span class="k">if</span> <span class="s">(</span>!<span class="i">@AromaticRingAtoms</span><span class="s">)</span> <span class="s">{</span>
2358       <span class="k">next</span> <span class="j">RING</span><span class="sc">;</span>
2359     <span class="s">}</span>
2360 
2361     <span class="c"># Start off with a new connected component...</span>
2362     <span class="c">#</span>
2363     <span class="k">my</span><span class="s">(</span><span class="i">$ComponentNum</span><span class="s">)</span><span class="sc">;</span>
2364     <span class="i">$ComponentNum</span> = <span class="k">scalar</span> <span class="i">@PartiallyAromaticRingComponents</span><span class="sc">;</span>
2365     <span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponents</span>[<span class="i">$ComponentNum</span>]} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2366 
2367     <span class="i">$Index</span> = <span class="n">0</span><span class="sc">;</span>
2368     <span class="k">push</span> <span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponents</span>[<span class="i">$ComponentNum</span>]}<span class="cm">,</span> <span class="i">$AromaticRingAtoms</span>[<span class="i">$Index</span>]<span class="sc">;</span>
2369 
2370     <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$#AromaticRingAtoms</span><span class="s">)</span> <span class="s">{</span>
2371       <span class="k">if</span> <span class="s">(</span><span class="s">(</span><span class="i">$AromaticRingAtomsIndices</span>[<span class="i">$Index</span>] - <span class="i">$AromaticRingAtomsIndices</span>[<span class="i">$Index</span> -<span class="n">1</span>]<span class="s">)</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2372         <span class="c"># New connected component...</span>
2373         <span class="i">$ComponentNum</span> += <span class="n">1</span><span class="sc">;</span>
2374         <span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponents</span>[<span class="i">$ComponentNum</span>]} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2375       <span class="s">}</span>
2376       <span class="k">push</span> <span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponents</span>[<span class="i">$ComponentNum</span>]}<span class="cm">,</span> <span class="i">$AromaticRingAtoms</span>[<span class="i">$Index</span>]<span class="sc">;</span>
2377     <span class="s">}</span>
2378   <span class="s">}</span>
2379 
2380   <span class="k">return</span> <span class="s">(</span>\<span class="i">@PartiallyAromaticRingComponents</span><span class="s">)</span><span class="sc">;</span>
2381 <span class="s">}</span>
2382 
2383 <span class="c"># Kekulize fully aromatic fused and individual rings along with any partially aromatic ring</span>
2384 <span class="c"># components...</span>
2385 <span class="c">#</span>
<a name="_KekulizeCompleteAndPartialAromaticRings-"></a>2386 <span class="k">sub </span><span class="m">_KekulizeCompleteAndPartialAromaticRings</span> <span class="s">{</span>
2387   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AromaticFusedRingSetsRef</span><span class="cm">,</span> <span class="i">$AromaticRingsRef</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2388   <span class="k">my</span><span class="s">(</span><span class="i">$Status</span><span class="cm">,</span> <span class="i">$ConnectedPathsAtomsSetsRef</span><span class="cm">,</span> <span class="i">$ConnectedPathsBondsSetsRef</span><span class="cm">,</span> <span class="i">$ConnectdPathsSetsTypesRef</span><span class="cm">,</span> <span class="i">$PathSetIndex</span><span class="cm">,</span> <span class="i">$PathAtom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$BondID</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$DeleteAtomsAromaticity</span><span class="cm">,</span> <span class="i">$DeleteBondsAromaticity</span><span class="cm">,</span> <span class="i">%PathAtomsProcessingStatusMap</span><span class="cm">,</span> <span class="i">%PathBondsProcessingStatusMap</span><span class="s">)</span><span class="sc">;</span>
2389 
2390   <span class="s">(</span><span class="i">$ConnectedPathsAtomsSetsRef</span><span class="cm">,</span> <span class="i">$ConnectedPathsBondsSetsRef</span><span class="cm">,</span> <span class="i">$ConnectdPathsSetsTypesRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_SetupCompleteAndPartialAromaticRingsForKekulizaiton</span><span class="s">(</span><span class="i">$AromaticFusedRingSetsRef</span><span class="cm">,</span> <span class="i">$AromaticRingsRef</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="s">)</span><span class="sc">;</span>
2391 
2392   <span class="k">if</span> <span class="s">(</span>!<span class="i">@</span>{<span class="i">$ConnectedPathsAtomsSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2393     <span class="c"># Nothing to do...</span>
2394     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2395   <span class="s">}</span>
2396 
2397   <span class="c"># Delete any aromaticity property set for non-ring bonds connected any two ring</span>
2398   <span class="c"># aromatic atoms...</span>
2399   <span class="c">#</span>
2400   <span class="i">$This</span><span class="i">-&gt;_ProcessNonRingAromaticBondsBetweenAromaticRingAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2401 
2402   <span class="i">%PathAtomsProcessingStatusMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2403   <span class="i">%PathBondsProcessingStatusMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2404 
2405   <span class="i">$Status</span> = <span class="n">1</span><span class="sc">;</span>
2406 
2407   <span class="j">PATHSET:</span> <span class="k">for</span> <span class="i">$PathSetIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$ConnectedPathsAtomsSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2408     <span class="k">my</span><span class="s">(</span><span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathSetProcessingStatusRef</span><span class="s">)</span><span class="sc">;</span>
2409 
2410     <span class="s">(</span><span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathSetProcessingStatusRef</span><span class="s">)</span> = <span class="s">(</span><span class="k">undef</span><span class="s">)</span> x <span class="n">3</span><span class="sc">;</span>
2411 
2412     <span class="k">if</span> <span class="s">(</span><span class="i">$ConnectdPathsSetsTypesRef</span>-&gt;[<span class="i">$PathSetIndex</span>] =~ <span class="q">/^FusedAromatic$/i</span><span class="s">)</span> <span class="s">{</span>
2413       <span class="c"># Fused set of connected paths...</span>
2414       <span class="c">#</span>
2415       <span class="k">my</span><span class="s">(</span><span class="i">$FusedConnectedPathAtomsSetRef</span><span class="cm">,</span> <span class="i">$FusedConnectedPathBondsSetRef</span><span class="s">)</span><span class="sc">;</span>
2416 
2417       <span class="i">$FusedConnectedPathAtomsSetRef</span> = <span class="i">$ConnectedPathsAtomsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]<span class="sc">;</span>
2418       <span class="i">$FusedConnectedPathBondsSetRef</span> = <span class="i">$ConnectedPathsBondsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]<span class="sc">;</span>
2419 
2420       <span class="c"># Prepare for kekulization...</span>
2421       <span class="s">(</span><span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathSetProcessingStatusRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_SetupConnectedPathSetsForKekulization</span><span class="s">(</span><span class="i">$FusedConnectedPathAtomsSetRef</span><span class="cm">,</span> <span class="i">$FusedConnectedPathBondsSetRef</span><span class="s">)</span><span class="sc">;</span>
2422 
2423       <span class="c"># Perform kekulization starting with the first path set...</span>
2424       <span class="i">$PathSetProcessingStatusRef</span>-&gt;[<span class="n">0</span>] = <span class="q">&#39;Processed&#39;</span><span class="sc">;</span>
2425       <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_KekulizeConnectedPathSets</span><span class="s">(</span><span class="i">$FusedConnectedPathAtomsSetRef</span>-&gt;[<span class="n">0</span>]<span class="cm">,</span>  <span class="i">$FusedConnectedPathBondsSetRef</span>-&gt;[<span class="n">0</span>]<span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$FusedConnectedPathAtomsSetRef</span><span class="cm">,</span> <span class="i">$FusedConnectedPathBondsSetRef</span><span class="cm">,</span> <span class="i">$PathSetProcessingStatusRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2426         <span class="c"># Kekulization failed for the current fused paths set...</span>
2427         <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
2428       <span class="s">}</span>
2429     <span class="s">}</span>
2430     <span class="k">else</span> <span class="s">{</span>
2431       <span class="c"># An individual connected path...</span>
2432       <span class="c">#</span>
2433       <span class="k">my</span><span class="s">(</span><span class="i">@ConnectedPathAtomsSet</span><span class="cm">,</span> <span class="i">@ConnectedPathBondsSet</span><span class="s">)</span><span class="sc">;</span>
2434 
2435       <span class="i">@ConnectedPathAtomsSet</span> = <span class="s">(</span><span class="i">$ConnectedPathsAtomsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]<span class="s">)</span><span class="sc">;</span>
2436       <span class="i">@ConnectedPathBondsSet</span> = <span class="s">(</span><span class="i">$ConnectedPathsBondsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]<span class="s">)</span><span class="sc">;</span>
2437 
2438       <span class="c"># Prepare for kekulization...</span>
2439       <span class="s">(</span><span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_SetupConnectedPathSetsForKekulization</span><span class="s">(</span>\<span class="i">@ConnectedPathAtomsSet</span><span class="cm">,</span> \<span class="i">@ConnectedPathBondsSet</span><span class="s">)</span><span class="sc">;</span>
2440 
2441       <span class="c"># Perform kekulization...</span>
2442       <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_KekulizeConnectedPathSets</span><span class="s">(</span><span class="i">$ConnectedPathsAtomsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]<span class="cm">,</span> <span class="i">$ConnectedPathsBondsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]<span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2443         <span class="c"># Kekulization failed for the current path...</span>
2444         <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
2445       <span class="s">}</span>
2446     <span class="s">}</span>
2447 
2448     <span class="c"># Did kekulization succeed for the current path or path set?</span>
2449     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Status</span><span class="s">)</span> <span class="s">{</span>
2450       <span class="k">last</span> <span class="j">PATHSET</span><span class="sc">;</span>
2451     <span class="s">}</span>
2452 
2453     <span class="c"># Track atom and bond processing state for final assignment after kekulization</span>
2454     <span class="c"># is successfully completed for all the paths and fused path sets...</span>
2455     <span class="c">#</span>
2456     <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$AtomProcessingStatusMapRef</span>}<span class="s">)</span> <span class="s">{</span>
2457       <span class="i">$PathAtomsProcessingStatusMap</span>{<span class="i">$AtomID</span>} = <span class="i">$AtomProcessingStatusMapRef</span>-&gt;{<span class="i">$AtomID</span>}<span class="sc">;</span>
2458     <span class="s">}</span>
2459 
2460     <span class="k">for</span> <span class="i">$BondID</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$BondProcessingStatusMapRef</span>}<span class="s">)</span> <span class="s">{</span>
2461       <span class="i">$PathBondsProcessingStatusMap</span>{<span class="i">$BondID</span>} = <span class="i">$BondProcessingStatusMapRef</span>-&gt;{<span class="i">$BondID</span>}<span class="sc">;</span>
2462     <span class="s">}</span>
2463   <span class="s">}</span>
2464 
2465   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Status</span><span class="s">)</span> <span class="s">{</span>
2466     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_KekulizeCompleteAndPartialAromaticRings: Couldn&#39;t perform kekulization for marked ring aromatic atoms...&quot;</span><span class="sc">;</span>
2467     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2468   <span class="s">}</span>
2469 
2470   <span class="c"># Use PathAtomsProcessingStatusMap and PathBondsProcessingStatusMap to set</span>
2471   <span class="c"># single/double bonds in the molecule after successful kekulization along with modification of</span>
2472   <span class="c"># any aromatic flags...</span>
2473 
2474   <span class="k">for</span> <span class="i">$PathSetIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$ConnectedPathsAtomsSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2475     <span class="i">$DeleteAtomsAromaticity</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$DeleteBondsAromaticity</span> = <span class="n">0</span><span class="sc">;</span>
2476 
2477     <span class="k">if</span> <span class="s">(</span><span class="i">$ConnectdPathsSetsTypesRef</span>-&gt;[<span class="i">$PathSetIndex</span>] =~ <span class="q">/^FusedAromatic$/i</span><span class="s">)</span> <span class="s">{</span>
2478       <span class="k">for</span> <span class="i">$PathBondsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ConnectedPathsBondsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]}<span class="s">)</span> <span class="s">{</span>
2479         <span class="i">$This</span><span class="i">-&gt;_ProcessBondOrdersAssignedDuringSuccessfulKekulization</span><span class="s">(</span><span class="i">$PathBondsRef</span><span class="cm">,</span> \<span class="i">%PathBondsProcessingStatusMap</span><span class="cm">,</span> <span class="i">$DeleteBondsAromaticity</span><span class="s">)</span><span class="sc">;</span>
2480       <span class="s">}</span>
2481     <span class="s">}</span>
2482     <span class="k">else</span> <span class="s">{</span>
2483       <span class="k">if</span> <span class="s">(</span><span class="i">$ConnectdPathsSetsTypesRef</span>-&gt;[<span class="i">$PathSetIndex</span>] =~ <span class="q">/^PartiallyAromatic$/i</span> <span class="s">)</span> <span class="s">{</span>
2484         <span class="i">$DeleteBondsAromaticity</span> = <span class="n">1</span><span class="sc">;</span> <span class="i">$DeleteAtomsAromaticity</span> = <span class="n">1</span><span class="sc">;</span>
2485       <span class="s">}</span>
2486 
2487       <span class="k">if</span> <span class="s">(</span><span class="i">$DeleteAtomsAromaticity</span><span class="s">)</span> <span class="s">{</span>
2488         <span class="k">for</span> <span class="i">$PathAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ConnectedPathsAtomsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]}<span class="s">)</span> <span class="s">{</span>
2489           <span class="i">$PathAtom</span><span class="i">-&gt;DeleteAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2490         <span class="s">}</span>
2491       <span class="s">}</span>
2492 
2493       <span class="i">$This</span><span class="i">-&gt;_ProcessBondOrdersAssignedDuringSuccessfulKekulization</span><span class="s">(</span><span class="i">$ConnectedPathsBondsSetsRef</span>-&gt;[<span class="i">$PathSetIndex</span>]<span class="cm">,</span> \<span class="i">%PathBondsProcessingStatusMap</span><span class="cm">,</span> <span class="i">$DeleteBondsAromaticity</span><span class="s">)</span><span class="sc">;</span>
2494     <span class="s">}</span>
2495   <span class="s">}</span>
2496 
2497   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2498 <span class="s">}</span>
2499 
2500 <span class="c"># Look for any aromatic bonds outside the rings between two ring aromatic atoms</span>
2501 <span class="c"># and turn them into single non-aromatic bonds before kekulization; otherwise, kekulization</span>
2502 <span class="c"># fails.</span>
2503 <span class="c">#</span>
2504 <span class="c"># Note:</span>
2505 <span class="c">#   . Two atoms marked as aromatic atoms in two different rings, such as two rings</span>
2506 <span class="c">#     connected through a single bond, are still aromatic, but the bond is outside</span>
2507 <span class="c">#     the ring and shouldn&#39;t be marked as aromatic. It should be set to single bond without</span>
2508 <span class="c">#     any aromatic property for kekulization to succeed.</span>
2509 <span class="c">#</span>
2510 <span class="c">#     For example, the molecule  generated by SMILES parser for biphenyl SMILES string</span>
2511 <span class="c">#     &quot;c1ccccc1c2ccccc2&quot; sets up an aromatic bond between the two phenyl rings, as</span>
2512 <span class="c">#     it&#39;s connected to two aromatic atoms.</span>
2513 <span class="c">#</span>
<a name="_ProcessNonRingAromaticBondsBetweenAromaticRingAtoms-"></a>2514 <span class="k">sub </span><span class="m">_ProcessNonRingAromaticBondsBetweenAromaticRingAtoms</span> <span class="s">{</span>
2515   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2516   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="cm">,</span> <span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
2517 
2518   <span class="j">BOND:</span> <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2519     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$Bond</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span> &amp;&amp; <span class="i">$Bond</span><span class="i">-&gt;IsNotInRing</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2520       <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
2521     <span class="s">}</span>
2522 
2523     <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2524     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span> &amp;&amp; <span class="i">$Atom2</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span> &amp;&amp; <span class="i">$Atom1</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span> &amp;&amp; <span class="i">$Atom2</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2525       <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
2526     <span class="s">}</span>
2527 
2528     <span class="i">$Bond</span><span class="i">-&gt;SetBondOrder</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
2529     <span class="i">$Bond</span><span class="i">-&gt;DeleteAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2530   <span class="s">}</span>
2531 
2532   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
2533 <span class="s">}</span>
2534 
2535 <span class="c"># Setup completelty aromatic fused and individual rings along with partially aromatic ring</span>
2536 <span class="c"># components as sets of connected paths...</span>
2537 <span class="c">#</span>
<a name="_SetupCompleteAndPartialAromaticRingsForKekulizaiton-"></a>2538 <span class="k">sub </span><span class="m">_SetupCompleteAndPartialAromaticRingsForKekulizaiton</span> <span class="s">{</span>
2539   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AromaticFusedRingSetsRef</span><span class="cm">,</span> <span class="i">$AromaticRingsRef</span><span class="cm">,</span> <span class="i">$PartiallyAromaticRingComponentsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2540   <span class="k">my</span><span class="s">(</span><span class="i">@ConnectedPathsSets</span><span class="cm">,</span> <span class="i">@ConnectedPathsBondsSets</span><span class="cm">,</span> <span class="i">@ConnectdPathsSetsTypes</span><span class="s">)</span><span class="sc">;</span>
2541 
2542   <span class="i">@ConnectedPathsSets</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2543   <span class="i">@ConnectedPathsBondsSets</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2544   <span class="i">@ConnectdPathsSetsTypes</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2545 
2546   <span class="c"># Setup atoms and bonds for connected paths in fused aromatic ring sets...</span>
2547   <span class="c">#</span>
2548   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AromaticFusedRingSetsRef</span> &amp;&amp; <span class="i">@</span>{<span class="i">$AromaticFusedRingSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2549     <span class="k">my</span><span class="s">(</span><span class="i">$RingSetIndex</span><span class="s">)</span><span class="sc">;</span>
2550 
2551     <span class="k">push</span> <span class="i">@ConnectdPathsSetsTypes</span><span class="cm">,</span> <span class="s">(</span><span class="q">&#39;FusedAromatic&#39;</span><span class="s">)</span> x <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$AromaticFusedRingSetsRef</span>}<span class="sc">;</span>
2552     <span class="k">push</span> <span class="i">@ConnectedPathsSets</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$AromaticFusedRingSetsRef</span>}<span class="sc">;</span>
2553 
2554     <span class="k">for</span> <span class="i">$RingSetIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$AromaticFusedRingSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2555       <span class="k">my</span><span class="s">(</span><span class="i">@AromaticFusedRingBondsSet</span><span class="s">)</span><span class="sc">;</span>
2556 
2557       <span class="c"># Get ring bonds for each ring set...</span>
2558       <span class="c">#</span>
2559       <span class="i">@AromaticFusedRingBondsSet</span> = <span class="i">$This</span><span class="i">-&gt;GetRingBondsFromRings</span><span class="s">(</span><span class="i">@</span>{<span class="i">$AromaticFusedRingSetsRef</span>-&gt;[<span class="i">$RingSetIndex</span>]}<span class="s">)</span><span class="sc">;</span>
2560       <span class="k">push</span> <span class="i">@ConnectedPathsBondsSets</span><span class="cm">,</span> \<span class="i">@AromaticFusedRingBondsSet</span><span class="sc">;</span>
2561     <span class="s">}</span>
2562   <span class="s">}</span>
2563 
2564   <span class="c"># Set up atoms and bonds for connected paths in aromatic rings...</span>
2565   <span class="c">#</span>
2566   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$AromaticRingsRef</span> &amp;&amp; <span class="i">@</span>{<span class="i">$AromaticRingsRef</span>}<span class="s">)</span> <span class="s">{</span>
2567     <span class="k">my</span><span class="s">(</span><span class="i">@AromaticRingBondsSets</span><span class="s">)</span><span class="sc">;</span>
2568 
2569     <span class="k">push</span> <span class="i">@ConnectdPathsSetsTypes</span><span class="cm">,</span> <span class="s">(</span><span class="q">&#39;Aromatic&#39;</span><span class="s">)</span> x <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$AromaticRingsRef</span>}<span class="sc">;</span>
2570     <span class="k">push</span> <span class="i">@ConnectedPathsSets</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$AromaticRingsRef</span>}<span class="sc">;</span>
2571 
2572     <span class="c"># Get ring bonds for each ring...</span>
2573     <span class="i">@AromaticRingBondsSets</span> = <span class="i">$This</span><span class="i">-&gt;GetRingBondsFromRings</span><span class="s">(</span><span class="i">@</span>{<span class="i">$AromaticRingsRef</span>}<span class="s">)</span><span class="sc">;</span>
2574     <span class="k">push</span> <span class="i">@ConnectedPathsBondsSets</span><span class="cm">,</span> <span class="i">@AromaticRingBondsSets</span><span class="sc">;</span>
2575   <span class="s">}</span>
2576 
2577   <span class="c"># Set up atoms and bonds for connected paths in partially aromatic rings...</span>
2578   <span class="c">#</span>
2579   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span> <span class="i">$PartiallyAromaticRingComponentsRef</span> &amp;&amp; <span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponentsRef</span>}<span class="s">)</span> <span class="s">{</span>
2580     <span class="k">my</span><span class="s">(</span><span class="i">$ComponentIndex</span><span class="s">)</span><span class="sc">;</span>
2581 
2582     <span class="k">push</span> <span class="i">@ConnectedPathsSets</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponentsRef</span>}<span class="sc">;</span>
2583     <span class="k">push</span> <span class="i">@ConnectdPathsSetsTypes</span><span class="cm">,</span> <span class="s">(</span><span class="q">&#39;PartiallyAromatic&#39;</span><span class="s">)</span> x <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponentsRef</span>}<span class="sc">;</span>
2584 
2585     <span class="k">for</span> <span class="i">$ComponentIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$PartiallyAromaticRingComponentsRef</span>}<span class="s">)</span> <span class="s">{</span>
2586       <span class="k">my</span><span class="s">(</span><span class="i">@ComponentBonds</span><span class="s">)</span><span class="sc">;</span>
2587       <span class="i">@ComponentBonds</span> = <span class="i">$This</span><span class="i">-&gt;_GetPathBonds</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_GetAtomsIDsFromAtoms</span><span class="s">(</span><span class="i">@</span>{<span class="i">$PartiallyAromaticRingComponentsRef</span>-&gt;[<span class="i">$ComponentIndex</span>]}<span class="s">)</span><span class="s">)</span><span class="sc">;</span>
2588       <span class="k">push</span> <span class="i">@ConnectedPathsBondsSets</span><span class="cm">,</span> \<span class="i">@ComponentBonds</span><span class="sc">;</span>
2589     <span class="s">}</span>
2590   <span class="s">}</span>
2591 
2592   <span class="k">return</span> <span class="s">(</span>\<span class="i">@ConnectedPathsSets</span><span class="cm">,</span> \<span class="i">@ConnectedPathsBondsSets</span><span class="cm">,</span> \<span class="i">@ConnectdPathsSetsTypes</span><span class="s">)</span><span class="sc">;</span>
2593 <span class="s">}</span>
2594 
2595 <span class="c"># Process non-ring connected atoms which are marked aromatic and set connected</span>
2596 <span class="c"># bonds as alternate single/double bonds...</span>
2597 <span class="c">#</span>
2598 <span class="c"># Notes:</span>
2599 <span class="c">#   . Atom and bond aromaticity is deleted during kekulization of non-ring atoms.</span>
2600 <span class="c">#</span>
<a name="_KekulizeAromaticAtomsNotInRings-"></a>2601 <span class="k">sub </span><span class="m">_KekulizeAromaticAtomsNotInRings</span> <span class="s">{</span>
2602   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2603   <span class="k">my</span><span class="s">(</span><span class="i">$Status</span><span class="cm">,</span> <span class="i">$PathIndex</span><span class="cm">,</span> <span class="i">$PathAtom</span><span class="cm">,</span> <span class="i">$PathAtomID</span><span class="cm">,</span> <span class="i">$PathBondID</span><span class="cm">,</span> <span class="i">$ConnectedPathsAtomsRef</span><span class="cm">,</span> <span class="i">$ConnectedPathsBondsRef</span><span class="cm">,</span> <span class="i">$DeleteAtomsAromaticity</span><span class="cm">,</span> <span class="i">$DeleteBondsAromaticity</span><span class="cm">,</span> <span class="i">%PathAtomsProcessingStatusMap</span><span class="cm">,</span> <span class="i">%PathBondsProcessingStatusMap</span><span class="s">)</span><span class="sc">;</span>
2604 
2605   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasAromaticAtomsNotInRings</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2606     <span class="c"># Nothing to do...</span>
2607     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2608   <span class="s">}</span>
2609 
2610   <span class="c"># Identify paths for connected components containing non-ring aromatic atoms...</span>
2611   <span class="s">(</span><span class="i">$ConnectedPathsAtomsRef</span><span class="cm">,</span> <span class="i">$ConnectedPathsBondsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetConnectedComponentsPathsForNonRingAromaticAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2612 
2613   <span class="k">if</span> <span class="s">(</span>!<span class="i">@</span>{<span class="i">$ConnectedPathsAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2614     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_KekulizeAromaticAtomsNotInRings: Couldn&#39;t perform kekulization for marked non-ring aromatic atoms...&quot;</span><span class="sc">;</span>
2615     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2616   <span class="s">}</span>
2617 
2618   <span class="i">%PathAtomsProcessingStatusMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2619   <span class="i">%PathBondsProcessingStatusMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2620 
2621   <span class="i">$Status</span> = <span class="n">1</span><span class="sc">;</span>
2622 
2623   <span class="j">PATH:</span> <span class="k">for</span> <span class="i">$PathIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$ConnectedPathsAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2624     <span class="k">my</span><span class="s">(</span><span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">@ConnectedPathAtomsSet</span><span class="cm">,</span> <span class="i">@ConnectedPathBondsSet</span><span class="s">)</span><span class="sc">;</span>
2625 
2626     <span class="s">(</span><span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span> = <span class="s">(</span><span class="k">undef</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
2627 
2628     <span class="i">@ConnectedPathAtomsSet</span> = <span class="s">(</span><span class="i">$ConnectedPathsAtomsRef</span>-&gt;[<span class="i">$PathIndex</span>]<span class="s">)</span><span class="sc">;</span>
2629     <span class="i">@ConnectedPathBondsSet</span> = <span class="s">(</span><span class="i">$ConnectedPathsBondsRef</span>-&gt;[<span class="i">$PathIndex</span>]<span class="s">)</span><span class="sc">;</span>
2630 
2631     <span class="c"># Prepare for kekulization...</span>
2632     <span class="s">(</span><span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_SetupConnectedPathSetsForKekulization</span><span class="s">(</span>\<span class="i">@ConnectedPathAtomsSet</span><span class="cm">,</span> \<span class="i">@ConnectedPathBondsSet</span><span class="s">)</span><span class="sc">;</span>
2633 
2634     <span class="c"># Perform kekulization...</span>
2635     <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_KekulizeConnectedPathSets</span><span class="s">(</span><span class="i">$ConnectedPathsAtomsRef</span>-&gt;[<span class="i">$PathIndex</span>]<span class="cm">,</span> <span class="i">$ConnectedPathsBondsRef</span>-&gt;[<span class="i">$PathIndex</span>]<span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2636       <span class="c"># Kekulization failed for the current path...</span>
2637       <span class="i">$Status</span> = <span class="n">0</span><span class="sc">;</span>
2638       <span class="k">last</span> <span class="j">PATH</span><span class="sc">;</span>
2639     <span class="s">}</span>
2640 
2641     <span class="c"># Track atom and bond processing state for final assignment after kekulization</span>
2642     <span class="c"># is successfully completed for all the paths and fused path sets...</span>
2643     <span class="c">#</span>
2644     <span class="k">for</span> <span class="i">$PathAtomID</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$AtomProcessingStatusMapRef</span>}<span class="s">)</span> <span class="s">{</span>
2645       <span class="i">$PathAtomsProcessingStatusMap</span>{<span class="i">$PathAtomID</span>} = <span class="i">$AtomProcessingStatusMapRef</span>-&gt;{<span class="i">$PathAtomID</span>}<span class="sc">;</span>
2646     <span class="s">}</span>
2647 
2648     <span class="k">for</span> <span class="i">$PathBondID</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$BondProcessingStatusMapRef</span>}<span class="s">)</span> <span class="s">{</span>
2649       <span class="i">$PathBondsProcessingStatusMap</span>{<span class="i">$PathBondID</span>} = <span class="i">$BondProcessingStatusMapRef</span>-&gt;{<span class="i">$PathBondID</span>}<span class="sc">;</span>
2650     <span class="s">}</span>
2651   <span class="s">}</span>
2652 
2653   <span class="k">if</span> <span class="s">(</span>!<span class="i">$Status</span><span class="s">)</span> <span class="s">{</span>
2654     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_KekulizeAromaticAtomsNotInRings: Couldn&#39;t perform kekulization for marked non-ring aromatic atoms...&quot;</span><span class="sc">;</span>
2655     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2656   <span class="s">}</span>
2657 
2658   <span class="i">$DeleteAtomsAromaticity</span> = <span class="n">1</span><span class="sc">;</span> <span class="i">$DeleteBondsAromaticity</span> = <span class="n">1</span><span class="sc">;</span>
2659   <span class="k">for</span> <span class="i">$PathIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$ConnectedPathsAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2660     <span class="k">if</span> <span class="s">(</span><span class="i">$DeleteAtomsAromaticity</span><span class="s">)</span> <span class="s">{</span>
2661       <span class="k">for</span> <span class="i">$PathAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ConnectedPathsAtomsRef</span>-&gt;[<span class="i">$PathIndex</span>]}<span class="s">)</span> <span class="s">{</span>
2662         <span class="i">$PathAtom</span><span class="i">-&gt;DeleteAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2663       <span class="s">}</span>
2664     <span class="s">}</span>
2665     <span class="i">$This</span><span class="i">-&gt;_ProcessBondOrdersAssignedDuringSuccessfulKekulization</span><span class="s">(</span><span class="i">$ConnectedPathsBondsRef</span>-&gt;[<span class="i">$PathIndex</span>]<span class="cm">,</span> \<span class="i">%PathBondsProcessingStatusMap</span><span class="cm">,</span> <span class="i">$DeleteBondsAromaticity</span><span class="s">)</span><span class="sc">;</span>
2666   <span class="s">}</span>
2667 
2668   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2669 <span class="s">}</span>
2670 
2671 <span class="c"># Collect path atoms for connected components paths containing non-ring aromatic atoms...</span>
2672 <span class="c">#</span>
<a name="_GetConnectedComponentsPathsForNonRingAromaticAtoms-"></a>2673 <span class="k">sub </span><span class="m">_GetConnectedComponentsPathsForNonRingAromaticAtoms</span> <span class="s">{</span>
2674   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2675   <span class="k">my</span><span class="s">(</span><span class="i">$ComponentRef</span><span class="cm">,</span> <span class="i">$AtomIDsRef</span><span class="cm">,</span> <span class="i">$AtomIDsMapRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsAtomIDsRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsAtomIDsMapRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsPathsAtomIDsRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsPathsAtomsRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsPathsBondsRef</span><span class="s">)</span><span class="sc">;</span>
2676 
2677   <span class="c"># Retrieve information for marked aromatic atoms not in the rings...</span>
2678   <span class="s">(</span><span class="i">$AtomIDsRef</span><span class="cm">,</span> <span class="i">$AtomIDsMapRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetNonRingAromaticAtomIDs</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2679 
2680   <span class="c"># Identify connected components containing marked aromatic atoms not in the rings...</span>
2681   <span class="s">(</span><span class="i">$ConnectedComponentsAtomIDsRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsAtomIDsMapRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetConnectedComponentsForNonRingAromaticAtoms</span><span class="s">(</span><span class="i">$AtomIDsRef</span><span class="s">)</span><span class="sc">;</span>
2682 
2683   <span class="c"># Identify paths for connected components containing non-ring aromatic atoms...</span>
2684   <span class="s">(</span><span class="i">$ConnectedComponentsPathsAtomsRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsPathsBondsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetConnectedComponentsPathsAtomsAndBondsForNonRingAromaticAtoms</span><span class="s">(</span><span class="i">$AtomIDsMapRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsAtomIDsRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsAtomIDsMapRef</span><span class="s">)</span><span class="sc">;</span>
2685 
2686   <span class="k">return</span> <span class="s">(</span><span class="i">$ConnectedComponentsPathsAtomsRef</span><span class="cm">,</span> <span class="i">$ConnectedComponentsPathsBondsRef</span><span class="s">)</span><span class="sc">;</span>
2687 <span class="s">}</span>
2688 
2689 <span class="c"># Collect information for marked aromatic atoms not in the rings...</span>
2690 <span class="c">#</span>
<a name="_GetNonRingAromaticAtomIDs-"></a>2691 <span class="k">sub </span><span class="m">_GetNonRingAromaticAtomIDs</span> <span class="s">{</span>
2692   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2693   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="cm">,</span> <span class="i">%AtomIDsMap</span><span class="s">)</span><span class="sc">;</span>
2694 
2695   <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2696   <span class="i">%AtomIDsMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2697 
2698   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2699     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2700       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
2701     <span class="s">}</span>
2702     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2703       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
2704     <span class="s">}</span>
2705     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2706 
2707     <span class="k">push</span> <span class="i">@AtomIDs</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="sc">;</span>
2708     <span class="i">$AtomIDsMap</span>{<span class="i">$AtomID</span>} = <span class="i">$Atom</span><span class="sc">;</span>
2709   <span class="s">}</span>
2710 
2711   <span class="k">return</span> <span class="s">(</span>\<span class="i">@AtomIDs</span><span class="cm">,</span> \<span class="i">%AtomIDsMap</span><span class="s">)</span><span class="sc">;</span>
2712 <span class="s">}</span>
2713 
2714 <span class="c"># Retrieve connected non-ring atom components as a reference to an array of references</span>
2715 <span class="c"># containing atom IDs of connecnted components...</span>
2716 <span class="c">#</span>
<a name="_GetConnectedComponentsForNonRingAromaticAtoms-"></a>2717 <span class="k">sub </span><span class="m">_GetConnectedComponentsForNonRingAromaticAtoms</span> <span class="s">{</span>
2718   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomIDsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2719   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomIDsGraph</span><span class="cm">,</span> <span class="i">@BondedAtomPairIDs</span><span class="cm">,</span> <span class="i">@ComponentsAtomIDsRefs</span><span class="cm">,</span> <span class="i">@ComponentsAtomIDsMapRefs</span><span class="s">)</span><span class="sc">;</span>
2720 
2721   <span class="i">@ComponentsAtomIDsRefs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2722   <span class="i">@ComponentsAtomIDsMapRefs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2723 
2724   <span class="c"># Get bonded atom pair IDs...</span>
2725   <span class="i">@BondedAtomPairIDs</span> = <span class="i">$This</span><span class="i">-&gt;_GetBondedAtomPairAtomIDsFromAtomIDs</span><span class="s">(</span><span class="i">@</span>{<span class="i">$AtomIDsRef</span>}<span class="s">)</span><span class="sc">;</span>
2726 
2727   <span class="k">if</span> <span class="s">(</span>!<span class="i">@BondedAtomPairIDs</span><span class="s">)</span> <span class="s">{</span>
2728     <span class="k">return</span> <span class="s">(</span>\<span class="i">@ComponentsAtomIDsRefs</span><span class="cm">,</span> \<span class="i">@ComponentsAtomIDsMapRefs</span><span class="s">)</span><span class="sc">;</span>
2729   <span class="s">}</span>
2730 
2731   <span class="i">$AtomIDsGraph</span> = <span class="i">new</span> <span class="i">Graph</span><span class="s">(</span><span class="i">@</span>{<span class="i">$AtomIDsRef</span>}<span class="s">)</span><span class="sc">;</span>
2732   <span class="i">$AtomIDsGraph</span><span class="i">-&gt;AddEdges</span><span class="s">(</span><span class="i">@BondedAtomPairIDs</span><span class="s">)</span><span class="sc">;</span>
2733 
2734   <span class="i">@ComponentsAtomIDsRefs</span> = <span class="i">$AtomIDsGraph</span><span class="i">-&gt;GetConnectedComponentsVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2735 
2736   <span class="c"># Setup atom IDs map for each component...</span>
2737   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#ComponentsAtomIDsRefs</span><span class="s">)</span> <span class="s">{</span>
2738     <span class="i">%</span>{<span class="i">$ComponentsAtomIDsMapRefs</span>[<span class="i">$Index</span>]} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2739 
2740     <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ComponentsAtomIDsRefs</span>[<span class="i">$Index</span>]}<span class="s">)</span> <span class="s">{</span>
2741       <span class="i">$ComponentsAtomIDsMapRefs</span>[<span class="i">$Index</span>]{<span class="i">$AtomID</span>} = <span class="i">$AtomID</span><span class="sc">;</span>
2742     <span class="s">}</span>
2743   <span class="s">}</span>
2744 
2745   <span class="k">return</span> <span class="s">(</span>\<span class="i">@ComponentsAtomIDsRefs</span><span class="cm">,</span> \<span class="i">@ComponentsAtomIDsMapRefs</span><span class="s">)</span><span class="sc">;</span>
2746 <span class="s">}</span>
2747 
2748 <span class="c"># Get linear paths for connected components starting and ending at terminal aromatic atoms,</span>
2749 <span class="c"># which are connected to only one other aromatic atom in the connected component..</span>
2750 <span class="c">#</span>
<a name="_GetConnectedComponentsPathsAtomsAndBondsForNonRingAromaticAtoms-"></a>2751 <span class="k">sub </span><span class="m">_GetConnectedComponentsPathsAtomsAndBondsForNonRingAromaticAtoms</span> <span class="s">{</span>
2752   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomIDsMapRef</span><span class="cm">,</span> <span class="i">$ComponentsAtomIDsRef</span><span class="cm">,</span> <span class="i">$ComponentsAtomIDsMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2753   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomNbr</span><span class="cm">,</span> <span class="i">$AtomNbrID</span><span class="cm">,</span> <span class="i">$NumOfNonRingAromaticNbrs</span><span class="cm">,</span> <span class="i">$AtomIndex1</span><span class="cm">,</span> <span class="i">$AtomIndex2</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="cm">,</span> <span class="i">$AtomIDsGraph</span><span class="cm">,</span> <span class="i">$StartTerminalAtomID</span><span class="cm">,</span> <span class="i">$EndTerminalAtomID</span><span class="cm">,</span> <span class="i">@Paths</span><span class="cm">,</span> <span class="i">@PathAtomIDs</span><span class="cm">,</span> <span class="i">@PathsAtoms</span><span class="cm">,</span> <span class="i">@PathsBonds</span><span class="cm">,</span> <span class="i">@TerminalAtomIDs</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="cm">,</span> <span class="i">@BondedAtomPairIDs</span><span class="s">)</span><span class="sc">;</span>
2754 
2755   <span class="i">@PathsAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2756   <span class="i">@PathsBonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2757 
2758   <span class="i">@TerminalAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2759 
2760   <span class="i">$Index</span> = <span class="n">0</span><span class="sc">;</span>
2761   <span class="j">COMPONENT:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$ComponentsAtomIDsRef</span>}<span class="s">)</span> <span class="s">{</span>
2762     <span class="i">@</span>{<span class="i">$TerminalAtomIDs</span>[<span class="i">$Index</span>]} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2763 
2764     <span class="c"># Identify terminal atoms for connected components...</span>
2765     <span class="c">#</span>
2766     <span class="c"># Notes:</span>
2767     <span class="c">#   . Terminal atoms are defined as atoms connected to only one marked</span>
2768     <span class="c">#     aromatic atom.</span>
2769     <span class="c">#   . Linear connected compoents contain only two terminal atoms.</span>
2770     <span class="c">#</span>
2771     <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ComponentsAtomIDsRef</span>-&gt;[<span class="i">$Index</span>]}<span class="s">)</span> <span class="s">{</span>
2772       <span class="i">$Atom</span> = <span class="i">$AtomIDsMapRef</span>-&gt;{<span class="i">$AtomID</span>}<span class="sc">;</span>
2773       <span class="i">$NumOfNonRingAromaticNbrs</span> = <span class="n">0</span><span class="sc">;</span>
2774 
2775       <span class="j">ATOMNBRID:</span> <span class="k">for</span> <span class="i">$AtomNbr</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNeighbors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2776         <span class="i">$AtomNbrID</span> = <span class="i">$AtomNbr</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2777 
2778         <span class="c"># Is neighbor in the same connected components containing aromatic atoms?</span>
2779         <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$ComponentsAtomIDsMapRef</span>-&gt;[<span class="i">$Index</span>]{<span class="i">$AtomNbrID</span>}<span class="s">)</span> <span class="s">{</span>
2780           <span class="k">next</span> <span class="j">ATOMNBRID</span><span class="sc">;</span>
2781         <span class="s">}</span>
2782         <span class="i">$NumOfNonRingAromaticNbrs</span>++<span class="sc">;</span>
2783       <span class="s">}</span>
2784 
2785       <span class="c"># Is it a terminal atom?</span>
2786       <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfNonRingAromaticNbrs</span> != <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2787         <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
2788       <span class="s">}</span>
2789       <span class="k">push</span> <span class="i">@</span>{<span class="i">$TerminalAtomIDs</span>[<span class="i">$Index</span>]}<span class="cm">,</span> <span class="i">$AtomID</span><span class="sc">;</span>
2790     <span class="s">}</span>
2791 
2792     <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$TerminalAtomIDs</span>[<span class="i">$Index</span>]} != <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
2793       <span class="k">next</span> <span class="j">COMPONENT</span><span class="sc">;</span>
2794     <span class="s">}</span>
2795 
2796     <span class="c"># Setup bonded atom pair IDs for connected component...</span>
2797     <span class="c">#</span>
2798     <span class="i">@AtomIDs</span> = <span class="i">@</span>{<span class="i">$ComponentsAtomIDsRef</span>-&gt;[<span class="i">$Index</span>]}<span class="sc">;</span>
2799     <span class="i">@BondedAtomPairIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2800 
2801     <span class="k">for</span> <span class="i">$AtomIndex1</span> <span class="s">(</span> <span class="n">0</span> .. <span class="i">$#AtomIDs</span><span class="s">)</span> <span class="s">{</span>
2802       <span class="i">$AtomID1</span> = <span class="i">$AtomIDs</span>[<span class="i">$AtomIndex1</span>]<span class="sc">;</span>
2803       <span class="i">$Atom1</span> = <span class="i">$AtomIDsMapRef</span>-&gt;{<span class="i">$AtomID1</span>}<span class="sc">;</span>
2804 
2805       <span class="k">for</span> <span class="i">$AtomIndex2</span> <span class="s">(</span> <span class="s">(</span><span class="i">$AtomIndex1</span> + <span class="n">1</span><span class="s">)</span> .. <span class="i">$#AtomIDs</span><span class="s">)</span> <span class="s">{</span>
2806         <span class="i">$AtomID2</span> = <span class="i">$AtomIDs</span>[<span class="i">$AtomIndex2</span>]<span class="sc">;</span>
2807         <span class="i">$Atom2</span> = <span class="i">$AtomIDsMapRef</span>-&gt;{<span class="i">$AtomID2</span>}<span class="sc">;</span>
2808 
2809         <span class="k">if</span> <span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;IsBondedToAtom</span><span class="s">(</span><span class="i">$Atom2</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2810           <span class="k">push</span> <span class="i">@BondedAtomPairIDs</span><span class="cm">,</span> <span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
2811         <span class="s">}</span>
2812       <span class="s">}</span>
2813     <span class="s">}</span>
2814 
2815     <span class="k">if</span> <span class="s">(</span>!<span class="i">@BondedAtomPairIDs</span><span class="s">)</span> <span class="s">{</span>
2816       <span class="k">next</span> <span class="j">COMPONENT</span><span class="sc">;</span>
2817     <span class="s">}</span>
2818 
2819     <span class="c"># Get path for connected component...</span>
2820     <span class="i">$AtomIDsGraph</span> = <span class="i">new</span> <span class="i">Graph</span><span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
2821     <span class="i">$AtomIDsGraph</span><span class="i">-&gt;AddEdges</span><span class="s">(</span><span class="i">@BondedAtomPairIDs</span><span class="s">)</span><span class="sc">;</span>
2822 
2823     <span class="s">(</span><span class="i">$StartTerminalAtomID</span><span class="cm">,</span> <span class="i">$EndTerminalAtomID</span><span class="s">)</span> = <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span>  <span class="i">@</span>{<span class="i">$TerminalAtomIDs</span>[<span class="i">$Index</span>]}<span class="sc">;</span>
2824     <span class="i">@Paths</span> = <span class="i">$AtomIDsGraph</span><span class="i">-&gt;GetPathsBetween</span><span class="s">(</span><span class="i">$StartTerminalAtomID</span><span class="cm">,</span> <span class="i">$EndTerminalAtomID</span><span class="s">)</span><span class="sc">;</span>
2825 
2826     <span class="k">if</span> <span class="s">(</span><span class="i">@Paths</span> != <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
2827       <span class="k">next</span> <span class="j">COMPONENT</span><span class="sc">;</span>
2828     <span class="s">}</span>
2829 
2830     <span class="i">@PathAtomIDs</span> = <span class="i">$Paths</span>[<span class="n">0</span>]<span class="i">-&gt;GetVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2831 
2832     <span class="k">my</span><span class="s">(</span><span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
2833     <span class="i">@PathAtoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsFromAtomIDs</span><span class="s">(</span><span class="i">@PathAtomIDs</span><span class="s">)</span><span class="sc">;</span>
2834     <span class="k">push</span> <span class="i">@PathsAtoms</span><span class="cm">,</span> \<span class="i">@PathAtoms</span><span class="sc">;</span>
2835 
2836     <span class="k">my</span><span class="s">(</span><span class="i">@PathBonds</span><span class="s">)</span><span class="sc">;</span>
2837     <span class="i">@PathBonds</span> = <span class="i">$This</span><span class="i">-&gt;_GetPathBonds</span><span class="s">(</span><span class="i">@PathAtomIDs</span><span class="s">)</span><span class="sc">;</span>
2838     <span class="k">push</span> <span class="i">@PathsBonds</span><span class="cm">,</span> \<span class="i">@PathBonds</span><span class="sc">;</span>
2839 
2840   <span class="s">}</span>
2841 
2842   <span class="k">return</span> <span class="s">(</span>\<span class="i">@PathsAtoms</span><span class="cm">,</span> \<span class="i">@PathsBonds</span><span class="s">)</span><span class="sc">;</span>
2843 <span class="s">}</span>
2844 
2845 <span class="c"># Setup initial processing status of atoms and bonds involved in connected paths</span>
2846 <span class="c"># before starting kekulization...</span>
2847 <span class="c">#</span>
2848 <span class="c"># Possible atom processing status: DoubleBondPossible, DoubleBondAssigned, DoubleBondNotPossible</span>
2849 <span class="c"># Initial status: DoubleBondPossible or DoubleBondNotPossible</span>
2850 <span class="c">#</span>
2851 <span class="c"># Possible bond processing status: DoubleBondAssigned, SingleBondAssigned, NotProcessed</span>
2852 <span class="c">#</span>
2853 <span class="c"># Possible paths processing status: Processed, NotProcessed</span>
2854 <span class="c"># Initial status: NotProcessed</span>
2855 <span class="c">#</span>
<a name="_SetupConnectedPathSetsForKekulization-"></a>2856 <span class="k">sub </span><span class="m">_SetupConnectedPathSetsForKekulization</span> <span class="s">{</span>
2857   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2858   <span class="k">my</span><span class="s">(</span><span class="i">$PathIndex</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondID</span><span class="cm">,</span> <span class="i">%AtomProcessingStatusMap</span><span class="cm">,</span> <span class="i">%BondProcessingStatusMap</span><span class="cm">,</span> <span class="i">@PathsProcessingStatus</span><span class="cm">,</span> <span class="i">%InitialPathBondOrderMap</span><span class="s">)</span><span class="sc">;</span>
2859 
2860   <span class="c"># Possible path set status values: Processed, NotProcessed</span>
2861   <span class="c"># Initial value: NotProcessed</span>
2862   <span class="c">#</span>
2863   <span class="i">@PathsProcessingStatus</span> = <span class="s">(</span><span class="q">&#39;NotProcessed&#39;</span><span class="s">)</span> x <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PathAtomsSetsRef</span>}<span class="sc">;</span>
2864 
2865   <span class="c"># Collect initial bond order of path bonds before setting bond orders to 1</span>
2866   <span class="c"># and use it to set the bond order back to intial value after it has been processed for</span>
2867   <span class="c"># availability of double bonds...</span>
2868   <span class="c">#</span>
2869   <span class="i">%InitialPathBondOrderMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2870   <span class="k">for</span> <span class="i">$PathBondsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathBondsSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2871     <span class="j">BOND:</span> <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
2872       <span class="i">$BondID</span> = <span class="i">$Bond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2873       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$InitialPathBondOrderMap</span>{<span class="i">$BondID</span>}<span class="s">)</span> <span class="s">{</span>
2874         <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
2875       <span class="s">}</span>
2876       <span class="i">$InitialPathBondOrderMap</span>{<span class="i">$BondID</span>} = <span class="i">$Bond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2877       <span class="i">$Bond</span><span class="i">-&gt;SetBondOrder</span><span class="s">(</span><span class="n">1</span><span class="s">)</span><span class="sc">;</span>
2878     <span class="s">}</span>
2879   <span class="s">}</span>
2880 
2881   <span class="i">%AtomProcessingStatusMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2882   <span class="i">%BondProcessingStatusMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2883 
2884   <span class="k">for</span> <span class="i">$PathIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$PathAtomsSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2885 
2886     <span class="i">$PathAtomsRef</span> = <span class="i">$PathAtomsSetsRef</span>-&gt;[<span class="i">$PathIndex</span>]<span class="sc">;</span>
2887     <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
2888       <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2889       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$AtomProcessingStatusMap</span>{<span class="i">$AtomID</span>}<span class="s">)</span> <span class="s">{</span>
2890         <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
2891       <span class="s">}</span>
2892       <span class="i">$AtomProcessingStatusMap</span>{<span class="i">$AtomID</span>} = <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetNumOfBondsAvailableForNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span> &gt;= <span class="n">1</span><span class="s">)</span> ? <span class="q">&#39;DoubleBondPossible&#39;</span> <span class="co">:</span> <span class="q">&#39;DoubleBondNotPossible&#39;</span><span class="sc">;</span>
2893     <span class="s">}</span>
2894 
2895     <span class="i">$PathBondsRef</span> = <span class="i">$PathBondsSetsRef</span>-&gt;[<span class="i">$PathIndex</span>]<span class="sc">;</span>
2896     <span class="j">BOND:</span> <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
2897       <span class="i">$BondID</span> = <span class="i">$Bond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2898       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$BondProcessingStatusMap</span>{<span class="i">$BondID</span>}<span class="s">)</span> <span class="s">{</span>
2899         <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
2900       <span class="s">}</span>
2901       <span class="i">$BondProcessingStatusMap</span>{<span class="i">$BondID</span>} = <span class="q">&#39;NotProcessed&#39;</span><span class="sc">;</span>
2902     <span class="s">}</span>
2903   <span class="s">}</span>
2904 
2905   <span class="c"># Set bond orders back to initial bond orders...</span>
2906   <span class="k">for</span> <span class="i">$PathIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$PathAtomsSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
2907     <span class="i">$PathBondsRef</span> = <span class="i">$PathBondsSetsRef</span>-&gt;[<span class="i">$PathIndex</span>]<span class="sc">;</span>
2908 
2909     <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
2910       <span class="i">$BondID</span> = <span class="i">$Bond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2911       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$InitialPathBondOrderMap</span>{<span class="i">$BondID</span>}<span class="s">)</span> <span class="s">{</span>
2912         <span class="i">$Bond</span><span class="i">-&gt;SetBondOrder</span><span class="s">(</span><span class="i">$InitialPathBondOrderMap</span>{<span class="i">$BondID</span>}<span class="s">)</span><span class="sc">;</span>
2913       <span class="s">}</span>
2914     <span class="s">}</span>
2915   <span class="s">}</span>
2916 
2917   <span class="k">return</span> <span class="s">(</span>\<span class="i">%AtomProcessingStatusMap</span><span class="cm">,</span> \<span class="i">%BondProcessingStatusMap</span><span class="cm">,</span> \<span class="i">@PathsProcessingStatus</span><span class="s">)</span><span class="sc">;</span>
2918 <span class="s">}</span>
2919 
2920 <span class="c"># Kekulize connected path sets corresponding to fused rings, individual rings, or any other</span>
2921 <span class="c"># connected path...</span>
2922 <span class="c">#</span>
2923 <span class="c"># Note:</span>
2924 <span class="c">#   . PathAtomsRef and PathBondsRef contain paths and bonds corresponding to path</span>
2925 <span class="c">#     under consideration for kekulization</span>
2926 <span class="c">#   . PathAtomsSetsRef and PathBondsSetsRef contain any other available paths fused</span>
2927 <span class="c">#     to the path being kekulized</span>
2928 <span class="c">#   . _KekulizeConnectedPathSets is invoked recursively to kekulize all available paths</span>
2929 <span class="c">#</span>
<a name="_KekulizeConnectedPathSets-"></a>2930 <span class="k">sub </span><span class="m">_KekulizeConnectedPathSets</span> <span class="s">{</span>
2931   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="cm">,</span> <span class="i">$PathsProcessingStatusRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2932   <span class="k">my</span><span class="s">(</span><span class="i">$PathBond</span><span class="s">)</span><span class="sc">;</span>
2933 
2934   <span class="c"># Get next available path bond...</span>
2935   <span class="i">$PathBond</span> = <span class="i">$This</span><span class="i">-&gt;_GetNextAvailablePathBondForKekulization</span><span class="s">(</span><span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span><span class="sc">;</span>
2936 
2937   <span class="k">if</span> <span class="s">(</span><span class="i">$PathBond</span><span class="s">)</span> <span class="s">{</span>
2938     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_ProcessNextAvailablePathBondForKekulization</span><span class="s">(</span><span class="i">$PathBond</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="cm">,</span> <span class="i">$PathsProcessingStatusRef</span><span class="s">)</span><span class="sc">;</span>
2939   <span class="s">}</span>
2940 
2941   <span class="c"># Did kekulization succeed for the current path bonds?</span>
2942   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_DidKekulizationSucceedForPathBonds</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
2943     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
2944   <span class="s">}</span>
2945 
2946   <span class="c"># Is there any other path available for kekulization?</span>
2947   <span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetNextAvailablePathForKekulization</span><span class="s">(</span><span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="cm">,</span> <span class="i">$PathsProcessingStatusRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span><span class="sc">;</span>
2948 
2949   <span class="k">if</span> <span class="s">(</span><span class="i">$PathAtomsRef</span> &amp;&amp; <span class="i">$PathBondsRef</span><span class="s">)</span> <span class="s">{</span>
2950     <span class="c"># Recursively call itself to kekulize next path, which could either be a new path or part</span>
2951     <span class="c"># of a fused paths corresponding to fused ring sets...</span>
2952     <span class="c">#</span>
2953     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_KekulizeConnectedPathSets</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="cm">,</span> <span class="i">$PathsProcessingStatusRef</span><span class="s">)</span><span class="sc">;</span>
2954   <span class="s">}</span>
2955 
2956   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
2957 <span class="s">}</span>
2958 
2959 <span class="c"># Get next available path bond in a list of path bonds...</span>
2960 <span class="c">#</span>
<a name="_GetNextAvailablePathBondForKekulization-"></a>2961 <span class="k">sub </span><span class="m">_GetNextAvailablePathBondForKekulization</span> <span class="s">{</span>
2962   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2963   <span class="k">my</span><span class="s">(</span><span class="i">$AvailablePathBond</span><span class="cm">,</span> <span class="i">$PathBond</span><span class="cm">,</span> <span class="i">$PathBondID</span><span class="s">)</span><span class="sc">;</span>
2964 
2965   <span class="i">$AvailablePathBond</span> = <span class="k">undef</span><span class="sc">;</span>
2966 
2967   <span class="j">BOND:</span> <span class="k">for</span> <span class="i">$PathBond</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathBondsRef</span>}<span class="s">)</span> <span class="s">{</span>
2968     <span class="i">$PathBondID</span> = <span class="i">$PathBond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2969     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$BondProcessingStatusMapRef</span>-&gt;{<span class="i">$PathBondID</span>}<span class="s">)</span> <span class="s">{</span>
2970       <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
2971     <span class="s">}</span>
2972     <span class="k">if</span> <span class="s">(</span><span class="i">$BondProcessingStatusMapRef</span>-&gt;{<span class="i">$PathBondID</span>} =~ <span class="q">/^NotProcessed$/i</span><span class="s">)</span> <span class="s">{</span>
2973       <span class="i">$AvailablePathBond</span> = <span class="i">$PathBond</span><span class="sc">;</span>
2974       <span class="k">last</span> <span class="j">BOND</span><span class="sc">;</span>
2975     <span class="s">}</span>
2976   <span class="s">}</span>
2977 
2978   <span class="k">return</span> <span class="s">(</span><span class="i">$AvailablePathBond</span><span class="s">)</span><span class="sc">;</span>
2979 <span class="s">}</span>
2980 
2981 <span class="c"># Process next available path bond for kekulizaiton...</span>
2982 <span class="c">#</span>
<a name="_ProcessNextAvailablePathBondForKekulization-"></a>2983 <span class="k">sub </span><span class="m">_ProcessNextAvailablePathBondForKekulization</span> <span class="s">{</span>
2984   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathBond</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="cm">,</span> <span class="i">$PathsProcessingStatusRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
2985   <span class="k">my</span><span class="s">(</span><span class="i">$PathBondID</span><span class="cm">,</span> <span class="i">$PathAtom1</span><span class="cm">,</span> <span class="i">$PathAtom2</span><span class="cm">,</span> <span class="i">$PathAtomID1</span><span class="cm">,</span> <span class="i">$PathAtomID2</span><span class="cm">,</span> <span class="i">%CurrentAtomProcessingStatusMap</span><span class="cm">,</span> <span class="i">%CurrentBondProcessingStatusMap</span><span class="s">)</span><span class="sc">;</span>
2986 
2987   <span class="i">$PathBondID</span> = <span class="i">$PathBond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2988 
2989   <span class="s">(</span><span class="i">$PathAtom1</span><span class="cm">,</span> <span class="i">$PathAtom2</span><span class="s">)</span> = <span class="i">$PathBond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
2990   <span class="s">(</span><span class="i">$PathAtomID1</span><span class="cm">,</span> <span class="i">$PathAtomID2</span><span class="s">)</span> = <span class="s">(</span><span class="i">$PathAtom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$PathAtom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
2991 
2992   <span class="i">%CurrentAtomProcessingStatusMap</span> = <span class="i">%</span>{<span class="i">$AtomProcessingStatusMapRef</span>}<span class="sc">;</span>
2993   <span class="i">%CurrentBondProcessingStatusMap</span> = <span class="i">%</span>{<span class="i">$BondProcessingStatusMapRef</span>}<span class="sc">;</span>
2994 
2995   <span class="c"># Is it possible to assign a double bond to the current path bond?</span>
2996   <span class="k">if</span> <span class="s">(</span><span class="i">$AtomProcessingStatusMapRef</span>-&gt;{<span class="i">$PathAtomID1</span>} =~ <span class="q">/^DoubleBondPossible$/i</span> &amp;&amp; <span class="i">$AtomProcessingStatusMapRef</span>-&gt;{<span class="i">$PathAtomID2</span>} =~ <span class="q">/^DoubleBondPossible$/i</span> <span class="s">)</span> <span class="s">{</span>
2997     <span class="c"># Set current bond to double bond by appropriately marking atom and bond process status...</span>
2998     <span class="i">$AtomProcessingStatusMapRef</span>-&gt;{<span class="i">$PathAtomID1</span>} = <span class="q">&#39;DoubleBondAssigned&#39;</span><span class="sc">;</span>
2999     <span class="i">$AtomProcessingStatusMapRef</span>-&gt;{<span class="i">$PathAtomID2</span>} = <span class="q">&#39;DoubleBondAssigned&#39;</span><span class="sc">;</span>
3000 
3001     <span class="i">$BondProcessingStatusMapRef</span>-&gt;{<span class="i">$PathBondID</span>} = <span class="q">&#39;DoubleBondAssigned&#39;</span><span class="sc">;</span>
3002 
3003     <span class="c"># Recursively call  _KekulizeConnectedPathSets to kekulize next available bond...</span>
3004     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_KekulizeConnectedPathSets</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="cm">,</span> <span class="i">$PathsProcessingStatusRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3005       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3006     <span class="s">}</span>
3007 
3008     <span class="c"># Double bond at the current ring bond position didn&#39;t lead to successful kekulization...</span>
3009     <span class="i">%</span>{<span class="i">$AtomProcessingStatusMapRef</span>} = <span class="i">%CurrentAtomProcessingStatusMap</span><span class="sc">;</span>
3010     <span class="i">%</span>{<span class="i">$BondProcessingStatusMapRef</span>} = <span class="i">%CurrentBondProcessingStatusMap</span><span class="sc">;</span>
3011   <span class="s">}</span>
3012 
3013   <span class="c"># Try single bond at the current ring bond position and recursively call _KekulizeConnectedPathSets to kekulize</span>
3014   <span class="c"># rest of the ring bonds...</span>
3015   <span class="c">#</span>
3016   <span class="i">$BondProcessingStatusMapRef</span>-&gt;{<span class="i">$PathBondID</span>} = <span class="q">&#39;SingleBondAssigned&#39;</span><span class="sc">;</span>
3017 
3018   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_KekulizeConnectedPathSets</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="cm">,</span> <span class="i">$PathsProcessingStatusRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3019     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3020   <span class="s">}</span>
3021 
3022   <span class="i">%</span>{<span class="i">$AtomProcessingStatusMapRef</span>} = <span class="i">%CurrentAtomProcessingStatusMap</span><span class="sc">;</span>
3023   <span class="i">%</span>{<span class="i">$BondProcessingStatusMapRef</span>} = <span class="i">%CurrentBondProcessingStatusMap</span><span class="sc">;</span>
3024 
3025   <span class="c"># Kekulization didn&#39;t work out for path bonds...</span>
3026 
3027   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3028 
3029 <span class="s">}</span>
3030 
3031 <span class="c"># Get next available path for kekulization from a set of fused ring paths...</span>
3032 <span class="c">#</span>
<a name="_GetNextAvailablePathForKekulization-"></a>3033 <span class="k">sub </span><span class="m">_GetNextAvailablePathForKekulization</span> <span class="s">{</span>
3034   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsSetsRef</span><span class="cm">,</span> <span class="i">$PathBondsSetsRef</span><span class="cm">,</span> <span class="i">$PathsProcessingStatusRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3035   <span class="k">my</span><span class="s">(</span><span class="i">$PathIndex</span><span class="cm">,</span> <span class="i">$AvailablePathIndex</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$PathBond</span><span class="cm">,</span> <span class="i">$PathBondID</span><span class="cm">,</span> <span class="i">$MaxNumOfPathBondsProcessed</span><span class="cm">,</span> <span class="i">$NumOfPathBondsProcessed</span><span class="s">)</span><span class="sc">;</span>
3036 
3037   <span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AvailablePathIndex</span><span class="s">)</span> = <span class="s">(</span><span class="k">undef</span><span class="s">)</span> x <span class="n">3</span><span class="sc">;</span>
3038 
3039   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$PathAtomsSetsRef</span><span class="s">)</span>  &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$PathBondsSetsRef</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$PathsProcessingStatusRef</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3040     <span class="k">return</span> <span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="s">)</span><span class="sc">;</span>
3041   <span class="s">}</span>
3042 
3043   <span class="i">$MaxNumOfPathBondsProcessed</span> = <span class="n">-999</span><span class="sc">;</span>
3044   <span class="i">$AvailablePathIndex</span> = <span class="k">undef</span><span class="sc">;</span>
3045 
3046   <span class="j">PATHINDEX:</span> <span class="k">for</span> <span class="i">$PathIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#</span>{<span class="i">$PathsProcessingStatusRef</span>}<span class="s">)</span> <span class="s">{</span>
3047     <span class="k">if</span> <span class="s">(</span><span class="i">$PathsProcessingStatusRef</span>-&gt;[<span class="i">$PathIndex</span>] =~ <span class="q">/^Processed$/i</span><span class="s">)</span> <span class="s">{</span>
3048       <span class="k">next</span> <span class="j">PATHINDEX</span><span class="sc">;</span>
3049     <span class="s">}</span>
3050 
3051     <span class="c"># Count of already processed bonds in an unprocessed path bonds through</span>
3052     <span class="c"># their participation in any fused bonds sets...</span>
3053     <span class="c">#</span>
3054     <span class="i">$NumOfPathBondsProcessed</span> = <span class="n">0</span><span class="sc">;</span>
3055     <span class="j">PATHBOND:</span> <span class="k">for</span> <span class="i">$PathBond</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathBondsSetsRef</span>-&gt;[<span class="i">$PathIndex</span>]}<span class="s">)</span> <span class="s">{</span>
3056       <span class="i">$PathBondID</span> = <span class="i">$PathBond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3057       <span class="k">if</span> <span class="s">(</span><span class="i">$BondProcessingStatusMapRef</span>-&gt;{<span class="i">$PathBondID</span>} =~ <span class="q">/^NotProcessed$/i</span><span class="s">)</span> <span class="s">{</span>
3058         <span class="k">next</span> <span class="j">PATHBOND</span><span class="sc">;</span>
3059       <span class="s">}</span>
3060       <span class="i">$NumOfPathBondsProcessed</span>++<span class="sc">;</span>
3061     <span class="s">}</span>
3062 
3063     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPathBondsProcessed</span> &gt; <span class="i">$MaxNumOfPathBondsProcessed</span><span class="s">)</span> <span class="s">{</span>
3064       <span class="i">$AvailablePathIndex</span> = <span class="i">$PathIndex</span><span class="sc">;</span>
3065       <span class="i">$MaxNumOfPathBondsProcessed</span> = <span class="i">$NumOfPathBondsProcessed</span><span class="sc">;</span>
3066     <span class="s">}</span>
3067 
3068   <span class="s">}</span>
3069 
3070   <span class="c"># Is any path available?</span>
3071   <span class="k">if</span> <span class="s">(</span>!<span class="i">$AvailablePathIndex</span><span class="s">)</span> <span class="s">{</span>
3072     <span class="k">return</span> <span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="s">)</span><span class="sc">;</span>
3073   <span class="s">}</span>
3074 
3075   <span class="i">$PathsProcessingStatusRef</span>-&gt;[<span class="i">$AvailablePathIndex</span>] = <span class="q">&#39;Processed&#39;</span><span class="sc">;</span>
3076 
3077   <span class="i">$PathAtomsRef</span> = <span class="i">$PathAtomsSetsRef</span>-&gt;[<span class="i">$AvailablePathIndex</span>]<span class="sc">;</span>
3078   <span class="i">$PathBondsRef</span> = <span class="i">$PathBondsSetsRef</span>-&gt;[<span class="i">$AvailablePathIndex</span>]<span class="sc">;</span>
3079 
3080   <span class="k">return</span> <span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="s">)</span><span class="sc">;</span>
3081 <span class="s">}</span>
3082 
3083 <span class="c"># Check for kekulization in a specific set of path bonds. For successful kekulization, all</span>
3084 <span class="c"># all path atoms marked with DoubleBondPossible must be involved in a path double bond...</span>
3085 <span class="c">#</span>
<a name="_DidKekulizationSucceedForPathBonds-"></a>3086 <span class="k">sub </span><span class="m">_DidKekulizationSucceedForPathBonds</span> <span class="s">{</span>
3087   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$PathBondsRef</span><span class="cm">,</span> <span class="i">$AtomProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$BondProcessingStatusMapRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3088   <span class="k">my</span><span class="s">(</span><span class="i">$PathAtom</span><span class="cm">,</span> <span class="i">$PathAtomID</span><span class="s">)</span><span class="sc">;</span>
3089 
3090   <span class="k">for</span> <span class="i">$PathAtom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
3091     <span class="i">$PathAtomID</span> = <span class="i">$PathAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3092     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$AtomProcessingStatusMapRef</span>-&gt;{<span class="i">$PathAtomID</span>} &amp;&amp; <span class="i">$AtomProcessingStatusMapRef</span>-&gt;{<span class="i">$PathAtomID</span>} =~ <span class="q">/^DoubleBondPossible$/i</span><span class="s">)</span> <span class="s">{</span>
3093       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3094     <span class="s">}</span>
3095   <span class="s">}</span>
3096   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3097 <span class="s">}</span>
3098 
3099 <span class="c"># Assign bond orders to the bonds in a molecule which have been successfully</span>
3100 <span class="c"># kekulized along with optional clearing of aromaticty property...</span>
3101 <span class="c">#</span>
<a name="_ProcessBondOrdersAssignedDuringSuccessfulKekulization-"></a>3102 <span class="k">sub </span><span class="m">_ProcessBondOrdersAssignedDuringSuccessfulKekulization</span> <span class="s">{</span>
3103   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$BondsRef</span><span class="cm">,</span> <span class="i">$BondsProcessingStatusMapRef</span><span class="cm">,</span> <span class="i">$DeleteBondsAromaticity</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3104   <span class="k">my</span><span class="s">(</span><span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondID</span><span class="cm">,</span> <span class="i">$BondOrder</span><span class="s">)</span><span class="sc">;</span>
3105 
3106   <span class="i">$DeleteBondsAromaticity</span> = <span class="k">defined</span> <span class="i">$DeleteBondsAromaticity</span> ? <span class="i">$DeleteBondsAromaticity</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3107 
3108   <span class="j">BOND:</span> <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$BondsRef</span>}<span class="s">)</span> <span class="s">{</span>
3109     <span class="i">$BondID</span> = <span class="i">$Bond</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3110 
3111     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$BondsProcessingStatusMapRef</span>-&gt;{<span class="i">$BondID</span>}<span class="s">)</span> <span class="s">{</span>
3112       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_ProcessBondOrdersAssignedDuringSuccessfulKekulization: Couldn&#39;t process bond with bond ID, $BondID: It&#39;s not available in the list of bonds processed for kekulization...&quot;</span><span class="sc">;</span>
3113       <span class="k">next</span> <span class="j">BOND</span><span class="sc">;</span>
3114     <span class="s">}</span>
3115 
3116     <span class="i">$BondOrder</span> = <span class="s">(</span><span class="i">$BondsProcessingStatusMapRef</span>-&gt;{<span class="i">$BondID</span>} =~ <span class="q">/^DoubleBondAssigned$/i</span><span class="s">)</span> ? <span class="n">2</span> <span class="co">:</span> <span class="n">1</span><span class="sc">;</span>
3117     <span class="i">$Bond</span><span class="i">-&gt;SetBondOrder</span><span class="s">(</span><span class="i">$BondOrder</span><span class="s">)</span><span class="sc">;</span>
3118 
3119     <span class="k">if</span> <span class="s">(</span><span class="i">$DeleteBondsAromaticity</span><span class="s">)</span> <span class="s">{</span>
3120       <span class="i">$Bond</span><span class="i">-&gt;DeleteAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3121     <span class="s">}</span>
3122   <span class="s">}</span>
3123   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
3124 <span class="s">}</span>
3125 
3126 <span class="c"># Does molecule contains aromatic rings?</span>
3127 <span class="c">#</span>
<a name="HasAromaticRings-"></a>3128 <span class="k">sub </span><span class="m">HasAromaticRings</span> <span class="s">{</span>
3129   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3130 
3131   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfAromaticRings</span><span class="s">(</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3132 <span class="s">}</span>
3133 
3134 <span class="c"># Does molecule contains any aromatic atom in a ring?</span>
3135 <span class="c">#</span>
<a name="HasAromaticAtomsInRings-"></a>3136 <span class="k">sub </span><span class="m">HasAromaticAtomsInRings</span> <span class="s">{</span>
3137   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3138   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
3139 
3140   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3141     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3142       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
3143     <span class="s">}</span>
3144     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsInRing</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3145       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3146     <span class="s">}</span>
3147   <span class="s">}</span>
3148   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3149 <span class="s">}</span>
3150 
3151 <span class="c"># Does molecule contains any aromatic atom not in a ring?</span>
3152 <span class="c">#</span>
<a name="HasAromaticAtomsNotInRings-"></a>3153 <span class="k">sub </span><span class="m">HasAromaticAtomsNotInRings</span> <span class="s">{</span>
3154   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3155   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
3156 
3157   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3158     <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3159       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
3160     <span class="s">}</span>
3161     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsNotInRing</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3162       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
3163     <span class="s">}</span>
3164   <span class="s">}</span>
3165   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
3166 <span class="s">}</span>
3167 
3168 <span class="c"># Does molecule contains rings?</span>
3169 <span class="c">#</span>
<a name="HasRings-"></a>3170 <span class="k">sub </span><span class="m">HasRings</span> <span class="s">{</span>
3171   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3172 
3173   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsCyclic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3174 <span class="s">}</span>
3175 
3176 <span class="c"># Does molecule contains only one ring?</span>
3177 <span class="c">#</span>
<a name="HasOnlyOneRing-"></a>3178 <span class="k">sub </span><span class="m">HasOnlyOneRing</span> <span class="s">{</span>
3179   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3180 
3181   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsUnicyclic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3182 <span class="s">}</span>
3183 
3184 <span class="c"># Does molecule contains any rings?</span>
3185 <span class="c">#</span>
<a name="HasNoRings-"></a>3186 <span class="k">sub </span><span class="m">HasNoRings</span> <span class="s">{</span>
3187   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3188 
3189   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsAcyclic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3190 <span class="s">}</span>
3191 
3192 <span class="c"># Get size of smallest ring...</span>
3193 <span class="c">#</span>
<a name="GetSizeOfSmallestRing-"></a>3194 <span class="k">sub </span><span class="m">GetSizeOfSmallestRing</span> <span class="s">{</span>
3195   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3196 
3197   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetSizeOfSmallestCycle</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3198 <span class="s">}</span>
3199 
3200 <span class="c"># Get size of largest ring...</span>
3201 <span class="c">#</span>
<a name="GetSizeOfLargestRing-"></a>3202 <span class="k">sub </span><span class="m">GetSizeOfLargestRing</span> <span class="s">{</span>
3203   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3204 
3205   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetSizeOfLargestCycle</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3206 <span class="s">}</span>
3207 
3208 <span class="c"># Get number of rings...</span>
3209 <span class="c">#</span>
<a name="GetNumOfRings-"></a>3210 <span class="k">sub </span><span class="m">GetNumOfRings</span> <span class="s">{</span>
3211   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3212 
3213   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfCycles</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3214 <span class="s">}</span>
3215 
3216 <span class="c"># Get number of aromatic rings...</span>
3217 <span class="c">#</span>
<a name="GetNumOfAromaticRings-"></a>3218 <span class="k">sub </span><span class="m">GetNumOfAromaticRings</span> <span class="s">{</span>
3219   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3220   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfRings</span><span class="s">)</span><span class="sc">;</span>
3221 
3222   <span class="i">$NumOfRings</span> = <span class="k">scalar</span> <span class="i">$This</span><span class="i">-&gt;GetAromaticRings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3223 
3224   <span class="k">return</span> <span class="i">$NumOfRings</span><span class="sc">;</span>
3225 <span class="s">}</span>
3226 
3227 <span class="c"># Get num of rings with odd size...</span>
3228 <span class="c">#</span>
<a name="GetNumOfRingsWithOddSize-"></a>3229 <span class="k">sub </span><span class="m">GetNumOfRingsWithOddSize</span> <span class="s">{</span>
3230   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3231 
3232   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfCyclesWithOddSize</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3233 <span class="s">}</span>
3234 
3235 <span class="c"># Get num of rings with even size...</span>
3236 <span class="c">#</span>
<a name="GetNumOfRingsWithEvenSize-"></a>3237 <span class="k">sub </span><span class="m">GetNumOfRingsWithEvenSize</span> <span class="s">{</span>
3238   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3239 
3240   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfCyclesWithEvenSize</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3241 <span class="s">}</span>
3242 
3243 <span class="c"># Get num of rings with specified size...</span>
3244 <span class="c">#</span>
<a name="GetNumOfRingsWithSize-"></a>3245 <span class="k">sub </span><span class="m">GetNumOfRingsWithSize</span> <span class="s">{</span>
3246   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3247 
3248   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfCyclesWithSize</span><span class="s">(</span><span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3249 <span class="s">}</span>
3250 
3251 <span class="c"># Get num of rings with size less than a specified size...</span>
3252 <span class="c">#</span>
<a name="GetNumOfRingsWithSizeLessThan-"></a>3253 <span class="k">sub </span><span class="m">GetNumOfRingsWithSizeLessThan</span> <span class="s">{</span>
3254   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3255 
3256   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfCyclesWithSizeLessThan</span><span class="s">(</span><span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3257 <span class="s">}</span>
3258 
3259 <span class="c"># Get num of rings with size greater than a specified size...</span>
3260 <span class="c">#</span>
<a name="GetNumOfRingsWithSizeGreaterThan-"></a>3261 <span class="k">sub </span><span class="m">GetNumOfRingsWithSizeGreaterThan</span> <span class="s">{</span>
3262   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3263 
3264   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfCyclesWithSizeGreaterThan</span><span class="s">(</span><span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3265 <span class="s">}</span>
3266 
3267 <span class="c"># Get largest ring as an array containing ring atoms...</span>
3268 <span class="c">#</span>
<a name="GetLargestRing-"></a>3269 <span class="k">sub </span><span class="m">GetLargestRing</span> <span class="s">{</span>
3270   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3271 
3272   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRing</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetLargestCycle</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3273 <span class="s">}</span>
3274 
3275 <span class="c"># Get smallest ring as an array containing ring atoms...</span>
3276 <span class="c">#</span>
<a name="GetSmallestRing-"></a>3277 <span class="k">sub </span><span class="m">GetSmallestRing</span> <span class="s">{</span>
3278   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3279 
3280   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRing</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetSmallestCycle</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3281 <span class="s">}</span>
3282 
3283 <span class="c"># Get rings as an array containing references to arrays with ring atoms...</span>
3284 <span class="c">#</span>
<a name="GetRings-"></a>3285 <span class="k">sub </span><span class="m">GetRings</span> <span class="s">{</span>
3286   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3287 
3288   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetCycles</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3289 <span class="s">}</span>
3290 
3291 <span class="c"># Get aromatic rings as an array containing references to arrays with ring atoms...</span>
3292 <span class="c">#</span>
<a name="GetAromaticRings-"></a>3293 <span class="k">sub </span><span class="m">GetAromaticRings</span> <span class="s">{</span>
3294   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3295 
3296   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAromaticRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetCycles</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3297 <span class="s">}</span>
3298 
3299 <span class="c"># Get odd size rings as an array containing references to arrays with ring atoms...</span>
3300 <span class="c">#</span>
<a name="GetRingsWithOddSize-"></a>3301 <span class="k">sub </span><span class="m">GetRingsWithOddSize</span> <span class="s">{</span>
3302   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3303 
3304   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetCyclesWithOddSize</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3305 <span class="s">}</span>
3306 
3307 <span class="c"># Get even size rings as an array containing references to arrays with ring atoms...</span>
3308 <span class="c">#</span>
<a name="GetRingsWithEvenSize-"></a>3309 <span class="k">sub </span><span class="m">GetRingsWithEvenSize</span> <span class="s">{</span>
3310   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3311 
3312   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetCyclesWithEvenSize</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3313 <span class="s">}</span>
3314 
3315 <span class="c"># Get rings with a specific size as an array containing references to arrays with ring atoms...</span>
3316 <span class="c">#</span>
<a name="GetRingsWithSize-"></a>3317 <span class="k">sub </span><span class="m">GetRingsWithSize</span> <span class="s">{</span>
3318   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3319 
3320   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetCyclesWithSize</span><span class="s">(</span><span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3321 <span class="s">}</span>
3322 
3323 <span class="c"># Get rings with size less than a specific size as an array containing references to arrays with ring atoms...</span>
3324 <span class="c">#</span>
<a name="GetRingsWithSizeLessThan-"></a>3325 <span class="k">sub </span><span class="m">GetRingsWithSizeLessThan</span> <span class="s">{</span>
3326   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3327 
3328   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetCyclesWithSizeLessThan</span><span class="s">(</span><span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3329 <span class="s">}</span>
3330 
3331 <span class="c"># Get rings with size greater than a specific size as an array containing references to arrays with ring atoms...</span>
3332 <span class="c">#</span>
<a name="GetRingsWithSizeGreaterThan-"></a>3333 <span class="k">sub </span><span class="m">GetRingsWithSizeGreaterThan</span> <span class="s">{</span>
3334   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3335 
3336   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetCyclesWithSizeGreaterThan</span><span class="s">(</span><span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3337 <span class="s">}</span>
3338 
3339 <span class="c"># Generate an array of bond objects for an array of ring atoms and return an array</span>
3340 <span class="c"># of bond objects...</span>
3341 <span class="c">#</span>
<a name="GetRingBonds-"></a>3342 <span class="k">sub </span><span class="m">GetRingBonds</span> <span class="s">{</span>
3343   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@RingAtoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3344   <span class="k">my</span><span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
3345 
3346   <span class="i">@Bonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3347   <span class="k">if</span> <span class="s">(</span>!<span class="i">@RingAtoms</span><span class="s">)</span> <span class="s">{</span>
3348     <span class="c"># Return an empty ring bonds list...</span>
3349     <span class="k">return</span> <span class="i">@Bonds</span><span class="sc">;</span>
3350   <span class="s">}</span>
3351 
3352   <span class="k">my</span><span class="s">(</span><span class="i">@RingAtomIDs</span><span class="s">)</span><span class="sc">;</span>
3353 
3354   <span class="i">@RingAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3355   <span class="i">@RingAtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsIDsFromAtoms</span><span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span><span class="sc">;</span>
3356   <span class="k">if</span> <span class="s">(</span>!<span class="i">@RingAtomIDs</span><span class="s">)</span> <span class="s">{</span>
3357     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GetRingBonds: No ring bonds retrieved: Atom IDs couldn&#39;t be retrieved for specified atoms...&quot;</span><span class="sc">;</span>
3358     <span class="k">return</span> <span class="i">@Bonds</span><span class="sc">;</span>
3359   <span class="s">}</span>
3360 
3361   <span class="c"># Add start atom to the end to make it a cyclic path for ring: It&#39;s taken out during conversion</span>
3362   <span class="c"># of cyclic path to a ring...</span>
3363   <span class="k">push</span> <span class="i">@RingAtomIDs</span><span class="cm">,</span> <span class="i">$RingAtomIDs</span>[<span class="n">0</span>]<span class="sc">;</span>
3364 
3365   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetPathBonds</span><span class="s">(</span><span class="i">@RingAtomIDs</span><span class="s">)</span><span class="sc">;</span>
3366 <span class="s">}</span>
3367 
3368 <span class="c"># Generate an array containing references to arrays of ring bond objects for rings specified</span>
3369 <span class="c"># in an array of references to ring atoms...</span>
3370 <span class="c">#</span>
<a name="GetRingBondsFromRings-"></a>3371 <span class="k">sub </span><span class="m">GetRingBondsFromRings</span> <span class="s">{</span>
3372   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@RingAtomsSets</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3373   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">@RingBondsSets</span><span class="s">)</span><span class="sc">;</span>
3374 
3375   <span class="i">@RingBondsSets</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3376   <span class="k">for</span> <span class="i">$RingAtomsRef</span>  <span class="s">(</span><span class="i">@RingAtomsSets</span><span class="s">)</span> <span class="s">{</span>
3377     <span class="k">my</span><span class="s">(</span><span class="i">@RingBonds</span><span class="s">)</span><span class="sc">;</span>
3378     <span class="i">@RingBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetRingBonds</span><span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span><span class="sc">;</span>
3379 
3380     <span class="k">push</span> <span class="i">@RingBondsSets</span><span class="cm">,</span> \<span class="i">@RingBonds</span><span class="sc">;</span>
3381   <span class="s">}</span>
3382 
3383   <span class="k">return</span> <span class="i">@RingBondsSets</span><span class="sc">;</span>
3384 <span class="s">}</span>
3385 
3386 <span class="c"># Does molecule has any fused rings?</span>
3387 <span class="c">#</span>
<a name="HasFusedRings-"></a>3388 <span class="k">sub </span><span class="m">HasFusedRings</span> <span class="s">{</span>
3389   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3390 
3391   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;HasFusedCycles</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3392 <span class="s">}</span>
3393 
3394 <span class="c"># Get references to array of fused ring sets and non-fused rings. Fused ring sets array reference</span>
3395 <span class="c"># contains refernces to arrays of rings; Non-fused rings array reference contains references to</span>
3396 <span class="c"># arrays of ring atoms...</span>
3397 <span class="c"># rings.</span>
3398 <span class="c">#</span>
<a name="GetFusedAndNonFusedRings-"></a>3399 <span class="k">sub </span><span class="m">GetFusedAndNonFusedRings</span> <span class="s">{</span>
3400   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3401   <span class="k">my</span><span class="s">(</span><span class="i">$FusedCyclesSetsRef</span><span class="cm">,</span> <span class="i">$NonFusedCyclesRef</span><span class="cm">,</span> <span class="i">@FusedRingSets</span><span class="cm">,</span> <span class="i">@NonFusedRings</span><span class="s">)</span><span class="sc">;</span>
3402 
3403   <span class="i">@FusedRingSets</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@NonFusedRings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3404   <span class="s">(</span><span class="i">$FusedCyclesSetsRef</span><span class="cm">,</span> <span class="i">$NonFusedCyclesRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetFusedAndNonFusedCycles</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3405   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$FusedCyclesSetsRef</span><span class="s">)</span> &amp;&amp; <span class="k">defined</span><span class="s">(</span><span class="i">$NonFusedCyclesRef</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3406     <span class="k">return</span> <span class="s">(</span>\<span class="i">@FusedRingSets</span><span class="cm">,</span> \<span class="i">@NonFusedRings</span><span class="s">)</span><span class="sc">;</span>
3407   <span class="s">}</span>
3408   <span class="k">my</span><span class="s">(</span><span class="i">$FusedCyclesSetRef</span><span class="s">)</span><span class="sc">;</span>
3409 
3410   <span class="k">for</span> <span class="i">$FusedCyclesSetRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$FusedCyclesSetsRef</span>}<span class="s">)</span> <span class="s">{</span>
3411     <span class="k">my</span><span class="s">(</span><span class="i">@FusedRingSet</span><span class="s">)</span><span class="sc">;</span>
3412     <span class="i">@FusedRingSet</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3413     <span class="i">@FusedRingSet</span> = <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">@</span>{<span class="i">$FusedCyclesSetRef</span>}<span class="s">)</span><span class="sc">;</span>
3414     <span class="k">push</span> <span class="i">@FusedRingSets</span><span class="cm">,</span> \<span class="i">@FusedRingSet</span><span class="sc">;</span>
3415   <span class="s">}</span>
3416 
3417   <span class="i">@NonFusedRings</span> = <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">@</span>{<span class="i">$NonFusedCyclesRef</span>}<span class="s">)</span><span class="sc">;</span>
3418 
3419   <span class="k">return</span> <span class="s">(</span>\<span class="i">@FusedRingSets</span><span class="cm">,</span> \<span class="i">@NonFusedRings</span><span class="s">)</span><span class="sc">;</span>
3420 <span class="s">}</span>
3421 
3422 <span class="c"># Get rings as an array containing references to arrays with ring atoms...</span>
3423 <span class="c">#</span>
<a name="_GetRings-"></a>3424 <span class="k">sub </span><span class="m">_GetRings</span> <span class="s">{</span>
3425   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@CyclicPaths</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3426   <span class="k">my</span><span class="s">(</span><span class="i">$CyclicPath</span><span class="cm">,</span> <span class="i">@Rings</span><span class="s">)</span><span class="sc">;</span>
3427 
3428   <span class="i">@Rings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3429   <span class="k">if</span> <span class="s">(</span>!<span class="i">@CyclicPaths</span><span class="s">)</span> <span class="s">{</span>
3430     <span class="k">return</span> <span class="i">@Rings</span><span class="sc">;</span>
3431   <span class="s">}</span>
3432   <span class="k">if</span> <span class="s">(</span>!<span class="i">@CyclicPaths</span><span class="s">)</span> <span class="s">{</span>
3433     <span class="c"># Return an empty ring list...</span>
3434     <span class="k">return</span> <span class="i">@Rings</span><span class="sc">;</span>
3435   <span class="s">}</span>
3436 
3437   <span class="k">for</span> <span class="i">$CyclicPath</span> <span class="s">(</span><span class="i">@CyclicPaths</span><span class="s">)</span> <span class="s">{</span>
3438     <span class="k">my</span><span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span><span class="sc">;</span>
3439     <span class="i">@RingAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3440     <span class="k">push</span> <span class="i">@RingAtoms</span><span class="cm">,</span> <span class="i">$This</span><span class="i">-&gt;_GetRing</span><span class="s">(</span><span class="i">$CyclicPath</span><span class="s">)</span><span class="sc">;</span>
3441 
3442     <span class="k">push</span> <span class="i">@Rings</span><span class="cm">,</span> \<span class="i">@RingAtoms</span><span class="sc">;</span>
3443   <span class="s">}</span>
3444   <span class="k">return</span> <span class="i">@Rings</span><span class="sc">;</span>
3445 <span class="s">}</span>
3446 
3447 <span class="c"># Get aromatic rings as an array containing references to arrays with ring atoms...</span>
3448 <span class="c">#</span>
<a name="_GetAromaticRings-"></a>3449 <span class="k">sub </span><span class="m">_GetAromaticRings</span> <span class="s">{</span>
3450   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@CyclicPaths</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3451   <span class="k">my</span><span class="s">(</span><span class="i">$RingAtomsRef</span><span class="cm">,</span> <span class="i">@Rings</span><span class="cm">,</span> <span class="i">@AromaticRings</span><span class="s">)</span><span class="sc">;</span>
3452 
3453   <span class="i">@AromaticRings</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3454   <span class="i">@Rings</span> = <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">@CyclicPaths</span><span class="s">)</span><span class="sc">;</span>
3455 
3456   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Rings</span><span class="s">)</span> <span class="s">{</span>
3457     <span class="k">return</span> <span class="i">@AromaticRings</span><span class="sc">;</span>
3458   <span class="s">}</span>
3459   <span class="j">RING:</span> <span class="k">for</span> <span class="i">$RingAtomsRef</span> <span class="s">(</span><span class="i">@Rings</span><span class="s">)</span> <span class="s">{</span>
3460     <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;IsRingAromatic</span><span class="s">(</span><span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3461       <span class="k">next</span> <span class="j">RING</span><span class="sc">;</span>
3462     <span class="s">}</span>
3463     <span class="k">my</span><span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span><span class="sc">;</span>
3464     <span class="i">@RingAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3465     <span class="k">push</span> <span class="i">@RingAtoms</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$RingAtomsRef</span>}<span class="sc">;</span>
3466 
3467     <span class="k">push</span> <span class="i">@AromaticRings</span><span class="cm">,</span> \<span class="i">@RingAtoms</span><span class="sc">;</span>
3468   <span class="s">}</span>
3469   <span class="k">return</span> <span class="i">@AromaticRings</span><span class="sc">;</span>
3470 <span class="s">}</span>
3471 
3472 <span class="c"># Map atom IDs in cyclic path to atoms and return a reference to an array containing ring atoms...</span>
3473 <span class="c">#</span>
3474 <span class="c"># Note:</span>
3475 <span class="c">#   . Start and end vertex is same for cyclic paths. So end atom is removed before</span>
3476 <span class="c">#     returning atoms array as ring atoms...</span>
3477 <span class="c">#</span>
<a name="_GetRing-"></a>3478 <span class="k">sub </span><span class="m">_GetRing</span> <span class="s">{</span>
3479   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$CyclicPath</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3480   <span class="k">my</span><span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span><span class="sc">;</span>
3481 
3482   <span class="i">@RingAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3483   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$CyclicPath</span><span class="s">)</span> <span class="s">{</span>
3484     <span class="c"># Return an empty atoms list...</span>
3485     <span class="k">return</span> <span class="i">@RingAtoms</span><span class="sc">;</span>
3486   <span class="s">}</span>
3487 
3488   <span class="i">@RingAtoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetPathAtoms</span><span class="s">(</span><span class="i">$CyclicPath</span><span class="s">)</span><span class="sc">;</span>
3489   <span class="k">if</span> <span class="s">(</span><span class="i">@RingAtoms</span><span class="s">)</span> <span class="s">{</span>
3490     <span class="k">pop</span> <span class="i">@RingAtoms</span><span class="sc">;</span>
3491   <span class="s">}</span>
3492   <span class="k">return</span> <span class="i">@RingAtoms</span><span class="sc">;</span>
3493 <span class="s">}</span>
3494 
3495 <span class="c"># Map atom IDs to atoms and return a reference to an array containing these atoms...</span>
3496 <span class="c">#</span>
<a name="_GetPathAtoms-"></a>3497 <span class="k">sub </span><span class="m">_GetPathAtoms</span> <span class="s">{</span>
3498   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Path</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3499   <span class="k">my</span><span class="s">(</span><span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
3500 
3501   <span class="i">@PathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3502   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Path</span><span class="s">)</span> <span class="s">{</span>
3503     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetPathAtoms: No path atoms retrieved: Path must be defined...&quot;</span><span class="sc">;</span>
3504     <span class="k">return</span> <span class="i">@PathAtoms</span><span class="sc">;</span>
3505   <span class="s">}</span>
3506   <span class="k">my</span><span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
3507 
3508   <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3509   <span class="i">@AtomIDs</span> = <span class="i">$Path</span><span class="i">-&gt;GetVertices</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3510 
3511   <span class="i">@PathAtoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsFromAtomIDs</span><span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
3512 
3513   <span class="k">return</span> <span class="i">@PathAtoms</span><span class="sc">;</span>
3514 <span class="s">}</span>
3515 
3516 <span class="c"># Get bonds for a path specified by atom IDs...</span>
3517 <span class="c">#</span>
<a name="_GetPathBonds-"></a>3518 <span class="k">sub </span><span class="m">_GetPathBonds</span> <span class="s">{</span>
3519   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3520   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">@Bonds</span><span class="cm">,</span> <span class="i">@EdgesAtomIDs</span><span class="s">)</span><span class="sc">;</span>
3521 
3522   <span class="i">@Bonds</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@EdgesAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3523 
3524   <span class="k">if</span> <span class="s">(</span>!<span class="i">@AtomIDs</span> || <span class="i">@AtomIDs</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
3525     <span class="k">return</span> <span class="i">@Bonds</span><span class="sc">;</span>
3526   <span class="s">}</span>
3527 
3528   <span class="c"># Setup edges...</span>
3529   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$#AtomIDs</span> - <span class="n">1</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
3530     <span class="i">$AtomID1</span> = <span class="i">$AtomIDs</span>[<span class="i">$Index</span>]<span class="sc">;</span>
3531     <span class="i">$AtomID2</span> = <span class="i">$AtomIDs</span>[<span class="i">$Index</span> + <span class="n">1</span>]<span class="sc">;</span>
3532     <span class="k">push</span> <span class="i">@EdgesAtomIDs</span><span class="cm">,</span> <span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
3533   <span class="s">}</span>
3534   <span class="i">@Bonds</span> =  <span class="i">$This</span><span class="i">-&gt;GetEdgesProperty</span><span class="s">(</span><span class="q">&#39;Bond&#39;</span><span class="cm">,</span> <span class="i">@EdgesAtomIDs</span><span class="s">)</span><span class="sc">;</span>
3535 
3536   <span class="k">return</span> <span class="i">@Bonds</span><span class="sc">;</span>
3537 <span class="s">}</span>
3538 
3539 <span class="c"># Map atom ID to an atom...</span>
3540 <span class="c">#</span>
<a name="_GetAtomFromAtomID-"></a>3541 <span class="k">sub </span><span class="m">_GetAtomFromAtomID</span> <span class="s">{</span>
3542   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3543 
3544   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetVertexProperty</span><span class="s">(</span><span class="q">&#39;Atom&#39;</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
3545 <span class="s">}</span>
3546 
3547 <span class="c"># Map atom IDs to atoms and return an array containing these atoms...</span>
3548 <span class="c">#</span>
<a name="_GetAtomsFromAtomIDs-"></a>3549 <span class="k">sub </span><span class="m">_GetAtomsFromAtomIDs</span> <span class="s">{</span>
3550   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3551 
3552   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetVerticesProperty</span><span class="s">(</span><span class="q">&#39;Atom&#39;</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
3553 <span class="s">}</span>
3554 
3555 <span class="c"># Map atoms to atom IDs and return an array containing these atoms...</span>
3556 <span class="c">#</span>
<a name="_GetAtomsIDsFromAtoms-"></a>3557 <span class="k">sub </span><span class="m">_GetAtomsIDsFromAtoms</span> <span class="s">{</span>
3558   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3559 
3560   <span class="k">return</span> <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span> <span class="i">@Atoms</span><span class="sc">;</span>
3561 <span class="s">}</span>
3562 
3563 <span class="c"># Get bonded atom pair atom IDs for specified list of atom IDs...</span>
3564 <span class="c">#</span>
<a name="_GetBondedAtomPairAtomIDsFromAtomIDs-"></a>3565 <span class="k">sub </span><span class="m">_GetBondedAtomPairAtomIDsFromAtomIDs</span> <span class="s">{</span>
3566   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3567   <span class="k">my</span><span class="s">(</span><span class="i">$AtomIndex1</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$AtomIndex2</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="cm">,</span> <span class="i">@BondedAtomPairIDs</span><span class="s">)</span><span class="sc">;</span>
3568 
3569   <span class="i">@BondedAtomPairIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3570   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsFromAtomIDs</span><span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
3571 
3572   <span class="k">for</span> <span class="i">$AtomIndex1</span> <span class="s">(</span> <span class="n">0</span> .. <span class="i">$#Atoms</span><span class="s">)</span> <span class="s">{</span>
3573     <span class="i">$Atom1</span> = <span class="i">$Atoms</span>[<span class="i">$AtomIndex1</span>]<span class="sc">;</span>
3574     <span class="i">$AtomID1</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3575 
3576     <span class="j">ATOMINDEX2:</span> <span class="k">for</span> <span class="i">$AtomIndex2</span> <span class="s">(</span> <span class="s">(</span><span class="i">$AtomIndex1</span> + <span class="n">1</span><span class="s">)</span> .. <span class="i">$#Atoms</span><span class="s">)</span> <span class="s">{</span>
3577       <span class="i">$Atom2</span> = <span class="i">$Atoms</span>[<span class="i">$AtomIndex2</span>]<span class="sc">;</span>
3578       <span class="k">if</span> <span class="s">(</span>!<span class="i">$Atom1</span><span class="i">-&gt;IsBondedToAtom</span><span class="s">(</span><span class="i">$Atom2</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3579         <span class="k">next</span> <span class="j">ATOMINDEX2</span><span class="sc">;</span>
3580        <span class="s">}</span>
3581       <span class="i">$AtomID2</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3582 
3583       <span class="k">push</span> <span class="i">@BondedAtomPairIDs</span><span class="cm">,</span> <span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span><span class="sc">;</span>
3584     <span class="s">}</span>
3585   <span class="s">}</span>
3586 
3587   <span class="k">return</span> <span class="i">@BondedAtomPairIDs</span><span class="sc">;</span>
3588 <span class="s">}</span>
3589 
3590 <span class="c"># Get bonded atom pair atoms for specified list of atoms...</span>
3591 <span class="c">#</span>
<a name="_GetBondedAtomPairAtomsFromAtoms-"></a>3592 <span class="k">sub </span><span class="m">_GetBondedAtomPairAtomsFromAtoms</span> <span class="s">{</span>
3593   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3594   <span class="k">my</span><span class="s">(</span><span class="i">$AtomIndex1</span><span class="cm">,</span> <span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$AtomIndex2</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="cm">,</span> <span class="i">@BondedAtomPairAtoms</span><span class="s">)</span><span class="sc">;</span>
3595 
3596   <span class="i">@BondedAtomPairAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3597 
3598   <span class="k">for</span> <span class="i">$AtomIndex1</span> <span class="s">(</span> <span class="n">0</span> .. <span class="i">$#Atoms</span><span class="s">)</span> <span class="s">{</span>
3599     <span class="i">$Atom1</span> = <span class="i">$Atoms</span>[<span class="i">$AtomIndex1</span>]<span class="sc">;</span>
3600 
3601     <span class="j">ATOMINDEX2:</span> <span class="k">for</span> <span class="i">$AtomIndex2</span> <span class="s">(</span> <span class="s">(</span><span class="i">$AtomIndex1</span> + <span class="n">1</span><span class="s">)</span> .. <span class="i">$#Atoms</span><span class="s">)</span> <span class="s">{</span>
3602       <span class="i">$Atom2</span> = <span class="i">$Atoms</span>[<span class="i">$AtomIndex2</span>]<span class="sc">;</span>
3603       <span class="k">if</span> <span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;IsBondedToAtom</span><span class="s">(</span><span class="i">$Atom2</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
3604         <span class="k">next</span> <span class="j">ATOMINDEX2</span><span class="sc">;</span>
3605        <span class="s">}</span>
3606 
3607       <span class="k">push</span> <span class="i">@BondedAtomPairAtoms</span><span class="cm">,</span> <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3608     <span class="s">}</span>
3609   <span class="s">}</span>
3610 
3611   <span class="k">return</span> <span class="i">@BondedAtomPairAtoms</span><span class="sc">;</span>
3612 <span class="s">}</span>
3613 
3614 <span class="c"># Is atom in a ring?</span>
3615 <span class="c">#</span>
<a name="_IsAtomInRing-"></a>3616 <span class="k">sub </span><span class="m">_IsAtomInRing</span> <span class="s">{</span>
3617   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3618 
3619   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsCyclicVertex</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3620 <span class="s">}</span>
3621 
3622 <span class="c"># Is atom not in a ring?</span>
3623 <span class="c">#</span>
<a name="_IsAtomNotInRing-"></a>3624 <span class="k">sub </span><span class="m">_IsAtomNotInRing</span> <span class="s">{</span>
3625   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3626 
3627   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsAcyclicVertex</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3628 <span class="s">}</span>
3629 
3630 <span class="c"># Is atom only in one ring?</span>
3631 <span class="c">#</span>
<a name="_IsAtomInOnlyOneRing-"></a>3632 <span class="k">sub </span><span class="m">_IsAtomInOnlyOneRing</span> <span class="s">{</span>
3633   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3634 
3635   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsUnicyclicVertex</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3636 <span class="s">}</span>
3637 
3638 <span class="c"># Is atom in a ring of specified size?</span>
3639 <span class="c">#</span>
<a name="_IsAtomInRingOfSize-"></a>3640 <span class="k">sub </span><span class="m">_IsAtomInRingOfSize</span> <span class="s">{</span>
3641   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3642 
3643   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfVertexCyclesWithSize</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3644 <span class="s">}</span>
3645 
3646 <span class="c"># Get size of smallest ring containing specified atom...</span>
3647 <span class="c">#</span>
<a name="_GetSizeOfSmallestAtomRing-"></a>3648 <span class="k">sub </span><span class="m">_GetSizeOfSmallestAtomRing</span> <span class="s">{</span>
3649   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3650 
3651   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetSizeOfSmallestVertexCycle</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3652 <span class="s">}</span>
3653 
3654 <span class="c"># Get size of largest ring containing specified atom...</span>
3655 <span class="c">#</span>
<a name="_GetSizeOfLargestAtomRing-"></a>3656 <span class="k">sub </span><span class="m">_GetSizeOfLargestAtomRing</span> <span class="s">{</span>
3657   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3658 
3659   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetSizeOfLargestVertexCycle</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3660 <span class="s">}</span>
3661 
3662 <span class="c"># Get number of  rings containing specified atom...</span>
3663 <span class="c">#</span>
<a name="_GetNumOfAtomRings-"></a>3664 <span class="k">sub </span><span class="m">_GetNumOfAtomRings</span> <span class="s">{</span>
3665   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3666 
3667   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfVertexCycles</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3668 <span class="s">}</span>
3669 
3670 <span class="c"># Get number of  rings with odd size containing specified atom...</span>
3671 <span class="c">#</span>
<a name="_GetNumOfAtomRingsWithOddSize-"></a>3672 <span class="k">sub </span><span class="m">_GetNumOfAtomRingsWithOddSize</span> <span class="s">{</span>
3673   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3674 
3675   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfVertexCyclesWithOddSize</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3676 <span class="s">}</span>
3677 
3678 <span class="c"># Get number of  rings with even size containing specified atom...</span>
3679 <span class="c">#</span>
<a name="_GetNumOfAtomRingsWithEvenSize-"></a>3680 <span class="k">sub </span><span class="m">_GetNumOfAtomRingsWithEvenSize</span> <span class="s">{</span>
3681   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3682 
3683   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfVertexCyclesWithEvenSize</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3684 <span class="s">}</span>
3685 
3686 <span class="c"># Get number of  rings with specified size containing specified atom...</span>
3687 <span class="c">#</span>
<a name="_GetNumOfAtomRingsWithSize-"></a>3688 <span class="k">sub </span><span class="m">_GetNumOfAtomRingsWithSize</span> <span class="s">{</span>
3689   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3690 
3691   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfVertexCyclesWithSize</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3692 <span class="s">}</span>
3693 
3694 <span class="c"># Get number of  rings with size less than specified containing specified atom...</span>
3695 <span class="c">#</span>
<a name="_GetNumOfAtomRingsWithSizeLessThan-"></a>3696 <span class="k">sub </span><span class="m">_GetNumOfAtomRingsWithSizeLessThan</span> <span class="s">{</span>
3697   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3698 
3699   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfVertexCyclesWithSizeLessThan</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3700 <span class="s">}</span>
3701 
3702 <span class="c"># Get number of  rings with size greater than specified containing specified atom...</span>
3703 <span class="c">#</span>
<a name="_GetNumOfAtomRingsWithSizeGreaterThan-"></a>3704 <span class="k">sub </span><span class="m">_GetNumOfAtomRingsWithSizeGreaterThan</span> <span class="s">{</span>
3705   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3706 
3707   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfVertexCyclesWithSizeGreaterThan</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3708 <span class="s">}</span>
3709 
3710 <span class="c"># Get smallest ring as an array containing ring atoms...</span>
3711 <span class="c">#</span>
<a name="_GetSmallestAtomRing-"></a>3712 <span class="k">sub </span><span class="m">_GetSmallestAtomRing</span> <span class="s">{</span>
3713   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3714 
3715   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRing</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetSmallestVertexCycle</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3716 <span class="s">}</span>
3717 
3718 <span class="c"># Get odd size rings an array of references to arrays containing ring atoms...</span>
3719 <span class="c">#</span>
<a name="_GetLargestAtomRing-"></a>3720 <span class="k">sub </span><span class="m">_GetLargestAtomRing</span> <span class="s">{</span>
3721   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3722 
3723   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRing</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetLargestVertexCycle</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3724 <span class="s">}</span>
3725 
3726 <span class="c"># Get all rings an array of references to arrays containing ring atoms...</span>
3727 <span class="c">#</span>
<a name="_GetAtomRings-"></a>3728 <span class="k">sub </span><span class="m">_GetAtomRings</span> <span class="s">{</span>
3729   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3730 
3731   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetVertexCycles</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3732 <span class="s">}</span>
3733 
3734 <span class="c"># Get odd size rings an array of references to arrays containing ring atoms...</span>
3735 <span class="c">#</span>
<a name="_GetAtomRingsWithOddSize-"></a>3736 <span class="k">sub </span><span class="m">_GetAtomRingsWithOddSize</span> <span class="s">{</span>
3737   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3738 
3739   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetVertexCyclesWithOddSize</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3740 <span class="s">}</span>
3741 
3742 <span class="c"># Get even size rings an array of references to arrays containing ring atoms...</span>
3743 <span class="c">#</span>
<a name="_GetAtomRingsWithEvenSize-"></a>3744 <span class="k">sub </span><span class="m">_GetAtomRingsWithEvenSize</span> <span class="s">{</span>
3745   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3746 
3747   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetVertexCyclesWithEvenSize</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3748 <span class="s">}</span>
3749 
3750 <span class="c"># Get rings with specified size  an array of references to arrays containing ring atoms...</span>
3751 <span class="c">#</span>
<a name="_GetAtomRingsWithSize-"></a>3752 <span class="k">sub </span><span class="m">_GetAtomRingsWithSize</span> <span class="s">{</span>
3753   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3754 
3755   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetVertexCyclesWithSize</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3756 <span class="s">}</span>
3757 
3758 <span class="c"># Get rings with size less than specfied size as an array of references to arrays containing ring atoms...</span>
3759 <span class="c">#</span>
<a name="_GetAtomRingsWithSizeLessThan-"></a>3760 <span class="k">sub </span><span class="m">_GetAtomRingsWithSizeLessThan</span> <span class="s">{</span>
3761   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3762 
3763   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetVertexCyclesWithSizeLessThan</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3764 <span class="s">}</span>
3765 
3766 <span class="c"># Get rings with size less than specfied size as an array of references to arrays containing ring atoms...</span>
3767 <span class="c">#</span>
<a name="_GetAtomRingsWithSizeGreaterThan-"></a>3768 <span class="k">sub </span><span class="m">_GetAtomRingsWithSizeGreaterThan</span> <span class="s">{</span>
3769   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3770 
3771   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetVertexCyclesWithSizeGreaterThan</span><span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3772 <span class="s">}</span>
3773 
3774 <span class="c"># Is bond in a ring?</span>
3775 <span class="c">#</span>
<a name="_IsBondInRing-"></a>3776 <span class="k">sub </span><span class="m">_IsBondInRing</span> <span class="s">{</span>
3777   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3778   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3779 
3780   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3781 
3782   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsCyclicEdge</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3783 <span class="s">}</span>
3784 
3785 <span class="c"># Is bond not in a ring?</span>
3786 <span class="c">#</span>
<a name="_IsBondNotInRing-"></a>3787 <span class="k">sub </span><span class="m">_IsBondNotInRing</span> <span class="s">{</span>
3788   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3789   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3790 
3791   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3792 
3793   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsAcyclicEdge</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3794 <span class="s">}</span>
3795 
3796 <span class="c"># Is bond only in one ring?</span>
3797 <span class="c">#</span>
<a name="_IsBondInOnlyOneRing-"></a>3798 <span class="k">sub </span><span class="m">_IsBondInOnlyOneRing</span> <span class="s">{</span>
3799   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3800   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3801 
3802   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3803 
3804   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;IsUnicyclicEdge</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3805 <span class="s">}</span>
3806 
3807 <span class="c"># Is bond in a ring of specified size?</span>
3808 <span class="c">#</span>
<a name="_IsBondInRingOfSize-"></a>3809 <span class="k">sub </span><span class="m">_IsBondInRingOfSize</span> <span class="s">{</span>
3810   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3811   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3812 
3813   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3814 
3815   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfEdgeCyclesWithSize</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
3816 <span class="s">}</span>
3817 
3818 <span class="c"># Get size of smallest ring containing specified bond...</span>
3819 <span class="c">#</span>
<a name="_GetSizeOfSmallestBondRing-"></a>3820 <span class="k">sub </span><span class="m">_GetSizeOfSmallestBondRing</span> <span class="s">{</span>
3821   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3822   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3823 
3824   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3825 
3826   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetSizeOfSmallestEdgeCycle</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3827 <span class="s">}</span>
3828 
3829 <span class="c"># Get size of largest ring containing specified bond...</span>
3830 <span class="c">#</span>
<a name="_GetSizeOfLargestBondRing-"></a>3831 <span class="k">sub </span><span class="m">_GetSizeOfLargestBondRing</span> <span class="s">{</span>
3832   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3833   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3834 
3835   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3836 
3837   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetSizeOfLargestEdgeCycle</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3838 <span class="s">}</span>
3839 
3840 <span class="c"># Get number of  rings containing specified bond...</span>
3841 <span class="c">#</span>
<a name="_GetNumOfBondRings-"></a>3842 <span class="k">sub </span><span class="m">_GetNumOfBondRings</span> <span class="s">{</span>
3843   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3844   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3845 
3846   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3847 
3848   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfEdgeCycles</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3849 <span class="s">}</span>
3850 
3851 <span class="c"># Get number of  rings with odd size containing specified bond...</span>
3852 <span class="c">#</span>
<a name="_GetNumOfBondRingsWithOddSize-"></a>3853 <span class="k">sub </span><span class="m">_GetNumOfBondRingsWithOddSize</span> <span class="s">{</span>
3854   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3855   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3856 
3857   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3858 
3859   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfEdgeCyclesWithOddSize</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3860 <span class="s">}</span>
3861 
3862 <span class="c"># Get number of  rings with even size containing specified bond...</span>
3863 <span class="c">#</span>
<a name="_GetNumOfBondRingsWithEvenSize-"></a>3864 <span class="k">sub </span><span class="m">_GetNumOfBondRingsWithEvenSize</span> <span class="s">{</span>
3865   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3866   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3867 
3868   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3869 
3870   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfEdgeCyclesWithEvenSize</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3871 <span class="s">}</span>
3872 
3873 <span class="c"># Get number of  rings with specified size containing specified bond...</span>
3874 <span class="c">#</span>
<a name="_GetNumOfBondRingsWithSize-"></a>3875 <span class="k">sub </span><span class="m">_GetNumOfBondRingsWithSize</span> <span class="s">{</span>
3876   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3877   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3878 
3879   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3880 
3881   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfEdgeCyclesWithSize</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3882 <span class="s">}</span>
3883 
3884 <span class="c"># Get number of  rings with size less than specified containing specified bond...</span>
3885 <span class="c">#</span>
<a name="_GetNumOfBondRingsWithSizeLessThan-"></a>3886 <span class="k">sub </span><span class="m">_GetNumOfBondRingsWithSizeLessThan</span> <span class="s">{</span>
3887   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3888   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3889 
3890   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3891 
3892   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfEdgeCyclesWithSizeLessThan</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3893 <span class="s">}</span>
3894 
3895 <span class="c"># Get number of  rings with size greater than specified containing specified bond...</span>
3896 <span class="c">#</span>
<a name="_GetNumOfBondRingsWithSizeGreaterThan-"></a>3897 <span class="k">sub </span><span class="m">_GetNumOfBondRingsWithSizeGreaterThan</span> <span class="s">{</span>
3898   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3899   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3900 
3901   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3902 
3903   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetNumOfEdgeCyclesWithSizeGreaterThan</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="sc">;</span>
3904 <span class="s">}</span>
3905 
3906 <span class="c"># Get smallest ring as an array containing ring atoms...</span>
3907 <span class="c">#</span>
<a name="_GetSmallestBondRing-"></a>3908 <span class="k">sub </span><span class="m">_GetSmallestBondRing</span> <span class="s">{</span>
3909   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3910   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3911 
3912   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3913 
3914   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRing</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetSmallestEdgeCycle</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3915 <span class="s">}</span>
3916 
3917 <span class="c"># Get odd size rings an array of references to arrays containing ring atoms...</span>
3918 <span class="c">#</span>
<a name="_GetLargestBondRing-"></a>3919 <span class="k">sub </span><span class="m">_GetLargestBondRing</span> <span class="s">{</span>
3920   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3921   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3922 
3923   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3924 
3925   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRing</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetLargestEdgeCycle</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3926 <span class="s">}</span>
3927 
3928 <span class="c"># Get all rings an array of references to arrays containing ring atoms...</span>
3929 <span class="c">#</span>
<a name="_GetBondRings-"></a>3930 <span class="k">sub </span><span class="m">_GetBondRings</span> <span class="s">{</span>
3931   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3932   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3933 
3934   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3935 
3936   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetEdgeCycles</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3937 <span class="s">}</span>
3938 
3939 <span class="c"># Get odd size rings an array of references to arrays containing ring atoms...</span>
3940 <span class="c">#</span>
<a name="_GetBondRingsWithOddSize-"></a>3941 <span class="k">sub </span><span class="m">_GetBondRingsWithOddSize</span> <span class="s">{</span>
3942   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3943   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3944 
3945   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3946 
3947   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetEdgeCyclesWithOddSize</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3948 <span class="s">}</span>
3949 
3950 <span class="c"># Get even size rings an array of references to arrays containing ring atoms...</span>
3951 <span class="c">#</span>
<a name="_GetBondRingsWithEvenSize-"></a>3952 <span class="k">sub </span><span class="m">_GetBondRingsWithEvenSize</span> <span class="s">{</span>
3953   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3954   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3955 
3956   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3957 
3958   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetEdgeCyclesWithEvenSize</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3959 <span class="s">}</span>
3960 
3961 <span class="c"># Get rings with specified size  an array of references to arrays containing ring atoms...</span>
3962 <span class="c">#</span>
<a name="_GetBondRingsWithSize-"></a>3963 <span class="k">sub </span><span class="m">_GetBondRingsWithSize</span> <span class="s">{</span>
3964   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3965   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3966 
3967   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3968 
3969   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetEdgeCyclesWithSize</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3970 <span class="s">}</span>
3971 
3972 <span class="c"># Get rings with size less than specfied size as an array of references to arrays containing ring atoms...</span>
3973 <span class="c">#</span>
<a name="_GetBondRingsWithSizeLessThan-"></a>3974 <span class="k">sub </span><span class="m">_GetBondRingsWithSizeLessThan</span> <span class="s">{</span>
3975   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3976   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3977 
3978   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3979 
3980   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetEdgeCyclesWithSizeLessThan</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3981 <span class="s">}</span>
3982 
3983 <span class="c"># Get rings with size less than specfied size as an array of references to arrays containing ring atoms...</span>
3984 <span class="c">#</span>
<a name="_GetBondRingsWithSizeGreaterThan-"></a>3985 <span class="k">sub </span><span class="m">_GetBondRingsWithSizeGreaterThan</span> <span class="s">{</span>
3986   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
3987   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span><span class="sc">;</span>
3988 
3989   <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
3990 
3991   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetRings</span><span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetEdgeCyclesWithSizeGreaterThan</span><span class="s">(</span><span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="cm">,</span> <span class="i">$RingSize</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
3992 <span class="s">}</span>
3993 
3994 
3995 <span class="c"># Get atom paths starting from a specified atom as a reference to an array containing references</span>
3996 <span class="c"># to arrays with path atoms.</span>
3997 <span class="c">#</span>
3998 <span class="c"># Path atoms atoms correspond to to all possible paths for specified atom in molecule with length</span>
3999 <span class="c"># upto a specified length and sharing of bonds in paths traversed. By default, rings are</span>
4000 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4001 <span class="c">#</span>
4002 <span class="c"># Note:</span>
4003 <span class="c">#    . For molecule without any rings, this method returns the same set of atom paths</span>
4004 <span class="c">#      as GetAtomPathsStartingAtWithLengthUpto method.</span>
4005 <span class="c">#</span>
<a name="GetAllAtomPathsStartingAtWithLengthUpto-"></a>4006 <span class="k">sub </span><span class="m">GetAllAtomPathsStartingAtWithLengthUpto</span> <span class="s">{</span>
4007   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4008 
4009   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsStartingAt</span><span class="s">(</span><span class="q">&#39;AllAtomPathsWithLengthUpto&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4010 <span class="s">}</span>
4011 
4012 <span class="c"># Get atom paths starting from a specified atom as a reference to an array containing references</span>
4013 <span class="c"># to arrays with path atoms.</span>
4014 <span class="c">#</span>
4015 <span class="c"># Path atoms atoms correspond to to all possible paths for specified atom in molecule with</span>
4016 <span class="c"># specified length and sharing of bonds in paths traversed. By default, rings are</span>
4017 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4018 <span class="c">#</span>
4019 <span class="c"># Note:</span>
4020 <span class="c">#    . For molecule without any rings, this method returns the same set of atom paths</span>
4021 <span class="c">#      as GetAtomPathsStartingAtWithLengthUpto method.</span>
4022 <span class="c">#</span>
<a name="GetAllAtomPathsStartingAtWithLength-"></a>4023 <span class="k">sub </span><span class="m">GetAllAtomPathsStartingAtWithLength</span> <span class="s">{</span>
4024   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4025 
4026   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsStartingAt</span><span class="s">(</span><span class="q">&#39;AllAtomPathsWithLength&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4027 <span class="s">}</span>
4028 
4029 <span class="c"># Get atom paths starting from a specified atom as a reference to an array containing references</span>
4030 <span class="c"># to arrays with path atoms.</span>
4031 <span class="c">#</span>
4032 <span class="c"># Path atoms atoms correspond to to all possible paths for specified atom in molecule with all</span>
4033 <span class="c"># possible lengths and sharing of bonds in paths traversed. By default, rings are</span>
4034 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4035 <span class="c">#</span>
4036 <span class="c"># Note:</span>
4037 <span class="c">#    . For molecule without any rings, this method returns the same set of atom paths</span>
4038 <span class="c">#      as GetAtomPathsStartingAt method.</span>
4039 <span class="c">#</span>
<a name="GetAllAtomPathsStartingAt-"></a>4040 <span class="k">sub </span><span class="m">GetAllAtomPathsStartingAt</span> <span class="s">{</span>
4041   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4042 
4043   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsStartingAt</span><span class="s">(</span><span class="q">&#39;AllAtomPathsWithAllLengths&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4044 <span class="s">}</span>
4045 
4046 <span class="c"># Get atom paths starting from a specified atom as a reference to an array containing references</span>
4047 <span class="c"># to arrays with path atoms.</span>
4048 <span class="c">#</span>
4049 <span class="c"># Path atoms atoms correspond to to all possible paths for specified atom in molecule with length</span>
4050 <span class="c"># upto a specified length and no sharing of bonds in paths traversed. By default, rings are</span>
4051 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4052 <span class="c">#</span>
<a name="GetAtomPathsStartingAtWithLengthUpto-"></a>4053 <span class="k">sub </span><span class="m">GetAtomPathsStartingAtWithLengthUpto</span> <span class="s">{</span>
4054   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4055 
4056   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsStartingAt</span><span class="s">(</span><span class="q">&#39;AtomPathsWithLengthUpto&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4057 <span class="s">}</span>
4058 
4059 <span class="c"># Get atom paths starting from a specified atom as a reference to an array containing references</span>
4060 <span class="c"># to arrays with path atoms.</span>
4061 <span class="c">#</span>
4062 <span class="c"># Path atoms atoms correspond to to all possible paths for specified atom in molecule with</span>
4063 <span class="c"># specified length and no sharing of bonds in paths traversed. By default, rings are</span>
4064 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4065 <span class="c">#</span>
<a name="GetAtomPathsStartingAtWithLength-"></a>4066 <span class="k">sub </span><span class="m">GetAtomPathsStartingAtWithLength</span> <span class="s">{</span>
4067   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4068 
4069   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsStartingAt</span><span class="s">(</span><span class="q">&#39;AtomPathsWithLength&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4070 <span class="s">}</span>
4071 
4072 <span class="c"># Get atom paths starting from a specified atom as a reference to an array containing references</span>
4073 <span class="c"># to arrays with path atoms.</span>
4074 <span class="c">#</span>
4075 <span class="c"># Path atoms atoms correspond to to all possible paths for specified atom in molecule with all</span>
4076 <span class="c"># possible lengths and no sharing of bonds in paths traversed. By default, rings are</span>
4077 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4078 <span class="c">#</span>
4079 <span class="c">#</span>
<a name="GetAtomPathsStartingAt-"></a>4080 <span class="k">sub </span><span class="m">GetAtomPathsStartingAt</span> <span class="s">{</span>
4081   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4082 
4083   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsStartingAt</span><span class="s">(</span><span class="q">&#39;AtomPathsWithAllLengths&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4084 <span class="s">}</span>
4085 
4086 <span class="c"># Get atom paths as an array containing references to arrays with path atoms...</span>
4087 <span class="c">#</span>
<a name="_GetAtomPathsStartingAt-"></a>4088 <span class="k">sub </span><span class="m">_GetAtomPathsStartingAt</span> <span class="s">{</span>
4089   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Mode</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4090   <span class="k">my</span><span class="s">(</span><span class="i">@AtomPaths</span><span class="s">)</span><span class="sc">;</span>
4091 
4092   <span class="i">@AtomPaths</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4093   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$StartAtom</span><span class="s">)</span> <span class="s">{</span>
4094     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomPathsStartingAt: No atom paths retrieved: Start atom is not defined...&quot;</span><span class="sc">;</span>
4095     <span class="k">return</span> <span class="i">@AtomPaths</span><span class="sc">;</span>
4096   <span class="s">}</span>
4097   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$StartAtom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4098     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomPathsStartingAt: No atom paths retrieved: Start atom doesn&#39;t exist...&quot;</span><span class="sc">;</span>
4099     <span class="k">return</span> <span class="i">@AtomPaths</span><span class="sc">;</span>
4100   <span class="s">}</span>
4101   <span class="k">my</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">@Paths</span><span class="s">)</span><span class="sc">;</span>
4102 
4103   <span class="i">$StartAtomID</span> = <span class="i">$StartAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4104   <span class="i">@Paths</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4105 
4106   <span class="c"># Collect appropriate atom paths...</span>
4107   <span class="j">MODE:</span> <span class="s">{</span>
4108     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AtomPathsWithLengthUpto$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@Paths</span> = <span class="i">$This</span><span class="i">-&gt;GetPathsStartingAtWithLengthUpto</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4109     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AtomPathsWithLength$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@Paths</span> = <span class="i">$This</span><span class="i">-&gt;GetPathsStartingAtWithLength</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4110     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AtomPathsWithAllLengths$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@Paths</span> = <span class="i">$This</span><span class="i">-&gt;GetPathsStartingAt</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4111 
4112     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AllAtomPathsWithLengthUpto$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@Paths</span> = <span class="i">$This</span><span class="i">-&gt;GetAllPathsStartingAtWithLengthUpto</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4113     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AllAtomPathsWithLength$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@Paths</span> = <span class="i">$This</span><span class="i">-&gt;GetAllPathsStartingAtWithLength</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4114     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AllAtomPathsWithAllLengths$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@Paths</span> = <span class="i">$This</span><span class="i">-&gt;GetAllPathsStartingAt</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4115 
4116     <span class="k">print</span> <span class="q">&quot;Warn: ${ClassName}-&gt;_GetAtomPathsStartingAt: No atom paths retrieved: Mode, $Mode, is not supported...&quot;</span><span class="sc">;</span>
4117     <span class="k">return</span> <span class="i">@AtomPaths</span><span class="sc">;</span>
4118   <span class="s">}</span>
4119   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsFromPaths</span><span class="s">(</span>\<span class="i">@Paths</span><span class="s">)</span><span class="sc">;</span>
4120 <span class="s">}</span>
4121 
4122 <span class="c"># Get atom paths for all atoms as a reference to an array containing references to arrays with</span>
4123 <span class="c"># path atoms.</span>
4124 <span class="c">#</span>
4125 <span class="c"># Path atoms correspond to to all possible paths for each atom in molecule with length</span>
4126 <span class="c"># upto a specified length and sharing of bonds in paths traversed. By default, rings are</span>
4127 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4128 <span class="c">#</span>
4129 <span class="c"># Notes:</span>
4130 <span class="c">#    . For molecule without any rings, this method returns the same set of atom paths</span>
4131 <span class="c">#      as GetAtomPathsWithLengthUpto method.</span>
4132 <span class="c">#</span>
<a name="GetAllAtomPathsWithLengthUpto-"></a>4133 <span class="k">sub </span><span class="m">GetAllAtomPathsWithLengthUpto</span> <span class="s">{</span>
4134   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4135 
4136   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPaths</span><span class="s">(</span><span class="q">&#39;AllAtomPathsWithLengthUpto&#39;</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4137 <span class="s">}</span>
4138 
4139 <span class="c"># Get atom paths for all atoms as a reference to an array containing references to arrays with</span>
4140 <span class="c"># path atoms.</span>
4141 <span class="c">#</span>
4142 <span class="c"># Path atoms correspond to to all possible paths for each atom in molecule with</span>
4143 <span class="c"># a specified length and sharing of bonds in paths traversed. By default, rings are</span>
4144 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4145 <span class="c">#</span>
4146 <span class="c"># Notes:</span>
4147 <span class="c">#    . For molecule without any rings, this method returns the same set of atom paths</span>
4148 <span class="c">#      as GetAtomPathsWithLengthUpto method.</span>
4149 <span class="c">#</span>
<a name="GetAllAtomPathsWithLength-"></a>4150 <span class="k">sub </span><span class="m">GetAllAtomPathsWithLength</span> <span class="s">{</span>
4151   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4152 
4153   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPaths</span><span class="s">(</span><span class="q">&#39;AllAtomPathsWithLength&#39;</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4154 <span class="s">}</span>
4155 
4156 <span class="c"># Get atom paths for all atoms as a reference to an array containing references to arrays with</span>
4157 <span class="c"># path atoms.</span>
4158 <span class="c">#</span>
4159 <span class="c"># Path atoms correspond to to all possible paths for each atom in molecule with all</span>
4160 <span class="c"># possible lengths and sharing of bonds in paths traversed. By default, rings are</span>
4161 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4162 <span class="c">#</span>
4163 <span class="c"># Notes:</span>
4164 <span class="c">#    . For molecule without any rings, this method returns the same set of atom paths</span>
4165 <span class="c">#      as GetAtomPaths method.</span>
4166 <span class="c">#</span>
<a name="GetAllAtomPaths-"></a>4167 <span class="k">sub </span><span class="m">GetAllAtomPaths</span> <span class="s">{</span>
4168   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4169 
4170   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPaths</span><span class="s">(</span><span class="q">&#39;AllAtomPathsWithAllLengths&#39;</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4171 <span class="s">}</span>
4172 
4173 <span class="c"># Get atom paths for all atoms as a reference to an array containing references to arrays with</span>
4174 <span class="c"># path atoms.</span>
4175 <span class="c">#</span>
4176 <span class="c"># Path atoms correspond to to all possible paths for each atom in molecule with length</span>
4177 <span class="c"># upto a specified length and no sharing of bonds in paths traversed. By default, rings are</span>
4178 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4179 <span class="c">#</span>
<a name="GetAtomPathsWithLengthUpto-"></a>4180 <span class="k">sub </span><span class="m">GetAtomPathsWithLengthUpto</span> <span class="s">{</span>
4181   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4182 
4183   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPaths</span><span class="s">(</span><span class="q">&#39;AtomPathsWithLengthUpto&#39;</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4184 <span class="s">}</span>
4185 
4186 <span class="c"># Get atom paths for all atoms as a reference to an array containing references to arrays with</span>
4187 <span class="c"># path atoms.</span>
4188 <span class="c">#</span>
4189 <span class="c"># Path atoms correspond to to all possible paths for each atom in molecule with</span>
4190 <span class="c"># a specified length and no sharing of bonds in paths traversed. By default, rings are</span>
4191 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4192 <span class="c">#</span>
<a name="GetAtomPathsWithLength-"></a>4193 <span class="k">sub </span><span class="m">GetAtomPathsWithLength</span> <span class="s">{</span>
4194   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4195 
4196   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPaths</span><span class="s">(</span><span class="q">&#39;AtomPathsWithLength&#39;</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4197 <span class="s">}</span>
4198 
4199 
4200 <span class="c"># Get atom paths for all atoms as a reference to an array containing references to arrays with</span>
4201 <span class="c"># path atoms.</span>
4202 <span class="c">#</span>
4203 <span class="c"># Path atoms correspond to to all possible paths for each atom in molecule with all</span>
4204 <span class="c"># possible lengths and no sharing of bonds in paths traversed. By default, rings are</span>
4205 <span class="c"># included in paths. A path containing a ring is terminated at an atom completing the ring.</span>
4206 <span class="c">#</span>
<a name="GetAtomPaths-"></a>4207 <span class="k">sub </span><span class="m">GetAtomPaths</span> <span class="s">{</span>
4208   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4209 
4210   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPaths</span><span class="s">(</span><span class="q">&#39;AtomPathsWithAllLengths&#39;</span><span class="cm">,</span> <span class="k">undef</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span>
4211 <span class="s">}</span>
4212 
4213 <span class="c"># Get atom paths for all atoms as a reference to an array containing references to arrays with</span>
4214 <span class="c"># path atoms.</span>
4215 <span class="c">#</span>
<a name="_GetAtomPaths-"></a>4216 <span class="k">sub </span><span class="m">_GetAtomPaths</span> <span class="s">{</span>
4217   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Mode</span><span class="cm">,</span> <span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4218   <span class="k">my</span><span class="s">(</span><span class="i">$PathsRef</span><span class="cm">,</span> <span class="i">@AtomPaths</span><span class="s">)</span><span class="sc">;</span>
4219 
4220   <span class="i">@AtomPaths</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4221   <span class="c"># Collect appropriate atom paths...</span>
4222   <span class="j">MODE:</span> <span class="s">{</span>
4223     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AtomPathsWithLengthUpto$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$PathsRef</span> = <span class="i">$This</span><span class="i">-&gt;GetPathsWithLengthUpto</span><span class="s">(</span><span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4224     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AtomPathsWithLength$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$PathsRef</span> = <span class="i">$This</span><span class="i">-&gt;GetPathsWithLength</span><span class="s">(</span><span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4225     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AtomPathsWithAllLengths$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$PathsRef</span> = <span class="i">$This</span><span class="i">-&gt;GetPaths</span><span class="s">(</span><span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4226 
4227     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AllAtomPathsWithLengthUpto$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$PathsRef</span> = <span class="i">$This</span><span class="i">-&gt;GetAllPathsWithLengthUpto</span><span class="s">(</span><span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4228     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AllAtomPathsWithLength$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$PathsRef</span> = <span class="i">$This</span><span class="i">-&gt;GetAllPathsWithLength</span><span class="s">(</span><span class="i">$Length</span><span class="cm">,</span> <span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4229     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AllAtomPathsWithAllLengths$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">$PathsRef</span> = <span class="i">$This</span><span class="i">-&gt;GetAllPaths</span><span class="s">(</span><span class="i">$AllowCycles</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4230 
4231     <span class="k">print</span> <span class="q">&quot;Warn: ${ClassName}-&gt;_GetAtomPaths: No atom paths retrieved: Mode, $Mode, is not supported...&quot;</span><span class="sc">;</span>
4232     <span class="k">return</span> \<span class="i">@AtomPaths</span><span class="sc">;</span>
4233   <span class="s">}</span>
4234   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsFromPaths</span><span class="s">(</span><span class="i">$PathsRef</span><span class="s">)</span><span class="sc">;</span>
4235 <span class="s">}</span>
4236 
4237 <span class="c"># Get atom paths as an array reference containing references to arrays with path atoms...</span>
4238 <span class="c">#</span>
<a name="_GetAtomPathsFromPaths-"></a>4239 <span class="k">sub </span><span class="m">_GetAtomPathsFromPaths</span> <span class="s">{</span>
4240   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4241   <span class="k">my</span><span class="s">(</span><span class="i">$Path</span><span class="cm">,</span> <span class="i">@AtomPaths</span><span class="s">)</span><span class="sc">;</span>
4242 
4243   <span class="i">@AtomPaths</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4244   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$PathsRef</span><span class="s">)</span> <span class="s">{</span>
4245     <span class="k">return</span> \<span class="i">@AtomPaths</span><span class="sc">;</span>
4246   <span class="s">}</span>
4247   <span class="k">if</span> <span class="s">(</span>!<span class="i">@</span>{<span class="i">$PathsRef</span>}<span class="s">)</span> <span class="s">{</span>
4248     <span class="c"># Return an empty atom paths list...</span>
4249     <span class="k">return</span> \<span class="i">@AtomPaths</span><span class="sc">;</span>
4250   <span class="s">}</span>
4251   <span class="k">for</span> <span class="i">$Path</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathsRef</span>}<span class="s">)</span> <span class="s">{</span>
4252     <span class="k">my</span><span class="s">(</span><span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
4253     <span class="i">@PathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4254     <span class="i">@PathAtoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomPathFromPath</span><span class="s">(</span><span class="i">$Path</span><span class="s">)</span><span class="sc">;</span>
4255 
4256     <span class="k">push</span> <span class="i">@AtomPaths</span><span class="cm">,</span> \<span class="i">@PathAtoms</span><span class="sc">;</span>
4257   <span class="s">}</span>
4258   <span class="k">return</span> \<span class="i">@AtomPaths</span><span class="sc">;</span>
4259 <span class="s">}</span>
4260 
4261 <span class="c"># Generate an array of bond objects for an array of path atoms and return an array</span>
4262 <span class="c"># of bond objects...</span>
4263 <span class="c">#</span>
<a name="GetAtomPathBonds-"></a>4264 <span class="k">sub </span><span class="m">GetAtomPathBonds</span> <span class="s">{</span>
4265   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@PathAtoms</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4266   <span class="k">my</span><span class="s">(</span><span class="i">@Bonds</span><span class="s">)</span><span class="sc">;</span>
4267 
4268   <span class="k">if</span> <span class="s">(</span>!<span class="i">@PathAtoms</span><span class="s">)</span> <span class="s">{</span>
4269     <span class="c"># Return an empty ring bonds list...</span>
4270     <span class="k">return</span> <span class="i">@Bonds</span><span class="sc">;</span>
4271   <span class="s">}</span>
4272   <span class="k">my</span><span class="s">(</span><span class="i">@PathAtomIDs</span><span class="s">)</span><span class="sc">;</span>
4273 
4274   <span class="i">@PathAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4275   <span class="i">@PathAtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsIDsFromAtoms</span><span class="s">(</span><span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
4276 
4277   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetPathBonds</span><span class="s">(</span><span class="i">@PathAtomIDs</span><span class="s">)</span><span class="sc">;</span>
4278 <span class="s">}</span>
4279 
4280 <span class="c"># Map atom IDs in path to atoms and return a reference to an array containing ring atoms...</span>
4281 <span class="c">#</span>
<a name="_GetAtomPathFromPath-"></a>4282 <span class="k">sub </span><span class="m">_GetAtomPathFromPath</span> <span class="s">{</span>
4283   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Path</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4284   <span class="k">my</span><span class="s">(</span><span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
4285 
4286   <span class="i">@PathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4287   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$Path</span><span class="s">)</span> <span class="s">{</span>
4288     <span class="c"># Return an empty atoms list...</span>
4289     <span class="k">return</span> <span class="i">@PathAtoms</span><span class="sc">;</span>
4290   <span class="s">}</span>
4291 
4292   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetPathAtoms</span><span class="s">(</span><span class="i">$Path</span><span class="s">)</span><span class="sc">;</span>
4293 <span class="s">}</span>
4294 
4295 <span class="c"># Get atom paths between two specified atoms as a reference to an array containing references</span>
4296 <span class="c"># to arrays with path atoms. For molecules with rings, atom paths array contains may contain</span>
4297 <span class="c"># two paths.</span>
4298 <span class="c">#</span>
<a name="GetAtomPathsBetween-"></a>4299 <span class="k">sub </span><span class="m">GetAtomPathsBetween</span> <span class="s">{</span>
4300   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$EndAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4301   <span class="k">my</span><span class="s">(</span><span class="i">@AtomPaths</span><span class="s">)</span><span class="sc">;</span>
4302 
4303   <span class="i">@AtomPaths</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4304   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$StartAtom</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$StartAtom</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4305     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomPathsBetween: No atom paths retrieved: Start atom is not defined  or it doesn&#39;t exist...&quot;</span><span class="sc">;</span>
4306     <span class="k">return</span> <span class="i">@AtomPaths</span><span class="sc">;</span>
4307   <span class="s">}</span>
4308   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$EndAtom</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$EndAtom</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4309     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomPathsBetween: No atom paths retrieved: End atom is not defined  or it doesn&#39;t exist...&quot;</span><span class="sc">;</span>
4310     <span class="k">return</span> <span class="i">@AtomPaths</span><span class="sc">;</span>
4311   <span class="s">}</span>
4312   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsBetween</span><span class="s">(</span><span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$EndAtom</span><span class="s">)</span><span class="sc">;</span>
4313 <span class="s">}</span>
4314 
4315 <span class="c"># Get atom paths between two specified atoms as a reference to an array containing references</span>
4316 <span class="c"># to arrays with path atoms.</span>
4317 <span class="c">#</span>
<a name="_GetAtomPathsBetween-"></a>4318 <span class="k">sub </span><span class="m">_GetAtomPathsBetween</span> <span class="s">{</span>
4319   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$EndAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4320   <span class="k">my</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$EndAtomID</span><span class="cm">,</span> <span class="i">@Paths</span><span class="s">)</span><span class="sc">;</span>
4321 
4322   <span class="i">$StartAtomID</span> = <span class="i">$StartAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4323   <span class="i">$EndAtomID</span> = <span class="i">$EndAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4324 
4325   <span class="i">@Paths</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4326   <span class="i">@Paths</span> = <span class="i">$This</span><span class="i">-&gt;GetPathsBetween</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$EndAtomID</span><span class="s">)</span><span class="sc">;</span>
4327 
4328   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomPathsFromPaths</span><span class="s">(</span>\<span class="i">@Paths</span><span class="s">)</span><span class="sc">;</span>
4329 <span class="s">}</span>
4330 
4331 <span class="c"># Get atom neighborhoods around a specified atom as an array containing references</span>
4332 <span class="c"># to arrays with neighborhood atoms at different radii upto specified radius...</span>
4333 <span class="c">#</span>
<a name="GetAtomNeighborhoodsWithRadiusUpto-"></a>4334 <span class="k">sub </span><span class="m">GetAtomNeighborhoodsWithRadiusUpto</span> <span class="s">{</span>
4335   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Radius</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4336 
4337   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomNeighborhoods</span><span class="s">(</span><span class="q">&#39;RadiusUpto&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Radius</span><span class="s">)</span><span class="sc">;</span>
4338 <span class="s">}</span>
4339 
4340 <span class="c"># Get atom neighborhoods around a specified atom as an array containing references</span>
4341 <span class="c"># to arrays with neighborhood atoms at possible radii...</span>
4342 <span class="c">#</span>
<a name="GetAtomNeighborhoods-"></a>4343 <span class="k">sub </span><span class="m">GetAtomNeighborhoods</span> <span class="s">{</span>
4344   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4345 
4346   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomNeighborhoods</span><span class="s">(</span><span class="q">&#39;AllRadii&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
4347 <span class="s">}</span>
4348 
4349 <span class="c"># Get atom neighborhood around a specified atom, along with their successor connected atoms, collected</span>
4350 <span class="c"># with in a specified radius as a list containing references to lists with first value corresponding to neighborhood</span>
4351 <span class="c"># atom at a specific radius and second value as reference to a list containing its successor connected atoms.</span>
4352 <span class="c">#</span>
4353 <span class="c"># For a neighborhood atom at each radius level, the successor connected atoms correspond to the</span>
4354 <span class="c"># neighborhood atoms at the next radius level. Consequently, the neighborhood atoms at the last</span>
4355 <span class="c"># radius level don&#39;t contain any successor atoms which fall outside the range of specified radius.</span>
4356 <span class="c">#</span>
<a name="GetAtomNeighborhoodsWithSuccessorAtomsAndRadiusUpto-"></a>4357 <span class="k">sub </span><span class="m">GetAtomNeighborhoodsWithSuccessorAtomsAndRadiusUpto</span> <span class="s">{</span>
4358   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Radius</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4359 
4360   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomNeighborhoods</span><span class="s">(</span><span class="q">&#39;WithSuccessorsAndRadiusUpto&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Radius</span><span class="s">)</span><span class="sc">;</span>
4361 <span class="s">}</span>
4362 
4363 <span class="c"># Get atom neighborhood around a specified atom, along with their successor connected atoms, collected</span>
4364 <span class="c"># at all radii as a list containing references to lists with first value corresponding to neighborhood</span>
4365 <span class="c"># atom at a specific radius and second value as reference to a list containing its successor connected atoms.</span>
4366 <span class="c">#</span>
4367 <span class="c"># For a neighborhood atom at each radius level, the successor connected atoms correspond to the</span>
4368 <span class="c"># neighborhood atoms at the next radius level. Consequently, the neighborhood atoms at the last</span>
4369 <span class="c"># radius level don&#39;t contain any successor atoms which fall outside the range of specified radius.</span>
4370 <span class="c">#</span>
4371 <span class="c">#</span>
<a name="GetAtomNeighborhoodsWithSuccessorAtoms-"></a>4372 <span class="k">sub </span><span class="m">GetAtomNeighborhoodsWithSuccessorAtoms</span> <span class="s">{</span>
4373   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4374 
4375   <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetAtomNeighborhoods</span><span class="s">(</span><span class="q">&#39;WithSuccessorsAndAllRadii&#39;</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="k">undef</span><span class="s">)</span><span class="sc">;</span>
4376 <span class="s">}</span>
4377 
4378 <span class="c"># Get atom neighborhoods...</span>
4379 <span class="c">#</span>
<a name="_GetAtomNeighborhoods-"></a>4380 <span class="k">sub </span><span class="m">_GetAtomNeighborhoods</span> <span class="s">{</span>
4381   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Mode</span><span class="cm">,</span> <span class="i">$StartAtom</span><span class="cm">,</span> <span class="i">$Radius</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4382   <span class="k">my</span><span class="s">(</span><span class="i">@AtomNeighborhoods</span><span class="s">)</span><span class="sc">;</span>
4383 
4384   <span class="i">@AtomNeighborhoods</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4385 
4386   <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$StartAtom</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;HasAtom</span><span class="s">(</span><span class="i">$StartAtom</span><span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4387     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomNeighborhoods: No atom neighborhoods retrieved: Start atom is not defined  or it doesn&#39;t exist...&quot;</span><span class="sc">;</span>
4388     <span class="k">return</span> <span class="i">@AtomNeighborhoods</span><span class="sc">;</span>
4389   <span class="s">}</span>
4390   <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^(RadiusUpto|WithSuccessorsAndRadiusUpto)$/i</span><span class="s">)</span> <span class="s">{</span>
4391     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Radius</span><span class="s">)</span> &amp;&amp; <span class="i">$Radius</span> &gt; <span class="n">0</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4392       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;_GetAtomNeighborhoods: No atom neighborhoods retrieved: Radius is not defined or it&#39;s &lt;= 0 ...&quot;</span><span class="sc">;</span>
4393       <span class="k">return</span> <span class="i">@AtomNeighborhoods</span><span class="sc">;</span>
4394     <span class="s">}</span>
4395   <span class="s">}</span>
4396 
4397   <span class="c"># Collect neighborhood atom IDs...</span>
4398   <span class="k">my</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">@NeighborhoodAtomIDs</span><span class="cm">,</span> <span class="i">@NeighborhoodAtomIDsWithSuccessors</span><span class="s">)</span><span class="sc">;</span>
4399 
4400   <span class="i">@NeighborhoodAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@NeighborhoodAtomIDsWithSuccessors</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4401   <span class="i">$StartAtomID</span> = <span class="i">$StartAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4402 
4403   <span class="j">MODE:</span> <span class="s">{</span>
4404     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^RadiusUpto$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@NeighborhoodAtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetNeighborhoodVerticesWithRadiusUpto</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$Radius</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4405     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^AllRadii$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@NeighborhoodAtomIDs</span> = <span class="i">$This</span><span class="i">-&gt;GetNeighborhoodVertices</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4406 
4407     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^WithSuccessorsAndRadiusUpto$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@NeighborhoodAtomIDsWithSuccessors</span> = <span class="i">$This</span><span class="i">-&gt;GetNeighborhoodVerticesWithSuccessorsAndRadiusUpto</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="cm">,</span> <span class="i">$Radius</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4408     <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^WithSuccessorsAndAllRadii$/i</span><span class="s">)</span> <span class="s">{</span> <span class="i">@NeighborhoodAtomIDsWithSuccessors</span> = <span class="i">$This</span><span class="i">-&gt;GetNeighborhoodVerticesWithSuccessors</span><span class="s">(</span><span class="i">$StartAtomID</span><span class="s">)</span><span class="sc">;</span> <span class="k">last</span> <span class="j">MODE</span><span class="sc">;</span> <span class="s">}</span>
4409 
4410     <span class="k">print</span> <span class="q">&quot;Warn: ${ClassName}-&gt;_GetAtomNeighborhood: No atom neighborhoods retrieved: Mode, $Mode, is not supported...&quot;</span><span class="sc">;</span>
4411     <span class="k">return</span> <span class="i">@AtomNeighborhoods</span><span class="sc">;</span>
4412   <span class="s">}</span>
4413   <span class="k">if</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^(RadiusUpto|AllRadii)$/i</span><span class="s">)</span> <span class="s">{</span>
4414     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetNeighborhoodAtomsFromAtomIDs</span><span class="s">(</span>\<span class="i">@NeighborhoodAtomIDs</span><span class="s">)</span><span class="sc">;</span>
4415   <span class="s">}</span>
4416   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Mode</span> =~ <span class="q">/^(WithSuccessorsAndRadiusUpto|WithSuccessorsAndAllRadii)$/i</span><span class="s">)</span> <span class="s">{</span>
4417     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GetNeighborhoodAtomsWithSuccessorsFromAtomIDs</span><span class="s">(</span>\<span class="i">@NeighborhoodAtomIDsWithSuccessors</span><span class="s">)</span><span class="sc">;</span>
4418   <span class="s">}</span>
4419 
4420   <span class="k">return</span> <span class="i">@AtomNeighborhoods</span><span class="sc">;</span>
4421 <span class="s">}</span>
4422 
4423 <span class="c"># Map neighborhood atom IDs to atoms...</span>
4424 <span class="c">#</span>
<a name="_GetNeighborhoodAtomsFromAtomIDs-"></a>4425 <span class="k">sub </span><span class="m">_GetNeighborhoodAtomsFromAtomIDs</span> <span class="s">{</span>
4426   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NeighborhoodsAtomIDsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4427   <span class="k">my</span><span class="s">(</span><span class="i">$NeighborhoodAtomIDsRef</span><span class="cm">,</span> <span class="i">@AtomNeighborhoods</span><span class="s">)</span><span class="sc">;</span>
4428 
4429   <span class="i">@AtomNeighborhoods</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4430   <span class="k">for</span> <span class="i">$NeighborhoodAtomIDsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NeighborhoodsAtomIDsRef</span>}<span class="s">)</span> <span class="s">{</span>
4431     <span class="k">my</span><span class="s">(</span><span class="i">@AtomNeighborhood</span><span class="s">)</span><span class="sc">;</span>
4432 
4433     <span class="i">@AtomNeighborhood</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4434     <span class="i">@AtomNeighborhood</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsFromAtomIDs</span><span class="s">(</span><span class="i">@</span>{<span class="i">$NeighborhoodAtomIDsRef</span>}<span class="s">)</span><span class="sc">;</span>
4435     <span class="k">push</span> <span class="i">@AtomNeighborhoods</span><span class="cm">,</span> \<span class="i">@AtomNeighborhood</span><span class="sc">;</span>
4436   <span class="s">}</span>
4437   <span class="k">return</span> <span class="i">@AtomNeighborhoods</span><span class="sc">;</span>
4438 <span class="s">}</span>
4439 
4440 <span class="c"># Map neighborhood atom IDs with successors to atoms...</span>
4441 <span class="c">#</span>
<a name="_GetNeighborhoodAtomsWithSuccessorsFromAtomIDs-"></a>4442 <span class="k">sub </span><span class="m">_GetNeighborhoodAtomsWithSuccessorsFromAtomIDs</span> <span class="s">{</span>
4443   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$NeighborhoodsAtomIDsWithSuccessorsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4444   <span class="k">my</span><span class="s">(</span><span class="i">$Depth</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomIDsWithSuccessorsRef</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomIDWithSuccessorsRef</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomID</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomSuccessorsIDsRef</span><span class="cm">,</span> <span class="i">@AtomNeighborhoods</span><span class="s">)</span><span class="sc">;</span>
4445 
4446   <span class="i">$Depth</span> = <span class="n">0</span><span class="sc">;</span>
4447   <span class="i">@AtomNeighborhoods</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4448 
4449   <span class="c"># Go over neighborhoods at each level...</span>
4450   <span class="k">for</span> <span class="i">$NeighborhoodAtomIDsWithSuccessorsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NeighborhoodsAtomIDsWithSuccessorsRef</span>}<span class="s">)</span> <span class="s">{</span>
4451     <span class="i">@</span>{<span class="i">$AtomNeighborhoods</span>[<span class="i">$Depth</span>]} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4452 
4453     <span class="c"># Go over the neighborhood atoms and their successors at a specific level..</span>
4454     <span class="k">for</span> <span class="i">$NeighborhoodAtomIDWithSuccessorsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NeighborhoodAtomIDsWithSuccessorsRef</span>}<span class="s">)</span> <span class="s">{</span>
4455       <span class="k">my</span><span class="s">(</span><span class="i">$NeighborhoodAtom</span><span class="cm">,</span> <span class="i">@NeighborhoodAtomWithSuccessors</span><span class="cm">,</span> <span class="i">@NeighborhoodAtomSuccessorAtoms</span><span class="s">)</span><span class="sc">;</span>
4456 
4457       <span class="i">@NeighborhoodAtomWithSuccessors</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@NeighborhoodAtomSuccessorAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4458       <span class="s">(</span><span class="i">$NeighborhoodAtomID</span><span class="cm">,</span> <span class="i">$NeighborhoodAtomSuccessorsIDsRef</span><span class="s">)</span> = <span class="i">@</span>{<span class="i">$NeighborhoodAtomIDWithSuccessorsRef</span>}<span class="sc">;</span>
4459 
4460       <span class="c"># Map atom IDs to atoms...</span>
4461       <span class="i">$NeighborhoodAtom</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomFromAtomID</span><span class="s">(</span><span class="i">$NeighborhoodAtomID</span><span class="s">)</span><span class="sc">;</span>
4462       <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$NeighborhoodAtomSuccessorsIDsRef</span>}<span class="s">)</span> <span class="s">{</span>
4463         <span class="i">@NeighborhoodAtomSuccessorAtoms</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomsFromAtomIDs</span><span class="s">(</span><span class="i">@</span>{<span class="i">$NeighborhoodAtomSuccessorsIDsRef</span>}<span class="s">)</span><span class="sc">;</span>
4464       <span class="s">}</span>
4465 
4466       <span class="c"># Store an atom and its successors at each level in an array...</span>
4467       <span class="k">push</span> <span class="i">@NeighborhoodAtomWithSuccessors</span><span class="cm">,</span> <span class="s">(</span><span class="i">$NeighborhoodAtom</span><span class="cm">,</span> \<span class="i">@NeighborhoodAtomSuccessorAtoms</span><span class="s">)</span><span class="sc">;</span>
4468 
4469       <span class="k">push</span> <span class="i">@</span>{<span class="i">$AtomNeighborhoods</span>[<span class="i">$Depth</span>]} <span class="cm">,</span> \<span class="i">@NeighborhoodAtomWithSuccessors</span><span class="sc">;</span>
4470     <span class="s">}</span>
4471       <span class="i">$Depth</span>++<span class="sc">;</span>
4472   <span class="s">}</span>
4473   <span class="k">return</span> <span class="i">@AtomNeighborhoods</span><span class="sc">;</span>
4474 <span class="s">}</span>
4475 
4476 <span class="c"># Get next object ID...</span>
<a name="_GetNewObjectID-"></a>4477 <span class="k">sub </span><span class="m">_GetNewObjectID</span> <span class="s">{</span>
4478   <span class="i">$ObjectID</span>++<span class="sc">;</span>
4479   <span class="k">return</span> <span class="i">$ObjectID</span><span class="sc">;</span>
4480 <span class="s">}</span>
4481 
4482 <span class="c"># Is aromatic property set for the molecule?</span>
<a name="IsAromatic-"></a>4483 <span class="k">sub </span><span class="m">IsAromatic</span> <span class="s">{</span>
4484   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4485   <span class="k">my</span><span class="s">(</span><span class="i">$Aromatic</span><span class="s">)</span><span class="sc">;</span>
4486 
4487   <span class="i">$Aromatic</span> = <span class="i">$This</span><span class="i">-&gt;GetAromatic</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4488 
4489   <span class="k">return</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$Aromatic</span><span class="s">)</span> &amp;&amp; <span class="i">$Aromatic</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4490 <span class="s">}</span>
4491 
4492 <span class="c"># Does molecule contains any atoms with non-zero Z coordiantes?</span>
<a name="IsThreeDimensional-"></a>4493 <span class="k">sub </span><span class="m">IsThreeDimensional</span> <span class="s">{</span>
4494   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4495   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span><span class="sc">;</span>
4496 
4497   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4498   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
4499       <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetZ</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
4500         <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4501       <span class="s">}</span>
4502   <span class="s">}</span>
4503   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4504 <span class="s">}</span>
4505 
4506 <span class="c"># Does molecule contains any atoms with non-zero X or Y coordinates</span>
4507 <span class="c"># and only zero Z-coordinates?</span>
<a name="IsTwoDimensional-"></a>4508 <span class="k">sub </span><span class="m">IsTwoDimensional</span> <span class="s">{</span>
4509   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4510   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span><span class="sc">;</span>
4511 
4512   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4513   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
4514       <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetZ</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
4515         <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4516       <span class="s">}</span>
4517       <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetX</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span> || <span class="i">$Atom</span><span class="i">-&gt;GetY</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
4518         <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
4519       <span class="s">}</span>
4520   <span class="s">}</span>
4521   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
4522 <span class="s">}</span>
4523 
4524 <span class="c"># Get dimensionality of the molecule using one of the following two methods:</span>
4525 <span class="c">#   . Using explicitly set Dimensionality</span>
4526 <span class="c">#   . Going over atomic coordinates</span>
4527 <span class="c">#</span>
4528 <span class="c"># The valid dimensionality values are:</span>
4529 <span class="c">#   . 3D - Three dimensional: One of X, Y or Z coordinate is non-zero</span>
4530 <span class="c">#   . 2D - Two dimensional: One of X or Y coordinate is non-zero; All Z coordinates are zero</span>
4531 <span class="c">#   . 0D - Zero dimensional: All atomic coordinates are zero</span>
4532 <span class="c">#</span>
<a name="GetDimensionality-"></a>4533 <span class="k">sub </span><span class="m">GetDimensionality</span> <span class="s">{</span>
4534   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4535 
4536   <span class="c"># Is Dimensionality property explicitly set?</span>
4537   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;HasProperty</span><span class="s">(</span><span class="q">&#39;Dimensionality&#39;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4538     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;GetProperty</span><span class="s">(</span><span class="q">&#39;Dimensionality&#39;</span><span class="s">)</span><span class="sc">;</span>
4539   <span class="s">}</span>
4540   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">@Atoms</span><span class="s">)</span><span class="sc">;</span>
4541 
4542   <span class="i">@Atoms</span> = <span class="i">$This</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4543   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@Atoms</span><span class="s">)</span> <span class="s">{</span>
4544       <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetZ</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
4545         <span class="k">return</span> <span class="q">&#39;3D&#39;</span><span class="sc">;</span>
4546       <span class="s">}</span>
4547       <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;GetX</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span> || <span class="i">$Atom</span><span class="i">-&gt;GetY</span><span class="s">(</span><span class="s">)</span> != <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
4548         <span class="k">return</span> <span class="q">&#39;2D&#39;</span><span class="sc">;</span>
4549       <span class="s">}</span>
4550   <span class="s">}</span>
4551   <span class="k">return</span> <span class="q">&#39;0D&#39;</span><span class="sc">;</span>
4552 <span class="s">}</span>
4553 
4554 <span class="c"># Is it a molecule object?</span>
<a name="IsMolecule-"></a>4555 <span class="k">sub </span><span class="m">IsMolecule ($)</span> <span class="s">{</span>
4556   <span class="k">my</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4557 
4558   <span class="k">return</span> <span class="i">_IsMolecule</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span><span class="sc">;</span>
4559 <span class="s">}</span>
4560 
4561 <span class="c"># Return a string containing vertices, edges and other properties...</span>
<a name="StringifyMolecule-"></a>4562 <span class="k">sub </span><span class="m">StringifyMolecule</span> <span class="s">{</span>
4563   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4564   <span class="k">my</span><span class="s">(</span><span class="i">$MoleculeString</span><span class="cm">,</span> <span class="i">$ID</span><span class="cm">,</span> <span class="i">$Name</span><span class="cm">,</span> <span class="i">$NumOfAtoms</span><span class="cm">,</span> <span class="i">$NumOfBonds</span><span class="cm">,</span> <span class="i">$MolecularFormula</span><span class="cm">,</span> <span class="i">$NumOfRings</span><span class="cm">,</span> <span class="i">$MolecularWeight</span><span class="cm">,</span> <span class="i">$ExactMass</span><span class="cm">,</span> <span class="i">$FormalCharge</span><span class="cm">,</span> <span class="i">$SpinMultiplicity</span><span class="cm">,</span> <span class="i">$FreeRadicalElectrons</span><span class="cm">,</span> <span class="i">$Charge</span><span class="cm">,</span> <span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementsCompositionRef</span><span class="cm">,</span> <span class="i">$ElementalComposition</span><span class="s">)</span><span class="sc">;</span>
4565 
4566   <span class="i">$ID</span> = <span class="i">$This</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4567   <span class="i">$Name</span> = <span class="i">$This</span><span class="i">-&gt;GetName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4568   <span class="i">$NumOfAtoms</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4569   <span class="i">$NumOfBonds</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfBonds</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4570 
4571   <span class="i">$NumOfRings</span> = <span class="i">$This</span><span class="i">-&gt;GetNumOfRings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4572   <span class="k">if</span> <span class="s">(</span>!<span class="k">defined</span> <span class="i">$NumOfRings</span><span class="s">)</span> <span class="s">{</span>
4573     <span class="i">$NumOfRings</span> = <span class="q">&#39;undefined&#39;</span><span class="sc">;</span>
4574   <span class="s">}</span>
4575 
4576   <span class="i">$MolecularFormula</span> = <span class="i">$This</span><span class="i">-&gt;GetMolecularFormula</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4577 
4578   <span class="i">$MolecularWeight</span> = <span class="i">$This</span><span class="i">-&gt;GetMolecularWeight</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4579   <span class="i">$MolecularWeight</span> = <span class="i">round</span><span class="s">(</span><span class="i">$MolecularWeight</span><span class="cm">,</span> <span class="n">4</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
4580 
4581   <span class="i">$ExactMass</span> = <span class="i">$This</span><span class="i">-&gt;GetExactMass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4582   <span class="i">$ExactMass</span> = <span class="i">round</span><span class="s">(</span><span class="i">$ExactMass</span><span class="cm">,</span> <span class="n">4</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
4583 
4584   <span class="i">$FormalCharge</span> = <span class="i">$This</span><span class="i">-&gt;GetFormalCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4585   <span class="i">$Charge</span> = <span class="i">$This</span><span class="i">-&gt;GetCharge</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4586 
4587   <span class="i">$SpinMultiplicity</span> = <span class="i">$This</span><span class="i">-&gt;GetSpinMultiplicity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4588   <span class="i">$FreeRadicalElectrons</span> = <span class="i">$This</span><span class="i">-&gt;GetFreeRadicalElectrons</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4589 
4590   <span class="s">(</span><span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementsCompositionRef</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;GetElementalComposition</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4591   <span class="i">$ElementalComposition</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
4592   <span class="k">if</span> <span class="s">(</span><span class="k">defined</span><span class="s">(</span><span class="i">$ElementsRef</span><span class="s">)</span> &amp;&amp; <span class="i">@</span>{<span class="i">$ElementsRef</span>}<span class="s">)</span> <span class="s">{</span>
4593     <span class="i">$ElementalComposition</span> = <span class="q">&quot;[ &quot;</span> . <span class="i">FormatElementalCompositionInformation</span><span class="s">(</span><span class="i">$ElementsRef</span><span class="cm">,</span> <span class="i">$ElementsCompositionRef</span><span class="s">)</span> . <span class="q">&quot; ]&quot;</span><span class="sc">;</span>
4594   <span class="s">}</span>
4595 
4596   <span class="i">$MoleculeString</span> = <span class="q">&quot;Molecule: ID: $ID; Name: \&quot;$Name\&quot;; NumOfAtoms: $NumOfAtoms; NumOfBonds: $NumOfBonds; NumOfRings: $NumOfRings; MolecularFormula: $MolecularFormula; MolecularWeight: $MolecularWeight; ExactMass: $ExactMass; FormalCharge: $FormalCharge; Charge: $Charge; SpinMultiplicity: $SpinMultiplicity; FreeRadicalElectrons: $FreeRadicalElectrons; ElementalComposition: $ElementalComposition&quot;</span><span class="sc">;</span>
4597 
4598   <span class="k">return</span> <span class="i">$MoleculeString</span><span class="sc">;</span>
4599 <span class="s">}</span>
4600 
4601 <span class="c"># Load appropriate atom data files from &lt;MayaChemTools&gt;/lib directory used by various</span>
4602 <span class="c"># object methods in the current class...</span>
4603 <span class="c">#</span>
<a name="_LoadMoleculeClassData-"></a>4604 <span class="k">sub </span><span class="m">_LoadMoleculeClassData</span> <span class="s">{</span>
4605   <span class="k">my</span><span class="s">(</span><span class="i">$MayaChemToolsLibDir</span><span class="s">)</span><span class="sc">;</span>
4606 
4607   <span class="i">$MayaChemToolsLibDir</span> = <span class="i">GetMayaChemToolsLibDirName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4608 
4609   <span class="c"># Load and process data for aromaticity models...</span>
4610   <span class="i">_LoadAromaticityModelsData</span><span class="s">(</span><span class="i">$MayaChemToolsLibDir</span><span class="s">)</span><span class="sc">;</span>
4611   <span class="i">_ProcessAromaticityModelsData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4612 <span class="s">}</span>
4613 
4614 <span class="c">#</span>
4615 <span class="c"># Load data for supported aromaticity models...</span>
4616 <span class="c">#</span>
<a name="_LoadAromaticityModelsData-"></a>4617 <span class="k">sub </span><span class="m">_LoadAromaticityModelsData</span> <span class="s">{</span>
4618   <span class="k">my</span><span class="s">(</span><span class="i">$MayaChemToolsLibDir</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4619   <span class="k">my</span><span class="s">(</span><span class="i">$DataFile</span><span class="cm">,</span> <span class="i">$Index</span><span class="cm">,</span> <span class="i">$InDelim</span><span class="cm">,</span> <span class="i">$Line</span><span class="cm">,</span> <span class="i">$NumOfCols</span><span class="cm">,</span> <span class="i">$ParameterName</span><span class="cm">,</span> <span class="i">$ParameterValue</span><span class="cm">,</span> <span class="i">$ModelName</span><span class="cm">,</span> <span class="i">@ColLabels</span><span class="cm">,</span> <span class="i">@LineWords</span><span class="cm">,</span> <span class="i">%ParameterNames</span><span class="cm">,</span> <span class="i">%ColIndexToModelName</span><span class="cm">,</span> <span class="i">%SupportedParameterNames</span><span class="s">)</span><span class="sc">;</span>
4620 
4621   <span class="i">%AromaticityModelsDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4622   <span class="i">%CanonicalAromaticityModelNamesMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4623 
4624   <span class="c"># File format:</span>
4625   <span class="c">#</span>
4626   <span class="c"># &quot;ParameterName&quot;,&quot;MDLAromaticityModel&quot;,&quot;TriposAromaticityModel&quot;,&quot;MMFFAromaticityModel&quot;,&quot;ChemAxonBasicAromaticityModel&quot;,&quot;ChemAxonGeneralAromaticityModel&quot;,&quot;DaylightAromaticityModel&quot;,&quot;MayaChemToolsAromaticityModel&quot;</span>
4627   <span class="c"># &quot;AllowHeteroRingAtoms&quot;,&quot;No&quot;,&quot;No&quot;,&quot;Yes&quot;,&quot;Yes&quot;,&quot;Yes&quot;,&quot;Yes&quot;,&quot;Yes&quot;</span>
4628   <span class="c">#</span>
4629   <span class="i">$DataFile</span> = <span class="i">$MayaChemToolsLibDir</span> . <span class="q">&quot;/data/AromaticityModelsData.csv&quot;</span><span class="sc">;</span>
4630   <span class="k">if</span> <span class="s">(</span>! <span class="k">-e</span> <span class="q">&quot;$DataFile&quot;</span><span class="s">)</span> <span class="s">{</span>
4631     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}::_LoadAromaticityModelsData: MayaChemTools package file, $DataFile, is missing: Possible installation problems...&quot;</span><span class="sc">;</span>
4632   <span class="s">}</span>
4633 
4634   <span class="c"># Setup a list of currently supported aromaticity parameters...</span>
4635   <span class="c">#</span>
4636   <span class="k">my</span><span class="s">(</span><span class="i">@KnownNames</span><span class="s">)</span><span class="sc">;</span>
4637   <span class="i">@KnownNames</span> = <span class="q">qw(AllowHeteroRingAtoms HeteroRingAtomsList AllowExocyclicDoubleBonds AllowHomoNuclearExocyclicDoubleBonds AllowElectronegativeRingAtomExocyclicDoubleBonds AllowRingAtomFormalCharge AllowHeteroRingAtomFormalCharge MinimumRingSize)</span><span class="sc">;</span>
4638 
4639   <span class="i">%SupportedParameterNames</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4640   <span class="k">for</span> <span class="i">$ParameterName</span> <span class="s">(</span><span class="i">@KnownNames</span><span class="s">)</span> <span class="s">{</span>
4641     <span class="i">$SupportedParameterNames</span>{<span class="i">$ParameterName</span>} = <span class="i">$ParameterName</span><span class="sc">;</span>
4642   <span class="s">}</span>
4643 
4644   <span class="i">$InDelim</span> = <span class="q">&quot;\,&quot;</span><span class="sc">;</span>
4645   <span class="k">open</span> <span class="w">DATAFILE</span><span class="cm">,</span> <span class="q">&quot;$DataFile&quot;</span> <span class="k">or</span> <span class="w">croak</span> <span class="q">&quot;Couldn&#39;t open $DataFile: $! ...&quot;</span><span class="sc">;</span>
4646 
4647   <span class="c"># Skip lines up to column labels...</span>
4648   <span class="j">LINE:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$Line</span> = <span class="i">GetTextLine</span><span class="s">(</span>\<span class="i">*DATAFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4649     <span class="k">if</span> <span class="s">(</span><span class="i">$Line</span> !~ <span class="q">/^#/</span><span class="s">)</span> <span class="s">{</span>
4650       <span class="k">last</span> <span class="j">LINE</span><span class="sc">;</span>
4651     <span class="s">}</span>
4652   <span class="s">}</span>
4653   <span class="i">@ColLabels</span>= <span class="i">quotewords</span><span class="s">(</span><span class="i">$InDelim</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Line</span><span class="s">)</span><span class="sc">;</span>
4654   <span class="i">$NumOfCols</span> = <span class="i">@ColLabels</span><span class="sc">;</span>
4655 
4656   <span class="i">%ColIndexToModelName</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4657 
4658   <span class="c"># Process names of aromaticity models...</span>
4659   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$#ColLabels</span><span class="s">)</span> <span class="s">{</span>
4660     <span class="i">$ModelName</span> = <span class="i">$ColLabels</span>[<span class="i">$Index</span>]<span class="sc">;</span>
4661     <span class="i">$ModelName</span> =~ <span class="q">s/ //g</span><span class="sc">;</span>
4662 
4663     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$AromaticityModelsDataMap</span>{<span class="i">$ModelName</span>}<span class="s">)</span> <span class="s">{</span>
4664       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}::_LoadAromaticityModelsData: The aromaticity model name, $ModelName, in $DataFile has already exists.\nLine: $Line...&quot;</span><span class="sc">;</span>
4665     <span class="s">}</span>
4666     <span class="i">%</span>{<span class="i">$AromaticityModelsDataMap</span>{<span class="i">$ModelName</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4667 
4668     <span class="c"># Cannonicalize aromatic model name by converting into all lowercase...</span>
4669     <span class="i">$CanonicalAromaticityModelNamesMap</span>{<span class="k">lc</span><span class="s">(</span><span class="i">$ModelName</span><span class="s">)</span>} = <span class="i">$ModelName</span><span class="sc">;</span>
4670 
4671     <span class="i">$ColIndexToModelName</span>{<span class="i">$Index</span>} = <span class="i">$ModelName</span><span class="sc">;</span>
4672   <span class="s">}</span>
4673 
4674   <span class="c"># Process paramater name and their values for specified aromaticity models...</span>
4675   <span class="c">#</span>
4676   <span class="i">%ParameterNames</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4677   <span class="j">LINE:</span> <span class="k">while</span> <span class="s">(</span><span class="i">$Line</span> = <span class="i">GetTextLine</span><span class="s">(</span>\<span class="i">*DATAFILE</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
4678     <span class="k">if</span> <span class="s">(</span><span class="i">$Line</span> =~ <span class="q">/^#/</span><span class="s">)</span> <span class="s">{</span>
4679       <span class="k">next</span> <span class="j">LINE</span><span class="sc">;</span>
4680     <span class="s">}</span>
4681     <span class="i">@LineWords</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4682     <span class="i">@LineWords</span> = <span class="i">quotewords</span><span class="s">(</span><span class="i">$InDelim</span><span class="cm">,</span> <span class="n">0</span><span class="cm">,</span> <span class="i">$Line</span><span class="s">)</span><span class="sc">;</span>
4683     <span class="k">if</span> <span class="s">(</span><span class="i">@LineWords</span> != <span class="i">$NumOfCols</span><span class="s">)</span> <span class="s">{</span>
4684       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}::_LoadAromaticityModelsData: The number of data fields, @LineWords, in $DataFile must be $NumOfCols.\nLine: $Line...&quot;</span><span class="sc">;</span>
4685     <span class="s">}</span>
4686 
4687     <span class="c"># Process parameter name and values for aromaticity models...</span>
4688     <span class="c">#</span>
4689     <span class="i">$ParameterName</span> = <span class="i">$LineWords</span>[<span class="n">0</span>]<span class="sc">;</span>
4690 
4691     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$SupportedParameterNames</span>{<span class="i">$ParameterName</span>}<span class="s">)</span> <span class="s">{</span>
4692       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}::_LoadAromaticityModelsData: The current release of MayaChemTools doesn&#39;t support aromaticity model parameter name, $ParameterName, specified in $DataFile. It would be ignore during aromaticity detection.\nLine: $Line...&quot;</span><span class="sc">;</span>
4693     <span class="s">}</span>
4694 
4695     <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ParameterNames</span>{<span class="i">$ParameterName</span>}<span class="s">)</span> <span class="s">{</span>
4696       <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}::_LoadAromaticityModelsData: Ignoring aromaticity model data for parameter name, $ParameterName, in $DataFile. It has already been loaded.\nLine: $Line...&quot;</span><span class="sc">;</span>
4697       <span class="k">next</span> <span class="j">LINE</span><span class="sc">;</span>
4698     <span class="s">}</span>
4699     <span class="i">$ParameterNames</span>{<span class="i">$ParameterName</span>} = <span class="i">$ParameterName</span><span class="sc">;</span>
4700 
4701     <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$#LineWords</span><span class="s">)</span> <span class="s">{</span>
4702       <span class="i">$ModelName</span> = <span class="i">$ColIndexToModelName</span>{<span class="i">$Index</span>}<span class="sc">;</span>
4703       <span class="i">$ParameterValue</span> = <span class="i">$LineWords</span>[<span class="i">$Index</span>]<span class="sc">;</span>
4704       <span class="i">$AromaticityModelsDataMap</span>{<span class="i">$ModelName</span>}{<span class="i">$ParameterName</span>} = <span class="i">$ParameterValue</span><span class="sc">;</span>
4705     <span class="s">}</span>
4706   <span class="s">}</span>
4707   <span class="k">close</span> <span class="w">DATAFILE</span><span class="sc">;</span>
4708 <span class="s">}</span>
4709 
4710 <span class="c"># Process already loaded aromaticity model data...</span>
4711 <span class="c">#</span>
<a name="_ProcessAromaticityModelsData-"></a>4712 <span class="k">sub </span><span class="m">_ProcessAromaticityModelsData</span> <span class="s">{</span>
4713   <span class="k">my</span><span class="s">(</span><span class="i">$ParameterName</span><span class="cm">,</span> <span class="i">$ParameterValue</span><span class="cm">,</span> <span class="i">$ModelName</span><span class="cm">,</span> <span class="i">$NewParameterValue</span><span class="s">)</span><span class="sc">;</span>
4714 
4715   <span class="k">for</span> <span class="i">$ModelName</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%AromaticityModelsDataMap</span><span class="s">)</span> <span class="s">{</span>
4716     <span class="k">for</span> <span class="i">$ParameterName</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$AromaticityModelsDataMap</span>{<span class="i">$ModelName</span>}}<span class="s">)</span> <span class="s">{</span>
4717       <span class="i">$ParameterValue</span> = <span class="i">$AromaticityModelsDataMap</span>{<span class="i">$ModelName</span>}{<span class="i">$ParameterName</span>}<span class="sc">;</span>
4718       <span class="i">$ParameterValue</span> =~ <span class="q">s/ //g</span><span class="sc">;</span>
4719 
4720       <span class="j">VALUE:</span> <span class="s">{</span>
4721         <span class="k">if</span> <span class="s">(</span><span class="i">$ParameterValue</span> =~ <span class="q">/^Yes$/i</span><span class="s">)</span> <span class="s">{</span>
4722           <span class="i">$NewParameterValue</span> = <span class="n">1</span><span class="sc">;</span>
4723           <span class="k">last</span> <span class="j">VALUE</span><span class="sc">;</span>
4724         <span class="s">}</span>
4725         <span class="k">if</span> <span class="s">(</span><span class="i">$ParameterValue</span> =~ <span class="q">/^(NA|No)$/i</span><span class="s">)</span> <span class="s">{</span>
4726           <span class="i">$NewParameterValue</span> = <span class="n">0</span><span class="sc">;</span>
4727           <span class="k">last</span> <span class="j">VALUE</span><span class="sc">;</span>
4728         <span class="s">}</span>
4729         <span class="k">if</span> <span class="s">(</span><span class="i">$ParameterValue</span> =~ <span class="q">/^None$/i</span><span class="s">)</span> <span class="s">{</span>
4730           <span class="i">$NewParameterValue</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
4731           <span class="k">last</span> <span class="j">VALUE</span><span class="sc">;</span>
4732         <span class="s">}</span>
4733         <span class="i">$NewParameterValue</span> = <span class="i">$ParameterValue</span><span class="sc">;</span>
4734       <span class="s">}</span>
4735       <span class="i">$AromaticityModelsDataMap</span>{<span class="i">$ModelName</span>}{<span class="i">$ParameterName</span>} = <span class="i">$NewParameterValue</span><span class="sc">;</span>
4736 
4737       <span class="k">if</span> <span class="s">(</span><span class="i">$ParameterName</span> =~ <span class="q">/List/i</span><span class="s">)</span> <span class="s">{</span>
4738         <span class="c"># Setup a new parameter conatining a reference to a hash for the specified values...</span>
4739         <span class="k">my</span><span class="s">(</span><span class="i">$DataMapRefName</span><span class="cm">,</span> <span class="i">$DataValue</span><span class="cm">,</span> <span class="i">%DataMap</span><span class="s">)</span><span class="sc">;</span>
4740 
4741         <span class="i">$DataMapRefName</span> = <span class="q">&quot;${ParameterName}MapRef&quot;</span><span class="sc">;</span>
4742 
4743         <span class="i">%DataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
4744         <span class="k">for</span> <span class="i">$DataValue</span> <span class="s">(</span><span class="k">split</span> <span class="q">/\,/</span><span class="cm">,</span> <span class="i">$NewParameterValue</span><span class="s">)</span> <span class="s">{</span>
4745           <span class="i">$DataMap</span>{<span class="i">$DataValue</span>} = <span class="i">$DataValue</span><span class="sc">;</span>
4746         <span class="s">}</span>
4747         <span class="i">$AromaticityModelsDataMap</span>{<span class="i">$ModelName</span>}{<span class="i">$DataMapRefName</span>} = \<span class="i">%DataMap</span><span class="sc">;</span>
4748       <span class="s">}</span>
4749     <span class="s">}</span>
4750   <span class="s">}</span>
4751 <span class="s">}</span>
4752 
4753 <span class="c"># Is it a molecule object?</span>
<a name="_IsMolecule-"></a>4754 <span class="k">sub </span><span class="m">_IsMolecule</span> <span class="s">{</span>
4755   <span class="k">my</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
4756 
4757   <span class="k">return</span> <span class="s">(</span><span class="i">Scalar::Util::blessed</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> &amp;&amp; <span class="i">$Object</span><span class="i">-&gt;isa</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
4758 <span class="s">}</span>
4759 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
