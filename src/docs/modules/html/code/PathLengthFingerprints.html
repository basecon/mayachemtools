<html>
<head>
<title>MayaChemTools:Code:Fingerprints/PathLengthFingerprints.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-Fingerprints::PathLengthFingerprints-"></a>   1 <span class="k">package </span><span class="i">Fingerprints::PathLengthFingerprints</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># File: PathLengthFingerprints.pm</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2020 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">TextUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">MathUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Fingerprints::Fingerprints</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">AtomTypes::AtomicInvariantsAtomTypes</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">AtomTypes::DREIDINGAtomTypes</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">AtomTypes::EStateAtomTypes</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">AtomTypes::FunctionalClassAtomTypes</span><span class="sc">;</span>
  37 <span class="k">use</span> <span class="w">AtomTypes::MMFF94AtomTypes</span><span class="sc">;</span>
  38 <span class="k">use</span> <span class="w">AtomTypes::SLogPAtomTypes</span><span class="sc">;</span>
  39 <span class="k">use</span> <span class="w">AtomTypes::SYBYLAtomTypes</span><span class="sc">;</span>
  40 <span class="k">use</span> <span class="w">AtomTypes::TPSAAtomTypes</span><span class="sc">;</span>
  41 <span class="k">use</span> <span class="w">AtomTypes::UFFAtomTypes</span><span class="sc">;</span>
  42 
  43 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  44 
  45 <span class="i">@ISA</span> = <span class="q">qw(Fingerprints::Fingerprints Exporter)</span><span class="sc">;</span>
  46 <span class="i">@EXPORT</span> = <span class="q">qw()</span><span class="sc">;</span>
  47 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  48 
  49 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  50 
  51 <span class="c"># Setup class variables...</span>
  52 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="sc">;</span>
  53 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  54 
  55 <span class="c"># Overload Perl functions...</span>
  56 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyPathLengthFingerprints&#39;</span><span class="sc">;</span>
  57 
  58 <span class="c"># Class constructor...</span>
<a name="new-"></a>  59 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  60   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  61 
  62   <span class="c"># Initialize object...</span>
  63   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  64   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  65   <span class="i">$This</span><span class="i">-&gt;_InitializePathLengthFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  66 
  67   <span class="i">$This</span><span class="i">-&gt;_InitializePathLengthFingerprintsProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  68 
  69   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  70 <span class="s">}</span>
  71 
  72 <span class="c"># Initialize object data...</span>
  73 <span class="c">#</span>
<a name="_InitializePathLengthFingerprints-"></a>  74 <span class="k">sub </span><span class="m">_InitializePathLengthFingerprints</span> <span class="s">{</span>
  75   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  76 
  77   <span class="c"># Type of fingerprint to generate...</span>
  78   <span class="c">#</span>
  79   <span class="c"># PathLengthBits - A bit vector indicating presence/absence of atom paths</span>
  80   <span class="c"># PathLengthCount - A vector containing count of atom paths</span>
  81   <span class="c">#</span>
  82   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
  83 
  84   <span class="c"># Type of vector: FingerprintsBitVector or FingerprintsVector</span>
  85   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
  86 
  87   <span class="c"># Set default mininum, maximum, and default size. Although any arbitrary size can</span>
  88   <span class="c"># be specified, bit vector used to store bits work on a vector size which is</span>
  89   <span class="c"># power of 2 and additonal bits are automatically added and cleared.</span>
  90   <span class="c">#</span>
  91   <span class="i">$This</span>-&gt;{<span class="w">Size</span>} = <span class="n">1024</span><span class="sc">;</span>
  92 
  93   <span class="i">$This</span>-&gt;{<span class="w">MinSize</span>} = <span class="n">32</span><span class="sc">;</span>
  94   <span class="i">$This</span>-&gt;{<span class="w">MaxSize</span>} = <span class="n">2</span>**<span class="n">32</span><span class="sc">;</span>
  95 
  96   <span class="c"># Minimum and maximum path lengths to use for fingerprints generation...</span>
  97   <span class="i">$This</span>-&gt;{<span class="w">MinLength</span>} = <span class="n">1</span><span class="sc">;</span>
  98   <span class="i">$This</span>-&gt;{<span class="w">MaxLength</span>} = <span class="n">8</span><span class="sc">;</span>
  99 
 100   <span class="c"># Numner of bits to set for each atom path for FingerprintsBitVector...</span>
 101   <span class="i">$This</span>-&gt;{<span class="w">NumOfBitsToSetPerPath</span>} = <span class="n">1</span><span class="sc">;</span>
 102 
 103   <span class="c"># Atom identifier type to use for path atoms during fingerprints generation...</span>
 104   <span class="c">#</span>
 105   <span class="c"># Currently supported values are: AtomicInvariantsAtomTypes, DREIDINGAtomTypes,</span>
 106   <span class="c"># EStateAtomTypes, FunctionalClassAtomTypes, MMFF94AtomTypes, SLogPAtomTypes,</span>
 107   <span class="c"># SYBYLAtomTypes, TPSAAtomTypes, UFFAtomTypes</span>
 108   <span class="c">#</span>
 109   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 110 
 111   <span class="c"># Atom types assigned to atoms...</span>
 112   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 113 
 114   <span class="c"># For molecules containing rings, atom paths starting from each atom can be traversed in four</span>
 115   <span class="c"># different ways:</span>
 116   <span class="c">#</span>
 117   <span class="c"># . Atom paths without any rings and sharing of bonds in traversed paths.</span>
 118   <span class="c"># . Atom paths containing rings and without any sharing of bonds in traversed paths</span>
 119   <span class="c"># . All possible atom paths without any rings and sharing of bonds in traversed paths</span>
 120   <span class="c"># . All possible atom paths containing rings and with sharing of bonds in traversed paths.</span>
 121   <span class="c">#</span>
 122   <span class="c"># Atom path traversal is terminated at the last ring atom. For molecules containing no rings,</span>
 123   <span class="c"># first two and last two types described above are equivalent.</span>
 124   <span class="c">#</span>
 125   <span class="c"># AllowSharedBonds and AllowRings variables allow generation of differen types of paths</span>
 126   <span class="c"># to be used for fingerprints generation.</span>
 127   <span class="c">#</span>
 128   <span class="c"># In addition to atom symbols, bond symbols are also used to generate a string</span>
 129   <span class="c"># for atom paths. These atom paths strings are hased to a 32 bit integer key which</span>
 130   <span class="c"># in turn is used as a seed for a random number generation in range of 1 to fingerprint</span>
 131   <span class="c"># size for setting corresponding bit in bit vector.</span>
 132   <span class="c">#</span>
 133   <span class="c"># UseBondSymbols variable allow generation of atom path strings and consequently fingerprints.</span>
 134   <span class="c">#</span>
 135   <span class="c"># Combination of AllowSharedBonds, AllowRings, and UseBondSymbols allow generation of</span>
 136   <span class="c"># 8 different types of path length fingerprints:</span>
 137   <span class="c">#</span>
 138   <span class="c"># AllowSharedBonds    AllowRings    UseBondSymbols    PathLengthFingerprintsType</span>
 139   <span class="c">#</span>
 140   <span class="c"># No                  No            Yes                AtomPathsNoCyclesWithBondSymbols</span>
 141   <span class="c"># No                  Yes           Yes                AtomPathsWithCyclesWithBondSymbols</span>
 142   <span class="c">#</span>
 143   <span class="c"># Yes                 No            Yes                AllAtomPathsNoCyclesWithBondSymbols</span>
 144   <span class="c"># Yes                 Yes           Yes                AllAtomPathsWithCyclesWithBondSymbols [ DEFAULT ]</span>
 145   <span class="c">#</span>
 146   <span class="c"># No                  No            No                 AtomPathsNoCyclesNoBondSymbols</span>
 147   <span class="c"># No                  Yes           No                 AtomPathsWithCyclesNoBondSymbols</span>
 148   <span class="c">#</span>
 149   <span class="c"># Yes                 No            No                 AllAtomPathsNoCyclesNoBondSymbols</span>
 150   <span class="c"># Yes                 Yes           No                 AllAtomPathsWithCyclesNoWithBondSymbols</span>
 151   <span class="c">#</span>
 152   <span class="c">#</span>
 153 
 154   <span class="c"># By default, atom paths starting from atoms are allowed to share bonds already traversed...</span>
 155   <span class="i">$This</span>-&gt;{<span class="w">AllowSharedBonds</span>} = <span class="n">1</span><span class="sc">;</span>
 156 
 157   <span class="c"># By default rings are included in paths...</span>
 158   <span class="i">$This</span>-&gt;{<span class="w">AllowRings</span>} = <span class="n">1</span><span class="sc">;</span>
 159 
 160   <span class="c"># By default bond symbols are included in atom path strings...</span>
 161   <span class="i">$This</span>-&gt;{<span class="w">UseBondSymbols</span>} = <span class="n">1</span><span class="sc">;</span>
 162 
 163   <span class="c"># By default only structurally unique atom paths are used for generation</span>
 164   <span class="c"># atom path strings...</span>
 165   <span class="i">$This</span>-&gt;{<span class="w">UseUniquePaths</span>} = <span class="n">1</span><span class="sc">;</span>
 166 
 167   <span class="c"># Random number generator to use during generation of fingerprints bit-vector</span>
 168   <span class="c"># string: Perl CORE::rand or MayaChemTools MathUtil::random function.</span>
 169   <span class="c">#</span>
 170   <span class="c"># The random number generator implemented in MayaChemTools is a variant of</span>
 171   <span class="c"># linear congruential generator (LCG) as described by Miller et al. [ Ref 120 ].</span>
 172   <span class="c"># It is also referred to as Lehmer random number generator or Park-Miller</span>
 173   <span class="c"># random number generator.</span>
 174   <span class="c">#</span>
 175   <span class="c"># Unlike Perl&#39;s core random number generator function rand, the random number</span>
 176   <span class="c"># generator implemented in MayaChemTools, MathUtil::random,  generates consistent</span>
 177   <span class="c"># random values across different platformsfor a specific random seed and leads</span>
 178   <span class="c"># to generation of portable fingerprints bit-vector strings.</span>
 179   <span class="c">#</span>
 180   <span class="i">$This</span>-&gt;{<span class="w">UsePerlCoreRandom</span>} = <span class="n">1</span><span class="sc">;</span>
 181 
 182   <span class="c"># Bond symbols to use during generation of atom path strings...</span>
 183   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">BondOrderToSymbol</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 184   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">BondOrderToSymbol</span>}} = <span class="s">(</span><span class="q">&#39;1&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="q">&#39;1.5&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;2&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;=&#39;</span><span class="cm">,</span> <span class="q">&#39;3&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;#&#39;</span><span class="s">)</span><span class="sc">;</span>
 185 
 186   <span class="c"># BondSymbols map to use for bonded atom IDs to use during atom path strings...</span>
 187   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">BondSymbols</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 188 
 189   <span class="c"># Path atom IDs to remove duplicate paths...</span>
 190   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">UniqueLinearAtomPathsIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 191   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">UniqueCyclicAtomPathsIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 192 
 193   <span class="c"># Reference to all the atom paths upto specified path length...</span>
 194   <span class="i">$This</span>-&gt;{<span class="w">AtomPathsRef</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 195 
 196   <span class="c"># Atom paths strings created using specified atom types and bond symbols...</span>
 197   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 198 <span class="s">}</span>
 199 
 200 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a> 201 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
 202   <span class="c">#Class name...</span>
 203   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
 204 <span class="s">}</span>
 205 
 206 <span class="c"># Initialize object properties....</span>
<a name="_InitializePathLengthFingerprintsProperties-"></a> 207 <span class="k">sub </span><span class="m">_InitializePathLengthFingerprintsProperties</span> <span class="s">{</span>
 208   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 209 
 210   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
 211   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
 212     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
 213     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 214   <span class="s">}</span>
 215 
 216   <span class="c"># Make sure molecule object was specified...</span>
 217   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 218     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 219   <span class="s">}</span>
 220 
 221   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Type</span>}<span class="s">)</span> <span class="s">{</span>
 222     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying Type...&quot;</span><span class="sc">;</span>
 223   <span class="s">}</span>
 224 
 225   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">AtomIdentifierType</span>}<span class="s">)</span> <span class="s">{</span>
 226     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying AtomIdentifierType...&quot;</span><span class="sc">;</span>
 227   <span class="s">}</span>
 228 
 229   <span class="c"># Make sure it&#39;s power of 2...</span>
 230   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Size</span>}<span class="s">)</span> <span class="s">{</span>
 231     <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsNumberPowerOfNumber</span><span class="s">(</span><span class="i">$NamesAndValues</span>{<span class="w">Size</span>}<span class="cm">,</span> <span class="n">2</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 232       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Specified size value, $NamesAndValues{Size}, must be power of 2...&quot;</span><span class="sc">;</span>
 233     <span class="s">}</span>
 234   <span class="s">}</span>
 235 
 236   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^PathLengthBits$/i</span><span class="s">)</span> <span class="s">{</span>
 237     <span class="i">$This</span><span class="i">-&gt;_InitializePathLengthBits</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 238   <span class="s">}</span>
 239   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^PathLengthCount$/i</span><span class="s">)</span> <span class="s">{</span>
 240     <span class="i">$This</span><span class="i">-&gt;_InitializePathLengthCount</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 241   <span class="s">}</span>
 242   <span class="k">else</span> <span class="s">{</span>
 243     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_InitializePathLengthFingerprintsProperties: Unknown PathLength type: $This-&gt;{Type}; Supported PathLength type : PathLengthBits or PathLengthCount......&quot;</span><span class="sc">;</span>
 244   <span class="s">}</span>
 245 
 246   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 247 <span class="s">}</span>
 248 
 249 <span class="c"># Initialize PathLength bits...</span>
 250 <span class="c">#</span>
<a name="_InitializePathLengthBits-"></a> 251 <span class="k">sub </span><span class="m">_InitializePathLengthBits</span> <span class="s">{</span>
 252   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 253 
 254   <span class="c"># Vector type...</span>
 255   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;FingerprintsBitVector&#39;</span><span class="sc">;</span>
 256 
 257   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsBitVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 258 
 259   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 260 <span class="s">}</span>
 261 
 262 <span class="c"># Initialize PathLength key count...</span>
 263 <span class="c">#</span>
<a name="_InitializePathLengthCount-"></a> 264 <span class="k">sub </span><span class="m">_InitializePathLengthCount</span> <span class="s">{</span>
 265   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 266 
 267   <span class="c"># Vector type and type of values...</span>
 268   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;FingerprintsVector&#39;</span><span class="sc">;</span>
 269   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorType</span>} = <span class="q">&#39;NumericalValues&#39;</span><span class="sc">;</span>
 270 
 271   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 272 
 273   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 274 <span class="s">}</span>
 275 
 276 <span class="c"># Set type...</span>
 277 <span class="c">#</span>
<a name="SetType-"></a> 278 <span class="k">sub </span><span class="m">SetType</span> <span class="s">{</span>
 279   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 280 
 281   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>}<span class="s">)</span> <span class="s">{</span>
 282     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetType: Can&#39;t change type:  It&#39;s already set...&quot;</span><span class="sc">;</span>
 283   <span class="s">}</span>
 284 
 285   <span class="k">if</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^PathLengthBits$/i</span><span class="s">)</span> <span class="s">{</span>
 286     <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;PathLengthBits&#39;</span><span class="sc">;</span><span class="sc">;</span>
 287   <span class="s">}</span>
 288   <span class="k">elsif</span> <span class="s">(</span><span class="i">$Type</span> =~ <span class="q">/^PathLengthCount$/i</span><span class="s">)</span> <span class="s">{</span>
 289     <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;PathLengthCount&#39;</span><span class="sc">;</span><span class="sc">;</span>
 290   <span class="s">}</span>
 291   <span class="k">else</span> <span class="s">{</span>
 292     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetType: Unknown PathLength keys: $Type; Supported PathLength types: PathLengthBits or PathLengthCount...&quot;</span><span class="sc">;</span>
 293   <span class="s">}</span>
 294   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 295 <span class="s">}</span>
 296 
 297 <span class="c"># Disable vector type change...</span>
 298 <span class="c">#</span>
<a name="SetVectorType-"></a> 299 <span class="k">sub </span><span class="m">SetVectorType</span> <span class="s">{</span>
 300   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 301 
 302   <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetVectorType: Can&#39;t change vector type...&quot;</span><span class="sc">;</span>
 303 
 304   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 305 <span class="s">}</span>
 306 
 307 <span class="c"># Disable vector type change...</span>
 308 <span class="c">#</span>
<a name="SetFingerprintsVectorType-"></a> 309 <span class="k">sub </span><span class="m">SetFingerprintsVectorType</span> <span class="s">{</span>
 310   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 311 
 312   <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetFingerprintsVectorType: Can&#39;t change fingerprints vector type...&quot;</span><span class="sc">;</span>
 313 
 314   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 315 <span class="s">}</span>
 316 
 317 <span class="c"># Set atom identifier type to use for path length atom identifiers...</span>
 318 <span class="c">#</span>
<a name="SetAtomIdentifierType-"></a> 319 <span class="k">sub </span><span class="m">SetAtomIdentifierType</span> <span class="s">{</span>
 320   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IdentifierType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 321 
 322   <span class="k">if</span> <span class="s">(</span><span class="i">$IdentifierType</span> !~ <span class="q">/^(AtomicInvariantsAtomTypes|DREIDINGAtomTypes|EStateAtomTypes|FunctionalClassAtomTypes|MMFF94AtomTypes|SLogPAtomTypes|SYBYLAtomTypes|TPSAAtomTypes|UFFAtomTypes)$/i</span><span class="s">)</span> <span class="s">{</span>
 323     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomIdentifierType: Specified value, $IdentifierType, for AtomIdentifierType is not vaild. Supported types in current release of MayaChemTools: AtomicInvariantsAtomTypes, DREIDINGAtomTypes, EStateAtomTypes, FunctionalClassAtomTypes, MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes, TPSAAtomTypes, and UFFAtomTypes.&quot;</span><span class="sc">;</span>
 324   <span class="s">}</span>
 325 
 326   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>}<span class="s">)</span> <span class="s">{</span>
 327     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomIdentifierType: Can&#39;t change atom identifier type:  It&#39;s already set...&quot;</span><span class="sc">;</span>
 328   <span class="s">}</span>
 329 
 330   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} = <span class="i">$IdentifierType</span><span class="sc">;</span>
 331 
 332   <span class="c"># Initialize atom identifier type information...</span>
 333   <span class="i">$This</span><span class="i">-&gt;_InitializeAtomIdentifierTypeInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 334 
 335   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 336 <span class="s">}</span>
 337 
 338 <span class="c"># Set minimum path length...</span>
 339 <span class="c">#</span>
<a name="SetMinLength-"></a> 340 <span class="k">sub </span><span class="m">SetMinLength</span> <span class="s">{</span>
 341   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 342 
 343   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsPositiveInteger</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 344     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetMinLength: MinLength value, $Value, is not valid:  It must be a positive integer...&quot;</span><span class="sc">;</span>
 345   <span class="s">}</span>
 346   <span class="i">$This</span>-&gt;{<span class="w">MinLength</span>} = <span class="i">$Value</span><span class="sc">;</span>
 347 
 348   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 349 <span class="s">}</span>
 350 
 351 <span class="c"># Set maximum path length...</span>
 352 <span class="c">#</span>
<a name="SetMaxLength-"></a> 353 <span class="k">sub </span><span class="m">SetMaxLength</span> <span class="s">{</span>
 354   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 355 
 356   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsPositiveInteger</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 357     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetMaxLength: MaxLength value, $Value, is not valid:  It must be a positive integer...&quot;</span><span class="sc">;</span>
 358   <span class="s">}</span>
 359   <span class="i">$This</span>-&gt;{<span class="w">MaxLength</span>} = <span class="i">$Value</span><span class="sc">;</span>
 360 
 361   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 362 <span class="s">}</span>
 363 
 364 <span class="c"># Set number of bits to set for each path...</span>
 365 <span class="c">#</span>
<a name="SetNumOfBitsToSetPerPath-"></a> 366 <span class="k">sub </span><span class="m">SetNumOfBitsToSetPerPath</span> <span class="s">{</span>
 367   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 368 
 369   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsPositiveInteger</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 370     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetNumOfBitsToSetPerPath: NumOfBitsToSetPerPath value, $Value, is not valid:  It must be a positive integer...&quot;</span><span class="sc">;</span>
 371   <span class="s">}</span>
 372   <span class="i">$This</span>-&gt;{<span class="w">NumOfBitsToSetPerPath</span>} = <span class="i">$Value</span><span class="sc">;</span>
 373 
 374   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 375 <span class="s">}</span>
 376 
 377 <span class="c"># Generate fingerprints description...</span>
 378 <span class="c">#</span>
<a name="GetDescription-"></a> 379 <span class="k">sub </span><span class="m">GetDescription</span> <span class="s">{</span>
 380   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 381 
 382   <span class="c"># Is description explicity set?</span>
 383   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="s">)</span> <span class="s">{</span>
 384     <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="sc">;</span>
 385   <span class="s">}</span>
 386 
 387   <span class="c"># Generate fingerprints description...</span>
 388 
 389   <span class="k">return</span> <span class="q">&quot;$This-&gt;{Type}:$This-&gt;{AtomIdentifierType}:MinLength$This-&gt;{MinLength}:MaxLength$This-&gt;{MaxLength}&quot;</span><span class="sc">;</span>
 390 <span class="s">}</span>
 391 
 392 <span class="c"># Generate path length fingerprints...</span>
 393 <span class="c">#</span>
<a name="GenerateFingerprints-"></a> 394 <span class="k">sub </span><span class="m">GenerateFingerprints</span> <span class="s">{</span>
 395   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 396 
 397   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MinLength</span>} &gt; <span class="i">$This</span>-&gt;{<span class="w">MaxLength</span>}<span class="s">)</span> <span class="s">{</span>
 398     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;GenerateFingerprints: No fingerpritns generated: MinLength, $This-&gt;{MinLength}, must be &lt;= MaxLength, $This-&gt;{MaxLength}...&quot;</span><span class="sc">;</span>
 399   <span class="s">}</span>
 400 
 401   <span class="c"># Cache appropriate molecule data...</span>
 402   <span class="i">$This</span><span class="i">-&gt;_SetupMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 403 
 404   <span class="c"># Assign atom types to all atoms...</span>
 405   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_AssignAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 406     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GenerateFingerprints: $This-&gt;{AtomIdentifierType} fingerprints generation didn&#39;t succeed: Couldn&#39;t assign valid $This-&gt;{AtomIdentifierType} to all atoms...&quot;</span><span class="sc">;</span>
 407     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 408   <span class="s">}</span>
 409 
 410   <span class="c"># Setup bond symbol map...</span>
 411   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">UseBondSymbols</span>}<span class="s">)</span> <span class="s">{</span>
 412     <span class="i">$This</span><span class="i">-&gt;_InitializeBondSymbols</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 413   <span class="s">}</span>
 414 
 415   <span class="c"># Generate appropriate atom paths...</span>
 416   <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathsUpToMaxLength</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 417 
 418   <span class="c"># Initialize atom path strings...</span>
 419   <span class="i">$This</span><span class="i">-&gt;_InitializeAtomPathsStrings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 420 
 421   <span class="c"># Generate appropriate atom path strings for unique atom paths...</span>
 422   <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathsStrings</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 423 
 424   <span class="c"># Set final fingerprints...</span>
 425   <span class="i">$This</span><span class="i">-&gt;_SetFinalFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 426 
 427   <span class="c"># Clear cached molecule data...</span>
 428   <span class="i">$This</span><span class="i">-&gt;_ClearMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 429 
 430   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 431 <span class="s">}</span>
 432 
 433 <span class="c"># Assign appropriate atom types to all atoms...</span>
 434 <span class="c">#</span>
<a name="_AssignAtomTypes-"></a> 435 <span class="k">sub </span><span class="m">_AssignAtomTypes</span> <span class="s">{</span>
 436   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 437   <span class="k">my</span><span class="s">(</span><span class="i">$SpecifiedAtomTypes</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 438 
 439   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 440   <span class="i">$IgnoreHydrogens</span> = <span class="n">0</span><span class="sc">;</span>
 441 
 442   <span class="i">$SpecifiedAtomTypes</span> = <span class="k">undef</span><span class="sc">;</span>
 443 
 444   <span class="j">IDENTIFIERTYPE:</span> <span class="s">{</span>
 445     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 446       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::AtomicInvariantsAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="q">&#39;AtomicInvariantsToUse&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}<span class="s">)</span><span class="sc">;</span>
 447       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 448     <span class="s">}</span>
 449 
 450     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^DREIDINGAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 451       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::DREIDINGAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 452       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 453     <span class="s">}</span>
 454 
 455     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^EStateAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 456       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::EStateAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 457       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 458     <span class="s">}</span>
 459 
 460     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 461       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::FunctionalClassAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="q">&#39;FunctionalClassesToUse&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}<span class="s">)</span><span class="sc">;</span>
 462       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 463     <span class="s">}</span>
 464 
 465     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^MMFF94AtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 466       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::MMFF94AtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 467       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 468     <span class="s">}</span>
 469 
 470     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^SLogPAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 471       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::SLogPAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 472       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 473     <span class="s">}</span>
 474     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^SYBYLAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 475       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::SYBYLAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 476       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 477     <span class="s">}</span>
 478 
 479     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^TPSAAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 480       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::TPSAAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnorePhosphorus&#39;</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> <span class="q">&#39;IgnoreSulfur&#39;</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 481       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 482     <span class="s">}</span>
 483 
 484     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^UFFAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 485       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::UFFAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 486       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 487     <span class="s">}</span>
 488 
 489     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_AssignAtomTypes: Unknown atom indentifier type $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
 490   <span class="s">}</span>
 491 
 492   <span class="c"># Assign atom types...</span>
 493   <span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;AssignAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 494 
 495   <span class="c"># Make sure atom types assignment is successful...</span>
 496   <span class="k">if</span> <span class="s">(</span>!<span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;IsAtomTypesAssignmentSuccessful</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 497     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 498   <span class="s">}</span>
 499 
 500   <span class="c"># Collect assigned atom types...</span>
 501   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 502     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 503     <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID</span>} = <span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 504   <span class="s">}</span>
 505 
 506   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 507 <span class="s">}</span>
 508 
 509 <span class="c"># Setup bond symbol map for atoms to speed up generation of path length identifiers</span>
 510 <span class="c"># during fingerprints generation...</span>
 511 <span class="c">#</span>
<a name="_InitializeBondSymbols-"></a> 512 <span class="k">sub </span><span class="m">_InitializeBondSymbols</span> <span class="s">{</span>
 513   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 514   <span class="k">my</span><span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$Bond</span><span class="cm">,</span> <span class="i">$BondSymbol</span><span class="cm">,</span> <span class="i">$BondOrder</span><span class="s">)</span><span class="sc">;</span>
 515 
 516   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">BondSymbols</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 517 
 518   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">UseBondSymbols</span>}<span class="s">)</span> <span class="s">{</span>
 519     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 520   <span class="s">}</span>
 521 
 522   <span class="k">for</span> <span class="i">$Bond</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="i">-&gt;GetBonds</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 523     <span class="i">$BondOrder</span> = <span class="i">$Bond</span><span class="i">-&gt;GetBondOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 524     <span class="i">$BondSymbol</span> = <span class="i">$Bond</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span> ? <span class="q">&#39;:&#39;</span> <span class="co">:</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">BondOrderToSymbol</span>}{<span class="i">$BondOrder</span>}<span class="s">)</span> ? <span class="i">$This</span>-&gt;{<span class="w">BondOrderToSymbol</span>}{<span class="i">$BondOrder</span>} <span class="co">:</span> <span class="i">$BondOrder</span><span class="s">)</span><span class="sc">;</span>
 525     <span class="s">(</span><span class="i">$Atom1</span><span class="cm">,</span> <span class="i">$Atom2</span><span class="s">)</span> = <span class="i">$Bond</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 526     <span class="i">$AtomID1</span> = <span class="i">$Atom1</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">$AtomID2</span> = <span class="i">$Atom2</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 527     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomID1</span> &gt; <span class="i">$AtomID2</span><span class="s">)</span> <span class="s">{</span>
 528       <span class="s">(</span><span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="s">)</span> =  <span class="s">(</span><span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="s">)</span><span class="sc">;</span>
 529     <span class="s">}</span>
 530 
 531     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">BondSymbols</span>}{<span class="i">$AtomID1</span>}<span class="s">)</span> <span class="s">{</span>
 532       <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">BondSymbols</span>}{<span class="i">$AtomID1</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 533     <span class="s">}</span>
 534     <span class="i">$This</span>-&gt;{<span class="w">BondSymbols</span>}{<span class="i">$AtomID1</span>}{<span class="i">$AtomID2</span>} = <span class="i">$BondSymbol</span><span class="sc">;</span>
 535   <span class="s">}</span>
 536   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 537 <span class="s">}</span>
 538 
 539 <span class="c"># Get appropriate atom paths with length up to MaxLength...</span>
 540 <span class="c">#</span>
<a name="_GenerateAtomPathsUpToMaxLength-"></a> 541 <span class="k">sub </span><span class="m">_GenerateAtomPathsUpToMaxLength</span> <span class="s">{</span>
 542   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 543   <span class="k">my</span><span class="s">(</span><span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$AllowRings</span><span class="cm">,</span> <span class="i">$Molecule</span><span class="cm">,</span> <span class="i">$AtomPathsRef</span><span class="s">)</span><span class="sc">;</span>
 544 
 545   <span class="i">$PathLength</span> = <span class="i">$This</span>-&gt;{<span class="w">MaxLength</span>}<span class="sc">;</span>
 546   <span class="i">$AllowRings</span> = <span class="i">$This</span>-&gt;{<span class="w">AllowRings</span>}<span class="sc">;</span>
 547   <span class="i">$Molecule</span> = <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="sc">;</span>
 548 
 549   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AllowSharedBonds</span>}<span class="s">)</span> <span class="s">{</span>
 550     <span class="i">$AtomPathsRef</span> =  <span class="i">$Molecule</span><span class="i">-&gt;GetAllAtomPathsWithLengthUpto</span><span class="s">(</span><span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$AllowRings</span><span class="s">)</span><span class="sc">;</span>
 551   <span class="s">}</span>
 552   <span class="k">else</span> <span class="s">{</span>
 553     <span class="i">$AtomPathsRef</span> = <span class="i">$Molecule</span><span class="i">-&gt;GetAtomPathsWithLengthUpto</span><span class="s">(</span><span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$AllowRings</span><span class="s">)</span><span class="sc">;</span>
 554   <span class="s">}</span>
 555   <span class="i">$This</span>-&gt;{<span class="w">AtomPathsRef</span>} = <span class="i">$AtomPathsRef</span><span class="sc">;</span>
 556 
 557   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 558 <span class="s">}</span>
 559 
 560 <span class="c"># Initialize atom paths strings at various pathlength levels...</span>
 561 <span class="c">#</span>
<a name="_InitializeAtomPathsStrings-"></a> 562 <span class="k">sub </span><span class="m">_InitializeAtomPathsStrings</span> <span class="s">{</span>
 563   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 564   <span class="k">my</span><span class="s">(</span><span class="i">$PathLength</span><span class="s">)</span><span class="sc">;</span>
 565 
 566   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 567 
 568   <span class="k">for</span> <span class="i">$PathLength</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MinLength</span>} .. <span class="i">$This</span>-&gt;{<span class="w">MaxLength</span>}<span class="s">)</span> <span class="s">{</span>
 569     <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 570   <span class="s">}</span>
 571 
 572   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 573 <span class="s">}</span>
 574 
 575 <span class="c"># Generate appropriate atom path strings for unique atom paths...</span>
 576 <span class="c">#</span>
<a name="_GenerateAtomPathsStrings-"></a> 577 <span class="k">sub </span><span class="m">_GenerateAtomPathsStrings</span> <span class="s">{</span>
 578   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 579   <span class="k">my</span><span class="s">(</span><span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$MinPathLength</span><span class="cm">,</span> <span class="i">$UseUniquePaths</span><span class="s">)</span><span class="sc">;</span>
 580 
 581   <span class="i">$MinPathLength</span> = <span class="i">$This</span>-&gt;{<span class="w">MinLength</span>}<span class="sc">;</span>
 582   <span class="i">$UseUniquePaths</span> = <span class="i">$This</span>-&gt;{<span class="w">UseUniquePaths</span>}<span class="sc">;</span>
 583 
 584   <span class="j">PATHATOMS:</span> <span class="k">for</span> <span class="i">$PathAtomsRef</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomPathsRef</span>}}<span class="s">)</span> <span class="s">{</span>
 585     <span class="i">$PathLength</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 586     <span class="k">if</span> <span class="s">(</span><span class="i">$PathLength</span> &lt; <span class="i">$MinPathLength</span><span class="s">)</span> <span class="s">{</span>
 587       <span class="k">next</span> <span class="j">PATHATOMS</span><span class="sc">;</span>
 588     <span class="s">}</span>
 589     <span class="k">if</span> <span class="s">(</span><span class="i">$UseUniquePaths</span><span class="s">)</span> <span class="s">{</span>
 590       <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathStringUsingUniquePath</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 591     <span class="s">}</span>
 592     <span class="k">else</span> <span class="s">{</span>
 593       <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathString</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 594     <span class="s">}</span>
 595   <span class="s">}</span>
 596   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 597 <span class="s">}</span>
 598 
 599 <span class="c"># Generate atom path string using unique path...</span>
 600 <span class="c">#</span>
<a name="_GenerateAtomPathStringUsingUniquePath-"></a> 601 <span class="k">sub </span><span class="m">_GenerateAtomPathStringUsingUniquePath</span> <span class="s">{</span>
 602   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 603 
 604   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AllowRings</span>} &amp;&amp; <span class="i">$This</span><span class="i">-&gt;_DoesAtomPathContainsCycle</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 605     <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathStringUsingUniquePathContainingCycle</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 606   <span class="s">}</span>
 607   <span class="k">else</span> <span class="s">{</span>
 608     <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathStringUsingUniqueLinearPath</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 609   <span class="s">}</span>
 610   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 611 <span class="s">}</span>
 612 
 613 <span class="c"># Generate atom path string for specified path containing no cycle...</span>
 614 <span class="c">#</span>
<a name="_GenerateAtomPathStringUsingUniqueLinearPath-"></a> 615 <span class="k">sub </span><span class="m">_GenerateAtomPathStringUsingUniqueLinearPath</span> <span class="s">{</span>
 616   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 617 
 618   <span class="c"># Is it a unique linear atom path?</span>
 619   <span class="c">#</span>
 620   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_IsUniqueLinearAtomPath</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 621     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 622   <span class="s">}</span>
 623   <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathString</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 624 
 625   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 626 <span class="s">}</span>
 627 
 628 <span class="c"># Is it a structurally unique linear path?</span>
 629 <span class="c">#</span>
 630 <span class="c"># For a path to be structurally unique, all of its atom IDs must be diffferent from any</span>
 631 <span class="c"># earlier path atom IDs. In order to generate atom path atom ID invariant of the atom</span>
 632 <span class="c"># order in the molecule, atom IDs are sorted numerically before generating the path ID.</span>
 633 <span class="c">#</span>
 634 <span class="c"># Notes:</span>
 635 <span class="c">#   . Atom path ID doesn&#39;t reflect the order of atoms in the atom path.</span>
 636 <span class="c">#</span>
<a name="_IsUniqueLinearAtomPath-"></a> 637 <span class="k">sub </span><span class="m">_IsUniqueLinearAtomPath</span> <span class="s">{</span>
 638   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 639   <span class="k">my</span><span class="s">(</span><span class="i">$AtomPathID</span><span class="cm">,</span> <span class="i">$PathLength</span><span class="cm">,</span> <span class="i">@PathAtomIDs</span><span class="s">)</span><span class="sc">;</span>
 640 
 641   <span class="i">@PathAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 642   <span class="i">@PathAtomIDs</span> = <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="s">}</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 643 
 644   <span class="i">$AtomPathID</span> = <span class="k">join</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="i">@PathAtomIDs</span><span class="sc">;</span>
 645   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">UniqueLinearAtomPathsIDs</span>}{<span class="i">$AtomPathID</span>}<span class="s">)</span> <span class="s">{</span>
 646     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 647   <span class="s">}</span>
 648 
 649   <span class="c"># It&#39;s a unique atom path...</span>
 650   <span class="i">$This</span>-&gt;{<span class="w">UniqueLinearAtomPathsIDs</span>}{<span class="i">$AtomPathID</span>} = <span class="n">1</span><span class="sc">;</span>
 651 
 652   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 653 <span class="s">}</span>
 654 
 655 <span class="c"># Generate atom path string for specified path containing a cycle...</span>
 656 <span class="c">#</span>
<a name="_GenerateAtomPathStringUsingUniquePathContainingCycle-"></a> 657 <span class="k">sub </span><span class="m">_GenerateAtomPathStringUsingUniquePathContainingCycle</span> <span class="s">{</span>
 658   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 659 
 660   <span class="c"># Is it a unique atom path containing a cycle?</span>
 661   <span class="c">#</span>
 662   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_IsUniqueAtomPathContainingCycle</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 663     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 664   <span class="s">}</span>
 665 
 666   <span class="k">my</span><span class="s">(</span><span class="i">$CycleClosingPathAtomIndex</span><span class="s">)</span><span class="sc">;</span>
 667   <span class="s">(</span><span class="i">$CycleClosingPathAtomIndex</span><span class="s">)</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomPathCycleClosingAtomIndex</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 668 
 669   <span class="k">if</span> <span class="s">(</span><span class="i">$CycleClosingPathAtomIndex</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 670     <span class="i">$This</span><span class="i">-&gt;_GenerateUniqueAtomPathStringForPathCycle</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 671   <span class="s">}</span>
 672   <span class="k">else</span> <span class="s">{</span>
 673     <span class="i">$This</span><span class="i">-&gt;_GenerateUniqueAtomPathStringForPathContainingCycle</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$CycleClosingPathAtomIndex</span><span class="s">)</span><span class="sc">;</span>
 674   <span class="s">}</span>
 675   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 676 <span class="s">}</span>
 677 
 678 <span class="c"># Generate a unique atom path string for a cyclic path by generating atom path</span>
 679 <span class="c"># strings for all possible paths in the cycle and keeping the lexicographically smallest</span>
 680 <span class="c"># one.</span>
 681 <span class="c">#</span>
 682 <span class="c"># Although all the paths enumerated during atom path string generation are also</span>
 683 <span class="c"># present in the intial paths list, but structural uniqueness check would detect</span>
 684 <span class="c"># &#39;em earlier and this method ends being invoked only once for the first cyclic path.</span>
 685 <span class="c">#</span>
 686 <span class="c"># For atom paths containg same atom types and bond symbols, atom path strings</span>
 687 <span class="c"># would be same for the paths.</span>
 688 <span class="c">#</span>
<a name="_GenerateUniqueAtomPathStringForPathCycle-"></a> 689 <span class="k">sub </span><span class="m">_GenerateUniqueAtomPathStringForPathCycle</span> <span class="s">{</span>
 690   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 691 
 692   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_AreAllPathAtomsSymbolsSame</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span> &amp;&amp; <span class="i">$This</span><span class="i">-&gt;_AreAllPathBondSymbolsSame</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 693     <span class="k">return</span> <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathString</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 694   <span class="s">}</span>
 695 
 696   <span class="c"># Generate all possible atom path strings and select the lexicographically smallest one...</span>
 697   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$FinalAtomPathString</span><span class="cm">,</span> <span class="i">$FirstAtomPathString</span><span class="cm">,</span> <span class="i">$LastIndex</span><span class="cm">,</span> <span class="i">$FirstPartIndex</span><span class="cm">,</span> <span class="i">$FirstPartStartIndex</span><span class="cm">,</span> <span class="i">$FirstPartEndIndex</span><span class="cm">,</span> <span class="i">$SecondPartIndex</span><span class="cm">,</span> <span class="i">$SecondPartStartIndex</span><span class="cm">,</span> <span class="i">$SecondPartEndIndex</span><span class="cm">,</span> <span class="i">$AtomPathSymbolsRef</span><span class="cm">,</span> <span class="i">$AtomPathString</span><span class="cm">,</span> <span class="i">$ReverseAtomPathString</span><span class="cm">,</span> <span class="i">@FirstPartPathAtoms</span><span class="cm">,</span> <span class="i">@SecondPartPathAtoms</span><span class="cm">,</span> <span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
 698 
 699   <span class="i">$PathLength</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 700   <span class="i">$LastIndex</span> = <span class="i">$PathLength</span> - <span class="n">1</span><span class="sc">;</span>
 701 
 702   <span class="i">$FinalAtomPathString</span> = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 703   <span class="i">$FirstAtomPathString</span> = <span class="n">1</span><span class="sc">;</span>
 704 
 705   <span class="i">@FirstPartPathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@SecondPartPathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@PathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 706 
 707   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$LastIndex</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 708     <span class="i">@FirstPartPathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@SecondPartPathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">@PathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 709 
 710     <span class="i">$FirstPartStartIndex</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$FirstPartEndIndex</span> = <span class="i">$Index</span> - <span class="n">1</span><span class="sc">;</span>
 711     <span class="i">$SecondPartStartIndex</span> = <span class="i">$Index</span><span class="sc">;</span> <span class="i">$SecondPartEndIndex</span> = <span class="i">$LastIndex</span> - <span class="n">1</span><span class="sc">;</span>
 712 
 713     <span class="c"># Get first part atoms...</span>
 714     <span class="k">for</span> <span class="i">$FirstPartIndex</span> <span class="s">(</span><span class="i">$FirstPartStartIndex</span> .. <span class="i">$FirstPartEndIndex</span><span class="s">)</span> <span class="s">{</span>
 715       <span class="k">push</span> <span class="i">@FirstPartPathAtoms</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$FirstPartIndex</span>]<span class="sc">;</span>
 716     <span class="s">}</span>
 717 
 718     <span class="c"># Get second part atoms...</span>
 719     <span class="k">for</span> <span class="i">$SecondPartIndex</span> <span class="s">(</span><span class="i">$SecondPartStartIndex</span> .. <span class="i">$SecondPartEndIndex</span><span class="s">)</span> <span class="s">{</span>
 720       <span class="k">push</span> <span class="i">@SecondPartPathAtoms</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$SecondPartIndex</span>]<span class="sc">;</span>
 721     <span class="s">}</span>
 722 
 723     <span class="c"># Get final list of path atoms...</span>
 724     <span class="k">if</span> <span class="s">(</span><span class="i">@SecondPartPathAtoms</span><span class="s">)</span> <span class="s">{</span>
 725       <span class="k">push</span> <span class="i">@PathAtoms</span><span class="cm">,</span> <span class="i">@SecondPartPathAtoms</span><span class="sc">;</span>
 726     <span class="s">}</span>
 727     <span class="k">if</span> <span class="s">(</span><span class="i">@FirstPartPathAtoms</span><span class="s">)</span> <span class="s">{</span>
 728       <span class="k">push</span> <span class="i">@PathAtoms</span><span class="cm">,</span> <span class="i">@FirstPartPathAtoms</span><span class="sc">;</span>
 729     <span class="s">}</span>
 730 
 731     <span class="c"># Complete the cycle by adding first atom as the last atom...</span>
 732     <span class="k">push</span> <span class="i">@PathAtoms</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$SecondPartStartIndex</span>]<span class="sc">;</span>
 733 
 734     <span class="c"># Generate atom path string...</span>
 735     <span class="i">$AtomPathSymbolsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathSymbols</span><span class="s">(</span>\<span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
 736 
 737     <span class="i">$AtomPathString</span> = <span class="k">join</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$AtomPathSymbolsRef</span>}<span class="sc">;</span>
 738     <span class="i">$ReverseAtomPathString</span> = <span class="k">join</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="k">reverse</span> <span class="i">@</span>{<span class="i">$AtomPathSymbolsRef</span>}<span class="sc">;</span>
 739 
 740     <span class="k">if</span> <span class="s">(</span><span class="i">$ReverseAtomPathString</span> <span class="k">le</span> <span class="i">$AtomPathString</span><span class="s">)</span> <span class="s">{</span>
 741       <span class="i">$AtomPathString</span> = <span class="i">$ReverseAtomPathString</span><span class="sc">;</span>
 742     <span class="s">}</span>
 743 
 744     <span class="c"># Update final atom path string...</span>
 745 
 746     <span class="k">if</span> <span class="s">(</span><span class="i">$FirstAtomPathString</span><span class="s">)</span> <span class="s">{</span>
 747       <span class="i">$FirstAtomPathString</span> = <span class="n">0</span><span class="sc">;</span>
 748       <span class="i">$FinalAtomPathString</span> = <span class="i">$AtomPathString</span><span class="sc">;</span>
 749     <span class="s">}</span>
 750     <span class="k">else</span> <span class="s">{</span>
 751       <span class="k">if</span> <span class="s">(</span><span class="i">$AtomPathString</span> <span class="k">le</span> <span class="i">$FinalAtomPathString</span><span class="s">)</span> <span class="s">{</span>
 752         <span class="i">$FinalAtomPathString</span> = <span class="i">$AtomPathString</span><span class="sc">;</span>
 753       <span class="s">}</span>
 754     <span class="s">}</span>
 755   <span class="s">}</span>
 756 
 757   <span class="c"># Set final atom path string...</span>
 758   <span class="c">#</span>
 759   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$FinalAtomPathString</span>}<span class="s">)</span> <span class="s">{</span>
 760     <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$FinalAtomPathString</span>} += <span class="n">1</span><span class="sc">;</span>
 761   <span class="s">}</span>
 762   <span class="k">else</span> <span class="s">{</span>
 763     <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$FinalAtomPathString</span>} = <span class="n">1</span><span class="sc">;</span>
 764   <span class="s">}</span>
 765 
 766   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 767 <span class="s">}</span>
 768 
 769 <span class="c">#</span>
 770 <span class="c"># Generate a unique atom path string for paths containing a cycle closed by</span>
 771 <span class="c"># the specified atom index and the last atom index.</span>
 772 <span class="c">#</span>
 773 <span class="c"># The following methodology is used to generate atom path string which is</span>
 774 <span class="c"># independemt of initial atom ordering:</span>
 775 <span class="c">#   . Generate atom paths string from first atom to the atom before the first cycle</span>
 776 <span class="c">#     closing atom.</span>
 777 <span class="c">#   . Generate atom path string from atoms from first cycle closing atom index to</span>
 778 <span class="c">#     the last path atom in both forward and reverse order. And select the lexicographically</span>
 779 <span class="c">#     smallest atom path string.</span>
 780 <span class="c">#   . Combine atom path string generated in first step with second step to generate</span>
 781 <span class="c">#     final atom path string.</span>
 782 <span class="c">#</span>
<a name="_GenerateUniqueAtomPathStringForPathContainingCycle-"></a> 783 <span class="k">sub </span><span class="m">_GenerateUniqueAtomPathStringForPathContainingCycle</span> <span class="s">{</span>
 784   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="cm">,</span> <span class="i">$CycleClosingAtomIndex</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 785   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$LastIndex</span><span class="cm">,</span> <span class="i">$LinearPartStartIndex</span><span class="cm">,</span> <span class="i">$LinearPartEndIndex</span><span class="cm">,</span> <span class="i">$CyclicPartStartIndex</span><span class="cm">,</span> <span class="i">$CyclicPartEndIndex</span><span class="cm">,</span> <span class="i">$CyclicPartAtomPathSymbolsRef</span><span class="cm">,</span> <span class="i">$CyclicPartAtomPathString</span><span class="cm">,</span> <span class="i">$ReverseCyclicPartAtomPathString</span><span class="cm">,</span> <span class="i">$AtomPathString</span><span class="cm">,</span> <span class="i">$AtomPathSymbolsRef</span><span class="cm">,</span> <span class="i">@CyclicPartPathAtoms</span><span class="cm">,</span> <span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
 786 
 787   <span class="i">$PathLength</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 788   <span class="i">$LastIndex</span> = <span class="i">$PathLength</span> - <span class="n">1</span><span class="sc">;</span>
 789 
 790   <span class="i">@PathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 791 
 792   <span class="c"># Get path atoms corresponding to linear  part of the path...</span>
 793   <span class="i">$LinearPartStartIndex</span> = <span class="n">0</span><span class="sc">;</span> <span class="i">$LinearPartEndIndex</span> = <span class="i">$CycleClosingAtomIndex</span> - <span class="n">1</span><span class="sc">;</span>
 794 
 795   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="i">$LinearPartStartIndex</span> .. <span class="i">$LinearPartEndIndex</span><span class="s">)</span> <span class="s">{</span>
 796     <span class="k">push</span> <span class="i">@PathAtoms</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
 797   <span class="s">}</span>
 798 
 799   <span class="c"># Get atoms correcponding to cyclic part of the path...</span>
 800   <span class="i">@CyclicPartPathAtoms</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 801   <span class="i">$CyclicPartStartIndex</span> = <span class="i">$CycleClosingAtomIndex</span><span class="sc">;</span> <span class="i">$CyclicPartEndIndex</span> = <span class="i">$LastIndex</span><span class="sc">;</span>
 802 
 803   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="i">$CyclicPartStartIndex</span> .. <span class="i">$CyclicPartEndIndex</span><span class="s">)</span> <span class="s">{</span>
 804     <span class="k">push</span> <span class="i">@CyclicPartPathAtoms</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span>
 805   <span class="s">}</span>
 806 
 807   <span class="c"># Setup a lexicographically smaller atom path string for cyclic part...</span>
 808 
 809   <span class="i">$CyclicPartAtomPathSymbolsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathSymbols</span><span class="s">(</span>\<span class="i">@CyclicPartPathAtoms</span><span class="s">)</span><span class="sc">;</span>
 810   <span class="i">$CyclicPartAtomPathString</span> = <span class="k">join</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$CyclicPartAtomPathSymbolsRef</span>}<span class="sc">;</span>
 811   <span class="i">$ReverseCyclicPartAtomPathString</span> = <span class="k">join</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="k">reverse</span> <span class="i">@</span>{<span class="i">$CyclicPartAtomPathSymbolsRef</span>}<span class="sc">;</span>
 812 
 813   <span class="c"># Setup atom path corresponding to linear part and lexigraphicall smaller cyclic part...</span>
 814 
 815   <span class="k">if</span> <span class="s">(</span><span class="i">$ReverseCyclicPartAtomPathString</span> <span class="k">le</span> <span class="i">$CyclicPartAtomPathString</span><span class="s">)</span> <span class="s">{</span>
 816     <span class="k">push</span> <span class="i">@PathAtoms</span><span class="cm">,</span> <span class="k">reverse</span> <span class="i">@CyclicPartPathAtoms</span><span class="sc">;</span>
 817   <span class="s">}</span>
 818   <span class="k">else</span> <span class="s">{</span>
 819     <span class="k">push</span> <span class="i">@PathAtoms</span><span class="cm">,</span> <span class="i">@CyclicPartPathAtoms</span><span class="sc">;</span>
 820   <span class="s">}</span>
 821 
 822   <span class="c"># Setup final atom path string...</span>
 823 
 824   <span class="i">$AtomPathSymbolsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathSymbols</span><span class="s">(</span>\<span class="i">@PathAtoms</span><span class="s">)</span><span class="sc">;</span>
 825   <span class="i">$AtomPathString</span> = <span class="k">join</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$AtomPathSymbolsRef</span>}<span class="sc">;</span>
 826 
 827   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$AtomPathString</span>}<span class="s">)</span> <span class="s">{</span>
 828     <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$AtomPathString</span>} += <span class="n">1</span><span class="sc">;</span>
 829   <span class="s">}</span>
 830   <span class="k">else</span> <span class="s">{</span>
 831     <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$AtomPathString</span>} = <span class="n">1</span><span class="sc">;</span>
 832   <span class="s">}</span>
 833 
 834   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 835 <span class="s">}</span>
 836 
 837 <span class="c"># Does atom path contain a cycle?</span>
 838 <span class="c">#</span>
 839 <span class="c"># For an atom path to contain cycle, it must satisfy the following conditions:</span>
 840 <span class="c">#   . Pathlength &gt;= 3</span>
 841 <span class="c">#   . Last atom ID is equal to first atom ID or some other atom ID besides itself</span>
 842 <span class="c">#</span>
<a name="_DoesAtomPathContainsCycle-"></a> 843 <span class="k">sub </span><span class="m">_DoesAtomPathContainsCycle</span> <span class="s">{</span>
 844   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 845   <span class="k">my</span><span class="s">(</span><span class="i">$PathLength</span><span class="s">)</span><span class="sc">;</span>
 846 
 847   <span class="i">$PathLength</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 848   <span class="k">if</span> <span class="s">(</span><span class="i">$PathLength</span> &lt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 849     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 850   <span class="s">}</span>
 851 
 852   <span class="k">my</span><span class="s">(</span><span class="i">$AtomIndex</span><span class="cm">,</span> <span class="i">$LastAtomIndex</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$LastAtom</span><span class="cm">,</span> <span class="i">$LastAtomID</span><span class="s">)</span><span class="sc">;</span>
 853 
 854   <span class="i">$LastAtomIndex</span> = <span class="i">$PathLength</span> - <span class="n">1</span><span class="sc">;</span>
 855   <span class="i">$LastAtom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$LastAtomIndex</span>]<span class="sc">;</span>
 856   <span class="i">$LastAtomID</span> = <span class="i">$LastAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 857 
 858   <span class="c"># Look for atomID similar to last atom ID...</span>
 859   <span class="k">for</span> <span class="i">$AtomIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$LastAtomIndex</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 860     <span class="i">$Atom</span> =  <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$AtomIndex</span>]<span class="sc">;</span>
 861     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 862 
 863     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomID</span> == <span class="i">$LastAtomID</span><span class="s">)</span> <span class="s">{</span>
 864       <span class="c"># It&#39;s a cycle...</span>
 865       <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 866     <span class="s">}</span>
 867   <span class="s">}</span>
 868   <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 869 <span class="s">}</span>
 870 
 871 <span class="c"># Get atom path cycle closing atom index...</span>
 872 <span class="c">#</span>
<a name="_GetAtomPathCycleClosingAtomIndex-"></a> 873 <span class="k">sub </span><span class="m">_GetAtomPathCycleClosingAtomIndex</span> <span class="s">{</span>
 874   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 875   <span class="k">my</span><span class="s">(</span><span class="i">$AtomIndex</span><span class="cm">,</span> <span class="i">$LastAtomIndex</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$LastAtom</span><span class="cm">,</span> <span class="i">$LastAtomID</span><span class="cm">,</span> <span class="i">$PathLength</span><span class="s">)</span><span class="sc">;</span>
 876 
 877   <span class="i">$PathLength</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 878 
 879   <span class="i">$LastAtomIndex</span> = <span class="i">$PathLength</span> - <span class="n">1</span><span class="sc">;</span>
 880   <span class="i">$LastAtom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$LastAtomIndex</span>]<span class="sc">;</span> <span class="i">$LastAtomID</span> = <span class="i">$LastAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 881 
 882   <span class="c"># Look for atomID similar to last atom ID...</span>
 883   <span class="k">for</span> <span class="i">$AtomIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$LastAtomIndex</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 884     <span class="i">$Atom</span> =  <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$AtomIndex</span>]<span class="sc">;</span> <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 885 
 886     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomID</span> == <span class="i">$LastAtomID</span><span class="s">)</span> <span class="s">{</span>
 887       <span class="c"># It&#39;s a cycle closing atom...</span>
 888       <span class="k">return</span> <span class="i">$AtomIndex</span><span class="sc">;</span>
 889     <span class="s">}</span>
 890   <span class="s">}</span>
 891   <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 892 <span class="s">}</span>
 893 
 894 <span class="c"># Is it a structurally unique path containing a cycle?</span>
 895 <span class="c">#</span>
 896 <span class="c"># For atom paths containing cycles, last atom ID is either equal to first atom ID or</span>
 897 <span class="c"># some other atom ID besides itself.</span>
 898 <span class="c">#</span>
 899 <span class="c"># In order to determine its structurally unqiue independent of initial atom ordering,</span>
 900 <span class="c"># the following methodolgy is used:</span>
 901 <span class="c">#</span>
 902 <span class="c">#   . For paths with same first and atom IDs:</span>
 903 <span class="c">#      . Remove the last atom ID from atom path</span>
 904 <span class="c">#      . Sort atom IDs in the path</span>
 905 <span class="c">#      . Add first atom ID from the sorted list to the end of list to complete the cycle</span>
 906 <span class="c">#      . Generate a atom path ID</span>
 907 <span class="c">#      . Use final path ID to track uniqueness of path containing cycle.</span>
 908 <span class="c">#</span>
 909 <span class="c">#   . For paths with last atom ID equal to some other atom ID besidies itself:</span>
 910 <span class="c">#      . Sort atom IDs in atom path</span>
 911 <span class="c">#      . Generate atom path ID and use it to track unqiueness of atom paths.</span>
 912 <span class="c">#</span>
<a name="_IsUniqueAtomPathContainingCycle-"></a> 913 <span class="k">sub </span><span class="m">_IsUniqueAtomPathContainingCycle</span> <span class="s">{</span>
 914   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 915   <span class="k">my</span><span class="s">(</span><span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$AtomPathID</span><span class="cm">,</span> <span class="i">$FirstAtom</span><span class="cm">,</span> <span class="i">$LastAtom</span><span class="cm">,</span> <span class="i">$FirstAtomID</span><span class="cm">,</span> <span class="i">$LastAtomID</span><span class="cm">,</span> <span class="i">@PathAtomIDs</span><span class="cm">,</span> <span class="i">@SortedPathAtomIDs</span><span class="s">)</span><span class="sc">;</span>
 916 
 917   <span class="i">@PathAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 918   <span class="i">@PathAtomIDs</span> = <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="s">}</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 919 
 920   <span class="i">$PathLength</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 921 
 922   <span class="i">$FirstAtom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="n">0</span>]<span class="sc">;</span> <span class="i">$FirstAtomID</span> = <span class="i">$FirstAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 923   <span class="i">$LastAtom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$PathLength</span> - <span class="n">1</span>]<span class="sc">;</span> <span class="i">$LastAtomID</span> = <span class="i">$LastAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 924 
 925   <span class="k">if</span> <span class="s">(</span><span class="i">$FirstAtomID</span> == <span class="i">$LastAtomID</span><span class="s">)</span> <span class="s">{</span>
 926     <span class="k">pop</span> <span class="i">@PathAtomIDs</span><span class="sc">;</span>
 927 
 928     <span class="i">@SortedPathAtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 929     <span class="i">@SortedPathAtomIDs</span> = <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="i">@PathAtomIDs</span><span class="sc">;</span>
 930 
 931     <span class="k">push</span> <span class="i">@SortedPathAtomIDs</span><span class="cm">,</span> <span class="i">$SortedPathAtomIDs</span>[<span class="n">0</span>]<span class="sc">;</span>
 932 
 933     <span class="i">$AtomPathID</span> = <span class="k">join</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="i">@SortedPathAtomIDs</span><span class="sc">;</span>
 934   <span class="s">}</span>
 935   <span class="k">else</span> <span class="s">{</span>
 936     <span class="i">$AtomPathID</span> = <span class="k">join</span> <span class="q">&#39;-&#39;</span><span class="cm">,</span> <span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="i">@PathAtomIDs</span><span class="sc">;</span>
 937   <span class="s">}</span>
 938 
 939   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">UniqueCyclicAtomPathsIDs</span>}{<span class="i">$AtomPathID</span>}<span class="s">)</span> <span class="s">{</span>
 940     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 941   <span class="s">}</span>
 942 
 943   <span class="c"># It&#39;s a unique atom path containing a cycle...</span>
 944   <span class="i">$This</span>-&gt;{<span class="w">UniqueCyclicAtomPathsIDs</span>}{<span class="i">$AtomPathID</span>} = <span class="n">1</span><span class="sc">;</span>
 945 
 946   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 947 <span class="s">}</span>
 948 
 949 <span class="c"># Generate atom path string for specified atom path...</span>
 950 <span class="c">#</span>
<a name="_GenerateAtomPathString-"></a> 951 <span class="k">sub </span><span class="m">_GenerateAtomPathString</span> <span class="s">{</span>
 952   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 953   <span class="k">my</span><span class="s">(</span><span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$AtomPathString</span><span class="cm">,</span> <span class="i">$ReverseAtomPathString</span><span class="cm">,</span> <span class="i">$AtomPathSymbolsRef</span><span class="s">)</span><span class="sc">;</span>
 954 
 955   <span class="i">$PathLength</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="sc">;</span>
 956 
 957   <span class="c"># Generate path atom and bond symbols...</span>
 958   <span class="c">#</span>
 959   <span class="i">$AtomPathSymbolsRef</span> = <span class="i">$This</span><span class="i">-&gt;_GenerateAtomPathSymbols</span><span class="s">(</span><span class="i">$PathAtomsRef</span><span class="s">)</span><span class="sc">;</span>
 960 
 961   <span class="c"># Check presence of path using path ID created by atom path symbols...</span>
 962   <span class="i">$AtomPathString</span> = <span class="k">join</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$AtomPathSymbolsRef</span>}<span class="sc">;</span>
 963   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$AtomPathString</span>}<span class="s">)</span> <span class="s">{</span>
 964     <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$AtomPathString</span>} += <span class="n">1</span><span class="sc">;</span>
 965     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 966   <span class="s">}</span>
 967 
 968   <span class="c"># Check presence of reverse path using path ID created by atom path symbols...</span>
 969   <span class="c">#</span>
 970   <span class="i">$ReverseAtomPathString</span> = <span class="k">join</span> <span class="q">&#39;&#39;</span><span class="cm">,</span> <span class="k">reverse</span> <span class="i">@</span>{<span class="i">$AtomPathSymbolsRef</span>}<span class="sc">;</span>
 971   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$ReverseAtomPathString</span>}<span class="s">)</span> <span class="s">{</span>
 972     <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$ReverseAtomPathString</span>} += <span class="n">1</span><span class="sc">;</span>
 973     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 974   <span class="s">}</span>
 975 
 976   <span class="c"># Use lexicographically smaller atom path string as PathID...</span>
 977   <span class="c">#</span>
 978   <span class="k">if</span> <span class="s">(</span><span class="i">$AtomPathString</span> <span class="k">le</span> <span class="i">$ReverseAtomPathString</span><span class="s">)</span> <span class="s">{</span>
 979     <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$AtomPathString</span>} = <span class="n">1</span><span class="sc">;</span>
 980   <span class="s">}</span>
 981   <span class="k">else</span> <span class="s">{</span>
 982     <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$ReverseAtomPathString</span>} = <span class="n">1</span><span class="sc">;</span>
 983   <span class="s">}</span>
 984   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 985 <span class="s">}</span>
 986 
 987 <span class="c">#  Are atom types for all path atoms same?</span>
 988 <span class="c">#</span>
<a name="_AreAllPathAtomsSymbolsSame-"></a> 989 <span class="k">sub </span><span class="m">_AreAllPathAtomsSymbolsSame</span> <span class="s">{</span>
 990   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 991   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$FirstAtomType</span><span class="s">)</span><span class="sc">;</span>
 992 
 993   <span class="i">$Atom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="n">0</span>]<span class="sc">;</span> <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 994   <span class="i">$FirstAtomType</span> = <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 995 
 996   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$#</span>{<span class="i">$PathAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
 997     <span class="i">$Atom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span> <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 998     <span class="i">$AtomType</span> = <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 999 
1000     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomType</span> <span class="k">ne</span> <span class="i">$FirstAtomType</span><span class="s">)</span> <span class="s">{</span>
1001       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1002     <span class="s">}</span>
1003   <span class="s">}</span>
1004   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1005 <span class="s">}</span>
1006 
1007 <span class="c">#  Are bond symbols for all path bonds same?</span>
1008 <span class="c">#</span>
<a name="_AreAllPathBondSymbolsSame-"></a>1009 <span class="k">sub </span><span class="m">_AreAllPathBondSymbolsSame</span> <span class="s">{</span>
1010   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1011   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$BondedAtom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$BondedAtomID</span><span class="cm">,</span> <span class="i">$BondAtomID1</span><span class="cm">,</span> <span class="i">$BondAtomID2</span><span class="cm">,</span> <span class="i">$FirstBondSymbol</span><span class="cm">,</span> <span class="i">$BondSymbol</span><span class="s">)</span><span class="sc">;</span>
1012 
1013   <span class="c"># During no usage of bond symbols, just ignore them and assume they are same...</span>
1014   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">UseBondSymbols</span>}<span class="s">)</span> <span class="s">{</span>
1015     <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1016   <span class="s">}</span>
1017 
1018   <span class="i">$Atom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="n">0</span>]<span class="sc">;</span> <span class="i">$BondedAtom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="n">1</span>]<span class="sc">;</span>
1019   <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">$BondedAtomID</span> = <span class="i">$BondedAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1020 
1021   <span class="s">(</span><span class="i">$BondAtomID1</span><span class="cm">,</span> <span class="i">$BondAtomID2</span><span class="s">)</span> = <span class="s">(</span><span class="i">$AtomID</span> &lt; <span class="i">$BondedAtomID</span><span class="s">)</span> ? <span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$BondedAtomID</span><span class="s">)</span> <span class="co">:</span> <span class="s">(</span><span class="i">$BondedAtomID</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
1022   <span class="i">$FirstBondSymbol</span> = <span class="i">$This</span>-&gt;{<span class="w">BondSymbols</span>}{<span class="i">$BondAtomID1</span>}{<span class="i">$BondAtomID2</span>}<span class="sc">;</span>
1023 
1024   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">1</span> .. <span class="s">(</span><span class="i">$#</span>{<span class="i">$PathAtomsRef</span>} - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1025     <span class="i">$Atom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span> <span class="i">$BondedAtom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$Index</span> + <span class="n">1</span>]<span class="sc">;</span>
1026     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">$BondedAtomID</span> = <span class="i">$BondedAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1027 
1028     <span class="s">(</span><span class="i">$BondAtomID1</span><span class="cm">,</span> <span class="i">$BondAtomID2</span><span class="s">)</span> = <span class="s">(</span><span class="i">$AtomID</span> &lt; <span class="i">$BondedAtomID</span><span class="s">)</span> ? <span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$BondedAtomID</span><span class="s">)</span> <span class="co">:</span> <span class="s">(</span><span class="i">$BondedAtomID</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
1029     <span class="i">$BondSymbol</span> = <span class="i">$This</span>-&gt;{<span class="w">BondSymbols</span>}{<span class="i">$BondAtomID1</span>}{<span class="i">$BondAtomID2</span>}<span class="sc">;</span>
1030 
1031     <span class="k">if</span> <span class="s">(</span><span class="i">$BondSymbol</span> <span class="k">ne</span> <span class="i">$FirstBondSymbol</span><span class="s">)</span> <span class="s">{</span>
1032       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
1033     <span class="s">}</span>
1034   <span class="s">}</span>
1035   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
1036 <span class="s">}</span>
1037 
1038 <span class="c"># Generate atom path symbols...</span>
1039 <span class="c">#</span>
<a name="_GenerateAtomPathSymbols-"></a>1040 <span class="k">sub </span><span class="m">_GenerateAtomPathSymbols</span> <span class="s">{</span>
1041   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$PathAtomsRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1042   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">@AtomPathSymbols</span><span class="s">)</span><span class="sc">;</span>
1043 
1044   <span class="i">@AtomPathSymbols</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1045 
1046   <span class="k">if</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathAtomsRef</span>} == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
1047     <span class="i">$Atom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="n">0</span>]<span class="sc">;</span> <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1048     <span class="k">push</span> <span class="i">@AtomPathSymbols</span><span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
1049     <span class="k">return</span> \<span class="i">@AtomPathSymbols</span><span class="sc">;</span>
1050   <span class="s">}</span>
1051 
1052   <span class="c"># Ignore bond information...</span>
1053   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">UseBondSymbols</span>}<span class="s">)</span> <span class="s">{</span>
1054     <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PathAtomsRef</span>}<span class="s">)</span> <span class="s">{</span>
1055       <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1056       <span class="k">push</span> <span class="i">@AtomPathSymbols</span><span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
1057     <span class="s">}</span>
1058     <span class="k">return</span> \<span class="i">@AtomPathSymbols</span><span class="sc">;</span>
1059   <span class="s">}</span>
1060 
1061   <span class="c"># Use atoms and bonds to generate atom path string...</span>
1062   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$BondedAtom</span><span class="cm">,</span> <span class="i">$BondedAtomID</span><span class="cm">,</span> <span class="i">$BondAtomID1</span><span class="cm">,</span> <span class="i">$BondAtomID2</span><span class="s">)</span><span class="sc">;</span>
1063 
1064   <span class="c"># Process atom type of first atom in path...</span>
1065   <span class="i">$Atom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="n">0</span>]<span class="sc">;</span> <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1066   <span class="k">push</span> <span class="i">@AtomPathSymbols</span><span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
1067 
1068   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$#</span>{<span class="i">$PathAtomsRef</span>} - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1069     <span class="i">$Atom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$Index</span>]<span class="sc">;</span> <span class="i">$BondedAtom</span> = <span class="i">$PathAtomsRef</span>-&gt;[<span class="i">$Index</span> + <span class="n">1</span>]<span class="sc">;</span>
1070     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span> <span class="i">$BondedAtomID</span> = <span class="i">$BondedAtom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1071 
1072     <span class="s">(</span><span class="i">$BondAtomID1</span><span class="cm">,</span> <span class="i">$BondAtomID2</span><span class="s">)</span> = <span class="s">(</span><span class="i">$AtomID</span> &lt; <span class="i">$BondedAtomID</span><span class="s">)</span> ? <span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$BondedAtomID</span><span class="s">)</span> <span class="co">:</span> <span class="s">(</span><span class="i">$BondedAtomID</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="s">)</span><span class="sc">;</span>
1073     <span class="k">push</span> <span class="i">@AtomPathSymbols</span><span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">BondSymbols</span>}{<span class="i">$BondAtomID1</span>}{<span class="i">$BondAtomID2</span>}<span class="sc">;</span>
1074 
1075     <span class="c"># Process atom type of next atom in path...</span>
1076     <span class="k">push</span> <span class="i">@AtomPathSymbols</span><span class="cm">,</span> <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$BondedAtomID</span>}<span class="sc">;</span>
1077   <span class="s">}</span>
1078   <span class="k">return</span> \<span class="i">@AtomPathSymbols</span><span class="sc">;</span>
1079 <span class="s">}</span>
1080 
1081 <span class="c"># Set final fingerprits...</span>
1082 <span class="c">#</span>
<a name="_SetFinalFingerprints-"></a>1083 <span class="k">sub </span><span class="m">_SetFinalFingerprints</span> <span class="s">{</span>
1084   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1085 
1086   <span class="c"># Mark successful generation of fingerprints...</span>
1087   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsGenerated</span>} = <span class="n">1</span><span class="sc">;</span>
1088 
1089   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^PathLengthBits$/i</span><span class="s">)</span> <span class="s">{</span>
1090     <span class="i">$This</span><span class="i">-&gt;_SetFinalFingerprintsBitVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1091   <span class="s">}</span>
1092   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^PathLengthCount$/i</span><span class="s">)</span> <span class="s">{</span>
1093     <span class="i">$This</span><span class="i">-&gt;_SetFinalFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1094   <span class="s">}</span>
1095 
1096   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1097 <span class="s">}</span>
1098 
1099 <span class="c"># Set final fingerprits bit vector...</span>
1100 <span class="c">#</span>
<a name="_SetFinalFingerprintsBitVector-"></a>1101 <span class="k">sub </span><span class="m">_SetFinalFingerprintsBitVector</span> <span class="s">{</span>
1102   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1103   <span class="k">my</span><span class="s">(</span><span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$Size</span><span class="cm">,</span> <span class="i">$AtomPathString</span><span class="cm">,</span> <span class="i">$AtomPathHashCode</span><span class="cm">,</span> <span class="i">$AtomPathBitPos</span><span class="cm">,</span> <span class="i">$FingerprintsBitVector</span><span class="cm">,</span> <span class="i">$SkipBitPosCheck</span><span class="cm">,</span> <span class="i">$NumOfBitsToSetPerPath</span><span class="cm">,</span> <span class="i">$SetBitNum</span><span class="s">)</span><span class="sc">;</span>
1104 
1105   <span class="i">$FingerprintsBitVector</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVector</span>}<span class="sc">;</span>
1106 
1107   <span class="i">$Size</span> = <span class="i">$This</span>-&gt;{<span class="w">Size</span>}<span class="sc">;</span>
1108 
1109   <span class="i">$SkipBitPosCheck</span> = <span class="n">1</span><span class="sc">;</span>
1110   <span class="i">$NumOfBitsToSetPerPath</span> = <span class="i">$This</span>-&gt;{<span class="w">NumOfBitsToSetPerPath</span>}<span class="sc">;</span>
1111 
1112   <span class="k">for</span> <span class="i">$PathLength</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}}<span class="s">)</span> <span class="s">{</span>
1113     <span class="k">for</span> <span class="i">$AtomPathString</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}}<span class="s">)</span> <span class="s">{</span>
1114       <span class="i">$AtomPathHashCode</span> = <span class="i">TextUtil::HashCode</span><span class="s">(</span><span class="i">$AtomPathString</span><span class="s">)</span><span class="sc">;</span>
1115 
1116       <span class="c"># Set random number seed...</span>
1117       <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">UsePerlCoreRandom</span>}<span class="s">)</span> <span class="s">{</span>
1118         <span class="i">CORE::</span><span class="k">srand</span><span class="s">(</span><span class="i">$AtomPathHashCode</span><span class="s">)</span><span class="sc">;</span>
1119       <span class="s">}</span>
1120       <span class="k">else</span> <span class="s">{</span>
1121         <span class="i">MathUtil::srandom</span><span class="s">(</span><span class="i">$AtomPathHashCode</span><span class="s">)</span><span class="sc">;</span>
1122       <span class="s">}</span>
1123 
1124       <span class="k">for</span> <span class="i">$SetBitNum</span> <span class="s">(</span><span class="n">1</span> .. <span class="i">$NumOfBitsToSetPerPath</span><span class="s">)</span> <span class="s">{</span>
1125         <span class="i">$AtomPathBitPos</span> = <span class="i">$This</span>-&gt;{<span class="w">UsePerlCoreRandom</span>} ? <span class="k">int</span><span class="s">(</span><span class="i">CORE::</span><span class="k">rand</span><span class="s">(</span><span class="i">$Size</span><span class="s">)</span><span class="s">)</span> <span class="co">:</span> <span class="k">int</span><span class="s">(</span><span class="i">MathUtil::random</span><span class="s">(</span><span class="i">$Size</span><span class="s">)</span><span class="s">)</span><span class="sc">;</span>
1126         <span class="i">$FingerprintsBitVector</span><span class="i">-&gt;SetBit</span><span class="s">(</span><span class="i">$AtomPathBitPos</span><span class="cm">,</span> <span class="i">$SkipBitPosCheck</span><span class="s">)</span><span class="sc">;</span>
1127       <span class="s">}</span>
1128     <span class="s">}</span>
1129   <span class="s">}</span>
1130   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1131 <span class="s">}</span>
1132 
1133 <span class="c"># Set final fingerprits vector...</span>
1134 <span class="c">#</span>
<a name="_SetFinalFingerprintsVector-"></a>1135 <span class="k">sub </span><span class="m">_SetFinalFingerprintsVector</span> <span class="s">{</span>
1136   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1137   <span class="k">my</span><span class="s">(</span><span class="i">$PathLength</span><span class="cm">,</span> <span class="i">$AtomPathString</span><span class="cm">,</span> <span class="i">$FingerprintsVector</span><span class="cm">,</span> <span class="i">$AtomPathCount</span><span class="cm">,</span> <span class="i">@Values</span><span class="cm">,</span> <span class="i">@ValueIDs</span><span class="s">)</span><span class="sc">;</span>
1138 
1139   <span class="i">@Values</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1140   <span class="i">@ValueIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1141 
1142   <span class="k">for</span> <span class="i">$PathLength</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}}<span class="s">)</span> <span class="s">{</span>
1143     <span class="k">for</span> <span class="i">$AtomPathString</span> <span class="s">(</span><span class="k">sort</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}}<span class="s">)</span> <span class="s">{</span>
1144       <span class="i">$AtomPathCount</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomPathsStrings</span>}{<span class="i">$PathLength</span>}{<span class="i">$AtomPathString</span>}<span class="sc">;</span>
1145 
1146       <span class="k">push</span> <span class="i">@Values</span><span class="cm">,</span> <span class="i">$AtomPathCount</span><span class="sc">;</span>
1147       <span class="k">push</span> <span class="i">@ValueIDs</span><span class="cm">,</span> <span class="i">$AtomPathString</span><span class="sc">;</span>
1148     <span class="s">}</span>
1149   <span class="s">}</span>
1150 
1151   <span class="c"># Add PathLengthIDs and values to fingerprint vector...</span>
1152   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValueIDs</span><span class="s">(</span>\<span class="i">@ValueIDs</span><span class="s">)</span><span class="sc">;</span>
1153   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValues</span><span class="s">(</span>\<span class="i">@Values</span><span class="s">)</span><span class="sc">;</span>
1154 
1155   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1156 <span class="s">}</span>
1157 
1158 <span class="c"># Cache  appropriate molecule data...</span>
1159 <span class="c">#</span>
<a name="_SetupMoleculeDataCache-"></a>1160 <span class="k">sub </span><span class="m">_SetupMoleculeDataCache</span> <span class="s">{</span>
1161   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1162 
1163   <span class="c"># Get all atoms...</span>
1164   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1165 
1166   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1167 <span class="s">}</span>
1168 
1169 <span class="c"># Clear cached molecule data...</span>
1170 <span class="c">#</span>
<a name="_ClearMoleculeDataCache-"></a>1171 <span class="k">sub </span><span class="m">_ClearMoleculeDataCache</span> <span class="s">{</span>
1172   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1173 
1174   <span class="c"># Clear atoms...</span>
1175   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1176 
1177   <span class="c"># Clear path atoms..</span>
1178   <span class="i">$This</span>-&gt;{<span class="w">AtomPathsRef</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
1179 
1180   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1181 <span class="s">}</span>
1182 
1183 <span class="c"># Set atomic invariants to use atom identifiers...</span>
1184 <span class="c">#</span>
<a name="SetAtomicInvariantsToUse-"></a>1185 <span class="k">sub </span><span class="m">SetAtomicInvariantsToUse</span> <span class="s">{</span>
1186   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1187   <span class="k">my</span><span class="s">(</span><span class="i">$FirstValue</span><span class="cm">,</span> <span class="i">$TypeOfFirstValue</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">$SpecifiedAtomicInvariant</span><span class="cm">,</span> <span class="i">$AtomicInvariantValue</span><span class="cm">,</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@AtomicInvariantsToUse</span><span class="s">)</span><span class="sc">;</span>
1188 
1189   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
1190     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetAtomicInvariantsToUse: No values specified...&quot;</span><span class="sc">;</span>
1191     <span class="k">return</span><span class="sc">;</span>
1192   <span class="s">}</span>
1193 
1194   <span class="i">$FirstValue</span> = <span class="i">$Values</span>[<span class="n">0</span>]<span class="sc">;</span>
1195   <span class="i">$TypeOfFirstValue</span> = <span class="k">ref</span> <span class="i">$FirstValue</span><span class="sc">;</span>
1196 
1197   <span class="i">@SpecifiedAtomicInvariants</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1198   <span class="i">@AtomicInvariantsToUse</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1199 
1200   <span class="k">if</span> <span class="s">(</span><span class="i">$TypeOfFirstValue</span> =~ <span class="q">/^ARRAY/</span><span class="s">)</span> <span class="s">{</span>
1201     <span class="k">push</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FirstValue</span>}<span class="sc">;</span>
1202   <span class="s">}</span>
1203   <span class="k">else</span> <span class="s">{</span>
1204     <span class="k">push</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@Values</span><span class="sc">;</span>
1205   <span class="s">}</span>
1206 
1207   <span class="c"># Make sure specified AtomicInvariants are valid...</span>
1208   <span class="k">for</span> <span class="i">$SpecifiedAtomicInvariant</span> <span class="s">(</span><span class="i">@SpecifiedAtomicInvariants</span><span class="s">)</span> <span class="s">{</span>
1209     <span class="k">if</span> <span class="s">(</span>!<span class="i">AtomTypes::AtomicInvariantsAtomTypes::IsAtomicInvariantAvailable</span><span class="s">(</span><span class="i">$SpecifiedAtomicInvariant</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1210       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomicInvariantsToUse: Specified atomic invariant, $SpecifiedAtomicInvariant, is not supported...\n &quot;</span><span class="sc">;</span>
1211     <span class="s">}</span>
1212     <span class="i">$AtomicInvariant</span> = <span class="i">$SpecifiedAtomicInvariant</span><span class="sc">;</span>
1213     <span class="k">push</span> <span class="i">@AtomicInvariantsToUse</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="sc">;</span>
1214   <span class="s">}</span>
1215 
1216   <span class="c"># Set atomic invariants to use...</span>
1217   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1218   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}}<span class="cm">,</span> <span class="i">@AtomicInvariantsToUse</span><span class="sc">;</span>
1219 
1220   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1221 <span class="s">}</span>
1222 
1223 <span class="c"># Set functional classes to use for atom identifiers...</span>
1224 <span class="c">#</span>
<a name="SetFunctionalClassesToUse-"></a>1225 <span class="k">sub </span><span class="m">SetFunctionalClassesToUse</span> <span class="s">{</span>
1226   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1227   <span class="k">my</span><span class="s">(</span><span class="i">$FirstValue</span><span class="cm">,</span> <span class="i">$TypeOfFirstValue</span><span class="cm">,</span> <span class="i">$FunctionalClass</span><span class="cm">,</span> <span class="i">$SpecifiedFunctionalClass</span><span class="cm">,</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@FunctionalClassesToUse</span><span class="s">)</span><span class="sc">;</span>
1228 
1229   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
1230     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalClassesToUse: No values specified...&quot;</span><span class="sc">;</span>
1231     <span class="k">return</span><span class="sc">;</span>
1232   <span class="s">}</span>
1233 
1234   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} !~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1235     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalClassesToUse: FunctionalClassesToUse can&#39;t be set for InitialAtomIdentifierType of $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
1236     <span class="k">return</span><span class="sc">;</span>
1237   <span class="s">}</span>
1238 
1239   <span class="i">$FirstValue</span> = <span class="i">$Values</span>[<span class="n">0</span>]<span class="sc">;</span>
1240   <span class="i">$TypeOfFirstValue</span> = <span class="k">ref</span> <span class="i">$FirstValue</span><span class="sc">;</span>
1241 
1242   <span class="i">@SpecifiedFunctionalClasses</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1243   <span class="i">@FunctionalClassesToUse</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1244 
1245   <span class="k">if</span> <span class="s">(</span><span class="i">$TypeOfFirstValue</span> =~ <span class="q">/^ARRAY/</span><span class="s">)</span> <span class="s">{</span>
1246     <span class="k">push</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FirstValue</span>}<span class="sc">;</span>
1247   <span class="s">}</span>
1248   <span class="k">else</span> <span class="s">{</span>
1249     <span class="k">push</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@Values</span><span class="sc">;</span>
1250   <span class="s">}</span>
1251 
1252   <span class="c"># Make sure specified FunctionalClasses are valid...</span>
1253   <span class="k">for</span> <span class="i">$SpecifiedFunctionalClass</span> <span class="s">(</span><span class="i">@SpecifiedFunctionalClasses</span><span class="s">)</span> <span class="s">{</span>
1254     <span class="k">if</span> <span class="s">(</span>!<span class="i">AtomTypes::FunctionalClassAtomTypes::IsFunctionalClassAvailable</span><span class="s">(</span><span class="i">$SpecifiedFunctionalClass</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
1255       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetFunctionalClassesToUse: Specified functional class, $SpecifiedFunctionalClass, is not supported...\n &quot;</span><span class="sc">;</span>
1256     <span class="s">}</span>
1257     <span class="k">push</span> <span class="i">@FunctionalClassesToUse</span><span class="cm">,</span> <span class="i">$SpecifiedFunctionalClass</span><span class="sc">;</span>
1258   <span class="s">}</span>
1259 
1260   <span class="c"># Set functional classes to use...</span>
1261   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1262   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}}<span class="cm">,</span> <span class="i">@FunctionalClassesToUse</span><span class="sc">;</span>
1263 
1264   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1265 <span class="s">}</span>
1266 
1267 <span class="c"># Initialize atom indentifier type information...</span>
1268 <span class="c">#</span>
1269 <span class="c"># Current supported values:</span>
1270 <span class="c">#</span>
1271 <span class="c"># AtomicInvariantsAtomTypes, DREIDINGAtomTypes, EStateAtomTypes, FunctionalClassAtomTypes,</span>
1272 <span class="c"># MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes, TPSAAtomTypes, UFFAtomTypes</span>
1273 <span class="c">#</span>
<a name="_InitializeAtomIdentifierTypeInformation-"></a>1274 <span class="k">sub </span><span class="m">_InitializeAtomIdentifierTypeInformation</span> <span class="s">{</span>
1275   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1276 
1277   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1278     <span class="i">$This</span><span class="i">-&gt;_InitializeAtomicInvariantsAtomTypesInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1279   <span class="s">}</span>
1280   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1281     <span class="i">$This</span><span class="i">-&gt;_InitializeFunctionalClassAtomTypesInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1282   <span class="s">}</span>
1283   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^(DREIDINGAtomTypes|EStateAtomTypes|MMFF94AtomTypes|SLogPAtomTypes|SYBYLAtomTypes|TPSAAtomTypes|UFFAtomTypes)$/i</span><span class="s">)</span> <span class="s">{</span>
1284     <span class="c"># Nothing to do for now...</span>
1285   <span class="s">}</span>
1286   <span class="k">else</span> <span class="s">{</span>
1287     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_InitializeAtomIdentifierTypeInformation: Unknown atom indentifier type $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
1288   <span class="s">}</span>
1289 
1290   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1291 <span class="s">}</span>
1292 
1293 <span class="c"># Initialize atomic invariants atom types to use for generating atom identifiers...</span>
1294 <span class="c">#</span>
1295 <span class="c"># Let:</span>
1296 <span class="c">#   AS = Atom symbol corresponding to element symbol</span>
1297 <span class="c">#</span>
1298 <span class="c">#   X&lt;n&gt;   = Number of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
1299 <span class="c">#   BO&lt;n&gt; = Sum of bond orders to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
1300 <span class="c">#   LBO&lt;n&gt; = Largest bond order of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
1301 <span class="c">#   SB&lt;n&gt; = Number of single bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
1302 <span class="c">#   DB&lt;n&gt; = Number of double bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
1303 <span class="c">#   TB&lt;n&gt; = Number of triple bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
1304 <span class="c">#   H&lt;n&gt;   = Number of implicit and explicit hydrogens for atom</span>
1305 <span class="c">#   Ar     = Aromatic annotation indicating whether atom is aromatic</span>
1306 <span class="c">#   RA     = Ring atom annotation indicating whether atom is a ring</span>
1307 <span class="c">#   FC&lt;+n/-n&gt; = Formal charge assigned to atom</span>
1308 <span class="c">#   MN&lt;n&gt; = Mass number indicating isotope other than most abundant isotope</span>
1309 <span class="c">#   SM&lt;n&gt; = Spin multiplicity of atom. Possible values: 1 (singlet), 2 (doublet) or 3 (triplet)</span>
1310 <span class="c">#</span>
1311 <span class="c"># Then:</span>
1312 <span class="c">#</span>
1313 <span class="c">#   Atom type generated by AtomTypes::AtomicInvariantsAtomTypes class corresponds to:</span>
1314 <span class="c">#</span>
1315 <span class="c">#     AS.X&lt;n&gt;.BO&lt;n&gt;.LBO&lt;n&gt;.&lt;SB&gt;&lt;n&gt;.&lt;DB&gt;&lt;n&gt;.&lt;TB&gt;&lt;n&gt;.H&lt;n&gt;.Ar.RA.FC&lt;+n/-n&gt;.MN&lt;n&gt;.SM&lt;n&gt;</span>
1316 <span class="c">#</span>
1317 <span class="c"># Except for AS which is a required atomic invariant in atom types, all other atomic invariants are</span>
1318 <span class="c"># optional. Default atomic invariants used for AtomID are: AS, X&lt;n&gt;, BO&lt;n&gt;, H&lt;n&gt;, FC&lt;+n/-n&gt;.</span>
1319 <span class="c"># AtomID specification doesn&#39;t include atomic invariants with zero or undefined values.</span>
1320 <span class="c">#</span>
<a name="_InitializeAtomicInvariantsAtomTypesInformation-"></a>1321 <span class="k">sub </span><span class="m">_InitializeAtomicInvariantsAtomTypesInformation</span> <span class="s">{</span>
1322   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1323 
1324   <span class="c"># Default atomic invariants to use for generating atom neighborhood atom IDs: AS, X, BO, H, FC</span>
1325   <span class="c">#</span>
1326   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1327   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="q">&#39;AS&#39;</span><span class="cm">,</span> <span class="q">&#39;X&#39;</span><span class="cm">,</span> <span class="q">&#39;BO&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;FC&#39;</span><span class="s">)</span><span class="sc">;</span>
1328 
1329   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1330 <span class="s">}</span>
1331 
1332 <span class="c"># Initialize functional class atom types, generated by AtomTypes::FunctionalClassAtomTypes</span>
1333 <span class="c"># class, to use for generating atom identifiers...</span>
1334 <span class="c">#</span>
1335 <span class="c"># Let:</span>
1336 <span class="c">#   HBD: HydrogenBondDonor</span>
1337 <span class="c">#   HBA: HydrogenBondAcceptor</span>
1338 <span class="c">#   PI :  PositivelyIonizable</span>
1339 <span class="c">#   NI : NegativelyIonizable</span>
1340 <span class="c">#   Ar : Aromatic</span>
1341 <span class="c">#   Hal : Halogen</span>
1342 <span class="c">#   H : Hydrophobic</span>
1343 <span class="c">#   RA : RingAtom</span>
1344 <span class="c">#   CA : ChainAtom</span>
1345 <span class="c">#</span>
1346 <span class="c"># Then:</span>
1347 <span class="c">#</span>
1348 <span class="c">#   Functiononal class atom type specification for an atom corresponds to:</span>
1349 <span class="c">#</span>
1350 <span class="c">#     Ar.CA.H.HBA.HBD.Hal.NI.PI.RA</span>
1351 <span class="c">#</span>
1352 <span class="c">#   Default functional classes used are: HBD, HBA, PI, NI, Ar, Hal</span>
1353 <span class="c">#</span>
1354 <span class="c">#   FunctionalAtomTypes are assigned using the following definitions [ Ref 60-61, Ref 65-66 ]:</span>
1355 <span class="c">#</span>
1356 <span class="c">#     HydrogenBondDonor: NH, NH2, OH</span>
1357 <span class="c">#     HydrogenBondAcceptor: N[!H], O</span>
1358 <span class="c">#     PositivelyIonizable: +, NH2</span>
1359 <span class="c">#     NegativelyIonizable: -, C(=O)OH, S(=O)OH, P(=O)OH</span>
1360 <span class="c">#</span>
<a name="_InitializeFunctionalClassAtomTypesInformation-"></a>1361 <span class="k">sub </span><span class="m">_InitializeFunctionalClassAtomTypesInformation</span> <span class="s">{</span>
1362   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1363 
1364   <span class="c"># Default functional class atom typess to use for generating atom identifiers</span>
1365   <span class="c"># are: HBD, HBA, PI, NI, Ar, Hal</span>
1366   <span class="c">#</span>
1367   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1368   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="q">&#39;HBD&#39;</span><span class="cm">,</span> <span class="q">&#39;HBA&#39;</span><span class="cm">,</span> <span class="q">&#39;PI&#39;</span><span class="cm">,</span> <span class="q">&#39;NI&#39;</span><span class="cm">,</span> <span class="q">&#39;Ar&#39;</span><span class="cm">,</span> <span class="q">&#39;Hal&#39;</span><span class="s">)</span><span class="sc">;</span>
1369 
1370   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
1371 <span class="s">}</span>
1372 
1373 <span class="c"># Return a string containg data for PathLengthFingerprints object...</span>
1374 <span class="c">#</span>
<a name="StringifyPathLengthFingerprints-"></a>1375 <span class="k">sub </span><span class="m">StringifyPathLengthFingerprints</span> <span class="s">{</span>
1376   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1377   <span class="k">my</span><span class="s">(</span><span class="i">$PathLengthsFingerprintsString</span><span class="s">)</span><span class="sc">;</span>
1378 
1379   <span class="c"># Type of fingerprint...</span>
1380   <span class="i">$PathLengthsFingerprintsString</span> = <span class="q">&quot;Fingerprint type: $This-&gt;{Type}; AtomIdentifierType: $This-&gt;{AtomIdentifierType}&quot;</span><span class="sc">;</span>
1381 
1382   <span class="c"># Path length...</span>
1383   <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; MinPathLength: $This-&gt;{MinLength}; MaxPathLength: $This-&gt;{MaxLength}&quot;</span><span class="sc">;</span>
1384 
1385   <span class="c"># Fingerprint generation control...</span>
1386   <span class="k">my</span><span class="s">(</span><span class="i">$AllowSharedBonds</span><span class="cm">,</span> <span class="i">$AllowRings</span><span class="cm">,</span> <span class="i">$UseBondSymbols</span><span class="cm">,</span> <span class="i">$UseUniquePaths</span><span class="s">)</span><span class="sc">;</span>
1387 
1388   <span class="i">$AllowSharedBonds</span> = <span class="i">$This</span>-&gt;{<span class="w">AllowSharedBonds</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="sc">;</span>
1389   <span class="i">$AllowRings</span> = <span class="i">$This</span>-&gt;{<span class="w">AllowRings</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="sc">;</span>
1390   <span class="i">$UseBondSymbols</span> = <span class="i">$This</span>-&gt;{<span class="w">UseBondSymbols</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="sc">;</span>
1391   <span class="i">$UseUniquePaths</span> = <span class="i">$This</span>-&gt;{<span class="w">UseBondSymbols</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="sc">;</span>
1392 
1393   <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; UseUniquePaths: $UseUniquePaths; AllowSharedBonds: $AllowSharedBonds; AllowRings: $AllowRings; UseBondSymbols: $UseBondSymbols&quot;</span><span class="sc">;</span>
1394 
1395   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1396     <span class="k">my</span><span class="s">(</span><span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="i">@AtomicInvariantsOrder</span><span class="cm">,</span> <span class="i">%AvailableAtomicInvariants</span><span class="s">)</span><span class="sc">;</span>
1397 
1398     <span class="i">@AtomicInvariantsOrder</span> = <span class="i">AtomTypes::AtomicInvariantsAtomTypes::GetAtomicInvariantsOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1399     <span class="i">%AvailableAtomicInvariants</span> = <span class="i">AtomTypes::AtomicInvariantsAtomTypes::GetAvailableAtomicInvariants</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1400 
1401     <span class="k">for</span> <span class="i">$AtomicInvariant</span> <span class="s">(</span><span class="i">@AtomicInvariantsOrder</span><span class="s">)</span> <span class="s">{</span>
1402       <span class="k">push</span> <span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="q">&quot;$AtomicInvariant: $AvailableAtomicInvariants{$AtomicInvariant}&quot;</span><span class="sc">;</span>
1403     <span class="s">}</span>
1404 
1405     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; AtomicInvariantsToUse: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}}<span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1406     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; AtomicInvariantsOrder: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomicInvariantsOrder</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1407     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; AvailableAtomicInvariants: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1408   <span class="s">}</span>
1409   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
1410     <span class="k">my</span><span class="s">(</span><span class="i">$FunctionalClass</span><span class="cm">,</span> <span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="i">@FunctionalClassesOrder</span><span class="cm">,</span> <span class="i">%AvailableFunctionalClasses</span><span class="s">)</span><span class="sc">;</span>
1411 
1412     <span class="i">@FunctionalClassesOrder</span> = <span class="i">AtomTypes::FunctionalClassAtomTypes::GetFunctionalClassesOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1413     <span class="i">%AvailableFunctionalClasses</span> = <span class="i">AtomTypes::FunctionalClassAtomTypes::GetAvailableFunctionalClasses</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1414 
1415     <span class="k">for</span> <span class="i">$FunctionalClass</span> <span class="s">(</span><span class="i">@FunctionalClassesOrder</span><span class="s">)</span> <span class="s">{</span>
1416       <span class="k">push</span> <span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="q">&quot;$FunctionalClass: $AvailableFunctionalClasses{$FunctionalClass}&quot;</span><span class="sc">;</span>
1417     <span class="s">}</span>
1418 
1419     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; FunctionalClassesToUse: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}}<span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1420     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; FunctionalClassesOrder: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@FunctionalClassesOrder</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1421     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; AvailableFunctionalClasses: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1422   <span class="s">}</span>
1423 
1424   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^PathLengthBits$/i</span><span class="s">)</span> <span class="s">{</span>
1425     <span class="c"># Size...</span>
1426     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; Size: $This-&gt;{Size}; MinSize: $This-&gt;{MinSize}; MaxSize: $This-&gt;{MaxSize}&quot;</span><span class="sc">;</span>
1427 
1428     <span class="c"># NumOfBitsToSetPerPath...</span>
1429     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; NumOfBitsToSetPerPath: $This-&gt;{NumOfBitsToSetPerPath}&quot;</span><span class="sc">;</span>
1430 
1431     <span class="c"># Fingerprint bit density and num of bits set...</span>
1432     <span class="k">my</span><span class="s">(</span><span class="i">$NumOfSetBits</span><span class="cm">,</span> <span class="i">$BitDensity</span><span class="s">)</span><span class="sc">;</span>
1433     <span class="i">$NumOfSetBits</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVector</span>}<span class="i">-&gt;GetNumOfSetBits</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1434     <span class="i">$BitDensity</span> = <span class="i">$This</span>-&gt;{<span class="w">FingerprintsBitVector</span>}<span class="i">-&gt;GetFingerprintsBitDensity</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1435     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; NumOfOnBits: $NumOfSetBits; BitDensity: $BitDensity&quot;</span><span class="sc">;</span>
1436 
1437     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; FingerprintsBitVector: &lt; $This-&gt;{FingerprintsBitVector} &gt;&quot;</span><span class="sc">;</span>
1438   <span class="s">}</span>
1439   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Type</span>} =~ <span class="q">/^PathLengthCount$/i</span><span class="s">)</span> <span class="s">{</span>
1440     <span class="i">$PathLengthsFingerprintsString</span> .= <span class="q">&quot;; FingerprintsVector: &lt; $This-&gt;{FingerprintsVector} &gt;&quot;</span><span class="sc">;</span>
1441   <span class="s">}</span>
1442 
1443   <span class="k">return</span> <span class="i">$PathLengthsFingerprintsString</span><span class="sc">;</span>
1444 <span class="s">}</span>
1445 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
