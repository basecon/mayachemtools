<html>
<head>
<title>MayaChemTools:Code:AtomTypes/TPSAAtomTypes.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-AtomTypes::TPSAAtomTypes-"></a>   1 <span class="k">package </span><span class="i">AtomTypes::TPSAAtomTypes</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># File: TPSAAtomTypes.pm</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2020 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">Scalar::Util</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">AtomTypes::AtomTypes</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  33 
  34 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  35 
  36 <span class="i">@ISA</span> = <span class="q">qw(AtomTypes::AtomTypes Exporter)</span><span class="sc">;</span>
  37 <span class="i">@EXPORT</span> = <span class="q">qw(GetTPSAAtomTypesData GetAllPossibleTPSAAtomTypes)</span><span class="sc">;</span>
  38 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  39 
  40 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  41 
  42 <span class="c"># Setup class variables...</span>
  43 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="cm">,</span> <span class="i">%TPSAAtomTypesDataMap</span><span class="s">)</span><span class="sc">;</span>
  44 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  45 
  46 <span class="c"># Overload Perl functions...</span>
  47 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyTPSAAtomTypes&#39;</span><span class="sc">;</span>
  48 
  49 <span class="c"># Class constructor...</span>
<a name="new-"></a>  50 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  51   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  52 
  53   <span class="c"># Initialize object...</span>
  54   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  55   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  56   <span class="i">$This</span><span class="i">-&gt;_InitializeTPSAAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  57 
  58   <span class="i">$This</span><span class="i">-&gt;_InitializeTPSAAtomTypesProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  59 
  60   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  61 <span class="s">}</span>
  62 
  63 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a>  64 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
  65   <span class="c">#Class name...</span>
  66   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
  67 
  68   <span class="c"># Initialize the data hash. It&#39;ll be loaded on demand later...</span>
  69   <span class="i">%TPSAAtomTypesDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  70 <span class="s">}</span>
  71 
  72 <span class="c"># Initialize object data...</span>
  73 <span class="c">#</span>
<a name="_InitializeTPSAAtomTypes-"></a>  74 <span class="k">sub </span><span class="m">_InitializeTPSAAtomTypes</span> <span class="s">{</span>
  75   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  76 
  77   <span class="c"># Type of AtomTypes...</span>
  78   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;TPSA&#39;</span><span class="sc">;</span>
  79 
  80   <span class="c"># Besides polar atoms - N, O, P, S - no TPSA atom types are assigned to any other</span>
  81   <span class="c"># atoms.</span>
  82   <span class="c">#</span>
  83   <span class="c"># By default, TPSA atom types are not assigned to Phosphorus and Sulfur atoms.</span>
  84   <span class="c">#</span>
  85   <span class="i">$This</span>-&gt;{<span class="w">IgnorePhosphorus</span>} = <span class="n">0</span><span class="sc">;</span>
  86   <span class="i">$This</span>-&gt;{<span class="w">IgnoreSulfur</span>} = <span class="n">0</span><span class="sc">;</span>
  87 
  88   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  89 <span class="s">}</span>
  90 
  91 <span class="c"># Initialize object properties...</span>
  92 <span class="c">#</span>
<a name="_InitializeTPSAAtomTypesProperties-"></a>  93 <span class="k">sub </span><span class="m">_InitializeTPSAAtomTypesProperties</span> <span class="s">{</span>
  94   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  95 
  96   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
  97   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
  98     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
  99     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 100   <span class="s">}</span>
 101 
 102   <span class="c"># Make sure molecule object was specified...</span>
 103   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 104     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 105   <span class="s">}</span>
 106 
 107   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 108 <span class="s">}</span>
 109 
 110 <span class="c"># Get TPSA atom types and associated data loaded from TPSA data file as</span>
 111 <span class="c"># a reference to hash with the following hash data format:</span>
 112 <span class="c">#</span>
 113 <span class="c"># @{$TPSAAtomTypesDataMap{AtomTypes}} - Array of all possible atom types for all atoms</span>
 114 <span class="c"># @{$TPSAAtomTypesDataMap-&gt;{ColLabels}} - Array of column labels</span>
 115 <span class="c"># %{$TPSAAtomTypesDataMap-&gt;{DataCol&lt;Num&gt;}} - Hash keys pair: &lt;DataCol&lt;Num&gt;, AtomType&gt;</span>
 116 <span class="c">#</span>
 117 <span class="c"># This functionality can be either invoked as a class function or an</span>
 118 <span class="c"># object method.</span>
 119 <span class="c">#</span>
<a name="GetTPSAAtomTypesData-"></a> 120 <span class="k">sub </span><span class="m">GetTPSAAtomTypesData</span> <span class="s">{</span>
 121 
 122   <span class="c"># Make sure data is loaded...</span>
 123   <span class="i">_CheckAndLoadTPSAAtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 124 
 125   <span class="k">return</span> \<span class="i">%TPSAAtomTypesDataMap</span><span class="sc">;</span>
 126 <span class="s">}</span>
 127 
 128 <span class="c"># Get all possible TPSA atom types atoms as an array reference...</span>
 129 <span class="c">#</span>
 130 <span class="c"># This functionality can be either invoked as a class function or an</span>
 131 <span class="c"># object method.</span>
 132 <span class="c">#</span>
<a name="GetAllPossibleTPSAAtomTypes-"></a> 133 <span class="k">sub </span><span class="m">GetAllPossibleTPSAAtomTypes</span> <span class="s">{</span>
 134   <span class="k">return</span> <span class="i">_GetAllPossibleTPSAAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 135 <span class="s">}</span>
 136 
 137 <span class="c"># Are all atoms types successfully assigned?</span>
 138 <span class="c">#</span>
 139 <span class="c"># Notes:</span>
 140 <span class="c">#   . Dynamic checking of atom types assignment for atoms eliminates the need</span>
 141 <span class="c">#     to check and synchronize valid atom types during SetAtomType.</span>
 142 <span class="c">#   . Base class method is overrided to check atom assignment to nitrogen and</span>
 143 <span class="c">#     oxygen atom with optional check for phosphorus and sulfur atoms.</span>
 144 <span class="c">#</span>
<a name="IsAtomTypesAssignmentSuccessful-"></a> 145 <span class="k">sub </span><span class="m">IsAtomTypesAssignmentSuccessful</span> <span class="s">{</span>
 146   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 147   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 148 
 149   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 150     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span> || <span class="i">$Atom</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span> ||
 151         <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span>-&gt;{<span class="w">IgnorePhosphorus</span>}<span class="s">)</span> ||
 152         <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span>-&gt;{<span class="w">IgnoreSulfur</span>}<span class="s">)</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 153       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 154     <span class="s">}</span>
 155     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 156     <span class="k">if</span> <span class="s">(</span><span class="i">$AtomType</span> =~ <span class="q">/^None$/i</span><span class="s">)</span> <span class="s">{</span>
 157       <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 158     <span class="s">}</span>
 159   <span class="s">}</span>
 160 
 161   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 162 <span class="s">}</span>
 163 
 164 <span class="c"># Get all possible TPSA atom types as an array reference...</span>
 165 <span class="c">#</span>
<a name="_GetAllPossibleTPSAAtomTypes-"></a> 166 <span class="k">sub </span><span class="m">_GetAllPossibleTPSAAtomTypes</span> <span class="s">{</span>
 167   <span class="k">my</span><span class="s">(</span><span class="i">$TPSAAtomTypesDataRef</span><span class="s">)</span><span class="sc">;</span>
 168 
 169   <span class="i">$TPSAAtomTypesDataRef</span> = <span class="i">GetTPSAAtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 170 
 171   <span class="k">return</span> \<span class="i">@</span>{<span class="i">$TPSAAtomTypesDataRef</span>-&gt;{<span class="w">AtomTypes</span>}}<span class="sc">;</span>
 172 <span class="s">}</span>
 173 
 174 <span class="c"># Assign Topological Polar Surface Area (TPSA) atom types [ Ref 90-91 ] to Nitrogen and Oxygen</span>
 175 <span class="c"># atoms with optional assignment to Phosphorus and Sulfur atoms.</span>
 176 <span class="c">#</span>
 177 <span class="c"># Notes:</span>
 178 <span class="c">#     o Number of atom type symbols for:</span>
 179 <span class="c">#         o N: 27</span>
 180 <span class="c">#         o O: 7</span>
 181 <span class="c">#         o P: 5</span>
 182 <span class="c">#         o S: 8</span>
 183 <span class="c">#</span>
<a name="AssignAtomTypes-"></a> 184 <span class="k">sub </span><span class="m">AssignAtomTypes</span> <span class="s">{</span>
 185   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 186   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 187 
 188   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 189     <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 190     <span class="i">$This</span><span class="i">-&gt;SetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 191   <span class="s">}</span>
 192 
 193   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 194 <span class="s">}</span>
 195 
 196 <span class="c"># Get TPSA atom type for atom...</span>
 197 <span class="c">#</span>
<a name="_GetAtomType-"></a> 198 <span class="k">sub </span><span class="m">_GetAtomType</span> <span class="s">{</span>
 199   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 200   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 201 
 202   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 203 
 204   <span class="j">ATOM:</span> <span class="s">{</span>
 205     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsNitrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 206       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 207       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 208     <span class="s">}</span>
 209 
 210     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsOxygen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 211       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForOxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 212       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 213     <span class="s">}</span>
 214 
 215     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsPhosphorus</span><span class="s">(</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span>-&gt;{<span class="w">IgnorePhosphorus</span>}<span class="s">)</span> <span class="s">{</span>
 216       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForPhosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 217       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 218     <span class="s">}</span>
 219 
 220     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsSulfur</span><span class="s">(</span><span class="s">)</span> &amp;&amp; !<span class="i">$This</span>-&gt;{<span class="w">IgnoreSulfur</span>}<span class="s">)</span> <span class="s">{</span>
 221       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForSulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 222       <span class="k">last</span> <span class="j">ATOM</span><span class="sc">;</span>
 223     <span class="s">}</span>
 224     <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 225   <span class="s">}</span>
 226 
 227   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 228 <span class="s">}</span>
 229 
 230 
 231 <span class="c"># Get TPSA atom type for Nitrogen atom...</span>
 232 <span class="c">#</span>
 233 <span class="c"># 27 AtomTypeSymbols for element N:</span>
 234 <span class="c">#</span>
 235 <span class="c"># AtomTypeSymbol - SMARTS - Comments</span>
 236 <span class="c"># N1 - &#39;[N](-*)(-*)-*&#39;</span>
 237 <span class="c"># N2 - &#39;[N](-*)=*&#39;</span>
 238 <span class="c"># N3 - &#39;[N]#*&#39;</span>
 239 <span class="c"># N4 - &#39;[N](-*)(=*)=*&#39; - As in nitro group</span>
 240 <span class="c"># N5 - &#39;[N](=*)#*&#39; - Middle nitrogen in azide group</span>
 241 <span class="c"># N6 - &#39;[N]1(-*)-*-*-1&#39; - Atom in a 3 membered ring</span>
 242 <span class="c"># N7 - &#39;[NH](-*)-*&#39;</span>
 243 <span class="c"># N8 - &#39;[NH]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 244 <span class="c"># N9 - &#39;[NH]=*&#39;</span>
 245 <span class="c"># N10 - &#39;[NH2]-*&#39;</span>
 246 <span class="c"># N11 - &#39;[N+](-*)(-*)(-*)-*&#39;</span>
 247 <span class="c"># N12 - &#39;[N+](-*)(-*)=*&#39;</span>
 248 <span class="c"># N13 - &#39;[N+](-*)#*&#39; - Nitrogen in isocyano group</span>
 249 <span class="c"># N14 - &#39;[NH+](-*)(-*)-*&#39;</span>
 250 <span class="c"># N15 - &#39;[NH+](-*)=*&#39;</span>
 251 <span class="c"># N16 - &#39;[NH2+](-*)-*&#39;</span>
 252 <span class="c"># N17 - &#39;[NH2+]=*&#39;</span>
 253 <span class="c"># N18 - &#39;[NH3+]-*&#39;</span>
 254 <span class="c"># N19 - &#39;[n](:*):*&#39;</span>
 255 <span class="c"># N20 - &#39;[n](:*)(:*):*&#39;</span>
 256 <span class="c"># N21 - &#39;[n](-*)(:*):*&#39;</span>
 257 <span class="c"># N22 - &#39;[n](=*)(:*):*&#39; - As in pyridine N-oxide</span>
 258 <span class="c"># N23 - &#39;[nH](:*):*&#39;</span>
 259 <span class="c"># N24 - &#39;[n+](:*)(:*):*&#39;</span>
 260 <span class="c"># N25 - &#39;[n+](-*)(:*):*&#39;</span>
 261 <span class="c"># N26 - &#39;[nH+](:*):*&#39;</span>
 262 <span class="c"># N - &#39;[#7]&#39; - Any other Nitrogen; Contribution: 30.5 - X*8.2 + H*1.5 or 0.0 for negative value</span>
 263 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogen-"></a> 264 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogen</span> <span class="s">{</span>
 265   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 266   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span><span class="sc">;</span>
 267 
 268   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 269 
 270   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="s">(</span><span class="q">&#39;0&#39;</span><span class="s">)</span> x <span class="n">2</span><span class="sc">;</span>
 271 
 272   <span class="s">(</span><span class="i">$NumOfSigmaBonds</span><span class="cm">,</span> <span class="i">$NumOfPiBonds</span><span class="s">)</span> = <span class="i">$Atom</span><span class="i">-&gt;GetNumOfSigmaAndPiBondsToNonHydrogenAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 273   <span class="i">$NumOfSigmaBonds</span> += <span class="i">$Atom</span><span class="i">-&gt;GetAtomicInvariantValue</span><span class="s">(</span><span class="q">&#39;H&#39;</span><span class="s">)</span><span class="sc">;</span>
 274 
 275   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 276 
 277     <span class="c"># Aromatic Nitrogens...</span>
 278     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsAromatic</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 279       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForAromaticNitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 280       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 281     <span class="s">}</span>
 282 
 283     <span class="c"># Only single bonds...</span>
 284     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">0</span><span class="s">)</span> <span class="s">{</span>
 285       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithOnlySigmaBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 286       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 287     <span class="s">}</span>
 288 
 289     <span class="c"># One double bond...</span>
 290     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 291       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithOnePiBond</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 292       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 293     <span class="s">}</span>
 294 
 295     <span class="c"># One triple bond or two double bonds...</span>
 296     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 297       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithTwoPiBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 298       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 299     <span class="s">}</span>
 300 
 301     <span class="c"># One triple bond and a double bond...</span>
 302     <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfPiBonds</span> == <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
 303       <span class="i">$AtomType</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTypeForNitrogenWithThreePiBonds</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 304       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 305     <span class="s">}</span>
 306 
 307     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 308   <span class="s">}</span>
 309   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 310 <span class="s">}</span>
 311 
 312 <span class="c"># Get TPSA atom type for Oxygen atom...</span>
 313 <span class="c">#</span>
 314 <span class="c"># AtomTypeSymbol - SMARTS - Comments</span>
 315 <span class="c"># O1 - &#39;[O](-*)-*&#39;</span>
 316 <span class="c"># O2 - &#39;[O]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 317 <span class="c"># O3 - &#39;[O]=*&#39;</span>
 318 <span class="c"># O4 - &#39;[OH]-*&#39;</span>
 319 <span class="c"># O5 - &#39;[O-]-*&#39;</span>
 320 <span class="c"># O6 - &#39;[o](:*):*&#39;</span>
 321 <span class="c"># O - &#39;[#8]&#39; - Any other Oxygen; Contribution: 28.5 - X*8.6 + H*1.5 or 0.0 for negative value</span>
 322 <span class="c">#</span>
<a name="_GetAtomTypeForOxygen-"></a> 323 <span class="k">sub </span><span class="m">_GetAtomTypeForOxygen</span> <span class="s">{</span>
 324   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 325   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 326 
 327   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 328 
 329   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 330 
 331     <span class="c"># O6 - &#39;[o](:*):*&#39;</span>
 332     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO6Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 333       <span class="i">$AtomType</span> = <span class="q">&#39;O6&#39;</span><span class="sc">;</span>
 334       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 335     <span class="s">}</span>
 336 
 337     <span class="c"># O3 - &#39;[O]=*&#39;</span>
 338     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO3Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 339       <span class="i">$AtomType</span> = <span class="q">&#39;O3&#39;</span><span class="sc">;</span>
 340       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 341     <span class="s">}</span>
 342 
 343     <span class="c"># O4 - &#39;[OH]-*&#39;</span>
 344     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO4Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 345       <span class="i">$AtomType</span> = <span class="q">&#39;O4&#39;</span><span class="sc">;</span>
 346       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 347     <span class="s">}</span>
 348 
 349     <span class="c"># O5 - &#39;[O-]-*&#39;</span>
 350     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO5Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 351       <span class="i">$AtomType</span> = <span class="q">&#39;O5&#39;</span><span class="sc">;</span>
 352       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 353     <span class="s">}</span>
 354 
 355     <span class="c"># O2 - &#39;[O]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 356     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO2Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 357       <span class="i">$AtomType</span> = <span class="q">&#39;O2&#39;</span><span class="sc">;</span>
 358       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 359     <span class="s">}</span>
 360 
 361     <span class="c"># O1 - &#39;[O](-*)-*&#39;</span>
 362     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsO1Oxygen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 363       <span class="i">$AtomType</span> = <span class="q">&#39;O1&#39;</span><span class="sc">;</span>
 364       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 365     <span class="s">}</span>
 366 
 367     <span class="c"># Any other Oxygen...</span>
 368     <span class="i">$AtomType</span> = <span class="q">&#39;O&#39;</span><span class="sc">;</span>
 369   <span class="s">}</span>
 370 
 371   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 372 <span class="s">}</span>
 373 
 374 <span class="c"># Get TPSA atom type for Phosphorus atom...</span>
 375 <span class="c">#</span>
 376 <span class="c"># 4 AtomTypeSymbols for element P:</span>
 377 <span class="c">#</span>
 378 <span class="c"># AtomTypeSymbol - SMARTS - Comments</span>
 379 <span class="c"># P1 - &#39;[P](-*)(-*)-*&#39;</span>
 380 <span class="c"># P2 - &#39;[P](-*)=*&#39;</span>
 381 <span class="c"># P3 - &#39;[P](-*)(-*)(-*)=*&#39;</span>
 382 <span class="c"># P4 - &#39;[PH](-*)(-*)=*&#39;</span>
 383 <span class="c"># P - &#39;[#15]&#39; - Any other Sulfur</span>
 384 <span class="c">#</span>
<a name="_GetAtomTypeForPhosphorus-"></a> 385 <span class="k">sub </span><span class="m">_GetAtomTypeForPhosphorus</span> <span class="s">{</span>
 386   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 387   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 388 
 389   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 390 
 391   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 392 
 393     <span class="c"># P1 - &#39;[P](-*)(-*)-*&#39;</span>
 394     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsP1Phosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 395       <span class="i">$AtomType</span> = <span class="q">&#39;P1&#39;</span><span class="sc">;</span>
 396       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 397     <span class="s">}</span>
 398 
 399     <span class="c"># P2 - &#39;[P](-*)=*&#39;</span>
 400     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsP2Phosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 401       <span class="i">$AtomType</span> = <span class="q">&#39;P2&#39;</span><span class="sc">;</span>
 402       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 403     <span class="s">}</span>
 404 
 405     <span class="c"># P3 - &#39;[P](-*)(-*)(-*)=*&#39;</span>
 406     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsP3Phosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 407       <span class="i">$AtomType</span> = <span class="q">&#39;P3&#39;</span><span class="sc">;</span>
 408       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 409     <span class="s">}</span>
 410 
 411     <span class="c"># P4 - &#39;[PH](-*)(-*)=*&#39;</span>
 412     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsP4Phosphorus</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 413       <span class="i">$AtomType</span> = <span class="q">&#39;P4&#39;</span><span class="sc">;</span>
 414       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 415     <span class="s">}</span>
 416 
 417     <span class="c"># Any other Phosphorus...</span>
 418     <span class="i">$AtomType</span> = <span class="q">&#39;P&#39;</span><span class="sc">;</span>
 419   <span class="s">}</span>
 420 
 421   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 422 <span class="s">}</span>
 423 
 424 <span class="c"># Get TPSA atom type for Sulfur atom...</span>
 425 <span class="c">#</span>
 426 <span class="c"># 7 AtomTypeSymbols for element S:</span>
 427 <span class="c">#</span>
 428 <span class="c"># AtomTypeSymbol - SMARTS - Comments</span>
 429 <span class="c"># S1 - &#39;[S](-*)-*&#39;</span>
 430 <span class="c"># S2 - &#39;[S]=*&#39;</span>
 431 <span class="c"># S3 - &#39;[S](-*)(-*)=*&#39;</span>
 432 <span class="c"># S4 - &#39;[S](-*)(-*)(=*)=*&#39;</span>
 433 <span class="c"># S5 - &#39;[SH]-*&#39;</span>
 434 <span class="c"># S6 - &#39;[s](:*):*&#39;</span>
 435 <span class="c"># S - &#39;[#16]&#39; - Any other Phosphorus</span>
 436 <span class="c">#</span>
<a name="_GetAtomTypeForSulfur-"></a> 437 <span class="k">sub </span><span class="m">_GetAtomTypeForSulfur</span> <span class="s">{</span>
 438   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 439   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 440 
 441   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 442 
 443   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 444 
 445     <span class="c"># S6 - &#39;[s](:*):*&#39;</span>
 446     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS6Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 447       <span class="i">$AtomType</span> = <span class="q">&#39;S6&#39;</span><span class="sc">;</span>
 448       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 449     <span class="s">}</span>
 450 
 451     <span class="c"># S4 - &#39;[S](-*)(-*)(=*)=*&#39;</span>
 452     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS4Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 453       <span class="i">$AtomType</span> = <span class="q">&#39;S4&#39;</span><span class="sc">;</span>
 454       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 455     <span class="s">}</span>
 456 
 457     <span class="c"># S1 - &#39;[S](-*)-*&#39;</span>
 458     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS1Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 459       <span class="i">$AtomType</span> = <span class="q">&#39;S1&#39;</span><span class="sc">;</span>
 460       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 461     <span class="s">}</span>
 462 
 463     <span class="c"># S2 - &#39;[S]=*&#39;</span>
 464     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS2Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 465       <span class="i">$AtomType</span> = <span class="q">&#39;S2&#39;</span><span class="sc">;</span>
 466       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 467     <span class="s">}</span>
 468 
 469     <span class="c"># S3 - &#39;[S](-*)(-*)=*&#39;</span>
 470     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS3Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 471       <span class="i">$AtomType</span> = <span class="q">&#39;S3&#39;</span><span class="sc">;</span>
 472       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 473     <span class="s">}</span>
 474 
 475     <span class="c"># S5 - &#39;[SH]-*&#39;</span>
 476     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsS5Sulfur</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 477       <span class="i">$AtomType</span> = <span class="q">&#39;S5&#39;</span><span class="sc">;</span>
 478       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 479     <span class="s">}</span>
 480 
 481     <span class="c"># Any other Sulfur...</span>
 482     <span class="i">$AtomType</span> = <span class="q">&#39;S&#39;</span><span class="sc">;</span>
 483   <span class="s">}</span>
 484 
 485   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 486 <span class="s">}</span>
 487 
 488 <span class="c"># Get TPSA atom type for aromatic Nitrogen...</span>
 489 <span class="c">#</span>
<a name="_GetAtomTypeForAromaticNitrogen-"></a> 490 <span class="k">sub </span><span class="m">_GetAtomTypeForAromaticNitrogen</span> <span class="s">{</span>
 491   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 492   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 493 
 494   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 495 
 496   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 497 
 498     <span class="c"># N19 - &#39;[n](:*):*&#39;</span>
 499     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN19Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 500       <span class="i">$AtomType</span> = <span class="q">&#39;N19&#39;</span><span class="sc">;</span>
 501       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 502     <span class="s">}</span>
 503 
 504     <span class="c"># N20 - &#39;[n](:*)(:*):*&#39;</span>
 505     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN20Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 506       <span class="i">$AtomType</span> = <span class="q">&#39;N20&#39;</span><span class="sc">;</span>
 507       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 508     <span class="s">}</span>
 509 
 510     <span class="c"># N21 - &#39;[n](-*)(:*):*&#39;</span>
 511     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN21Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 512       <span class="i">$AtomType</span> = <span class="q">&#39;N21&#39;</span><span class="sc">;</span>
 513       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 514     <span class="s">}</span>
 515 
 516     <span class="c"># N22 - &#39;[n](=*)(:*):*&#39; - As in pyridine N-oxide</span>
 517     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN22Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 518       <span class="i">$AtomType</span> = <span class="q">&#39;N22&#39;</span><span class="sc">;</span>
 519       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 520     <span class="s">}</span>
 521 
 522     <span class="c"># N23 - &#39;[nH](:*):*&#39;</span>
 523     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN23Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 524       <span class="i">$AtomType</span> = <span class="q">&#39;N23&#39;</span><span class="sc">;</span>
 525       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 526     <span class="s">}</span>
 527 
 528     <span class="c"># N24 - &#39;[n+](:*)(:*):*&#39;</span>
 529     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN24Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 530       <span class="i">$AtomType</span> = <span class="q">&#39;N24&#39;</span><span class="sc">;</span>
 531       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 532     <span class="s">}</span>
 533 
 534     <span class="c"># N25 - &#39;[n+](-*)(:*):*&#39;</span>
 535     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN25Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 536       <span class="i">$AtomType</span> = <span class="q">&#39;N25&#39;</span><span class="sc">;</span>
 537       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 538     <span class="s">}</span>
 539 
 540     <span class="c"># N26 - &#39;[nH+](:*):*&#39;</span>
 541     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN26Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 542       <span class="i">$AtomType</span> = <span class="q">&#39;N26&#39;</span><span class="sc">;</span>
 543       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 544     <span class="s">}</span>
 545 
 546     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 547   <span class="s">}</span>
 548 
 549   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 550 <span class="s">}</span>
 551 
 552 <span class="c"># Get TPSA atom type for Nitrogen with only sigma bonds...</span>
 553 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithOnlySigmaBonds-"></a> 554 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithOnlySigmaBonds</span> <span class="s">{</span>
 555   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 556   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 557 
 558   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 559 
 560   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 561 
 562    <span class="c"># N6 - &#39;[N]1(-*)-*-*-1&#39; - Atom in a 3 membered ring</span>
 563     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN6Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 564       <span class="i">$AtomType</span> = <span class="q">&#39;N6&#39;</span><span class="sc">;</span>
 565       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 566     <span class="s">}</span>
 567 
 568     <span class="c"># N1 - &#39;[N](-*)(-*)-*&#39;</span>
 569     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN1Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 570       <span class="i">$AtomType</span> = <span class="q">&#39;N1&#39;</span><span class="sc">;</span>
 571       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 572     <span class="s">}</span>
 573 
 574     <span class="c"># N8 - &#39;[NH]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 575     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN8Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 576       <span class="i">$AtomType</span> = <span class="q">&#39;N8&#39;</span><span class="sc">;</span>
 577       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 578     <span class="s">}</span>
 579 
 580     <span class="c"># N7 - &#39;[NH](-*)-*&#39;</span>
 581     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN7Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 582       <span class="i">$AtomType</span> = <span class="q">&#39;N7&#39;</span><span class="sc">;</span>
 583       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 584     <span class="s">}</span>
 585 
 586     <span class="c"># N10 - &#39;[NH2]-*&#39;</span>
 587     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN10Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 588       <span class="i">$AtomType</span> = <span class="q">&#39;N10&#39;</span><span class="sc">;</span>
 589       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 590     <span class="s">}</span>
 591 
 592     <span class="c"># N11 - &#39;[N+](-*)(-*)(-*)-*&#39;</span>
 593     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN11Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 594       <span class="i">$AtomType</span> = <span class="q">&#39;N11&#39;</span><span class="sc">;</span>
 595       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 596     <span class="s">}</span>
 597 
 598     <span class="c"># N14 - &#39;[NH+](-*)(-*)-*&#39;</span>
 599     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN14Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 600       <span class="i">$AtomType</span> = <span class="q">&#39;N14&#39;</span><span class="sc">;</span>
 601       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 602     <span class="s">}</span>
 603 
 604     <span class="c"># N16 - &#39;[NH2+](-*)-*&#39;</span>
 605     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN16Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 606       <span class="i">$AtomType</span> = <span class="q">&#39;N16&#39;</span><span class="sc">;</span>
 607       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 608     <span class="s">}</span>
 609 
 610     <span class="c"># N18 - &#39;[NH3+]-*&#39;</span>
 611     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN18Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 612       <span class="i">$AtomType</span> = <span class="q">&#39;N18&#39;</span><span class="sc">;</span>
 613       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 614     <span class="s">}</span>
 615 
 616     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 617   <span class="s">}</span>
 618 
 619   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 620 <span class="s">}</span>
 621 
 622 <span class="c"># Get TPSA atom type for Nitrogen with one pi bonds...</span>
 623 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithOnePiBond-"></a> 624 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithOnePiBond</span> <span class="s">{</span>
 625   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 626   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 627 
 628   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 629 
 630   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 631 
 632     <span class="c"># N2 - &#39;[N](-*)=*&#39;</span>
 633     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN2Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 634       <span class="i">$AtomType</span> = <span class="q">&#39;N2&#39;</span><span class="sc">;</span>
 635       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 636     <span class="s">}</span>
 637 
 638     <span class="c"># N9 - &#39;[NH]=*&#39;</span>
 639     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN9Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 640       <span class="i">$AtomType</span> = <span class="q">&#39;N9&#39;</span><span class="sc">;</span>
 641       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 642     <span class="s">}</span>
 643 
 644     <span class="c"># N12 - &#39;[N+](-*)(-*)=*&#39;</span>
 645     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN12Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 646       <span class="i">$AtomType</span> = <span class="q">&#39;N12&#39;</span><span class="sc">;</span>
 647       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 648     <span class="s">}</span>
 649 
 650     <span class="c"># N15 - &#39;[NH+](-*)=*&#39;</span>
 651     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN15Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 652       <span class="i">$AtomType</span> = <span class="q">&#39;N15&#39;</span><span class="sc">;</span>
 653       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 654     <span class="s">}</span>
 655 
 656     <span class="c"># N17 - &#39;[NH2+]=*&#39;</span>
 657     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN17Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 658       <span class="i">$AtomType</span> = <span class="q">&#39;N17&#39;</span><span class="sc">;</span>
 659       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 660     <span class="s">}</span>
 661 
 662     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 663   <span class="s">}</span>
 664 
 665   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 666 <span class="s">}</span>
 667 
 668 <span class="c"># Get TPSA atom type for Nitrogen with two pi bonds...</span>
 669 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithTwoPiBonds-"></a> 670 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithTwoPiBonds</span> <span class="s">{</span>
 671   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 672   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 673 
 674   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 675 
 676   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 677 
 678     <span class="c"># N3 - &#39;[N]#*&#39;</span>
 679     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN3Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 680       <span class="i">$AtomType</span> = <span class="q">&#39;N3&#39;</span><span class="sc">;</span>
 681       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 682     <span class="s">}</span>
 683 
 684     <span class="c"># N4 - &#39;[N](-*)(=*)=*&#39; - As in nitro group</span>
 685     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN4Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 686       <span class="i">$AtomType</span> = <span class="q">&#39;N4&#39;</span><span class="sc">;</span>
 687       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 688     <span class="s">}</span>
 689 
 690     <span class="c"># N13 - &#39;[N+](-*)#*&#39;- Nitrogen in isocyano group</span>
 691     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN13Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 692       <span class="i">$AtomType</span> = <span class="q">&#39;N13&#39;</span><span class="sc">;</span>
 693       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 694     <span class="s">}</span>
 695 
 696     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 697   <span class="s">}</span>
 698 
 699   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 700 <span class="s">}</span>
 701 
 702 <span class="c"># Get TPSA atom type for Nitrogen with three pi bonds...</span>
 703 <span class="c">#</span>
<a name="_GetAtomTypeForNitrogenWithThreePiBonds-"></a> 704 <span class="k">sub </span><span class="m">_GetAtomTypeForNitrogenWithThreePiBonds</span> <span class="s">{</span>
 705   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 706   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 707 
 708   <span class="i">$AtomType</span> = <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 709 
 710   <span class="j">ATOMTYPE:</span> <span class="s">{</span>
 711 
 712     <span class="c"># N5 - &#39;[N](=*)#*&#39; - Middle nitrogen in azide group</span>
 713     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span><span class="i">-&gt;_IsN5Nitrogen</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 714       <span class="i">$AtomType</span> = <span class="q">&#39;N5&#39;</span><span class="sc">;</span>
 715       <span class="k">last</span> <span class="j">ATOMTYPE</span><span class="sc">;</span>
 716     <span class="s">}</span>
 717 
 718     <span class="i">$AtomType</span> = <span class="q">&#39;N&#39;</span><span class="sc">;</span>
 719   <span class="s">}</span>
 720 
 721   <span class="k">return</span> <span class="i">$AtomType</span><span class="sc">;</span>
 722 <span class="s">}</span>
 723 
 724 <span class="c"># N1 - &#39;[N](-*)(-*)-*&#39;</span>
 725 <span class="c">#</span>
<a name="_IsN1Nitrogen-"></a> 726 <span class="k">sub </span><span class="m">_IsN1Nitrogen</span> <span class="s">{</span>
 727   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 728 
 729   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.!RA3.X3.SB3.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 730 <span class="s">}</span>
 731 
 732 <span class="c"># N2 - &#39;[N](-*)=*&#39;</span>
 733 <span class="c">#</span>
<a name="_IsN2Nitrogen-"></a> 734 <span class="k">sub </span><span class="m">_IsN2Nitrogen</span> <span class="s">{</span>
 735   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 736 
 737   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.SB1.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 738 <span class="s">}</span>
 739 
 740 <span class="c"># N3 - &#39;[N]#*&#39;</span>
 741 <span class="c">#</span>
<a name="_IsN3Nitrogen-"></a> 742 <span class="k">sub </span><span class="m">_IsN3Nitrogen</span> <span class="s">{</span>
 743   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 744 
 745   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.TB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 746 <span class="s">}</span>
 747 
 748 <span class="c"># N4 - &#39;[N](-*)(=*)=*&#39; - As in nitro group</span>
 749 <span class="c">#</span>
<a name="_IsN4Nitrogen-"></a> 750 <span class="k">sub </span><span class="m">_IsN4Nitrogen</span> <span class="s">{</span>
 751   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 752 
 753   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X3.SB1.DB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 754 <span class="s">}</span>
 755 
 756 <span class="c"># N5 - &#39;[N](=*)#*&#39; - Middle nitrogen in azide group</span>
 757 <span class="c">#</span>
<a name="_IsN5Nitrogen-"></a> 758 <span class="k">sub </span><span class="m">_IsN5Nitrogen</span> <span class="s">{</span>
 759   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 760 
 761   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.DB1.TB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 762 <span class="s">}</span>
 763 
 764 <span class="c"># N6 - &#39;[N]1(-*)-*-*-1&#39; - Atom in a 3 membered ring</span>
 765 <span class="c">#</span>
<a name="_IsN6Nitrogen-"></a> 766 <span class="k">sub </span><span class="m">_IsN6Nitrogen</span> <span class="s">{</span>
 767   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 768 
 769   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA3.X3.SB3.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 770 <span class="s">}</span>
 771 
 772 <span class="c"># N7 - &#39;[NH](-*)-*&#39;</span>
 773 <span class="c">#</span>
<a name="_IsN7Nitrogen-"></a> 774 <span class="k">sub </span><span class="m">_IsN7Nitrogen</span> <span class="s">{</span>
 775   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 776 
 777   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.!RA3.X2.SB2.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 778 <span class="s">}</span>
 779 
 780 <span class="c"># N8 - &#39;[NH]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 781 <span class="c">#</span>
<a name="_IsN8Nitrogen-"></a> 782 <span class="k">sub </span><span class="m">_IsN8Nitrogen</span> <span class="s">{</span>
 783   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 784 
 785   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.RA3.X2.SB2.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 786 <span class="s">}</span>
 787 
 788 <span class="c"># N9 - &#39;[NH]=*&#39;</span>
 789 <span class="c">#</span>
<a name="_IsN9Nitrogen-"></a> 790 <span class="k">sub </span><span class="m">_IsN9Nitrogen</span> <span class="s">{</span>
 791   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 792 
 793   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.DB1.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 794 <span class="s">}</span>
 795 
 796 <span class="c"># N10 - &#39;[NH2]-*&#39;</span>
 797 <span class="c">#</span>
<a name="_IsN10Nitrogen-"></a> 798 <span class="k">sub </span><span class="m">_IsN10Nitrogen</span> <span class="s">{</span>
 799   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 800 
 801   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.SB1.H2.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 802 <span class="s">}</span>
 803 
 804 <span class="c"># N11 - &#39;[N+](-*)(-*)(-*)-*&#39;</span>
 805 <span class="c">#</span>
<a name="_IsN11Nitrogen-"></a> 806 <span class="k">sub </span><span class="m">_IsN11Nitrogen</span> <span class="s">{</span>
 807   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 808 
 809   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X4.SB4.H0.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 810 <span class="s">}</span>
 811 
 812 <span class="c"># N12 - &#39;[N+](-*)(-*)=*&#39;</span>
 813 <span class="c">#</span>
<a name="_IsN12Nitrogen-"></a> 814 <span class="k">sub </span><span class="m">_IsN12Nitrogen</span> <span class="s">{</span>
 815   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 816 
 817   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X3.SB2.DB1.H0.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 818 <span class="s">}</span>
 819 
 820 <span class="c"># N13 - &#39;[N+](-*)#*&#39;- Nitrogen in isocyano group</span>
 821 <span class="c">#</span>
<a name="_IsN13Nitrogen-"></a> 822 <span class="k">sub </span><span class="m">_IsN13Nitrogen</span> <span class="s">{</span>
 823   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 824 
 825   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.SB1.TB1.H0.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 826 <span class="s">}</span>
 827 
 828 <span class="c"># N14 - &#39;[NH+](-*)(-*)-*&#39;</span>
 829 <span class="c">#</span>
<a name="_IsN14Nitrogen-"></a> 830 <span class="k">sub </span><span class="m">_IsN14Nitrogen</span> <span class="s">{</span>
 831   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 832 
 833   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X3.SB3.H1.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 834 <span class="s">}</span>
 835 
 836 <span class="c"># N15 - &#39;[NH+](-*)=*&#39;</span>
 837 <span class="c">#</span>
<a name="_IsN15Nitrogen-"></a> 838 <span class="k">sub </span><span class="m">_IsN15Nitrogen</span> <span class="s">{</span>
 839   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 840 
 841   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.SB1.DB1.H1.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 842 <span class="s">}</span>
 843 
 844 <span class="c"># N16 - &#39;[NH2+](-*)-*&#39;</span>
 845 <span class="c">#</span>
<a name="_IsN16Nitrogen-"></a> 846 <span class="k">sub </span><span class="m">_IsN16Nitrogen</span> <span class="s">{</span>
 847   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 848 
 849   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X2.SB2.H2.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 850 <span class="s">}</span>
 851 
 852 <span class="c"># N17 - &#39;[NH2+]=*&#39;</span>
 853 <span class="c">#</span>
<a name="_IsN17Nitrogen-"></a> 854 <span class="k">sub </span><span class="m">_IsN17Nitrogen</span> <span class="s">{</span>
 855   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 856 
 857   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.DB1.H2.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 858 <span class="s">}</span>
 859 
 860 <span class="c"># N18 - &#39;[NH3+]-*&#39;</span>
 861 <span class="c">#</span>
<a name="_IsN18Nitrogen-"></a> 862 <span class="k">sub </span><span class="m">_IsN18Nitrogen</span> <span class="s">{</span>
 863   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 864 
 865   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.X1.SB1.H3.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 866 <span class="s">}</span>
 867 
 868 <span class="c"># N19 - &#39;[n](:*):*&#39;</span>
 869 <span class="c">#</span>
<a name="_IsN19Nitrogen-"></a> 870 <span class="k">sub </span><span class="m">_IsN19Nitrogen</span> <span class="s">{</span>
 871   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 872 
 873   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X2.AB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 874 <span class="s">}</span>
 875 
 876 <span class="c"># N20 - &#39;[n](:*)(:*):*&#39;</span>
 877 <span class="c">#</span>
<a name="_IsN20Nitrogen-"></a> 878 <span class="k">sub </span><span class="m">_IsN20Nitrogen</span> <span class="s">{</span>
 879   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 880 
 881   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB3.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 882 <span class="s">}</span>
 883 
 884 <span class="c"># N21 - &#39;[n](-*)(:*):*&#39;</span>
 885 <span class="c">#</span>
<a name="_IsN21Nitrogen-"></a> 886 <span class="k">sub </span><span class="m">_IsN21Nitrogen</span> <span class="s">{</span>
 887   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 888 
 889   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB2.H0.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 890 <span class="s">}</span>
 891 
 892 <span class="c"># N22 - &#39;[n](=*)(:*):*&#39; - As in pyridine N-oxide</span>
 893 <span class="c">#</span>
<a name="_IsN22Nitrogen-"></a> 894 <span class="k">sub </span><span class="m">_IsN22Nitrogen</span> <span class="s">{</span>
 895   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 896 
 897   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB2.H0.FC0&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;=&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 898 <span class="s">}</span>
 899 
 900 <span class="c"># N23 - &#39;[nH](:*):*&#39;</span>
 901 <span class="c">#</span>
<a name="_IsN23Nitrogen-"></a> 902 <span class="k">sub </span><span class="m">_IsN23Nitrogen</span> <span class="s">{</span>
 903   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 904 
 905   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X2.AB2.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 906 <span class="s">}</span>
 907 
 908 <span class="c"># N24 - &#39;[n+](:*)(:*):*&#39;</span>
 909 <span class="c">#</span>
<a name="_IsN24Nitrogen-"></a> 910 <span class="k">sub </span><span class="m">_IsN24Nitrogen</span> <span class="s">{</span>
 911   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 912 
 913   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB3.H0.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 914 <span class="s">}</span>
 915 
 916 <span class="c"># N25 - &#39;[n+](-*)(:*):*&#39;</span>
 917 <span class="c">#</span>
<a name="_IsN25Nitrogen-"></a> 918 <span class="k">sub </span><span class="m">_IsN25Nitrogen</span> <span class="s">{</span>
 919   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 920 
 921   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X3.AB2.H0.FC+1&#39;</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="cm">,</span> <span class="q">&#39;*&#39;</span><span class="s">]</span><span class="cm">,</span> <span class="s">[</span><span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;:&#39;</span><span class="cm">,</span> <span class="q">&#39;-&#39;</span><span class="s">]</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 922 <span class="s">}</span>
 923 
 924 <span class="c"># N26 - &#39;[nH+](:*):*&#39;</span>
 925 <span class="c">#</span>
<a name="_IsN26Nitrogen-"></a> 926 <span class="k">sub </span><span class="m">_IsN26Nitrogen</span> <span class="s">{</span>
 927   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 928 
 929   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;N.Ar.X2.AB2.H1.FC+1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 930 <span class="s">}</span>
 931 
 932 <span class="c"># O1 - &#39;[O](-*)-*&#39;</span>
 933 <span class="c">#</span>
<a name="_IsO1Oxygen-"></a> 934 <span class="k">sub </span><span class="m">_IsO1Oxygen</span> <span class="s">{</span>
 935   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 936 
 937   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.!RA.X2.SB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 938 <span class="s">}</span>
 939 
 940 <span class="c"># O2 - &#39;[O]1-*-*-1&#39; - Atom in a 3 membered ring</span>
 941 <span class="c">#</span>
<a name="_IsO2Oxygen-"></a> 942 <span class="k">sub </span><span class="m">_IsO2Oxygen</span> <span class="s">{</span>
 943   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 944 
 945   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.RA3.X2.SB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 946 <span class="s">}</span>
 947 
 948 <span class="c"># O3 - &#39;[O]=*&#39;</span>
 949 <span class="c">#</span>
<a name="_IsO3Oxygen-"></a> 950 <span class="k">sub </span><span class="m">_IsO3Oxygen</span> <span class="s">{</span>
 951   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 952 
 953   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 954 <span class="s">}</span>
 955 
 956 <span class="c"># O4 - &#39;[OH]-*&#39;</span>
 957 <span class="c">#</span>
<a name="_IsO4Oxygen-"></a> 958 <span class="k">sub </span><span class="m">_IsO4Oxygen</span> <span class="s">{</span>
 959   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 960 
 961   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.SB1.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 962 <span class="s">}</span>
 963 
 964 <span class="c"># O5 - &#39;[O-]-*&#39;</span>
 965 <span class="c">#</span>
<a name="_IsO5Oxygen-"></a> 966 <span class="k">sub </span><span class="m">_IsO5Oxygen</span> <span class="s">{</span>
 967   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 968 
 969   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.X1.SB1.H0.FC-1&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 970 <span class="s">}</span>
 971 
 972 <span class="c"># O6 - &#39;[o](:*):*&#39;</span>
 973 <span class="c">#</span>
<a name="_IsO6Oxygen-"></a> 974 <span class="k">sub </span><span class="m">_IsO6Oxygen</span> <span class="s">{</span>
 975   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 976 
 977   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;O.Ar.X2.AB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 978 <span class="s">}</span>
 979 
 980 <span class="c"># P1 - &#39;[P](-*)(-*)-*&#39;</span>
 981 <span class="c">#</span>
<a name="_IsP1Phosphorus-"></a> 982 <span class="k">sub </span><span class="m">_IsP1Phosphorus</span> <span class="s">{</span>
 983   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 984 
 985   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X3.SB3.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 986 <span class="s">}</span>
 987 
 988 <span class="c"># P2 - &#39;[P](-*)=*&#39;</span>
 989 <span class="c">#</span>
<a name="_IsP2Phosphorus-"></a> 990 <span class="k">sub </span><span class="m">_IsP2Phosphorus</span> <span class="s">{</span>
 991   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 992 
 993   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X2.SB1.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 994 <span class="s">}</span>
 995 
 996 <span class="c"># P3 - &#39;[P](-*)(-*)(-*)=*&#39;</span>
 997 <span class="c">#</span>
<a name="_IsP3Phosphorus-"></a> 998 <span class="k">sub </span><span class="m">_IsP3Phosphorus</span> <span class="s">{</span>
 999   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1000 
1001   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X4.SB3.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1002 <span class="s">}</span>
1003 
1004 <span class="c"># P4 - &#39;[PH](-*)(-*)=*&#39;</span>
1005 <span class="c">#</span>
<a name="_IsP4Phosphorus-"></a>1006 <span class="k">sub </span><span class="m">_IsP4Phosphorus</span> <span class="s">{</span>
1007   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1008 
1009   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;P.X3.SB2.DB1.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1010 <span class="s">}</span>
1011 
1012 <span class="c"># S1 - &#39;[S](-*)-*&#39;</span>
1013 <span class="c">#</span>
<a name="_IsS1Sulfur-"></a>1014 <span class="k">sub </span><span class="m">_IsS1Sulfur</span> <span class="s">{</span>
1015   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1016 
1017   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X2.SB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1018 <span class="s">}</span>
1019 
1020 <span class="c"># S2 - &#39;[S]=*&#39;</span>
1021 <span class="c">#</span>
<a name="_IsS2Sulfur-"></a>1022 <span class="k">sub </span><span class="m">_IsS2Sulfur</span> <span class="s">{</span>
1023   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1024 
1025   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1026 <span class="s">}</span>
1027 
1028 <span class="c"># S3 - &#39;[S](-*)(-*)=*&#39;</span>
1029 <span class="c">#</span>
<a name="_IsS3Sulfur-"></a>1030 <span class="k">sub </span><span class="m">_IsS3Sulfur</span> <span class="s">{</span>
1031   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1032 
1033   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X3.SB2.DB1.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1034 <span class="s">}</span>
1035 
1036 <span class="c"># S4 - &#39;[S](-*)(-*)(=*)=*&#39;</span>
1037 <span class="c">#</span>
<a name="_IsS4Sulfur-"></a>1038 <span class="k">sub </span><span class="m">_IsS4Sulfur</span> <span class="s">{</span>
1039   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1040 
1041   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X4.SB2.DB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1042 <span class="s">}</span>
1043 
1044 <span class="c"># S5 - &#39;[SH]-*&#39;</span>
1045 <span class="c">#</span>
<a name="_IsS5Sulfur-"></a>1046 <span class="k">sub </span><span class="m">_IsS5Sulfur</span> <span class="s">{</span>
1047   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1048 
1049   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.X1.SB1.H1.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1050 <span class="s">}</span>
1051 
1052 <span class="c"># S6 - &#39;[s](:*):*&#39;</span>
1053 <span class="c">#</span>
<a name="_IsS6Sulfur-"></a>1054 <span class="k">sub </span><span class="m">_IsS6Sulfur</span> <span class="s">{</span>
1055   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Atom</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1056 
1057   <span class="k">return</span> <span class="i">$Atom</span><span class="i">-&gt;DoesAtomNeighborhoodMatch</span><span class="s">(</span><span class="q">&#39;S.Ar.X2.AB2.H0.FC0&#39;</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1058 <span class="s">}</span>
1059 
1060 <span class="c"># Return a string containg data for TPSAAtomTypes object...</span>
1061 <span class="c">#</span>
<a name="StringifyTPSAAtomTypes-"></a>1062 <span class="k">sub </span><span class="m">StringifyTPSAAtomTypes</span> <span class="s">{</span>
1063   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1064   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTypesString</span><span class="s">)</span><span class="sc">;</span>
1065 
1066   <span class="c"># Type of AtomTypes...</span>
1067   <span class="i">$AtomTypesString</span> = <span class="q">&quot;AtomTypes: $This-&gt;{Type}; IgnorePhosphorus: &quot;</span> . <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">IgnorePhosphorus</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="s">)</span> . <span class="q">&quot;; IgnoreSulfur: &quot;</span> .  <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">IgnoreSulfur</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="s">)</span><span class="sc">;</span>
1068 
1069   <span class="c"># Setup atom types information...</span>
1070   <span class="k">my</span><span class="s">(</span><span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="i">%AssignedAtomTypes</span><span class="s">)</span><span class="sc">;</span>
1071 
1072   <span class="i">@AtomTypesInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1073   <span class="i">%AssignedAtomTypes</span> = <span class="i">$This</span><span class="i">-&gt;GetAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1074 
1075   <span class="k">for</span> <span class="i">$AtomID</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span> <span class="i">$a</span> &lt;=&gt; <span class="i">$b</span> <span class="s">}</span> <span class="k">keys</span> <span class="i">%AssignedAtomTypes</span><span class="s">)</span> <span class="s">{</span>
1076     <span class="i">$AtomType</span> = <span class="i">$AssignedAtomTypes</span>{<span class="i">$AtomID</span>} ? <span class="i">$AssignedAtomTypes</span>{<span class="i">$AtomID</span>} <span class="co">:</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
1077     <span class="k">push</span> <span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="q">&quot;$AtomID:$AtomType&quot;</span><span class="sc">;</span>
1078   <span class="s">}</span>
1079   <span class="i">$AtomTypesString</span> .= <span class="q">&quot;; AtomIDs:AtomTypes: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomTypesInfo</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
1080 
1081   <span class="k">return</span> <span class="i">$AtomTypesString</span><span class="sc">;</span>
1082 <span class="s">}</span>
1083 
1084 <span class="c"># Is it a TPSAAtomTypes object?</span>
<a name="_IsTPSAAtomTypes-"></a>1085 <span class="k">sub </span><span class="m">_IsTPSAAtomTypes</span> <span class="s">{</span>
1086   <span class="k">my</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
1087 
1088   <span class="k">return</span> <span class="s">(</span><span class="i">Scalar::Util::blessed</span><span class="s">(</span><span class="i">$Object</span><span class="s">)</span> &amp;&amp; <span class="i">$Object</span><span class="i">-&gt;isa</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
1089 <span class="s">}</span>
1090 
1091 <span class="c"># Check and load TPSA atom types data...</span>
1092 <span class="c">#</span>
<a name="_CheckAndLoadTPSAAtomTypesData-"></a>1093 <span class="k">sub </span><span class="m">_CheckAndLoadTPSAAtomTypesData</span> <span class="s">{</span>
1094 
1095   <span class="c"># Is it already loaded?</span>
1096   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$TPSAAtomTypesDataMap</span>{<span class="w">AtomTypes</span>}<span class="s">)</span> <span class="s">{</span>
1097     <span class="k">return</span><span class="sc">;</span>
1098   <span class="s">}</span>
1099 
1100   <span class="i">_LoadTPSAAtomTypesData</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1101 <span class="s">}</span>
1102 
1103 <span class="c"># Load TPSA atom types data from the file assuming first column to be atom type symbol..</span>
1104 <span class="c">#</span>
1105 <span class="c"># Format:</span>
1106 <span class="c">#</span>
1107 <span class="c"># &quot;AtomType&quot;,&quot;SMARTS&quot;,&quot;TPSAContribution&quot;,&quot;Comments&quot;</span>
1108 <span class="c"># &quot;N1&quot;,&quot;[N](-*)(-*)-*&quot;,&quot;3.24&quot;,&quot;&quot;</span>
1109 <span class="c"># &quot;N2&quot;,&quot;[N](-*)=*&quot;,&quot;12.36&quot;,&quot;&quot;</span>
1110 <span class="c">#</span>
<a name="_LoadTPSAAtomTypesData-"></a>1111 <span class="k">sub </span><span class="m">_LoadTPSAAtomTypesData</span> <span class="s">{</span>
1112   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTypesDataFile</span><span class="cm">,</span> <span class="i">$MayaChemToolsLibDir</span><span class="s">)</span><span class="sc">;</span>
1113 
1114   <span class="i">$MayaChemToolsLibDir</span> = <span class="i">FileUtil::GetMayaChemToolsLibDirName</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1115 
1116   <span class="i">$AtomTypesDataFile</span> =  <span class="q">&quot;$MayaChemToolsLibDir&quot;</span> . <span class="q">&quot;/data/TPSAAtomTypes.csv&quot;</span><span class="sc">;</span>
1117   <span class="k">if</span> <span class="s">(</span>! <span class="k">-e</span> <span class="q">&quot;$AtomTypesDataFile&quot;</span><span class="s">)</span> <span class="s">{</span>
1118     <span class="w">croak</span> <span class="q">&quot;Error: MayaChemTools package file, $AtomTypesDataFile, is missing: Possible installation problems...&quot;</span><span class="sc">;</span>
1119   <span class="s">}</span>
1120 
1121   <span class="i">%TPSAAtomTypesDataMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
1122   <span class="i">AtomTypes::AtomTypes::LoadAtomTypesData</span><span class="s">(</span><span class="i">$AtomTypesDataFile</span><span class="cm">,</span> \<span class="i">%TPSAAtomTypesDataMap</span><span class="s">)</span><span class="sc">;</span>
1123 <span class="s">}</span>
1124 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
