<html>
<head>
<title>MayaChemTools:Code:Fingerprints/EStateIndiciesFingerprints.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-Fingerprints::EStateIndiciesFingerprints-"></a>   1 <span class="k">package </span><span class="i">Fingerprints::EStateIndiciesFingerprints</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># File: EStateIndiciesFingerprints.pm</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2020 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">TextUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">FileUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">MathUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">Fingerprints::Fingerprints</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">AtomTypes::EStateAtomTypes</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">AtomicDescriptors::EStateValuesDescriptors</span><span class="sc">;</span>
  37 
  38 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  39 
  40 <span class="i">@ISA</span> = <span class="q">qw(Fingerprints::Fingerprints Exporter)</span><span class="sc">;</span>
  41 <span class="i">@EXPORT</span> = <span class="q">qw()</span><span class="sc">;</span>
  42 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  43 
  44 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  45 
  46 <span class="c"># Setup class variables...</span>
  47 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="sc">;</span>
  48 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  49 
  50 <span class="c"># Overload Perl functions...</span>
  51 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyEStateIndiciesFingerprints&#39;</span><span class="sc">;</span>
  52 
  53 <span class="c"># Class constructor...</span>
<a name="new-"></a>  54 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  55   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  56 
  57   <span class="c"># Initialize object...</span>
  58   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  59   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  60   <span class="i">$This</span><span class="i">-&gt;_InitializeEStateIndiciesFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  61 
  62   <span class="i">$This</span><span class="i">-&gt;_InitializeEStateIndiciesFingerprintsProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  63 
  64   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  65 <span class="s">}</span>
  66 
  67 <span class="c"># Initialize object data...</span>
  68 <span class="c">#</span>
<a name="_InitializeEStateIndiciesFingerprints-"></a>  69 <span class="k">sub </span><span class="m">_InitializeEStateIndiciesFingerprints</span> <span class="s">{</span>
  70   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  71 
  72   <span class="c"># EStateIndicies is a vector containing sum of E-state values for E-state atom types</span>
  73   <span class="c">#</span>
  74   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;EStateIndicies&#39;</span><span class="sc">;</span>
  75 
  76   <span class="c"># EStateAtomTypesSetToUse for EStateIndicies:</span>
  77   <span class="c">#</span>
  78   <span class="c"># ArbitrarySize - Corrresponds to only E-state atom types detected in molecule</span>
  79   <span class="c"># FixedSize - Corresponds to fixed number of E-state atom types previously defined [ Ref 77 ]</span>
  80   <span class="c">#</span>
  81   <span class="c"># The default EStateAtomTypesSetToUse value for EStateIndicies fingerprints type: ArbitrarySize.</span>
  82   <span class="c"># Possible values: ArbitrarySize or FixedSize.</span>
  83   <span class="c">#</span>
  84   <span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypesSetToUse</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
  85 
  86   <span class="c"># Assigned E-state atom types...</span>
  87   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypes</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  88 
  89   <span class="c"># Vector values precision for real values during E-state indicies...</span>
  90   <span class="i">$This</span>-&gt;{<span class="w">ValuesPrecision</span>} = <span class="n">3</span><span class="sc">;</span>
  91 
  92   <span class="c"># Calculated E-state values and indicies for generating E-state indicies fingerprints...</span>
  93   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">EStateValues</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  94   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">EStateIndicies</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  95 <span class="s">}</span>
  96 
  97 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a>  98 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
  99   <span class="c">#Class name...</span>
 100   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
 101 
 102 <span class="s">}</span>
 103 
 104 <span class="c"># Initialize object properties....</span>
<a name="_InitializeEStateIndiciesFingerprintsProperties-"></a> 105 <span class="k">sub </span><span class="m">_InitializeEStateIndiciesFingerprintsProperties</span> <span class="s">{</span>
 106   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 107 
 108   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
 109   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
 110     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
 111     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 112   <span class="s">}</span>
 113 
 114   <span class="c"># Make sure molecule object was specified...</span>
 115   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 116     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 117   <span class="s">}</span>
 118 
 119   <span class="i">$This</span><span class="i">-&gt;_InitializeEstateIndicies</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 120 
 121   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 122 <span class="s">}</span>
 123 
 124 <span class="c"># Initialize E-state indicies...</span>
 125 <span class="c">#</span>
<a name="_InitializeEstateIndicies-"></a> 126 <span class="k">sub </span><span class="m">_InitializeEstateIndicies</span> <span class="s">{</span>
 127   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 128 
 129   <span class="c"># Set default EStateAtomTypesSetToUse...</span>
 130   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypesSetToUse</span>}<span class="s">)</span> <span class="s">{</span>
 131     <span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypesSetToUse</span>} = <span class="q">&#39;ArbitrarySize&#39;</span><span class="sc">;</span>
 132   <span class="s">}</span>
 133 
 134   <span class="c"># Vector type...</span>
 135   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;FingerprintsVector&#39;</span><span class="sc">;</span>
 136 
 137   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypesSetToUse</span>} =~ <span class="q">/^FixedSize$/i</span><span class="s">)</span> <span class="s">{</span>
 138     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorType</span>} = <span class="q">&#39;OrderedNumericalValues&#39;</span><span class="sc">;</span>
 139   <span class="s">}</span>
 140   <span class="k">else</span> <span class="s">{</span>
 141     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorType</span>} = <span class="q">&#39;NumericalValues&#39;</span><span class="sc">;</span>
 142   <span class="s">}</span>
 143 
 144   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 145 
 146   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 147 <span class="s">}</span>
 148 
 149 <span class="c"># Disable set size method...</span>
 150 <span class="c">#</span>
<a name="SetSize-"></a> 151 <span class="k">sub </span><span class="m">SetSize</span> <span class="s">{</span>
 152   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Type</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 153 
 154   <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetSize: Can&#39;t change size:  It&#39;s not allowed...&quot;</span><span class="sc">;</span>
 155 <span class="s">}</span>
 156 
 157 <span class="c"># Set E-state atom types set to use...</span>
 158 <span class="c">#</span>
<a name="SetEStateAtomTypesSetToUse-"></a> 159 <span class="k">sub </span><span class="m">SetEStateAtomTypesSetToUse</span> <span class="s">{</span>
 160   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 161 
 162   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypesSetToUse</span>}<span class="s">)</span> <span class="s">{</span>
 163     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetEStateAtomTypesSetToUse: Can&#39;t change size:  It&#39;s already set...&quot;</span><span class="sc">;</span>
 164   <span class="s">}</span>
 165 
 166   <span class="k">if</span> <span class="s">(</span><span class="i">$Value</span> !~ <span class="q">/^(ArbitrarySize|FixedSize)/i</span><span class="s">)</span> <span class="s">{</span>
 167     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetEStateAtomTypesSetToUse: Unknown EStateAtomTypesSetToUse value: $Value; Supported values: ArbitrarySize or FixedSize&quot;</span><span class="sc">;</span>
 168   <span class="s">}</span>
 169 
 170   <span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypesSetToUse</span>} = <span class="i">$Value</span><span class="sc">;</span>
 171 
 172   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 173 <span class="s">}</span>
 174 
 175 <span class="c"># Set vector values precision for real values for E-state indicies...</span>
 176 <span class="c">#</span>
<a name="SetValuesPrecision-"></a> 177 <span class="k">sub </span><span class="m">SetValuesPrecision</span> <span class="s">{</span>
 178   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 179 
 180   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsPositiveInteger</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 181     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetValuesPrecision: ValuesPrecision value, $Value, is not valid:  It must be a positive integer...&quot;</span><span class="sc">;</span>
 182   <span class="s">}</span>
 183   <span class="i">$This</span>-&gt;{<span class="w">ValuesPrecision</span>} = <span class="i">$Value</span><span class="sc">;</span>
 184 
 185   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 186 <span class="s">}</span>
 187 
 188 <span class="c"># Generate fingerprints description...</span>
 189 <span class="c">#</span>
<a name="GetDescription-"></a> 190 <span class="k">sub </span><span class="m">GetDescription</span> <span class="s">{</span>
 191   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 192 
 193   <span class="c"># Is description explicity set?</span>
 194   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="s">)</span> <span class="s">{</span>
 195     <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="sc">;</span>
 196   <span class="s">}</span>
 197 
 198   <span class="c"># Generate fingerprints description...</span>
 199 
 200   <span class="k">return</span> <span class="q">&quot;$This-&gt;{Type}:$This-&gt;{EStateAtomTypesSetToUse}&quot;</span><span class="sc">;</span>
 201 <span class="s">}</span>
 202 
 203 <span class="c"># Generate electrotopological state indicies (E-state) [ Ref 75-78 ] fingerprints for</span>
 204 <span class="c"># non-hydrogen atoms in a molecule...</span>
 205 <span class="c">#</span>
 206 <span class="c"># EStateIndicies fingerprints constitute a vector containing sum of E-state values</span>
 207 <span class="c"># for E-state atom types. Two types of E-state atom types set size are allowed:</span>
 208 <span class="c">#</span>
 209 <span class="c"># ArbitrarySize - Corrresponds to only E-state atom types detected in molecule</span>
 210 <span class="c"># FixedSize - Corresponds to fixed number of E-state atom types previously defined</span>
 211 <span class="c">#</span>
 212 <span class="c"># Module AtomTypes::EStateAtomTypes.pm is used to assign E-state atom types to</span>
 213 <span class="c"># non-hydrogen atoms in the molecule which is able to assign atom types to any valid</span>
 214 <span class="c"># atom group. However, for FixedSize value of EStateAtomTypesSetToUse, only a fixed</span>
 215 <span class="c"># set of E-state atom types corresponding to specific atom groups [ Appendix III in</span>
 216 <span class="c"># Ref 77 ] are used for fingerprints.</span>
 217 <span class="c">#</span>
 218 <span class="c"># The fixed size E-state atom type set size used during generation of fingerprints corresponding</span>
 219 <span class="c"># FixedSize value of EStateAtomTypesSetToUse contains 87 E-state non-hydrogen atom types</span>
 220 <span class="c"># in EStateAtomTypes.csv data file distributed with MayaChemTools.</span>
 221 <span class="c">#</span>
 222 <span class="c"># Combination of Type and EStateAtomTypesSetToUse allow generation of 2 different types of</span>
 223 <span class="c"># E-state indicies fingerprints:</span>
 224 <span class="c">#</span>
 225 <span class="c"># Type                        EStateAtomTypesSetToUse</span>
 226 <span class="c">#</span>
 227 <span class="c"># EStateIndicies               ArbitrarySize      [ default fingerprints ]</span>
 228 <span class="c"># EStateIndicies               FixedSize</span>
 229 <span class="c">#</span>
 230 <span class="c"># The default is generate EStateIndicies type fingeprints corresponding to ArbitrarySize as</span>
 231 <span class="c"># EStateAtomTypesSetToUse value.</span>
 232 <span class="c">#</span>
 233 <span class="c">#</span>
<a name="GenerateFingerprints-"></a> 234 <span class="k">sub </span><span class="m">GenerateFingerprints</span> <span class="s">{</span>
 235   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 236 
 237   <span class="c"># Cache appropriate molecule data...</span>
 238   <span class="i">$This</span><span class="i">-&gt;_SetupMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 239 
 240   <span class="c"># Assign E-state atom types...</span>
 241   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_AssignEStateAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 242     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GenerateFingerprints: $This-&gt;{Type} fingerprints generation didn&#39;t succeed: Couldn&#39;t assign valid E-state atom types to all atoms...&quot;</span><span class="sc">;</span>
 243     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 244   <span class="s">}</span>
 245 
 246   <span class="c"># Calculate E-state indicies...</span>
 247   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CalculateEStateIndicies</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 248     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GenerateFingerprints: $This-&gt;{Type} fingerprints generation didn&#39;t succeed: Couldn&#39;t calculate E-state values for all atoms...&quot;</span><span class="sc">;</span>
 249     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 250   <span class="s">}</span>
 251 
 252   <span class="c"># Set final fingerprints...</span>
 253   <span class="i">$This</span><span class="i">-&gt;_SetFinalFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 254 
 255   <span class="c"># Clear cached molecule data...</span>
 256   <span class="i">$This</span><span class="i">-&gt;_ClearMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 257 
 258   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 259 <span class="s">}</span>
 260 
 261 <span class="c"># Assign E-state atom types...</span>
 262 <span class="c">#</span>
<a name="_AssignEStateAtomTypes-"></a> 263 <span class="k">sub </span><span class="m">_AssignEStateAtomTypes</span> <span class="s">{</span>
 264   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 265   <span class="k">my</span><span class="s">(</span><span class="i">$EStateAtomTypes</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="s">)</span><span class="sc">;</span>
 266 
 267   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypes</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 268 
 269   <span class="c"># Assign E-state atom types...</span>
 270   <span class="i">$EStateAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::EStateAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="n">1</span><span class="s">)</span><span class="sc">;</span>
 271   <span class="i">$EStateAtomTypes</span><span class="i">-&gt;AssignAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 272 
 273   <span class="c"># Make sure atom types assignment is successful...</span>
 274   <span class="k">if</span> <span class="s">(</span>!<span class="i">$EStateAtomTypes</span><span class="i">-&gt;IsAtomTypesAssignmentSuccessful</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 275     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 276   <span class="s">}</span>
 277 
 278   <span class="c"># Collect assigned atom types...</span>
 279   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 280     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 281 
 282     <span class="i">$AtomType</span> = <span class="i">$EStateAtomTypes</span><span class="i">-&gt;GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 283     <span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypes</span>}{<span class="i">$AtomID</span>} = <span class="i">$AtomType</span><span class="sc">;</span>
 284   <span class="s">}</span>
 285   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 286 <span class="s">}</span>
 287 
 288 <span class="c"># Calculate E-state indicies by summing up E-state values for specific</span>
 289 <span class="c"># E-state atom types...</span>
 290 <span class="c">#</span>
<a name="_CalculateEStateIndicies-"></a> 291 <span class="k">sub </span><span class="m">_CalculateEStateIndicies</span> <span class="s">{</span>
 292   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 293   <span class="k">my</span><span class="s">(</span><span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$EStateValue</span><span class="s">)</span><span class="sc">;</span>
 294 
 295   <span class="c"># Calculate E-state values to generate E-state indicies...</span>
 296   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_CalculateEStateValuesDescriptors</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 297     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 298   <span class="s">}</span>
 299 
 300   <span class="c"># Calculate E-state indicies...</span>
 301   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 302     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 303 
 304     <span class="i">$AtomType</span> = <span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypes</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 305     <span class="i">$EStateValue</span> = <span class="i">$This</span>-&gt;{<span class="w">EStateValues</span>}{<span class="i">$AtomID</span>}<span class="sc">;</span>
 306 
 307     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">EStateIndicies</span>}{<span class="i">$AtomType</span>}<span class="s">)</span> <span class="s">{</span>
 308       <span class="i">$This</span>-&gt;{<span class="w">EStateIndicies</span>}{<span class="i">$AtomType</span>} = <span class="n">0</span><span class="sc">;</span>
 309     <span class="s">}</span>
 310 
 311     <span class="i">$This</span>-&gt;{<span class="w">EStateIndicies</span>}{<span class="i">$AtomType</span>} += <span class="i">$EStateValue</span><span class="sc">;</span>
 312   <span class="s">}</span>
 313   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 314 <span class="s">}</span>
 315 
 316 <span class="c"># Calculate E-state values for E-state indicies...</span>
 317 <span class="c">#</span>
<a name="_CalculateEStateValuesDescriptors-"></a> 318 <span class="k">sub </span><span class="m">_CalculateEStateValuesDescriptors</span> <span class="s">{</span>
 319   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 320   <span class="k">my</span><span class="s">(</span><span class="i">$EStateValuesDescriptors</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$EStateValue</span><span class="s">)</span><span class="sc">;</span>
 321 
 322   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">EStateValues</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 323 
 324   <span class="c"># Calculate and assign E-state values...</span>
 325   <span class="i">$EStateValuesDescriptors</span> = <span class="i">new</span> <span class="i">AtomicDescriptors::EStateValuesDescriptors</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="s">)</span><span class="sc">;</span>
 326   <span class="i">$EStateValuesDescriptors</span><span class="i">-&gt;GenerateDescriptors</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 327 
 328   <span class="c"># Make sure E-state values calculation is successful...</span>
 329   <span class="k">if</span> <span class="s">(</span>!<span class="i">$EStateValuesDescriptors</span><span class="i">-&gt;IsDescriptorsGenerationSuccessful</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 330     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 331   <span class="s">}</span>
 332 
 333   <span class="c"># Collect assigned E-state values...</span>
 334   <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 335     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 336     <span class="i">$EStateValue</span> = <span class="i">$EStateValuesDescriptors</span><span class="i">-&gt;GetDescriptorValue</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 337     <span class="i">$This</span>-&gt;{<span class="w">EStateValues</span>}{<span class="i">$AtomID</span>} = <span class="i">$EStateValue</span><span class="sc">;</span>
 338   <span class="s">}</span>
 339   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 340 <span class="s">}</span>
 341 
 342 <span class="c"># Set final final fingerpritns for E-state indicies...</span>
 343 <span class="c">#</span>
<a name="_SetFinalFingerprints-"></a> 344 <span class="k">sub </span><span class="m">_SetFinalFingerprints</span> <span class="s">{</span>
 345   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 346   <span class="k">my</span><span class="s">(</span><span class="i">$AtomType</span><span class="cm">,</span> <span class="i">$ValuesPrecision</span><span class="cm">,</span> <span class="i">$EStateAtomTypesDataRef</span><span class="cm">,</span> <span class="i">@Values</span><span class="cm">,</span> <span class="i">@IDs</span><span class="s">)</span><span class="sc">;</span>
 347 
 348   <span class="c"># Mark successful generation of fingerprints...</span>
 349   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsGenerated</span>} = <span class="n">1</span><span class="sc">;</span>
 350 
 351   <span class="i">@Values</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 352   <span class="i">@IDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 353 
 354   <span class="i">$ValuesPrecision</span> = <span class="i">$This</span>-&gt;{<span class="w">ValuesPrecision</span>}<span class="sc">;</span>
 355 
 356   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">EStateAtomTypesSetToUse</span>} =~ <span class="q">/^FixedSize$/i</span><span class="s">)</span> <span class="s">{</span>
 357     <span class="c"># Use fixed size E-state atom types set for non-hydrogen atoms...</span>
 358     <span class="k">for</span> <span class="i">$AtomType</span> <span class="s">(</span><span class="i">@</span>{<span class="i">AtomTypes::EStateAtomTypes::GetAllPossibleEStateNonHydrogenAtomTypes</span><span class="s">(</span><span class="s">)</span>}<span class="s">)</span> <span class="s">{</span>
 359       <span class="k">push</span> <span class="i">@IDs</span><span class="cm">,</span> <span class="q">&quot;S${AtomType}&quot;</span><span class="sc">;</span>
 360       <span class="k">push</span> <span class="i">@Values</span><span class="cm">,</span> <span class="k">exists</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">EStateIndicies</span>}{<span class="i">$AtomType</span>}<span class="s">)</span> ? <span class="i">MathUtil::round</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">EStateIndicies</span>}{<span class="i">$AtomType</span>}<span class="cm">,</span> <span class="i">$ValuesPrecision</span><span class="s">)</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 361     <span class="s">}</span>
 362   <span class="s">}</span>
 363   <span class="k">else</span> <span class="s">{</span>
 364     <span class="k">for</span> <span class="i">$AtomType</span> <span class="s">(</span><span class="k">sort</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">EStateIndicies</span>}}<span class="s">)</span> <span class="s">{</span>
 365       <span class="k">push</span> <span class="i">@IDs</span><span class="cm">,</span> <span class="q">&quot;S${AtomType}&quot;</span><span class="sc">;</span>
 366       <span class="k">push</span> <span class="i">@Values</span><span class="cm">,</span> <span class="i">MathUtil::round</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">EStateIndicies</span>}{<span class="i">$AtomType</span>}<span class="cm">,</span> <span class="i">$ValuesPrecision</span><span class="s">)</span><span class="sc">;</span>
 367     <span class="s">}</span>
 368   <span class="s">}</span>
 369 
 370   <span class="c"># Add IDs and values to fingerprint vector...</span>
 371   <span class="k">if</span> <span class="s">(</span><span class="i">@IDs</span><span class="s">)</span> <span class="s">{</span>
 372     <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValueIDs</span><span class="s">(</span>\<span class="i">@IDs</span><span class="s">)</span><span class="sc">;</span>
 373   <span class="s">}</span>
 374   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValues</span><span class="s">(</span>\<span class="i">@Values</span><span class="s">)</span><span class="sc">;</span>
 375 
 376   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 377 <span class="s">}</span>
 378 
 379 <span class="c"># Cache  appropriate molecule data...</span>
 380 <span class="c">#</span>
<a name="_SetupMoleculeDataCache-"></a> 381 <span class="k">sub </span><span class="m">_SetupMoleculeDataCache</span> <span class="s">{</span>
 382   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 383 
 384   <span class="c"># Get all non-hydrogen atoms...</span>
 385   <span class="k">my</span><span class="s">(</span><span class="i">$NegateAtomCheckMethod</span><span class="s">)</span><span class="sc">;</span>
 386   <span class="i">$NegateAtomCheckMethod</span> = <span class="n">1</span><span class="sc">;</span>
 387   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="q">&quot;IsHydrogen&quot;</span><span class="cm">,</span> <span class="i">$NegateAtomCheckMethod</span><span class="s">)</span><span class="sc">;</span>
 388 
 389   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 390 <span class="s">}</span>
 391 
 392 <span class="c"># Clear cached molecule data...</span>
 393 <span class="c">#</span>
<a name="_ClearMoleculeDataCache-"></a> 394 <span class="k">sub </span><span class="m">_ClearMoleculeDataCache</span> <span class="s">{</span>
 395   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 396 
 397   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 398 
 399   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 400 <span class="s">}</span>
 401 
 402 <span class="c"># Return a string containg data for EStateIndiciesFingerprints object...</span>
<a name="StringifyEStateIndiciesFingerprints-"></a> 403 <span class="k">sub </span><span class="m">StringifyEStateIndiciesFingerprints</span> <span class="s">{</span>
 404   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 405   <span class="k">my</span><span class="s">(</span><span class="i">$EStateIndiciesFingerprintsString</span><span class="s">)</span><span class="sc">;</span>
 406 
 407   <span class="c"># Type of Keys...</span>
 408   <span class="i">$EStateIndiciesFingerprintsString</span> = <span class="q">&quot;Type: $This-&gt;{Type}; EStateAtomTypesSetToUse: $This-&gt;{EStateAtomTypesSetToUse}&quot;</span><span class="sc">;</span>
 409 
 410   <span class="c"># Fingerprint vector...</span>
 411   <span class="i">$EStateIndiciesFingerprintsString</span> .= <span class="q">&quot;; FingerprintsVector: &lt; $This-&gt;{FingerprintsVector} &gt;&quot;</span><span class="sc">;</span>
 412 
 413   <span class="k">return</span> <span class="i">$EStateIndiciesFingerprintsString</span><span class="sc">;</span>
 414 <span class="s">}</span>
 415 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
