<html>
<head>
<title>MayaChemTools:Code:Fingerprints/TopologicalAtomTripletsFingerprints.pm</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
<a name="package-Fingerprints::TopologicalAtomTripletsFingerprints-"></a>   1 <span class="k">package </span><span class="i">Fingerprints::TopologicalAtomTripletsFingerprints</span><span class="sc">;</span>
   2 <span class="c">#</span>
   3 <span class="c"># File: TopologicalAtomTripletsFingerprints.pm</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2020 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">Carp</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Exporter</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">Fingerprints::Fingerprints</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">TextUtil</span> <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Molecule</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">AtomTypes::AtomicInvariantsAtomTypes</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">AtomTypes::DREIDINGAtomTypes</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">AtomTypes::EStateAtomTypes</span><span class="sc">;</span>
  35 <span class="k">use</span> <span class="w">AtomTypes::FunctionalClassAtomTypes</span><span class="sc">;</span>
  36 <span class="k">use</span> <span class="w">AtomTypes::MMFF94AtomTypes</span><span class="sc">;</span>
  37 <span class="k">use</span> <span class="w">AtomTypes::SLogPAtomTypes</span><span class="sc">;</span>
  38 <span class="k">use</span> <span class="w">AtomTypes::SYBYLAtomTypes</span><span class="sc">;</span>
  39 <span class="k">use</span> <span class="w">AtomTypes::TPSAAtomTypes</span><span class="sc">;</span>
  40 <span class="k">use</span> <span class="w">AtomTypes::UFFAtomTypes</span><span class="sc">;</span>
  41 
  42 <span class="k">use</span> <span class="w">vars</span> <span class="q">qw(@ISA @EXPORT @EXPORT_OK %EXPORT_TAGS)</span><span class="sc">;</span>
  43 
  44 <span class="i">@ISA</span> = <span class="q">qw(Fingerprints::Fingerprints Exporter)</span><span class="sc">;</span>
  45 <span class="i">@EXPORT</span> = <span class="q">qw()</span><span class="sc">;</span>
  46 <span class="i">@EXPORT_OK</span> = <span class="q">qw()</span><span class="sc">;</span>
  47 
  48 <span class="i">%EXPORT_TAGS</span> = <span class="s">(</span><span class="w">all</span>  <span class="cm">=&gt;</span> <span class="s">[</span><span class="i">@EXPORT</span><span class="cm">,</span> <span class="i">@EXPORT_OK</span><span class="s">]</span><span class="s">)</span><span class="sc">;</span>
  49 
  50 <span class="c"># Setup class variables...</span>
  51 <span class="k">my</span><span class="s">(</span><span class="i">$ClassName</span><span class="s">)</span><span class="sc">;</span>
  52 <span class="i">_InitializeClass</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  53 
  54 <span class="c"># Overload Perl functions...</span>
  55 <span class="k">use</span> <span class="w">overload</span> <span class="q">&#39;&quot;&quot;&#39;</span> <span class="cm">=&gt;</span> <span class="q">&#39;StringifyTopologicalAtomTripletsFingerprints&#39;</span><span class="sc">;</span>
  56 
  57 <span class="c"># Class constructor...</span>
<a name="new-"></a>  58 <span class="k">sub </span><span class="m">new</span> <span class="s">{</span>
  59   <span class="k">my</span><span class="s">(</span><span class="i">$Class</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  60 
  61   <span class="c"># Initialize object...</span>
  62   <span class="k">my</span> <span class="i">$This</span> = <span class="i">$Class</span><span class="i">-&gt;SUPER::new</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  63   <span class="k">bless</span> <span class="i">$This</span><span class="cm">,</span> <span class="k">ref</span><span class="s">(</span><span class="i">$Class</span><span class="s">)</span> || <span class="i">$Class</span><span class="sc">;</span>
  64   <span class="i">$This</span><span class="i">-&gt;_InitializeTopologicalAtomTripletsFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  65 
  66   <span class="i">$This</span><span class="i">-&gt;_InitializeTopologicalAtomTripletsFingerprintsProperties</span><span class="s">(</span><span class="i">%NamesAndValues</span><span class="s">)</span><span class="sc">;</span>
  67 
  68   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
  69 <span class="s">}</span>
  70 
  71 <span class="c"># Initialize object data...</span>
  72 <span class="c">#</span>
<a name="_InitializeTopologicalAtomTripletsFingerprints-"></a>  73 <span class="k">sub </span><span class="m">_InitializeTopologicalAtomTripletsFingerprints</span> <span class="s">{</span>
  74   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  75 
  76   <span class="c"># Type of fingerprint...</span>
  77   <span class="i">$This</span>-&gt;{<span class="w">Type</span>} = <span class="q">&#39;TopologicalAtomTriplets&#39;</span><span class="sc">;</span>
  78 
  79   <span class="c"># Type of vector...</span>
  80   <span class="i">$This</span>-&gt;{<span class="w">VectorType</span>} = <span class="q">&#39;FingerprintsVector&#39;</span><span class="sc">;</span>
  81 
  82   <span class="c"># Type of FingerprintsVector...</span>
  83   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVectorType</span>} = <span class="q">&#39;NumericalValues&#39;</span><span class="sc">;</span>
  84 
  85   <span class="c"># Minimum and maximum bond distance between atom paris...</span>
  86   <span class="i">$This</span>-&gt;{<span class="w">MinDistance</span>} = <span class="n">1</span><span class="sc">;</span>
  87   <span class="i">$This</span>-&gt;{<span class="w">MaxDistance</span>} = <span class="n">10</span><span class="sc">;</span>
  88 
  89   <span class="c"># Determines whether to apply triangle inequality to distance triplets...</span>
  90   <span class="c">#</span>
  91   <span class="i">$This</span>-&gt;{<span class="w">UseTriangleInequality</span>} = <span class="n">0</span><span class="sc">;</span>
  92 
  93   <span class="c"># Atom identifier type to use for atom IDs in atom triplets...</span>
  94   <span class="c">#</span>
  95   <span class="c"># Currently supported values are: AtomicInvariantsAtomTypes, DREIDINGAtomTypes,</span>
  96   <span class="c"># EStateAtomTypes, FunctionalClassAtomTypes, MMFF94AtomTypes, SLogPAtomTypes,</span>
  97   <span class="c"># SYBYLAtomTypes, TPSAAtomTypes, UFFAtomTypes</span>
  98   <span class="c">#</span>
  99   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 100 
 101   <span class="c"># Atom types assigned to each heavy atom...</span>
 102   <span class="c">#</span>
 103   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 104 
 105   <span class="c"># All atom triplets between minimum and maximum distance...</span>
 106   <span class="c">#</span>
 107   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 108   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 109 <span class="s">}</span>
 110 
 111 <span class="c"># Initialize class ...</span>
<a name="_InitializeClass-"></a> 112 <span class="k">sub </span><span class="m">_InitializeClass</span> <span class="s">{</span>
 113   <span class="c">#Class name...</span>
 114   <span class="i">$ClassName</span> = <span class="w">__PACKAGE__</span><span class="sc">;</span>
 115 <span class="s">}</span>
 116 
 117 <span class="c"># Initialize object properties....</span>
<a name="_InitializeTopologicalAtomTripletsFingerprintsProperties-"></a> 118 <span class="k">sub </span><span class="m">_InitializeTopologicalAtomTripletsFingerprintsProperties</span> <span class="s">{</span>
 119   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">%NamesAndValues</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 120 
 121   <span class="k">my</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">$MethodName</span><span class="s">)</span><span class="sc">;</span>
 122   <span class="k">while</span> <span class="s">(</span><span class="s">(</span><span class="i">$Name</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="k">each</span>  <span class="i">%NamesAndValues</span><span class="s">)</span> <span class="s">{</span>
 123     <span class="i">$MethodName</span> = <span class="q">&quot;Set${Name}&quot;</span><span class="sc">;</span>
 124     <span class="i">$This</span><span class="i">-&gt;$MethodName</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="sc">;</span>
 125   <span class="s">}</span>
 126 
 127   <span class="c"># Make sure molecule object was specified...</span>
 128   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">Molecule</span>}<span class="s">)</span> <span class="s">{</span>
 129     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying molecule...&quot;</span><span class="sc">;</span>
 130   <span class="s">}</span>
 131   <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$NamesAndValues</span>{<span class="w">AtomIdentifierType</span>}<span class="s">)</span> <span class="s">{</span>
 132     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;New: Object can&#39;t be instantiated without specifying AtomIdentifierType...&quot;</span><span class="sc">;</span>
 133   <span class="s">}</span>
 134 
 135   <span class="i">$This</span><span class="i">-&gt;_InitializeFingerprintsVector</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 136 
 137   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 138 <span class="s">}</span>
 139 
 140 <span class="c"># Set minimum distance for atom triplets...</span>
 141 <span class="c">#</span>
<a name="SetMinDistance-"></a> 142 <span class="k">sub </span><span class="m">SetMinDistance</span> <span class="s">{</span>
 143   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 144 
 145   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsPositiveInteger</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 146     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetMinDistance: MinDistance value, $Value, is not valid:  It must be a positive integer...&quot;</span><span class="sc">;</span>
 147   <span class="s">}</span>
 148   <span class="i">$This</span>-&gt;{<span class="w">MinDistance</span>} = <span class="i">$Value</span><span class="sc">;</span>
 149 
 150   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 151 <span class="s">}</span>
 152 
 153 <span class="c"># Set maximum distance for atom triplets...</span>
 154 <span class="c">#</span>
<a name="SetMaxDistance-"></a> 155 <span class="k">sub </span><span class="m">SetMaxDistance</span> <span class="s">{</span>
 156   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Value</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 157 
 158   <span class="k">if</span> <span class="s">(</span>!<span class="i">TextUtil::IsPositiveInteger</span><span class="s">(</span><span class="i">$Value</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 159     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetMaxDistance: MaxDistance value, $Value, is not valid:  It must be a positive integer...&quot;</span><span class="sc">;</span>
 160   <span class="s">}</span>
 161   <span class="i">$This</span>-&gt;{<span class="w">MaxDistance</span>} = <span class="i">$Value</span><span class="sc">;</span>
 162 
 163   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 164 <span class="s">}</span>
 165 
 166 <span class="c"># Set atom identifier type..</span>
 167 <span class="c">#</span>
<a name="SetAtomIdentifierType-"></a> 168 <span class="k">sub </span><span class="m">SetAtomIdentifierType</span> <span class="s">{</span>
 169   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$IdentifierType</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 170 
 171   <span class="k">if</span> <span class="s">(</span><span class="i">$IdentifierType</span> !~ <span class="q">/^(AtomicInvariantsAtomTypes|DREIDINGAtomTypes|EStateAtomTypes|FunctionalClassAtomTypes|MMFF94AtomTypes|SLogPAtomTypes|SYBYLAtomTypes|TPSAAtomTypes|UFFAtomTypes)$/i</span><span class="s">)</span> <span class="s">{</span>
 172     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomIdentifierType: Specified value, $IdentifierType, for AtomIdentifierType is not vaild. Supported types in current release of MayaChemTools: AtomicInvariantsAtomTypes, DREIDINGAtomTypes, EStateAtomTypes, FunctionalClassAtomTypes, MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes, TPSAAtomTypes, and UFFAtomTypes.&quot;</span><span class="sc">;</span>
 173   <span class="s">}</span>
 174 
 175   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>}<span class="s">)</span> <span class="s">{</span>
 176     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SeAtomIdentifierType: Can&#39;t change intial atom identifier type:  It&#39;s already set...&quot;</span><span class="sc">;</span>
 177   <span class="s">}</span>
 178 
 179   <span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} = <span class="i">$IdentifierType</span><span class="sc">;</span>
 180 
 181   <span class="c"># Initialize atom identifier type information...</span>
 182   <span class="i">$This</span><span class="i">-&gt;_InitializeAtomIdentifierTypeInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 183 
 184   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 185 <span class="s">}</span>
 186 
 187 <span class="c"># Generate fingerprints description...</span>
 188 <span class="c">#</span>
<a name="GetDescription-"></a> 189 <span class="k">sub </span><span class="m">GetDescription</span> <span class="s">{</span>
 190   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 191 
 192   <span class="c"># Is description explicity set?</span>
 193   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="s">)</span> <span class="s">{</span>
 194     <span class="k">return</span> <span class="i">$This</span>-&gt;{<span class="w">Description</span>}<span class="sc">;</span>
 195   <span class="s">}</span>
 196 
 197   <span class="c"># Generate fingerprints description...</span>
 198 
 199   <span class="k">return</span> <span class="q">&quot;$This-&gt;{Type}:$This-&gt;{AtomIdentifierType}:MinDistance$This-&gt;{MinDistance}:MaxDistance$This-&gt;{MaxDistance}&quot;</span><span class="sc">;</span>
 200 <span class="s">}</span>
 201 
 202 <span class="c"># Generate topological atom triplets fingerprints...</span>
 203 <span class="c">#</span>
 204 <span class="c"># Let:</span>
 205 <span class="c">#</span>
 206 <span class="c">#   AT = Any of the supported atom types</span>
 207 <span class="c">#</span>
 208 <span class="c">#   ATx = Atom type for  atom x</span>
 209 <span class="c">#   ATy = Atom type for  atom y</span>
 210 <span class="c">#   ATz = Atom type for  atom z</span>
 211 <span class="c">#</span>
 212 <span class="c">#   Dxy = Distance between Px and Py</span>
 213 <span class="c">#   Dxz = Distance between Px and Pz</span>
 214 <span class="c">#   Dyz = Distance between Py and Pz</span>
 215 <span class="c">#</span>
 216 <span class="c"># Then:</span>
 217 <span class="c">#</span>
 218 <span class="c">#   ATx-Dyz-ATy-Dxz-ATz-Dxy = Atom triplet ID for atom types ATx, ATy and Atz</span>
 219 <span class="c">#</span>
 220 <span class="c"># Methodology:</span>
 221 <span class="c">#   . Generate a distance matrix.</span>
 222 <span class="c">#   . Assign atom types to all the atoms.</span>
 223 <span class="c">#   . Using distance matrix and atom types, count occurrence of unique atom triplets</span>
 224 <span class="c">#     within specified distance range along with optional trinagle inequality</span>
 225 <span class="c">#</span>
 226 <span class="c"># Notes:</span>
 227 <span class="c">#   . Hydrogen atoms are ignored during the fingerprint generation.</span>
 228 <span class="c">#   . For a molecule containing N atoms with all different atom type, the total number of</span>
 229 <span class="c">#     possible unique atom triplets without applying triangle inquality check corresponds to:</span>
 230 <span class="c">#</span>
 231 <span class="c">#     Factorial( N ) / ( Factorial( N - 3 ) * Factorial (3) )</span>
 232 <span class="c">#</span>
 233 <span class="c">#     However, due to similar atom types assigned to atoms in a molecule for a specific atom</span>
 234 <span class="c">#     typing methodology and specified distance range used during fingerprints generation, the</span>
 235 <span class="c">#     actual number of unique triplets is usually smaller than the theoretical limit.</span>
 236 <span class="c">#</span>
<a name="GenerateFingerprints-"></a> 237 <span class="k">sub </span><span class="m">GenerateFingerprints</span> <span class="s">{</span>
 238   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 239 
 240   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">MinDistance</span>} &gt; <span class="i">$This</span>-&gt;{<span class="w">MaxDistance</span>}<span class="s">)</span> <span class="s">{</span>
 241     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;GenerateTopologicalAtomTripletsFingerprints: No fingerpritns generated: MinDistance, $This-&gt;{MinDistance}, must be &lt;= MaxDistance, $This-&gt;{MaxDistance}...&quot;</span><span class="sc">;</span>
 242   <span class="s">}</span>
 243 
 244   <span class="c"># Cache appropriate molecule data...</span>
 245   <span class="i">$This</span><span class="i">-&gt;_SetupMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 246 
 247   <span class="c"># Generate distance matrix...</span>
 248   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_SetupDistanceMatrix</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 249     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GenerateFingerprints: $This-&gt;{AtomIdentifierType} fingerprints generation didn&#39;t succeed: Couldn&#39;t generate distance matrix...&quot;</span><span class="sc">;</span>
 250     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 251   <span class="s">}</span>
 252 
 253   <span class="c"># Assign atom types to all heavy atoms...</span>
 254   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span><span class="i">-&gt;_AssignAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 255     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;GenerateFingerprints: $This-&gt;{AtomIdentifierType} fingerprints generation didn&#39;t succeed: Couldn&#39;t assign valid $This-&gt;{AtomIdentifierType} to all atoms...&quot;</span><span class="sc">;</span>
 256     <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 257   <span class="s">}</span>
 258 
 259   <span class="c"># Intialize values of toplogical atom triplets...</span>
 260   <span class="i">$This</span><span class="i">-&gt;_InitializeToplogicalAtomTriplets</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 261 
 262   <span class="c"># Count atom triplets...</span>
 263   <span class="i">$This</span><span class="i">-&gt;_GenerateAndCountAtomTriplets</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 264 
 265   <span class="c"># Set final fingerprints...</span>
 266   <span class="i">$This</span><span class="i">-&gt;_SetFinalFingerprints</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 267 
 268   <span class="c"># Clear cached molecule data...</span>
 269   <span class="i">$This</span><span class="i">-&gt;_ClearMoleculeDataCache</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 270 
 271   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 272 <span class="s">}</span>
 273 
 274 <span class="c"># Setup distance matrix...</span>
 275 <span class="c">#</span>
<a name="_SetupDistanceMatrix-"></a> 276 <span class="k">sub </span><span class="m">_SetupDistanceMatrix</span> <span class="s">{</span>
 277   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 278 
 279   <span class="i">$This</span>-&gt;{<span class="w">DistanceMatrix</span>} = <span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetDistanceMatrix</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 280 
 281   <span class="k">if</span> <span class="s">(</span>!<span class="i">$This</span>-&gt;{<span class="w">DistanceMatrix</span>}<span class="s">)</span> <span class="s">{</span>
 282     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 283   <span class="s">}</span>
 284 
 285   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 286 <span class="s">}</span>
 287 
 288 <span class="c"># Assign appropriate atom types to all heavy atoms...</span>
 289 <span class="c">#</span>
<a name="_AssignAtomTypes-"></a> 290 <span class="k">sub </span><span class="m">_AssignAtomTypes</span> <span class="s">{</span>
 291   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 292   <span class="k">my</span><span class="s">(</span><span class="i">$SpecifiedAtomTypes</span><span class="cm">,</span> <span class="i">$Atom</span><span class="cm">,</span> <span class="i">$AtomID</span><span class="cm">,</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 293 
 294   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 295   <span class="i">$IgnoreHydrogens</span> = <span class="n">1</span><span class="sc">;</span>
 296 
 297   <span class="i">$SpecifiedAtomTypes</span> = <span class="k">undef</span><span class="sc">;</span>
 298 
 299   <span class="j">IDENTIFIERTYPE:</span> <span class="s">{</span>
 300     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 301       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::AtomicInvariantsAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="q">&#39;AtomicInvariantsToUse&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}<span class="s">)</span><span class="sc">;</span>
 302       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 303     <span class="s">}</span>
 304 
 305     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^DREIDINGAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 306       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::DREIDINGAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 307       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 308     <span class="s">}</span>
 309 
 310     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^EStateAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 311       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::EStateAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 312       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 313     <span class="s">}</span>
 314 
 315     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 316       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::FunctionalClassAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="cm">,</span> <span class="q">&#39;FunctionalClassesToUse&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}<span class="s">)</span><span class="sc">;</span>
 317       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 318     <span class="s">}</span>
 319 
 320     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^MMFF94AtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 321       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::MMFF94AtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 322       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 323     <span class="s">}</span>
 324 
 325     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^SLogPAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 326       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::SLogPAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 327       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 328     <span class="s">}</span>
 329     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^SYBYLAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 330       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::SYBYLAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 331       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 332     <span class="s">}</span>
 333 
 334     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^TPSAAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 335       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::TPSAAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnorePhosphorus&#39;</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="cm">,</span> <span class="q">&#39;IgnoreSulfur&#39;</span> <span class="cm">=&gt;</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 336       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 337     <span class="s">}</span>
 338 
 339     <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^UFFAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 340       <span class="i">$SpecifiedAtomTypes</span> = <span class="i">new</span> <span class="i">AtomTypes::UFFAtomTypes</span><span class="s">(</span><span class="q">&#39;Molecule&#39;</span> <span class="cm">=&gt;</span> <span class="i">$This</span>-&gt;{<span class="w">Molecule</span>}<span class="cm">,</span> <span class="q">&#39;IgnoreHydrogens&#39;</span> <span class="cm">=&gt;</span> <span class="i">$IgnoreHydrogens</span><span class="s">)</span><span class="sc">;</span>
 341       <span class="k">last</span> <span class="j">IDENTIFIERTYPE</span><span class="sc">;</span>
 342     <span class="s">}</span>
 343 
 344     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_AssignAtomTypes: Unknown atom indentifier type $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
 345   <span class="s">}</span>
 346 
 347   <span class="c"># Assign atom types...</span>
 348   <span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;AssignAtomTypes</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 349 
 350   <span class="c"># Make sure atom types assignment is successful...</span>
 351   <span class="k">if</span> <span class="s">(</span>!<span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;IsAtomTypesAssignmentSuccessful</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 352     <span class="k">return</span> <span class="k">undef</span><span class="sc">;</span>
 353   <span class="s">}</span>
 354 
 355   <span class="c"># Collect assigned atom types...</span>
 356   <span class="j">ATOM:</span> <span class="k">for</span> <span class="i">$Atom</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="s">)</span> <span class="s">{</span>
 357     <span class="k">if</span> <span class="s">(</span><span class="i">$Atom</span><span class="i">-&gt;IsHydrogen</span><span class="s">(</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 358       <span class="k">next</span> <span class="j">ATOM</span><span class="sc">;</span>
 359     <span class="s">}</span>
 360     <span class="i">$AtomID</span> = <span class="i">$Atom</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 361     <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID</span>} = <span class="i">$SpecifiedAtomTypes</span><span class="i">-&gt;GetAtomType</span><span class="s">(</span><span class="i">$Atom</span><span class="s">)</span><span class="sc">;</span>
 362   <span class="s">}</span>
 363 
 364   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 365 <span class="s">}</span>
 366 
 367 <span class="c"># Initialize topological atom triplets between specified distance range...</span>
 368 <span class="c">#</span>
<a name="_InitializeToplogicalAtomTriplets-"></a> 369 <span class="k">sub </span><span class="m">_InitializeToplogicalAtomTriplets</span> <span class="s">{</span>
 370   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 371   <span class="k">my</span><span class="s">(</span><span class="i">$Distance</span><span class="s">)</span><span class="sc">;</span>
 372 
 373   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 374   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsCount</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 375 
 376   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 377 <span class="s">}</span>
 378 
 379 <span class="c"># Count atom triplets between mininum and maximum distance at each</span>
 380 <span class="c"># distance using distance matrix and atom types assiged to each heavy</span>
 381 <span class="c"># atom.</span>
 382 <span class="c">#</span>
<a name="_GenerateAndCountAtomTriplets-"></a> 383 <span class="k">sub </span><span class="m">_GenerateAndCountAtomTriplets</span> <span class="s">{</span>
 384   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 385   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfAtoms</span><span class="cm">,</span> <span class="i">$AtomIndex1</span><span class="cm">,</span> <span class="i">$AtomIndex2</span><span class="cm">,</span> <span class="i">$AtomIndex3</span><span class="cm">,</span> <span class="i">$AtomID1</span><span class="cm">,</span> <span class="i">$AtomID2</span><span class="cm">,</span> <span class="i">$AtomID3</span><span class="cm">,</span> <span class="i">$AtomType1</span><span class="cm">,</span> <span class="i">$AtomType2</span><span class="cm">,</span> <span class="i">$AtomType3</span><span class="cm">,</span> <span class="i">$Distance12</span><span class="cm">,</span> <span class="i">$Distance13</span><span class="cm">,</span> <span class="i">$Distance23</span><span class="cm">,</span> <span class="i">$SkipIndexCheck</span><span class="cm">,</span> <span class="i">$DistanceMatrix</span><span class="cm">,</span> <span class="i">$AtomTripletID</span><span class="s">)</span><span class="sc">;</span>
 386 
 387   <span class="i">$NumOfAtoms</span> = <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="sc">;</span>
 388   <span class="i">$DistanceMatrix</span> = <span class="i">$This</span>-&gt;{<span class="w">DistanceMatrix</span>}<span class="sc">;</span>
 389   <span class="i">$SkipIndexCheck</span> = <span class="n">0</span><span class="sc">;</span>
 390 
 391   <span class="j">ATOMINDEX1:</span> <span class="k">for</span> <span class="i">$AtomIndex1</span> <span class="s">(</span><span class="n">0</span> .. <span class="s">(</span><span class="i">$NumOfAtoms</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 392     <span class="i">$AtomID1</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomIndexToID</span>}{<span class="i">$AtomIndex1</span>}<span class="sc">;</span>
 393     <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID1</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 394       <span class="k">next</span> <span class="j">ATOMINDEX1</span><span class="sc">;</span>
 395     <span class="s">}</span>
 396     <span class="i">$AtomType1</span> = <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID1</span>}<span class="sc">;</span>
 397 
 398     <span class="j">ATOMINDEX2:</span> <span class="k">for</span> <span class="i">$AtomIndex2</span> <span class="s">(</span><span class="s">(</span><span class="i">$AtomIndex1</span> + <span class="n">1</span><span class="s">)</span> .. <span class="s">(</span><span class="i">$NumOfAtoms</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 399       <span class="i">$AtomID2</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomIndexToID</span>}{<span class="i">$AtomIndex2</span>}<span class="sc">;</span>
 400       <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID2</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 401         <span class="k">next</span> <span class="j">ATOMINDEX2</span><span class="sc">;</span>
 402       <span class="s">}</span>
 403       <span class="i">$AtomType2</span> = <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID2</span>}<span class="sc">;</span>
 404 
 405       <span class="i">$Distance12</span> = <span class="i">$DistanceMatrix</span><span class="i">-&gt;GetValue</span><span class="s">(</span><span class="i">$AtomIndex1</span><span class="cm">,</span> <span class="i">$AtomIndex2</span><span class="cm">,</span> <span class="i">$SkipIndexCheck</span><span class="s">)</span><span class="sc">;</span>
 406       <span class="k">if</span> <span class="s">(</span><span class="i">$Distance12</span> &lt; <span class="i">$This</span>-&gt;{<span class="w">MinDistance</span>} || <span class="i">$Distance12</span> &gt; <span class="i">$This</span>-&gt;{<span class="w">MaxDistance</span>}<span class="s">)</span> <span class="s">{</span>
 407         <span class="k">next</span> <span class="j">ATOMINDEX2</span><span class="sc">;</span>
 408       <span class="s">}</span>
 409 
 410       <span class="j">ATOMINDEX3:</span> <span class="k">for</span> <span class="i">$AtomIndex3</span> <span class="s">(</span><span class="s">(</span><span class="i">$AtomIndex2</span> + <span class="n">1</span><span class="s">)</span> .. <span class="s">(</span><span class="i">$NumOfAtoms</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 411         <span class="i">$AtomID3</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomIndexToID</span>}{<span class="i">$AtomIndex3</span>}<span class="sc">;</span>
 412         <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span><span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID3</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 413           <span class="k">next</span> <span class="j">ATOMINDEX3</span><span class="sc">;</span>
 414         <span class="s">}</span>
 415         <span class="i">$AtomType3</span> = <span class="i">$This</span>-&gt;{<span class="w">AssignedAtomTypes</span>}{<span class="i">$AtomID3</span>}<span class="sc">;</span>
 416 
 417         <span class="i">$Distance13</span> = <span class="i">$DistanceMatrix</span><span class="i">-&gt;GetValue</span><span class="s">(</span><span class="i">$AtomIndex1</span><span class="cm">,</span> <span class="i">$AtomIndex3</span><span class="cm">,</span> <span class="i">$SkipIndexCheck</span><span class="s">)</span><span class="sc">;</span>
 418         <span class="i">$Distance23</span> = <span class="i">$DistanceMatrix</span><span class="i">-&gt;GetValue</span><span class="s">(</span><span class="i">$AtomIndex2</span><span class="cm">,</span> <span class="i">$AtomIndex3</span><span class="cm">,</span> <span class="i">$SkipIndexCheck</span><span class="s">)</span><span class="sc">;</span>
 419 
 420         <span class="k">if</span> <span class="s">(</span><span class="i">$Distance13</span> &lt; <span class="i">$This</span>-&gt;{<span class="w">MinDistance</span>} || <span class="i">$Distance13</span> &gt; <span class="i">$This</span>-&gt;{<span class="w">MaxDistance</span>}<span class="s">)</span> <span class="s">{</span>
 421           <span class="k">next</span> <span class="j">ATOMINDEX3</span><span class="sc">;</span>
 422         <span class="s">}</span>
 423         <span class="k">if</span> <span class="s">(</span><span class="i">$Distance23</span> &lt; <span class="i">$This</span>-&gt;{<span class="w">MinDistance</span>} || <span class="i">$Distance23</span> &gt; <span class="i">$This</span>-&gt;{<span class="w">MaxDistance</span>}<span class="s">)</span> <span class="s">{</span>
 424           <span class="k">next</span> <span class="j">ATOMINDEX3</span><span class="sc">;</span>
 425         <span class="s">}</span>
 426         <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">UseTriangleInequality</span>} &amp;&amp; !<span class="i">$This</span><span class="i">-&gt;_DoDistancesSatisfyTriangleInequality</span><span class="s">(</span><span class="i">$Distance12</span><span class="cm">,</span> <span class="i">$Distance13</span><span class="cm">,</span> <span class="i">$Distance23</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 427           <span class="k">next</span> <span class="j">ATOMINDEX3</span><span class="sc">;</span>
 428         <span class="s">}</span>
 429 
 430         <span class="i">$AtomTripletID</span> = <span class="i">$This</span><span class="i">-&gt;_GetAtomTripletID</span><span class="s">(</span><span class="i">$AtomType1</span><span class="cm">,</span> <span class="i">$Distance23</span><span class="cm">,</span> <span class="i">$AtomType2</span><span class="cm">,</span> <span class="i">$Distance13</span><span class="cm">,</span> <span class="i">$AtomType3</span><span class="cm">,</span> <span class="i">$Distance12</span><span class="s">)</span><span class="sc">;</span>
 431         <span class="k">if</span> <span class="s">(</span>!<span class="k">exists</span> <span class="i">$This</span>-&gt;{<span class="w">AtomTripletsCount</span>}{<span class="i">$AtomTripletID</span>}<span class="s">)</span> <span class="s">{</span>
 432           <span class="i">$This</span>-&gt;{<span class="w">AtomTripletsCount</span>}{<span class="i">$AtomTripletID</span>} = <span class="n">0</span><span class="sc">;</span>
 433         <span class="s">}</span>
 434         <span class="i">$This</span>-&gt;{<span class="w">AtomTripletsCount</span>}{<span class="i">$AtomTripletID</span>} += <span class="n">1</span><span class="sc">;</span>
 435       <span class="s">}</span>
 436     <span class="s">}</span>
 437   <span class="s">}</span>
 438   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 439 <span class="s">}</span>
 440 
 441 <span class="c"># Check triangle inequality...</span>
 442 <span class="c">#</span>
<a name="_DoDistancesSatisfyTriangleInequality-"></a> 443 <span class="k">sub </span><span class="m">_DoDistancesSatisfyTriangleInequality</span> <span class="s">{</span>
 444   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$Distance1</span><span class="cm">,</span> <span class="i">$Distance2</span><span class="cm">,</span> <span class="i">$Distance3</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 445 
 446   <span class="k">if</span> <span class="s">(</span> !<span class="s">(</span><span class="i">$Distance1</span> &gt; <span class="k">abs</span><span class="s">(</span><span class="i">$Distance2</span> - <span class="i">$Distance3</span><span class="s">)</span> &amp;&amp; <span class="i">$Distance1</span> &lt; <span class="s">(</span><span class="i">$Distance2</span> + <span class="i">$Distance3</span><span class="s">)</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
 447     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 448   <span class="s">}</span>
 449   <span class="k">if</span> <span class="s">(</span> !<span class="s">(</span><span class="i">$Distance2</span> &gt; <span class="k">abs</span><span class="s">(</span><span class="i">$Distance1</span> - <span class="i">$Distance3</span><span class="s">)</span> &amp;&amp; <span class="i">$Distance2</span> &lt; <span class="s">(</span><span class="i">$Distance1</span> + <span class="i">$Distance3</span><span class="s">)</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
 450     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 451   <span class="s">}</span>
 452   <span class="k">if</span> <span class="s">(</span> !<span class="s">(</span><span class="i">$Distance3</span> &gt; <span class="k">abs</span><span class="s">(</span><span class="i">$Distance1</span> - <span class="i">$Distance2</span><span class="s">)</span> &amp;&amp; <span class="i">$Distance3</span> &lt; <span class="s">(</span><span class="i">$Distance1</span> + <span class="i">$Distance2</span><span class="s">)</span><span class="s">)</span> <span class="s">)</span> <span class="s">{</span>
 453     <span class="k">return</span> <span class="n">0</span><span class="sc">;</span>
 454   <span class="s">}</span>
 455   <span class="k">return</span> <span class="n">1</span><span class="sc">;</span>
 456 <span class="s">}</span>
 457 
 458 <span class="c"># Get atom triplet ID corresponding to atom types and distances corresponding to atom triplet...</span>
 459 <span class="c">#</span>
<a name="_GetAtomTripletID-"></a> 460 <span class="k">sub </span><span class="m">_GetAtomTripletID</span> <span class="s">{</span>
 461   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">$ATx</span><span class="cm">,</span> <span class="i">$Dyz</span><span class="cm">,</span> <span class="i">$ATy</span><span class="cm">,</span> <span class="i">$Dxz</span><span class="cm">,</span> <span class="i">$ATz</span><span class="cm">,</span> <span class="i">$Dxy</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 462   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTripletID</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
 463 
 464   <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 465 
 466   <span class="i">@AtomIDs</span> = <span class="k">sort</span><span class="s">(</span><span class="q">&quot;${ATx}-D${Dyz}&quot;</span><span class="cm">,</span> <span class="q">&quot;${ATy}-D${Dxz}&quot;</span><span class="cm">,</span> <span class="q">&quot;${ATz}-D${Dxy}&quot;</span><span class="s">)</span><span class="sc">;</span>
 467   <span class="i">$AtomTripletID</span> = <span class="k">join</span> <span class="q">&quot;-&quot;</span><span class="cm">,</span> <span class="i">@AtomIDs</span><span class="sc">;</span>
 468 
 469   <span class="k">return</span> <span class="i">$AtomTripletID</span><span class="sc">;</span>
 470 <span class="s">}</span>
 471 
 472 <span class="c"># Set final fingerpritns vector...</span>
 473 <span class="c">#</span>
<a name="_SetFinalFingerprints-"></a> 474 <span class="k">sub </span><span class="m">_SetFinalFingerprints</span> <span class="s">{</span>
 475   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 476   <span class="k">my</span><span class="s">(</span><span class="i">$AtomTripletID</span><span class="cm">,</span> <span class="i">$Value</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span><span class="sc">;</span>
 477 
 478   <span class="c"># Mark successful generation of fingerprints...</span>
 479   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsGenerated</span>} = <span class="n">1</span><span class="sc">;</span>
 480 
 481   <span class="i">@Values</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 482   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 483 
 484   <span class="k">for</span> <span class="i">$AtomTripletID</span> <span class="s">(</span><span class="k">sort</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsCount</span>}}<span class="s">)</span> <span class="s">{</span>
 485     <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsIDs</span>}}<span class="cm">,</span> <span class="i">$AtomTripletID</span><span class="sc">;</span>
 486     <span class="i">$Value</span> = <span class="i">$This</span>-&gt;{<span class="w">AtomTripletsCount</span>}{<span class="i">$AtomTripletID</span>}<span class="sc">;</span>
 487     <span class="k">push</span> <span class="i">@Values</span><span class="cm">,</span> <span class="i">$Value</span><span class="sc">;</span>
 488   <span class="s">}</span>
 489 
 490   <span class="c"># Add AtomTripletsIDs and values to fingerprint vector...</span>
 491   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValueIDs</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsIDs</span>}}<span class="s">)</span><span class="sc">;</span>
 492   <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;AddValues</span><span class="s">(</span>\<span class="i">@Values</span><span class="s">)</span><span class="sc">;</span>
 493 
 494   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 495 <span class="s">}</span>
 496 
 497 <span class="c"># Get atom triplet IDs corresponding to atom triplets count values in fingerprint</span>
 498 <span class="c"># vector as an array or reference to an array...</span>
 499 <span class="c">#</span>
 500 <span class="c"># AtomTripletIDs list differes in molecules and is generated during finalization</span>
 501 <span class="c"># of fingerprints to make sure the fingerprint vector containing count values</span>
 502 <span class="c"># matches the atom triplets array.</span>
 503 <span class="c">#</span>
<a name="GetAtomTripletIDs-"></a> 504 <span class="k">sub </span><span class="m">GetAtomTripletIDs</span> <span class="s">{</span>
 505   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 506 
 507   <span class="k">return</span> <span class="k">wantarray</span> ? <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsIDs</span>}} <span class="co">:</span> \<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomTripletsIDs</span>}}<span class="sc">;</span>
 508 <span class="s">}</span>
 509 
 510 <span class="c"># Cache  appropriate molecule data...</span>
 511 <span class="c">#</span>
<a name="_SetupMoleculeDataCache-"></a> 512 <span class="k">sub </span><span class="m">_SetupMoleculeDataCache</span> <span class="s">{</span>
 513   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 514 
 515   <span class="c"># Get all atoms including hydrogens to correctly map atom indices to atom IDs for</span>
 516   <span class="c"># usage of distance matrix. The hydrogen atoms are ignored during processing...</span>
 517   <span class="c">#</span>
 518   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="i">$This</span><span class="i">-&gt;GetMolecule</span><span class="s">(</span><span class="s">)</span><span class="i">-&gt;GetAtoms</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 519 
 520   <span class="c"># Get all atom IDs...</span>
 521   <span class="k">my</span><span class="s">(</span><span class="i">@AtomIDs</span><span class="s">)</span><span class="sc">;</span>
 522   <span class="i">@AtomIDs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 523   <span class="i">@AtomIDs</span> =  <span class="k">map</span> <span class="s">{</span> <span class="i">$_</span><span class="i">-&gt;GetID</span><span class="s">(</span><span class="s">)</span> <span class="s">}</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}}<span class="sc">;</span>
 524 
 525   <span class="c"># Set AtomIndex to AtomID hash...</span>
 526   <span class="i">%</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomIndexToID</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 527   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomIndexToID</span>}}{ <span class="s">(</span><span class="n">0</span> .. <span class="i">$#AtomIDs</span><span class="s">)</span> } = <span class="i">@AtomIDs</span><span class="sc">;</span>
 528 
 529   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 530 <span class="s">}</span>
 531 
 532 <span class="c"># Set atomic invariants to use for atom identifiers...</span>
 533 <span class="c">#</span>
<a name="SetAtomicInvariantsToUse-"></a> 534 <span class="k">sub </span><span class="m">SetAtomicInvariantsToUse</span> <span class="s">{</span>
 535   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 536   <span class="k">my</span><span class="s">(</span><span class="i">$FirstValue</span><span class="cm">,</span> <span class="i">$TypeOfFirstValue</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">$SpecifiedAtomicInvariant</span><span class="cm">,</span> <span class="i">$AtomicInvariantValue</span><span class="cm">,</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@AtomicInvariantsToUse</span><span class="s">)</span><span class="sc">;</span>
 537 
 538   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
 539     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetAtomicInvariantsToUse: No values specified...&quot;</span><span class="sc">;</span>
 540     <span class="k">return</span><span class="sc">;</span>
 541   <span class="s">}</span>
 542 
 543   <span class="i">$FirstValue</span> = <span class="i">$Values</span>[<span class="n">0</span>]<span class="sc">;</span>
 544   <span class="i">$TypeOfFirstValue</span> = <span class="k">ref</span> <span class="i">$FirstValue</span><span class="sc">;</span>
 545 
 546   <span class="i">@SpecifiedAtomicInvariants</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 547   <span class="i">@AtomicInvariantsToUse</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 548 
 549   <span class="k">if</span> <span class="s">(</span><span class="i">$TypeOfFirstValue</span> =~ <span class="q">/^ARRAY/</span><span class="s">)</span> <span class="s">{</span>
 550     <span class="k">push</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FirstValue</span>}<span class="sc">;</span>
 551   <span class="s">}</span>
 552   <span class="k">else</span> <span class="s">{</span>
 553     <span class="k">push</span> <span class="i">@SpecifiedAtomicInvariants</span><span class="cm">,</span> <span class="i">@Values</span><span class="sc">;</span>
 554   <span class="s">}</span>
 555 
 556   <span class="c"># Make sure specified AtomicInvariants are valid...</span>
 557   <span class="k">for</span> <span class="i">$SpecifiedAtomicInvariant</span> <span class="s">(</span><span class="i">@SpecifiedAtomicInvariants</span><span class="s">)</span> <span class="s">{</span>
 558     <span class="k">if</span> <span class="s">(</span>!<span class="i">AtomTypes::AtomicInvariantsAtomTypes::IsAtomicInvariantAvailable</span><span class="s">(</span><span class="i">$SpecifiedAtomicInvariant</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 559       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetAtomicInvariantsToUse: Specified atomic invariant, $SpecifiedAtomicInvariant, is not supported...\n &quot;</span><span class="sc">;</span>
 560     <span class="s">}</span>
 561     <span class="i">$AtomicInvariant</span> = <span class="i">$SpecifiedAtomicInvariant</span><span class="sc">;</span>
 562     <span class="k">push</span> <span class="i">@AtomicInvariantsToUse</span><span class="cm">,</span> <span class="i">$AtomicInvariant</span><span class="sc">;</span>
 563   <span class="s">}</span>
 564 
 565   <span class="c"># Set atomic invariants to use...</span>
 566   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 567   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}}<span class="cm">,</span> <span class="i">@AtomicInvariantsToUse</span><span class="sc">;</span>
 568 
 569   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 570 <span class="s">}</span>
 571 
 572 <span class="c"># Set functional classes to use for atom identifiers...</span>
 573 <span class="c">#</span>
<a name="SetFunctionalClassesToUse-"></a> 574 <span class="k">sub </span><span class="m">SetFunctionalClassesToUse</span> <span class="s">{</span>
 575   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="cm">,</span> <span class="i">@Values</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 576   <span class="k">my</span><span class="s">(</span><span class="i">$FirstValue</span><span class="cm">,</span> <span class="i">$TypeOfFirstValue</span><span class="cm">,</span> <span class="i">$FunctionalClass</span><span class="cm">,</span> <span class="i">$SpecifiedFunctionalClass</span><span class="cm">,</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@FunctionalClassesToUse</span><span class="s">)</span><span class="sc">;</span>
 577 
 578   <span class="k">if</span> <span class="s">(</span>!<span class="i">@Values</span><span class="s">)</span> <span class="s">{</span>
 579     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalClassesToUse: No values specified...&quot;</span><span class="sc">;</span>
 580     <span class="k">return</span><span class="sc">;</span>
 581   <span class="s">}</span>
 582 
 583   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} !~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 584     <span class="w">carp</span> <span class="q">&quot;Warning: ${ClassName}-&gt;SetFunctionalClassesToUse: FunctionalClassesToUse can&#39;t be set for InitialAtomIdentifierType of $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
 585     <span class="k">return</span><span class="sc">;</span>
 586   <span class="s">}</span>
 587 
 588   <span class="i">$FirstValue</span> = <span class="i">$Values</span>[<span class="n">0</span>]<span class="sc">;</span>
 589   <span class="i">$TypeOfFirstValue</span> = <span class="k">ref</span> <span class="i">$FirstValue</span><span class="sc">;</span>
 590 
 591   <span class="i">@SpecifiedFunctionalClasses</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 592   <span class="i">@FunctionalClassesToUse</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 593 
 594   <span class="k">if</span> <span class="s">(</span><span class="i">$TypeOfFirstValue</span> =~ <span class="q">/^ARRAY/</span><span class="s">)</span> <span class="s">{</span>
 595     <span class="k">push</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@</span>{<span class="i">$FirstValue</span>}<span class="sc">;</span>
 596   <span class="s">}</span>
 597   <span class="k">else</span> <span class="s">{</span>
 598     <span class="k">push</span> <span class="i">@SpecifiedFunctionalClasses</span><span class="cm">,</span> <span class="i">@Values</span><span class="sc">;</span>
 599   <span class="s">}</span>
 600 
 601   <span class="c"># Make sure specified FunctionalClasses are valid...</span>
 602   <span class="k">for</span> <span class="i">$SpecifiedFunctionalClass</span> <span class="s">(</span><span class="i">@SpecifiedFunctionalClasses</span><span class="s">)</span> <span class="s">{</span>
 603     <span class="k">if</span> <span class="s">(</span>!<span class="i">AtomTypes::FunctionalClassAtomTypes::IsFunctionalClassAvailable</span><span class="s">(</span><span class="i">$SpecifiedFunctionalClass</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 604       <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;SetFunctionalClassesToUse: Specified functional class, $SpecifiedFunctionalClass, is not supported...\n &quot;</span><span class="sc">;</span>
 605     <span class="s">}</span>
 606     <span class="k">push</span> <span class="i">@FunctionalClassesToUse</span><span class="cm">,</span> <span class="i">$SpecifiedFunctionalClass</span><span class="sc">;</span>
 607   <span class="s">}</span>
 608 
 609   <span class="c"># Set functional classes to use...</span>
 610   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 611   <span class="k">push</span> <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}}<span class="cm">,</span> <span class="i">@FunctionalClassesToUse</span><span class="sc">;</span>
 612 
 613   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 614 <span class="s">}</span>
 615 
 616 <span class="c"># Initialize atom indentifier type information...</span>
 617 <span class="c">#</span>
 618 <span class="c"># Current supported values:</span>
 619 <span class="c">#</span>
 620 <span class="c"># AtomicInvariantsAtomTypes, DREIDINGAtomTypes, EStateAtomTypes, FunctionalClassAtomTypes,</span>
 621 <span class="c"># MMFF94AtomTypes, SLogPAtomTypes, SYBYLAtomTypes, TPSAAtomTypes, UFFAtomTypes</span>
 622 <span class="c">#</span>
<a name="_InitializeAtomIdentifierTypeInformation-"></a> 623 <span class="k">sub </span><span class="m">_InitializeAtomIdentifierTypeInformation</span> <span class="s">{</span>
 624   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 625 
 626   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 627     <span class="i">$This</span><span class="i">-&gt;_InitializeAtomicInvariantsAtomTypesInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 628   <span class="s">}</span>
 629   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 630     <span class="i">$This</span><span class="i">-&gt;_InitializeFunctionalClassAtomTypesInformation</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 631   <span class="s">}</span>
 632   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^(DREIDINGAtomTypes|EStateAtomTypes|MMFF94AtomTypes|SLogPAtomTypes|SYBYLAtomTypes|TPSAAtomTypes|UFFAtomTypes)$/i</span><span class="s">)</span> <span class="s">{</span>
 633     <span class="c"># Nothing to do for now...</span>
 634   <span class="s">}</span>
 635   <span class="k">else</span> <span class="s">{</span>
 636     <span class="w">croak</span> <span class="q">&quot;Error: ${ClassName}-&gt;_InitializeAtomIdentifierTypeInformation: Unknown atom indentifier type $This-&gt;{AtomIdentifierType}...&quot;</span><span class="sc">;</span>
 637   <span class="s">}</span>
 638 
 639   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 640 <span class="s">}</span>
 641 
 642 <span class="c"># Initialize atomic invariants atom types to use for generating atom IDs in atom triplets...</span>
 643 <span class="c">#</span>
 644 <span class="c"># Let:</span>
 645 <span class="c">#   AS = Atom symbol corresponding to element symbol</span>
 646 <span class="c">#</span>
 647 <span class="c">#   X&lt;n&gt;   = Number of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 648 <span class="c">#   BO&lt;n&gt; = Sum of bond orders to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 649 <span class="c">#   LBO&lt;n&gt; = Largest bond order of non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 650 <span class="c">#   SB&lt;n&gt; = Number of single bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 651 <span class="c">#   DB&lt;n&gt; = Number of double bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 652 <span class="c">#   TB&lt;n&gt; = Number of triple bonds to non-hydrogen atom neighbors or heavy atoms attached to atom</span>
 653 <span class="c">#   H&lt;n&gt;   = Number of implicit and explicit hydrogens for atom</span>
 654 <span class="c">#   Ar     = Aromatic annotation indicating whether atom is aromatic</span>
 655 <span class="c">#   RA     = Ring atom annotation indicating whether atom is a ring</span>
 656 <span class="c">#   FC&lt;+n/-n&gt; = Formal charge assigned to atom</span>
 657 <span class="c">#   MN&lt;n&gt; = Mass number indicating isotope other than most abundant isotope</span>
 658 <span class="c">#   SM&lt;n&gt; = Spin multiplicity of atom. Possible values: 1 (singlet), 2 (doublet) or 3 (triplet)</span>
 659 <span class="c">#</span>
 660 <span class="c">#   ATx = Atomic invariants atom type for atom x</span>
 661 <span class="c">#   ATy = Atomic invariants atom type for atom y</span>
 662 <span class="c">#   ATz = Atomic invariants atom type for atom z</span>
 663 <span class="c">#</span>
 664 <span class="c">#   Dxy = Distance between Px and Py</span>
 665 <span class="c">#   Dxz = Distance between Px and Pz</span>
 666 <span class="c">#   Dyz = Distance between Py and Pz</span>
 667 <span class="c">#</span>
 668 <span class="c"># Then:</span>
 669 <span class="c">#</span>
 670 <span class="c">#   Atom triplet AtomID generated by AtomTypes::AtomicInvariantsAtomTypes class corresponds to:</span>
 671 <span class="c">#</span>
 672 <span class="c">#     AS.X&lt;n&gt;.BO&lt;n&gt;.LBO&lt;n&gt;.&lt;SB&gt;&lt;n&gt;.&lt;DB&gt;&lt;n&gt;.&lt;TB&gt;&lt;n&gt;.H&lt;n&gt;.Ar.RA.FC&lt;+n/-n&gt;.MN&lt;n&gt;.SM&lt;n&gt;</span>
 673 <span class="c">#</span>
 674 <span class="c">#  Toplogical atom triplet ID between atom IDs ATx, ATy and ATz corresponds to:</span>
 675 <span class="c">#</span>
 676 <span class="c">#    ATx-Dyz-ATy-Dxz-ATz-Dxy</span>
 677 <span class="c">#</span>
 678 <span class="c"># Except for AS which is a required atomic invariant in atom triplet AtomIDs, all other atomic invariants are</span>
 679 <span class="c"># optional. Default atomic invariants used for AtomID are: AS, X&lt;n&gt;, BO&lt;n&gt;, H&lt;n&gt;, FC&lt;+n/-n&gt;.</span>
 680 <span class="c"># AtomID specification doesn&#39;t include atomic invariants with zero or undefined values.</span>
 681 <span class="c">#</span>
 682 <span class="c"># Examples of atom triplet AtomIDs:</span>
 683 <span class="c">#</span>
 684 <span class="c">#   O.X1.BO1.H1 - Hydroxyl oxygen in carboxylate with attached hydrogen and no explicit charge</span>
 685 <span class="c">#   O.X1.BO1.FC-1 - Hydroxyl ozygen in carboxylate with explicit negative charge</span>
 686 <span class="c">#   O.X1.BO2 - Carbonyl oxygen in carboxylate with double bond to carbon</span>
 687 <span class="c">#   O.X2.BO2 - Hydroxyl ozygen in carboxylate attached to carbonyl carbon and another heavy atom</span>
 688 <span class="c">#</span>
 689 <span class="c">#   C.X2.BO3.H1.Ar - Aromatic carbon</span>
 690 <span class="c">#</span>
<a name="_InitializeAtomicInvariantsAtomTypesInformation-"></a> 691 <span class="k">sub </span><span class="m">_InitializeAtomicInvariantsAtomTypesInformation</span> <span class="s">{</span>
 692   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 693 
 694   <span class="c"># Default atomic invariants to use for generating atom triplet atom IDs: AS, X, BO, H, FC</span>
 695   <span class="c">#</span>
 696   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 697   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}} = <span class="s">(</span><span class="q">&#39;AS&#39;</span><span class="cm">,</span> <span class="q">&#39;X&#39;</span><span class="cm">,</span> <span class="q">&#39;BO&#39;</span><span class="cm">,</span> <span class="q">&#39;H&#39;</span><span class="cm">,</span> <span class="q">&#39;FC&#39;</span><span class="s">)</span><span class="sc">;</span>
 698 
 699   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 700 <span class="s">}</span>
 701 
 702 <span class="c"># Initialize functional class atom types, generated by AtomTypes::FunctionalClassAtomTypes</span>
 703 <span class="c"># class, to use for generating atom identifiers...</span>
 704 <span class="c">#</span>
 705 <span class="c"># Let:</span>
 706 <span class="c">#   HBD: HydrogenBondDonor</span>
 707 <span class="c">#   HBA: HydrogenBondAcceptor</span>
 708 <span class="c">#   PI :  PositivelyIonizable</span>
 709 <span class="c">#   NI : NegativelyIonizable</span>
 710 <span class="c">#   Ar : Aromatic</span>
 711 <span class="c">#   Hal : Halogen</span>
 712 <span class="c">#   H : Hydrophobic</span>
 713 <span class="c">#   RA : RingAtom</span>
 714 <span class="c">#   CA : ChainAtom</span>
 715 <span class="c">#</span>
 716 <span class="c"># Then:</span>
 717 <span class="c">#</span>
 718 <span class="c">#   Functiononal class atom type specification for an atom corresponds to:</span>
 719 <span class="c">#</span>
 720 <span class="c">#     Ar.CA.H.HBA.HBD.Hal.NI.PI.RA</span>
 721 <span class="c">#</span>
 722 <span class="c">#   Default functional classes used are: HBD, HBA, PI, NI, Ar, Hal</span>
 723 <span class="c">#</span>
 724 <span class="c">#   FunctionalAtomTypes are assigned using the following definitions [ Ref 60-61, Ref 65-66 ]:</span>
 725 <span class="c">#</span>
 726 <span class="c">#     HydrogenBondDonor: NH, NH2, OH</span>
 727 <span class="c">#     HydrogenBondAcceptor: N[!H], O</span>
 728 <span class="c">#     PositivelyIonizable: +, NH2</span>
 729 <span class="c">#     NegativelyIonizable: -, C(=O)OH, S(=O)OH, P(=O)OH</span>
 730 <span class="c">#</span>
<a name="_InitializeFunctionalClassAtomTypesInformation-"></a> 731 <span class="k">sub </span><span class="m">_InitializeFunctionalClassAtomTypesInformation</span> <span class="s">{</span>
 732   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 733 
 734   <span class="c"># Default functional class atom typess to use for generating atom identifiers</span>
 735   <span class="c"># are: HBD, HBA, PI, NI, Ar, Hal</span>
 736   <span class="c">#</span>
 737   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 738   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}} = <span class="s">(</span><span class="q">&#39;HBD&#39;</span><span class="cm">,</span> <span class="q">&#39;HBA&#39;</span><span class="cm">,</span> <span class="q">&#39;PI&#39;</span><span class="cm">,</span> <span class="q">&#39;NI&#39;</span><span class="cm">,</span> <span class="q">&#39;Ar&#39;</span><span class="cm">,</span> <span class="q">&#39;Hal&#39;</span><span class="s">)</span><span class="sc">;</span>
 739 
 740   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 741 <span class="s">}</span>
 742 
 743 <span class="c"># Clear cached molecule data...</span>
 744 <span class="c">#</span>
<a name="_ClearMoleculeDataCache-"></a> 745 <span class="k">sub </span><span class="m">_ClearMoleculeDataCache</span> <span class="s">{</span>
 746   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 747 
 748   <span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">Atoms</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 749 
 750   <span class="k">return</span> <span class="i">$This</span><span class="sc">;</span>
 751 <span class="s">}</span>
 752 
 753 <span class="c"># Return a string containg data for TopologicalAtomTripletsFingerprints object...</span>
 754 <span class="c">#</span>
<a name="StringifyTopologicalAtomTripletsFingerprints-"></a> 755 <span class="k">sub </span><span class="m">StringifyTopologicalAtomTripletsFingerprints</span> <span class="s">{</span>
 756   <span class="k">my</span><span class="s">(</span><span class="i">$This</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 757   <span class="k">my</span><span class="s">(</span><span class="i">$FingerprintsString</span><span class="s">)</span><span class="sc">;</span>
 758 
 759   <span class="c"># Type of fingerprint...</span>
 760   <span class="i">$FingerprintsString</span> = <span class="q">&quot;Fingerprint type: $This-&gt;{Type}; AtomIdentifierType: $This-&gt;{AtomIdentifierType}&quot;</span><span class="sc">;</span>
 761 
 762   <span class="c"># Min and max distance...</span>
 763   <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; MinDistance:  $This-&gt;{MinDistance}; MaxDistance: $This-&gt;{MaxDistance}; UseTriangleInequality: &quot;</span> . <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">UseTriangleInequality</span>} ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;No&quot;</span><span class="s">)</span><span class="sc">;</span>
 764 
 765   <span class="k">if</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^AtomicInvariantsAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 766     <span class="k">my</span><span class="s">(</span><span class="i">$AtomicInvariant</span><span class="cm">,</span> <span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="i">@AtomicInvariantsOrder</span><span class="cm">,</span> <span class="i">%AvailableAtomicInvariants</span><span class="s">)</span><span class="sc">;</span>
 767 
 768     <span class="i">@AtomicInvariantsOrder</span> = <span class="i">AtomTypes::AtomicInvariantsAtomTypes::GetAtomicInvariantsOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 769     <span class="i">%AvailableAtomicInvariants</span> = <span class="i">AtomTypes::AtomicInvariantsAtomTypes::GetAvailableAtomicInvariants</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 770 
 771     <span class="k">for</span> <span class="i">$AtomicInvariant</span> <span class="s">(</span><span class="i">@AtomicInvariantsOrder</span><span class="s">)</span> <span class="s">{</span>
 772       <span class="k">push</span> <span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="q">&quot;$AtomicInvariant: $AvailableAtomicInvariants{$AtomicInvariant}&quot;</span><span class="sc">;</span>
 773     <span class="s">}</span>
 774 
 775     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; AtomicInvariantsToUse: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">AtomicInvariantsToUse</span>}}<span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 776     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; AtomicInvariantsOrder: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomicInvariantsOrder</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 777     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; AvailableAtomicInvariants: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@AtomicInvariants</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 778   <span class="s">}</span>
 779   <span class="k">elsif</span> <span class="s">(</span><span class="i">$This</span>-&gt;{<span class="w">AtomIdentifierType</span>} =~ <span class="q">/^FunctionalClassAtomTypes$/i</span><span class="s">)</span> <span class="s">{</span>
 780     <span class="k">my</span><span class="s">(</span><span class="i">$FunctionalClass</span><span class="cm">,</span> <span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="i">@FunctionalClassesOrder</span><span class="cm">,</span> <span class="i">%AvailableFunctionalClasses</span><span class="s">)</span><span class="sc">;</span>
 781 
 782     <span class="i">@FunctionalClassesOrder</span> = <span class="i">AtomTypes::FunctionalClassAtomTypes::GetFunctionalClassesOrder</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 783     <span class="i">%AvailableFunctionalClasses</span> = <span class="i">AtomTypes::FunctionalClassAtomTypes::GetAvailableFunctionalClasses</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 784 
 785     <span class="k">for</span> <span class="i">$FunctionalClass</span> <span class="s">(</span><span class="i">@FunctionalClassesOrder</span><span class="s">)</span> <span class="s">{</span>
 786       <span class="k">push</span> <span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="q">&quot;$FunctionalClass: $AvailableFunctionalClasses{$FunctionalClass}&quot;</span><span class="sc">;</span>
 787     <span class="s">}</span>
 788 
 789     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; FunctionalClassesToUse: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$This</span>-&gt;{<span class="w">FunctionalClassesToUse</span>}}<span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 790     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; FunctionalClassesOrder: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@FunctionalClassesOrder</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 791     <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; AvailableFunctionalClasses: &lt;&quot;</span> . <span class="i">TextUtil::JoinWords</span><span class="s">(</span>\<span class="i">@FunctionalClasses</span><span class="cm">,</span> <span class="q">&quot;, &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span> . <span class="q">&quot;&gt;&quot;</span><span class="sc">;</span>
 792   <span class="s">}</span>
 793 
 794   <span class="c"># Total number of atom triplets...</span>
 795   <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; NumOfAtomTriplets: &quot;</span> . <span class="i">$This</span>-&gt;{<span class="w">FingerprintsVector</span>}<span class="i">-&gt;GetNumOfValues</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 796 
 797   <span class="c"># FingerprintsVector...</span>
 798   <span class="i">$FingerprintsString</span> .= <span class="q">&quot;; FingerprintsVector: &lt; $This-&gt;{FingerprintsVector} &gt;&quot;</span><span class="sc">;</span>
 799 
 800   <span class="k">return</span> <span class="i">$FingerprintsString</span><span class="sc">;</span>
 801 <span class="s">}</span>
 802 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
