<html>
<head>
<title>MayaChemTools:Code:PyMOLVisualizeCryoEMDensity.py</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsPythonCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
    1 <span class="ch">#!/bin/env python</span>
    2 <span class="c1">#</span>
    3 <span class="c1"># File: PyMOLVisualizeCryoEMDensity.py</span>
    4 <span class="c1"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
    5 <span class="c1">#</span>
    6 <span class="c1"># Copyright (C) 2020 Manish Sud. All rights reserved.</span>
    7 <span class="c1">#</span>
    8 <span class="c1"># The functionality available in this script is implemented using PyMOL, a</span>
    9 <span class="c1"># molecular visualization system on an open source foundation originally</span>
   10 <span class="c1"># developed by Warren DeLano.</span>
   11 <span class="c1">#</span>
   12 <span class="c1"># This file is part of MayaChemTools.</span>
   13 <span class="c1">#</span>
   14 <span class="c1"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
   15 <span class="c1"># the terms of the GNU Lesser General Public License as published by the Free</span>
   16 <span class="c1"># Software Foundation; either version 3 of the License, or (at your option) any</span>
   17 <span class="c1"># later version.</span>
   18 <span class="c1">#</span>
   19 <span class="c1"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
   20 <span class="c1"># any warranty; without even the implied warranty of merchantability of fitness</span>
   21 <span class="c1"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
   22 <span class="c1"># details.</span>
   23 <span class="c1">#</span>
   24 <span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
   25 <span class="c1"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
   26 <span class="c1"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
   27 <span class="c1"># Boston, MA, 02111-1307, USA.</span>
   28 <span class="c1">#</span>
   29 
   30 <span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
   31 
   32 <span class="c1"># Add local python path to the global path and import standard library modules...</span>
   33 <span class="kn">import</span> <span class="nn">os</span>
   34 <span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span>  <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;Python&quot;</span><span class="p">))</span>
   35 <span class="kn">import</span> <span class="nn">time</span>
   36 <span class="kn">import</span> <span class="nn">re</span>
   37 <span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ElementTree</span>
   38 
   39 <span class="c1"># PyMOL imports...</span>
   40 <span class="k">try</span><span class="p">:</span>
   41     <span class="kn">import</span> <span class="nn">pymol</span>
   42     <span class="c1"># Finish launching PyMOL in  a command line mode for batch processing (-c)</span>
   43     <span class="c1"># along with the following options:  disable loading of pymolrc and plugins (-k);</span>
   44     <span class="c1"># suppress start up messages (-q)</span>
   45     <span class="n">pymol</span><span class="o">.</span><span class="n">finish_launching</span><span class="p">([</span><span class="s1">&#39;pymol&#39;</span><span class="p">,</span> <span class="s1">&#39;-ckq&#39;</span><span class="p">])</span>
   46 <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
   47     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import PyMOL module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
   48     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your PyMOL environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   49     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   50 
   51 <span class="c1"># MayaChemTools imports...</span>
   52 <span class="k">try</span><span class="p">:</span>
   53     <span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
   54     <span class="kn">import</span> <span class="nn">MiscUtil</span>
   55     <span class="kn">import</span> <span class="nn">PyMOLUtil</span>
   56 <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
   57     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import MayaChemTools module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
   58     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your MayaChemTools environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   59     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   60 
   61 <span class="n">ScriptName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   62 <span class="n">Options</span> <span class="o">=</span> <span class="p">{}</span>
   63 <span class="n">OptionsInfo</span> <span class="o">=</span> <span class="p">{}</span>
   64 
   65 <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
   66     <span class="sd">&quot;&quot;&quot;Start execution of the script&quot;&quot;&quot;</span>
   67     
   68     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2"> (PyMOL v</span><span class="si">%s</span><span class="s2">; </span><span class="si">%s</span><span class="s2">) Starting...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ScriptName</span><span class="p">,</span> <span class="n">pymol</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_version</span><span class="p">()[</span><span class="mi">0</span><span class="p">],</span> <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()))</span>
   69     
   70     <span class="p">(</span><span class="n">WallClockTime</span><span class="p">,</span> <span class="n">ProcessorTime</span><span class="p">)</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetWallClockAndProcessorTime</span><span class="p">()</span>
   71     
   72     <span class="c1"># Retrieve command line arguments and options...</span>
   73     <span class="n">RetrieveOptions</span><span class="p">()</span>
   74     
   75     <span class="c1"># Process and validate command line arguments and options...</span>
   76     <span class="n">ProcessOptions</span><span class="p">()</span>
   77 
   78     <span class="c1"># Perform actions required by the script...</span>
   79     <span class="n">GenerateCryoEMDensityVisualization</span><span class="p">()</span>
   80     
   81     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">: Done...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ScriptName</span><span class="p">)</span>
   82     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Total time: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetFormattedElapsedTime</span><span class="p">(</span><span class="n">WallClockTime</span><span class="p">,</span> <span class="n">ProcessorTime</span><span class="p">))</span>
   83 
   84 <span class="k">def</span> <span class="nf">GenerateCryoEMDensityVisualization</span><span class="p">():</span>
   85     <span class="sd">&quot;&quot;&quot;Generate cryo-EM density visualization.&quot;&quot;&quot;</span>
   86     
   87     <span class="n">Outfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span>
   88     <span class="n">OutFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
   89     <span class="k">if</span> <span class="n">OutFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
   90         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to open output fie </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
   91     
   92     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
   93 
   94     <span class="c1"># Setup header...</span>
   95     <span class="n">WritePMLHeader</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ScriptName</span><span class="p">)</span>
   96     <span class="n">WritePyMOLParameters</span><span class="p">(</span><span class="n">OutFH</span><span class="p">)</span>
   97 
   98     <span class="c1"># Load reffile for alignment..</span>
   99     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]:</span>
  100         <span class="n">WriteAlignReference</span><span class="p">(</span><span class="n">OutFH</span><span class="p">)</span>
  101 
  102     <span class="c1"># Setup view for each input file...</span>
  103     <span class="n">FirstComplex</span> <span class="o">=</span> <span class="bp">True</span>
  104     <span class="n">FirstComplexFirstChainName</span> <span class="o">=</span> <span class="bp">None</span>
  105     <span class="k">for</span> <span class="n">FileIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])):</span>
  106         <span class="c1"># Setup PyMOL object names...</span>
  107         <span class="n">PyMOLObjectNames</span> <span class="o">=</span> <span class="n">SetupPyMOLObjectNames</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">)</span>
  108 
  109         <span class="c1"># Setup complex view...</span>
  110         <span class="n">WriteComplexView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">FirstComplex</span><span class="p">)</span>
  111         
  112         <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  113         <span class="n">FirstChain</span> <span class="o">=</span> <span class="bp">True</span>
  114         <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
  115             <span class="k">if</span> <span class="n">FirstComplex</span> <span class="ow">and</span> <span class="n">FirstChain</span><span class="p">:</span>
  116                 <span class="n">FirstComplexFirstChainName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAlone&quot;</span><span class="p">]</span>
  117                 
  118             <span class="n">WriteChainView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  119             
  120             <span class="c1"># Setup ligand views...</span>
  121             <span class="n">FirstLigand</span> <span class="o">=</span> <span class="bp">True</span>
  122             <span class="k">for</span> <span class="n">LigandID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]:</span>
  123                 <span class="n">WriteChainLigandView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">)</span>
  124                 
  125                 <span class="c1"># Set up ligand level group...</span>
  126                 <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
  127                 <span class="k">if</span> <span class="n">FirstLigand</span><span class="p">:</span>
  128                     <span class="n">FirstLigand</span> <span class="o">=</span> <span class="bp">False</span>
  129                     <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  130                 <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  131             
  132             <span class="c1"># Setup Chain level group...</span>
  133             <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
  134             <span class="k">if</span> <span class="n">FirstChain</span><span class="p">:</span>
  135                 <span class="n">FirstChain</span> <span class="o">=</span> <span class="bp">False</span>
  136                 <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  137             <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  138     
  139         <span class="c1"># Set up complex level group...</span>
  140         <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
  141         <span class="k">if</span> <span class="n">FirstComplex</span><span class="p">:</span>
  142             <span class="n">FirstComplex</span> <span class="o">=</span> <span class="bp">False</span>
  143             <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  144         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  145         
  146         <span class="c1"># Delete empty PyMOL objects...</span>
  147         <span class="n">DeleteEmptyPyMOLObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">)</span>
  148         
  149     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]:</span>
  150         <span class="n">DeleteAlignReference</span><span class="p">(</span><span class="n">OutFH</span><span class="p">)</span>
  151 
  152     <span class="k">if</span> <span class="n">FirstComplexFirstChainName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  153         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">cmd.orient(&quot;</span><span class="si">%s</span><span class="s2">&quot;, animate = -1)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">FirstComplexFirstChainName</span><span class="p">)</span>
  154     <span class="k">else</span><span class="p">:</span>
  155         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">cmd.orient(&quot;visible&quot;, animate = -1)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
  156     
  157     <span class="n">OutFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  158 
  159     <span class="c1"># Generate PSE file as needed...</span>
  160     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOut&quot;</span><span class="p">]:</span>
  161         <span class="n">GeneratePyMOLSessionFile</span><span class="p">()</span>
  162 
  163 <span class="k">def</span> <span class="nf">WritePMLHeader</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ScriptName</span><span class="p">):</span>
  164     <span class="sd">&quot;&quot;&quot;Write out PML setting up complex view&quot;&quot;&quot;</span>
  165 
  166     <span class="n">HeaderInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLHeaderInfo</span><span class="p">(</span><span class="n">ScriptName</span><span class="p">)</span>
  167     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">HeaderInfo</span><span class="p">)</span>
  168 
  169 <span class="k">def</span> <span class="nf">WritePyMOLParameters</span><span class="p">(</span><span class="n">OutFH</span><span class="p">):</span>
  170     <span class="sd">&quot;&quot;&quot;Write out PyMOL global parameters. &quot;&quot;&quot;</span>
  171 
  172     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  173     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;mesh_width&quot;, </span><span class="si">%.2f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshWidth&quot;</span><span class="p">]))</span>
  174     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;transparency&quot;, </span><span class="si">%.2f</span><span class="s2">, &quot;&quot;, 0)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceTransparency&quot;</span><span class="p">]))</span>
  175     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_font_id&quot;, </span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;LabelFontID&quot;</span><span class="p">]))</span>
  176 
  177     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampCreate&quot;</span><span class="p">]:</span>
  178         <span class="n">ColorRampName</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span>
  179         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampContourLevel&quot;</span><span class="p">]</span>
  180         <span class="n">LowerContourLevel</span> <span class="o">=</span> <span class="n">ContourLevel</span> <span class="o">-</span> <span class="mf">0.3</span>
  181         <span class="n">UpperContourLevel</span> <span class="o">=</span> <span class="n">ContourLevel</span> <span class="o">+</span> <span class="mf">0.3</span>
  182         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.volume_ramp_new(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%.2f</span><span class="s2"> blue 0.00 </span><span class="si">%.2f</span><span class="s2"> cyan 0.20 </span><span class="si">%.2f</span><span class="s2"> blue 0.00&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ColorRampName</span><span class="p">,</span> <span class="n">LowerContourLevel</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">UpperContourLevel</span><span class="p">))</span>
  183         
  184     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  185     
  186     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up PyMOL gobal parameters...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
  187     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  188     
  189 <span class="k">def</span> <span class="nf">WriteAlignReference</span><span class="p">(</span><span class="n">OutFH</span><span class="p">):</span>
  190     <span class="sd">&quot;&quot;&quot;Setup object for alignment reference &quot;&quot;&quot;</span>
  191 
  192     <span class="n">RefFileInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">]</span>
  193     <span class="n">RefFile</span> <span class="o">=</span> <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span>
  194     <span class="n">RefName</span> <span class="o">=</span> <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLObjectName&quot;</span><span class="p">]</span>
  195     
  196     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  197     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.load(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RefFile</span><span class="p">,</span> <span class="n">RefName</span><span class="p">))</span>
  198     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.hide(&quot;everything&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RefName</span><span class="p">))</span>
  199     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.disable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RefName</span><span class="p">))</span>
  200     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  201     
  202     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Loading </span><span class="si">%s</span><span class="s2"> and setting up view for align reference...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">RefFile</span><span class="p">)</span>
  203     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  204     
  205 <span class="k">def</span> <span class="nf">WriteAlignComplex</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">):</span>
  206     <span class="sd">&quot;&quot;&quot;Setup alignment of complex to reference&quot;&quot;&quot;</span>
  207 
  208     <span class="n">RefFileInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">]</span>
  209     <span class="n">RefName</span> <span class="o">=</span> <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLObjectName&quot;</span><span class="p">]</span>
  210     
  211     <span class="n">ComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">]</span>
  212     
  213     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstChain$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  214         <span class="n">RefFirstChainID</span> <span class="o">=</span> <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
  215         <span class="n">RefAlignSelection</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> and chain </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RefName</span><span class="p">,</span> <span class="n">RefFirstChainID</span><span class="p">)</span>
  216         
  217         <span class="n">ComplexFirstChainID</span> <span class="o">=</span> <span class="n">RetrieveFirstChainID</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">)</span>
  218         <span class="n">ComplexAlignSelection</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> and chain </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ComplexName</span><span class="p">,</span> <span class="n">ComplexFirstChainID</span><span class="p">)</span>
  219     <span class="k">else</span><span class="p">:</span>
  220         <span class="n">RefAlignSelection</span> <span class="o">=</span> <span class="n">RefName</span>
  221         <span class="n">ComplexAlignSelection</span> <span class="o">=</span> <span class="n">ComplexName</span>
  222 
  223     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForAlignment</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignMethod&quot;</span><span class="p">],</span> <span class="n">RefAlignSelection</span><span class="p">,</span> <span class="n">ComplexAlignSelection</span><span class="p">)</span>
  224     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Aligning </span><span class="si">%s</span><span class="s2"> against reference </span><span class="si">%s</span><span class="s2"> ...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ComplexAlignSelection</span><span class="p">,</span> <span class="n">RefAlignSelection</span><span class="p">))</span>
  225     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  226     
  227 <span class="k">def</span> <span class="nf">DeleteAlignReference</span><span class="p">(</span><span class="n">OutFH</span><span class="p">):</span>
  228     <span class="sd">&quot;&quot;&quot;Delete alignment reference object.&quot;&quot;&quot;</span>
  229     
  230     <span class="n">RefName</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">][</span><span class="s2">&quot;PyMOLObjectName&quot;</span><span class="p">]</span>
  231     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Deleting alignment reference object </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">RefName</span><span class="p">)</span>
  232     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.delete(&quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">RefName</span><span class="p">)</span>
  233 
  234 <span class="k">def</span> <span class="nf">WriteComplexView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">FirstComplex</span><span class="p">):</span>
  235     <span class="sd">&quot;&quot;&quot;Write out PML for viewing polymer complex along with cryo-EM density.&quot;&quot;&quot;</span>
  236 
  237     <span class="c1"># Setup complex...</span>
  238     <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  239     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForPolymerComplexView</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">],</span> <span class="n">Infile</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
  240     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Loading </span><span class="si">%s</span><span class="s2"> and setting up view for complex...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
  241     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  242 
  243     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]:</span>
  244         <span class="c1"># No need to align complex on to itself...</span>
  245         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstInputFile$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignRefFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="ow">and</span> <span class="n">FirstComplex</span><span class="p">):</span>
  246             <span class="n">WriteAlignComplex</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">)</span>
  247 
  248     <span class="c1"># Setup cryo-EM density maps and meshes...</span>
  249     <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  250     <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  251     <span class="n">WriteComplexCryoEMDensityMapView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">DensityMapFile</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">)</span>
  252 
  253     <span class="c1"># Setup complex group...</span>
  254     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroupMembers&quot;</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  255 
  256 <span class="k">def</span> <span class="nf">WriteComplexCryoEMDensityMapView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">MapFileName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">):</span>
  257     <span class="sd">&quot;&quot;&quot;Write out PML for viewing cryoEM density map.&quot;&quot;&quot;</span>
  258 
  259     <span class="c1"># Load cryo-EM density map and setup mesh views...</span>
  260     <span class="n">Info</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
  261 <span class="s2">&quot;&quot;</span>
  262 <span class="s2">&quot;Loading cryo-EM density map </span><span class="si">%s</span><span class="s2"> and setting up mesh view for complex...&quot;</span>
  263 <span class="s2">&quot;&quot; &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">MapFileName</span>
  264     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Info</span><span class="p">)</span>
  265 
  266     <span class="n">MapName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span>
  267     <span class="n">ComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">]</span>
  268     
  269     <span class="n">Color</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">]</span>
  270     <span class="n">VolumeColorRamp</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span>
  271     
  272     <span class="n">VolumeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMVolume&quot;</span><span class="p">]</span>
  273     <span class="n">MeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMesh&quot;</span><span class="p">]</span>
  274     <span class="n">SurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMSurface&quot;</span><span class="p">]</span>
  275     
  276     <span class="n">AlignMapToObjectName</span> <span class="o">=</span> <span class="n">ComplexName</span> <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="bp">None</span>
  277     <span class="n">EnableMap</span> <span class="o">=</span> <span class="bp">True</span>
  278     <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMap</span><span class="p">(</span><span class="n">MapFileName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">AlignMapToObjectName</span><span class="p">,</span> <span class="n">EnableMap</span><span class="p">)</span>
  279     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  280 
  281     <span class="n">EnableMesh</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshComplex&quot;</span><span class="p">]</span>
  282     
  283     <span class="n">EnableVolume</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeComplex&quot;</span><span class="p">]</span>
  284     <span class="k">if</span> <span class="n">EnableVolume</span> <span class="ow">and</span> <span class="n">EnableMesh</span><span class="p">:</span>
  285         <span class="n">EnableVolume</span> <span class="o">=</span> <span class="bp">False</span>
  286         
  287     <span class="n">EnableSurface</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceComplex&quot;</span><span class="p">]</span>
  288     <span class="k">if</span> <span class="n">EnableSurface</span> <span class="ow">and</span> <span class="p">(</span><span class="n">EnableVolume</span> <span class="ow">or</span> <span class="n">EnableMesh</span><span class="p">):</span>
  289         <span class="n">EnableSurface</span> <span class="o">=</span> <span class="bp">False</span>
  290     
  291     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeComplex&quot;</span><span class="p">]:</span>
  292         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableVolume</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ComplexName</span><span class="p">)</span>
  293         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  294     
  295     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshComplex&quot;</span><span class="p">]:</span>
  296         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">MeshName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableMesh</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ComplexName</span><span class="p">)</span>
  297         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  298 
  299     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceComplex&quot;</span><span class="p">]:</span>
  300         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">SurfaceName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableSurface</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ComplexName</span><span class="p">)</span>
  301         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  302 
  303     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  304     
  305 <span class="k">def</span> <span class="nf">WriteChainView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  306     <span class="sd">&quot;&quot;&quot;Write out PML for viewing chain.&quot;&quot;&quot;</span>
  307     
  308     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">ChainID</span><span class="p">)</span>
  309     
  310     <span class="n">ChainComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  311     
  312     <span class="c1"># Setup chain complex group view...</span>
  313     <span class="n">WriteChainComplexAndMeshViews</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  314 
  315     <span class="c1"># Setup chain view...</span>
  316     <span class="n">WriteChainAloneViews</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  317     
  318     <span class="c1"># Setup chain solvent view...</span>
  319     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForSolventView</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;Solvent&quot;</span><span class="p">],</span> <span class="n">ChainComplexName</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
  320     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  321 
  322     <span class="c1"># Setup chain inorganic view...</span>
  323     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForInorganicView</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;Inorganic&quot;</span><span class="p">],</span> <span class="n">ChainComplexName</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
  324     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  325 
  326 <span class="k">def</span> <span class="nf">WriteChainComplexAndMeshViews</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  327     <span class="sd">&quot;&quot;&quot;Write chain complex and mesh views. &quot;&quot;&quot;</span>
  328     
  329     <span class="c1"># Setup chain complex...</span>
  330     <span class="n">ChainComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  331     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForPolymerChainComplexView</span><span class="p">(</span><span class="n">ChainComplexName</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">],</span> <span class="n">ChainID</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
  332     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  333 
  334     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  335     
  336     <span class="n">MeshChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  337     <span class="n">VolumeChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  338     <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  339     
  340     <span class="n">EnableVolumeChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableVolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  341     <span class="n">EnableMeshChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableMeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  342     <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableSurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  343     
  344     <span class="k">if</span> <span class="n">MeshChainComplex</span> <span class="ow">or</span> <span class="n">VolumeChainComplex</span> <span class="ow">or</span> <span class="n">SurfaceChainComplex</span><span class="p">:</span>
  345         <span class="c1"># Set up cryoEM mesh and group...</span>
  346         <span class="n">MapName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span>
  347         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  348         <span class="n">Color</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">]</span>
  349         
  350         <span class="n">VolumeColorRamp</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span>
  351         
  352         <span class="n">VolumeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMVolume&quot;</span><span class="p">]</span>
  353         <span class="n">MeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMMesh&quot;</span><span class="p">]</span>
  354         <span class="n">SurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMSurface&quot;</span><span class="p">]</span>
  355         
  356         <span class="k">if</span> <span class="n">VolumeChainComplex</span><span class="p">:</span>
  357             <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableVolumeChainComplex</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ChainComplexName</span><span class="p">)</span>
  358             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  359             
  360         <span class="k">if</span> <span class="n">MeshChainComplex</span><span class="p">:</span>
  361             <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">MeshName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableMeshChainComplex</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ChainComplexName</span><span class="p">)</span>
  362             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  363         
  364         <span class="k">if</span> <span class="n">SurfaceChainComplex</span><span class="p">:</span>
  365             <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">SurfaceName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableSurfaceChainComplex</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ChainComplexName</span><span class="p">)</span>
  366             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  367         
  368         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  369         
  370     <span class="c1"># Setup chain complex group...</span>
  371     <span class="n">EnableChainComplexGroup</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainComplexGroup&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  372     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroupMembers&quot;</span><span class="p">],</span> <span class="n">EnableChainComplexGroup</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  373     
  374 <span class="k">def</span> <span class="nf">WriteChainAloneViews</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  375     <span class="sd">&quot;&quot;&quot;Write individual chain views. &quot;&quot;&quot;</span>
  376 
  377     <span class="n">ChainComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  378     
  379     <span class="c1"># Setup chain view...</span>
  380     <span class="n">ChainName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAlone&quot;</span><span class="p">]</span>
  381     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForPolymerChainView</span><span class="p">(</span><span class="n">ChainName</span><span class="p">,</span> <span class="n">ChainComplexName</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  382     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  383 
  384     <span class="c1"># Setup chain putty by B-factor view...</span>
  385     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorChainCartoonPutty&quot;</span><span class="p">]:</span>
  386         <span class="n">BFactorPuttyName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneBFactorPutty&quot;</span><span class="p">]</span>
  387         <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForBFactorPuttyView</span><span class="p">(</span><span class="n">BFactorPuttyName</span><span class="p">,</span> <span class="n">ChainName</span><span class="p">,</span> <span class="n">ColorPalette</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorColorPalette&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
  388         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  389         
  390     <span class="c1"># Setup chain selections view...</span>
  391     <span class="n">SetupChainSelectionsView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  392     
  393     <span class="c1"># Setup chain group...</span>
  394     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  395     <span class="n">EnableChainAloneGroup</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainAloneGroup&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  396     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">],</span> <span class="n">EnableChainAloneGroup</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  397     
  398 <span class="k">def</span> <span class="nf">SetupChainSelectionsView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  399     <span class="sd">&quot;&quot;&quot;Setup chain selectons view. &quot;&quot;&quot;</span>
  400 
  401     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelections&quot;</span><span class="p">]:</span>
  402         <span class="k">return</span>
  403     
  404     <span class="n">ChainName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAlone&quot;</span><span class="p">]</span>
  405     <span class="n">SelectionsGroupIDPrefix</span> <span class="o">=</span> <span class="s2">&quot;ChainAloneSelections&quot;</span>
  406     
  407     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelectionsInfo&quot;</span><span class="p">][</span><span class="s2">&quot;Names&quot;</span><span class="p">])):</span>
  408         <span class="n">SelectionName</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelectionsInfo&quot;</span><span class="p">][</span><span class="s2">&quot;Names&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
  409         <span class="n">SpecifiedSelection</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelectionsInfo&quot;</span><span class="p">][</span><span class="s2">&quot;Selections&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
  410         
  411         <span class="n">SelectionNameGroupID</span> <span class="o">=</span> <span class="n">SelectionName</span>
  412         
  413         <span class="c1"># Setup selection object...</span>
  414         <span class="n">SelectionObjectID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">Selection&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  415         <span class="n">SelectionObjectName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionObjectID</span><span class="p">]</span>
  416         <span class="n">SelectionCmd</span> <span class="o">=</span> <span class="s2">&quot;(</span><span class="si">%s</span><span class="s2"> and (</span><span class="si">%s</span><span class="s2">))&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainName</span><span class="p">,</span> <span class="n">SpecifiedSelection</span><span class="p">)</span>
  417         <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForSelectionDisplayView</span><span class="p">(</span><span class="n">SelectionObjectName</span><span class="p">,</span> <span class="n">SelectionCmd</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SelectionsChainStyle&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  418         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  419         
  420         <span class="c1"># Set up cryo-EM mesh and group...</span>
  421         <span class="n">CryoEMVolumeID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMVolume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  422         <span class="n">CryoEMMeshID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMMesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  423         <span class="n">CryoEMSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  424         <span class="n">CryoEMMeshGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMGroup&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  425         <span class="n">CryoEMMeshGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMGroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  426         
  427         <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMVolumeID</span><span class="p">]</span>
  428         <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshID</span><span class="p">]</span>
  429         <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMSurfaceID</span><span class="p">]</span>
  430         <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshGroupID</span><span class="p">]</span>
  431         <span class="n">CryoEMMeshGroupMembers</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span>
  432 
  433         <span class="n">MapName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span>
  434         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  435         <span class="n">Color</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">]</span>
  436         
  437         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">CryoEMVolumeName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">SelectionObjectName</span><span class="p">)</span>
  438         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  439         
  440         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">CryoEMMeshName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">SelectionObjectName</span><span class="p">)</span>
  441         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  442         
  443         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">CryoEMSurfaceName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">SelectionObjectName</span><span class="p">)</span>
  444         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  445         
  446         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">CryoEMMeshGroupName</span><span class="p">,</span> <span class="n">CryoEMMeshGroupMembers</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  447         
  448         <span class="c1"># Setup groups for named selections...</span>
  449         <span class="n">SelectionsNameGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  450         <span class="n">SelectionsNameGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">GroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  451         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsNameGroupID</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsNameGroupMembersID</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">)</span>
  452     
  453     <span class="c1"># Setup a group for selections...</span>
  454     <span class="n">SelectionsGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">)</span>
  455     <span class="n">SelectionsGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">GroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">)</span>
  456     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsGroupID</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsGroupMembersID</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  457         
  458 <span class="k">def</span> <span class="nf">WriteChainLigandView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">):</span>
  459     <span class="sd">&quot;&quot;&quot;Write out PML for viewing ligand in a chain.&quot;&quot;&quot;</span>
  460     
  461     <span class="k">for</span> <span class="n">GroupID</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Ligand&quot;</span><span class="p">,</span> <span class="s2">&quot;Pocket&quot;</span><span class="p">,</span> <span class="s2">&quot;PocketSolvent&quot;</span><span class="p">,</span> <span class="s2">&quot;PocketInorganic&quot;</span><span class="p">]:</span>
  462         <span class="n">ComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  463         <span class="n">LigandName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;Ligand&quot;</span><span class="p">]</span>
  464         
  465         <span class="c1"># Setup main object...</span>
  466         <span class="n">GroupTypeObjectID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  467         <span class="n">GroupTypeObjectName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupTypeObjectID</span><span class="p">]</span>
  468         
  469         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Ligand$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  470             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for ligand </span><span class="si">%s</span><span class="s2"> in chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LigandID</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">))</span>
  471             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForLigandView</span><span class="p">(</span><span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ComplexName</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
  472             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  473         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Pocket$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  474             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for pocket around ligand </span><span class="si">%s</span><span class="s2"> in chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LigandID</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">))</span>
  475             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForLigandPocketView</span><span class="p">(</span><span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ComplexName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketDistanceCutoff&quot;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
  476             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  477             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_color&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketLabelColor&quot;</span><span class="p">],</span> <span class="n">GroupTypeObjectName</span><span class="p">))</span>
  478         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^PocketSolvent$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  479             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for solvent in pockect around ligand </span><span class="si">%s</span><span class="s2"> in chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LigandID</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">))</span>
  480             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForLigandPocketSolventView</span><span class="p">(</span><span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ComplexName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketDistanceCutoff&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  481             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  482         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^PocketInorganic$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  483             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for inorganic in pockect around ligand </span><span class="si">%s</span><span class="s2"> in chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LigandID</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">))</span>
  484             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForLigandPocketInorganicView</span><span class="p">(</span><span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ComplexName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketDistanceCutoff&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  485             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  486         
  487         <span class="c1"># Set up cryoEM mesh and group...</span>
  488         <span class="n">CryoEMMeshGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMeshGroup&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  489         <span class="n">CryoEMMeshGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMeshGroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  490         <span class="n">CryoEMVolumeID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMVolume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  491         <span class="n">CryoEMMeshID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  492         <span class="n">CryoEMSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  493 
  494         <span class="n">CryoEMMapName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span>
  495         <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMVolumeID</span><span class="p">]</span>
  496         <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshID</span><span class="p">]</span>
  497         <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMSurfaceID</span><span class="p">]</span>
  498         <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupID</span><span class="p">]</span>
  499         <span class="n">CryoEMMeshGroupMembers</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span>
  500         
  501         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">CryoEMMapName</span><span class="p">,</span> <span class="n">CryoEMVolumeName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">GroupTypeObjectName</span><span class="p">)</span>
  502         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  503 
  504         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  505         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">CryoEMMapName</span><span class="p">,</span> <span class="n">CryoEMMeshName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">GroupTypeObjectName</span><span class="p">)</span>
  506         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  507         
  508         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">CryoEMMapName</span><span class="p">,</span> <span class="n">CryoEMSurfaceName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">GroupTypeObjectName</span><span class="p">)</span>
  509         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  510         
  511         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">CryoEMMeshGroupName</span><span class="p">,</span> <span class="n">CryoEMMeshGroupMembers</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  512         
  513         <span class="c1"># Set up polar contacts...</span>
  514         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(Pocket|PocketSolvent|PocketInorganic)$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  515             <span class="n">PolarContactsID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">PolarContacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  516             <span class="n">PolarContactsName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">PolarContactsID</span><span class="p">]</span>
  517             
  518             <span class="n">PolarContactsColor</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsLigandColor&quot;</span><span class="p">]</span>
  519             <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^PocketSolvent$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  520                 <span class="n">PolarContactsColor</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsSolventColor&quot;</span><span class="p">]</span>
  521             <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^PocketInorganic$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  522                 <span class="n">PolarContactsColor</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsInorganicColor&quot;</span><span class="p">]</span>
  523             
  524             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForPolarContactsView</span><span class="p">(</span><span class="n">PolarContactsName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Color</span> <span class="o">=</span> <span class="n">PolarContactsColor</span><span class="p">,</span> <span class="n">Cutoff</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsCutoff&quot;</span><span class="p">])</span>
  525             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  526             
  527             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_color&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PolarContactsColor</span><span class="p">,</span> <span class="n">PolarContactsName</span><span class="p">))</span>
  528             
  529         <span class="c1"># Set up hydrophobic contacts...</span>
  530         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Pocket$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  531             <span class="n">HydrophobicContactsID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">HydrophobicContacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  532             <span class="n">HydrophobicContactsName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">HydrophobicContactsID</span><span class="p">]</span>
  533             <span class="n">HydrophobicContactsColor</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsLigandHydrophobicColor&quot;</span><span class="p">]</span>
  534             
  535             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForHydrophobicContactsView</span><span class="p">(</span><span class="n">HydrophobicContactsName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Color</span> <span class="o">=</span> <span class="n">HydrophobicContactsColor</span><span class="p">,</span> <span class="n">Cutoff</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsCutoff&quot;</span><span class="p">])</span>
  536             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  537             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_color&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">HydrophobicContactsColor</span><span class="p">,</span> <span class="n">HydrophobicContactsName</span><span class="p">))</span>
  538             
  539         <span class="c1"># Set up hydrophobic surface...</span>
  540         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Pocket$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="ow">and</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketSurface&quot;</span><span class="p">]:</span>
  541             <span class="n">HydrophobicSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">HydrophobicSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  542             <span class="n">HydrophobicSurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">HydrophobicSurfaceID</span><span class="p">]</span>
  543             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForHydrophobicSurfaceView</span><span class="p">(</span><span class="n">HydrophobicSurfaceName</span><span class="p">,</span> <span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ColorPalette</span> <span class="o">=</span> <span class="s2">&quot;RedToWhite&quot;</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
  544             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  545             
  546             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_color&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketLabelColor&quot;</span><span class="p">],</span> <span class="n">HydrophobicSurfaceName</span><span class="p">))</span>
  547         
  548         <span class="c1"># Setup group....</span>
  549         <span class="n">GroupNameID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  550         <span class="n">GroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">GroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  551         <span class="n">GroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupNameID</span><span class="p">]</span>
  552         <span class="n">GroupMembers</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span>
  553 
  554         <span class="n">Action</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span>
  555         <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span>
  556         <span class="k">if</span>  <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(Ligand|Pocket)$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  557             <span class="n">Action</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span>
  558             <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span>
  559         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupMembers</span><span class="p">,</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  560 
  561 <span class="k">def</span> <span class="nf">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupMembers</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
  562     <span class="sd">&quot;&quot;&quot;Generate and write PML for group. &quot;&quot;&quot;</span>
  563     
  564     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForGroup</span><span class="p">(</span><span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupMembers</span><span class="p">,</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  565     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up group </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">GroupName</span><span class="p">)</span>
  566     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  567 
  568 <span class="k">def</span> <span class="nf">SetupPMLForCryoEMDensityMap</span><span class="p">(</span><span class="n">MapFileName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">AlignMapToObjectName</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
  569     <span class="sd">&quot;&quot;&quot;Setup PML for loading and viewing cryo-EM density map. &quot;&quot;&quot;</span>
  570 
  571     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  572     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.load(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MapFileName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">))</span>
  573     <span class="k">if</span> <span class="n">AlignMapToObjectName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  574         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.matrix_copy(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AlignMapToObjectName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">))</span>
  575         
  576     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForEnableDisable</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">Enable</span><span class="p">))</span>
  577     
  578     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  579     
  580     <span class="k">return</span> <span class="n">PML</span>
  581     
  582 <span class="k">def</span> <span class="nf">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">MeshName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  583     <span class="sd">&quot;&quot;&quot;Setup PML for cryo-EM density mesh. &quot;&quot;&quot;</span>
  584 
  585     <span class="n">Carve</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshCarveRadius&quot;</span><span class="p">]</span>
  586     
  587     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  588     <span class="k">if</span> <span class="n">Selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  589         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isomesh(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MeshName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">))</span>
  590     <span class="k">else</span><span class="p">:</span>
  591         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isomesh(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%.1f</span><span class="s2">, &quot;(</span><span class="si">%s</span><span class="s2">)&quot;, carve = </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MeshName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="n">Carve</span><span class="p">))</span>
  592     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.color_deep(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="n">MeshName</span><span class="p">))</span>
  593     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForEnableDisable</span><span class="p">(</span><span class="n">MeshName</span><span class="p">,</span> <span class="n">Enable</span><span class="p">))</span>
  594     
  595     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  596     
  597     <span class="k">return</span> <span class="n">PML</span>
  598 
  599 <span class="k">def</span> <span class="nf">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  600     <span class="sd">&quot;&quot;&quot;Setup PML for cryo-EM density volume. &quot;&quot;&quot;</span>
  601 
  602     <span class="n">Carve</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeCarveRadius&quot;</span><span class="p">]</span>
  603     
  604     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  605     <span class="k">if</span> <span class="n">Selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  606         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.volume(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">VolumeName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">))</span>
  607     <span class="k">else</span><span class="p">:</span>
  608         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.volume(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;(</span><span class="si">%s</span><span class="s2">)&quot;, carve = </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">VolumeName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="n">Carve</span><span class="p">))</span>
  609     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForEnableDisable</span><span class="p">(</span><span class="n">VolumeName</span><span class="p">,</span> <span class="n">Enable</span><span class="p">))</span>
  610     
  611     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  612     
  613     <span class="k">return</span> <span class="n">PML</span>
  614 
  615 <span class="k">def</span> <span class="nf">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">SurfaceName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  616     <span class="sd">&quot;&quot;&quot;Setup PML for cryo-EM density surface. &quot;&quot;&quot;</span>
  617 
  618     <span class="n">Carve</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshCarveRadius&quot;</span><span class="p">]</span>
  619     
  620     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  621     <span class="k">if</span> <span class="n">Selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  622         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isosurface(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SurfaceName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">))</span>
  623     <span class="k">else</span><span class="p">:</span>
  624         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isosurface(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%.1f</span><span class="s2">, &quot;(</span><span class="si">%s</span><span class="s2">)&quot;, carve = </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SurfaceName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="n">Carve</span><span class="p">))</span>
  625     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.color_deep(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="n">SurfaceName</span><span class="p">))</span>
  626     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForEnableDisable</span><span class="p">(</span><span class="n">SurfaceName</span><span class="p">,</span> <span class="n">Enable</span><span class="p">))</span>
  627     
  628     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  629     
  630     <span class="k">return</span> <span class="n">PML</span>
  631 
  632 <span class="k">def</span> <span class="nf">GeneratePyMOLSessionFile</span><span class="p">():</span>
  633     <span class="sd">&quot;&quot;&quot;Generate PME file from PML file. &quot;&quot;&quot;</span>
  634 
  635     <span class="n">PSEOutfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOutfile&quot;</span><span class="p">]</span>
  636     <span class="n">PMLOutfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span>
  637     
  638     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">PSEOutfile</span><span class="p">)</span>
  639     
  640     <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">ConvertPMLFileToPSEFile</span><span class="p">(</span><span class="n">PMLOutfile</span><span class="p">,</span> <span class="n">PSEOutfile</span><span class="p">)</span>
  641     
  642     <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PSEOutfile</span><span class="p">):</span>
  643         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to generate PSE file, </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PSEOutfile</span><span class="p">))</span>
  644     
  645     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOut&quot;</span><span class="p">]:</span>
  646         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Deleting file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">PMLOutfile</span><span class="p">)</span>
  647         <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">PMLOutfile</span><span class="p">)</span>
  648 
  649 <span class="k">def</span> <span class="nf">DeleteEmptyPyMOLObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">):</span>
  650     <span class="sd">&quot;&quot;&quot;Delete empty PyMOL objects. &quot;&quot;&quot;</span>
  651     
  652     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AllowEmptyObjects&quot;</span><span class="p">]:</span>
  653         <span class="k">return</span>
  654     
  655     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  656     <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
  657         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Checking and deleting empty objects for chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainID</span><span class="p">))</span>
  658         
  659         <span class="c1"># Delete any chain level objects...</span>
  660         <span class="n">WritePMLToCheckAndDeleteEmptyObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;Solvent&quot;</span><span class="p">])</span>
  661         <span class="n">WritePMLToCheckAndDeleteEmptyObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;Inorganic&quot;</span><span class="p">])</span>
  662         
  663         <span class="k">for</span> <span class="n">LigandID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]:</span>
  664             <span class="c1"># Delete ligand level objects...</span>
  665             <span class="k">for</span> <span class="n">GroupID</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Pocket&quot;</span><span class="p">,</span> <span class="s2">&quot;PocketSolvent&quot;</span><span class="p">,</span> <span class="s2">&quot;PocketInorganic&quot;</span><span class="p">]:</span>
  666                 <span class="n">GroupNameID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  667                 <span class="n">GroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupNameID</span><span class="p">]</span>
  668 
  669                 <span class="n">GroupTypeObjectID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  670                 <span class="n">GroupTypeObjectName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupTypeObjectID</span><span class="p">]</span>
  671                 
  672                 <span class="n">WritePMLToCheckAndDeleteEmptyObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">GroupName</span><span class="p">)</span>
  673 
  674 <span class="k">def</span> <span class="nf">WritePMLToCheckAndDeleteEmptyObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ObjectName</span><span class="p">,</span> <span class="n">ParentObjectName</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  675     <span class="sd">&quot;&quot;&quot;Write PML to check and delete empty PyMOL objects. &quot;&quot;&quot;</span>
  676     
  677     <span class="k">if</span> <span class="n">ParentObjectName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  678         <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CheckAndDeleteEmptyObjects(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ObjectName</span><span class="p">)</span>
  679     <span class="k">else</span><span class="p">:</span>
  680         <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CheckAndDeleteEmptyObjects(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ObjectName</span><span class="p">,</span> <span class="n">ParentObjectName</span><span class="p">)</span>
  681     
  682     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  683 
  684 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNames</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">):</span>
  685     <span class="sd">&quot;&quot;&quot;Setup hierarchy of PyMOL groups and objects for ligand centric views of</span>
  686 <span class="sd">    cryo-EM density for chains and ligands present in input file.</span>
  687 <span class="sd">    &quot;&quot;&quot;</span>
  688 
  689     <span class="n">PyMOLObjectNames</span> <span class="o">=</span> <span class="p">{}</span>
  690     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  691     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  692 
  693     <span class="c1"># Setup groups and objects for complex...</span>
  694     <span class="n">SetupPyMOLObjectNamesForComplex</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">)</span>
  695     
  696     <span class="c1"># Setup groups and objects for chain...</span>
  697     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  698     <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
  699         <span class="n">SetupPyMOLObjectNamesForChain</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  700         
  701         <span class="c1"># Setup groups and objects for ligand...</span>
  702         <span class="k">for</span> <span class="n">LigandID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]:</span>
  703             <span class="n">SetupPyMOLObjectNamesForLigand</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">)</span>
  704 
  705     <span class="k">return</span> <span class="n">PyMOLObjectNames</span>
  706 
  707 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForComplex</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">):</span>
  708     <span class="sd">&quot;&quot;&quot;Stetup groups and objects for complex. &quot;&quot;&quot;</span>
  709     
  710     <span class="n">PDBFileRoot</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesRoots&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  711     
  712     <span class="n">PDBGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PDBFileRoot</span>
  713     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PDBGroupName</span>
  714     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  715 
  716     <span class="n">ComplexGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Complex&quot;</span> <span class="o">%</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroup&quot;</span><span class="p">]</span>
  717     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ComplexGroupName</span>
  718     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ComplexGroupName</span><span class="p">)</span>
  719     
  720     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Complex&quot;</span> <span class="o">%</span> <span class="n">ComplexGroupName</span>
  721 
  722     <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.CryoEM&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ComplexGroupName</span><span class="p">)</span>
  723     <span class="n">CryoEMMapName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Map&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  724     <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Volume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  725     <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Mesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  726     <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  727     
  728     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshGroupName</span>
  729     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMapName</span>
  730     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMVolume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMVolumeName</span>
  731     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshName</span>
  732     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMSurface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMSurfaceName</span>
  733 
  734     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  735     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMapName</span><span class="p">)</span>
  736     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeComplex&quot;</span><span class="p">]:</span>
  737         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMVolumeName</span><span class="p">)</span>
  738     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshComplex&quot;</span><span class="p">]:</span>
  739         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMeshName</span><span class="p">)</span>
  740     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceComplex&quot;</span><span class="p">]:</span>
  741         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMSurfaceName</span><span class="p">)</span>
  742     
  743     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  744     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">])</span>
  745     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroup&quot;</span><span class="p">])</span>
  746     
  747 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForChain</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  748     <span class="sd">&quot;&quot;&quot;Setup groups and objects for chain.&quot;&quot;&quot;</span>
  749     
  750     <span class="n">PDBGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroup&quot;</span><span class="p">]</span>
  751     
  752     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  753     <span class="n">MeshChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  754     <span class="n">VolumeChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  755     <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  756     
  757     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  758     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  759     
  760     <span class="c1"># Set up chain group and chain objects...</span>
  761     <span class="n">ChainGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Chain</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PDBGroupName</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  762     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainGroupName</span>
  763     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainGroupName</span><span class="p">)</span>
  764     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  765     
  766     <span class="c1"># Setup chain complex group and objects...</span>
  767     <span class="n">ChainComplexGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Complex&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainGroupName</span><span class="p">)</span>
  768     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainComplexGroupName</span>
  769     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainComplexGroupName</span><span class="p">)</span>
  770     
  771     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Complex&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainComplexGroupName</span><span class="p">)</span>
  772     
  773     <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.CryoEM&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainComplexGroupName</span><span class="p">)</span>
  774     <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Volume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  775     <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Mesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  776     <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  777     
  778     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshGroupName</span>
  779     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMVolume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMVolumeName</span>
  780     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMMesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshName</span>
  781     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMSurface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMSurfaceName</span>
  782     
  783     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  784     <span class="k">if</span> <span class="n">VolumeChainComplex</span><span class="p">:</span>
  785         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMVolumeName</span><span class="p">)</span>
  786     <span class="k">if</span> <span class="n">MeshChainComplex</span><span class="p">:</span>
  787         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMeshName</span><span class="p">)</span>
  788     <span class="k">if</span> <span class="n">SurfaceChainComplex</span><span class="p">:</span>
  789         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMSurfaceName</span><span class="p">)</span>
  790     
  791     <span class="n">NameIDs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  792     <span class="k">if</span> <span class="n">MeshChainComplex</span> <span class="ow">or</span> <span class="n">VolumeChainComplex</span> <span class="ow">or</span> <span class="n">SurfaceChainComplex</span> <span class="p">:</span>
  793         <span class="n">NameIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ChainComplexCryoEMGroup&quot;</span><span class="p">)</span>
  794     
  795     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  796     <span class="k">for</span> <span class="n">NameID</span> <span class="ow">in</span> <span class="n">NameIDs</span><span class="p">:</span>
  797         <span class="n">Name</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">NameID</span><span class="p">]</span>
  798         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  799 
  800     <span class="c1"># Setup up a group for individual chains...</span>
  801     <span class="n">ChainAloneGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Chain&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainGroupName</span><span class="p">)</span>
  802     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainAloneGroupName</span>
  803     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainAloneGroupName</span><span class="p">)</span>
  804         
  805     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  806         
  807     <span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Chain&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainAloneGroupName</span><span class="p">)</span>
  808     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAlone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Name</span>
  809     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  810         
  811     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorChainCartoonPutty&quot;</span><span class="p">]:</span>
  812         <span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.BFactor&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainAloneGroupName</span><span class="p">)</span>
  813         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneBFactorPutty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Name</span>
  814         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  815     
  816     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelections&quot;</span><span class="p">]:</span>
  817         <span class="c1"># Setup selections group and its subgroups..</span>
  818         <span class="n">SelectionsGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Selections&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainAloneGroupName</span><span class="p">)</span>
  819         
  820         <span class="n">SelectionsGroupIDPrefix</span> <span class="o">=</span> <span class="s2">&quot;ChainAloneSelections&quot;</span>
  821         <span class="n">SelectionsGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="n">SelectionsGroupIDPrefix</span>
  822         
  823         <span class="c1"># Add selections group to chain alone group...</span>
  824         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsGroupID</span><span class="p">]</span> <span class="o">=</span> <span class="n">SelectionsGroupName</span>
  825         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SelectionsGroupName</span><span class="p">)</span>
  826         
  827         <span class="c1"># Initialize selections group members...</span>
  828         <span class="n">SelectionsGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">GroupMembers&quot;</span> <span class="o">%</span> <span class="n">SelectionsGroupIDPrefix</span>
  829         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsGroupMembersID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  830         
  831         <span class="c1"># Setup selections name sub group and its members...</span>
  832         <span class="k">for</span> <span class="n">SelectionName</span> <span class="ow">in</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelectionsInfo&quot;</span><span class="p">][</span><span class="s2">&quot;Names&quot;</span><span class="p">]:</span>
  833             <span class="n">SelectionNameGroupID</span> <span class="o">=</span> <span class="n">SelectionName</span>
  834             
  835             <span class="n">SelectionsNameGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupName</span><span class="p">,</span> <span class="n">SelectionName</span><span class="p">)</span>
  836             <span class="n">SelectionsNameGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  837 
  838             <span class="c1"># Add selections name sub group to selections group...</span>
  839             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsNameGroupID</span><span class="p">]</span> <span class="o">=</span> <span class="n">SelectionsNameGroupName</span>
  840             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SelectionsNameGroupName</span><span class="p">)</span>
  841             
  842             <span class="c1"># Initialize selections names sub group members...</span>
  843             <span class="n">SelectionsNameGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">GroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  844             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsNameGroupMembersID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  845 
  846             <span class="c1"># Add selection object to selections name group...</span>
  847             <span class="n">SelectionObjectName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Selection&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsNameGroupName</span><span class="p">)</span>
  848             <span class="n">SelectionObjectID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">Selection&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  849             
  850             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionObjectID</span><span class="p">]</span> <span class="o">=</span> <span class="n">SelectionObjectName</span>
  851             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsNameGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SelectionObjectName</span><span class="p">)</span>
  852             
  853             <span class="c1"># Setup cryo-EM mesh group and add it to selections name group...</span>
  854             <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.CryoEM&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsNameGroupName</span><span class="p">)</span>
  855             <span class="n">CryoEMMeshGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMGroup&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  856             
  857             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshGroupID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshGroupName</span>
  858             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">SelectionsNameGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  859             
  860             <span class="c1"># Initialize cryo-EM mesh group members...</span>
  861             <span class="n">CryoEMMeshGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMGroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  862             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  863 
  864             <span class="c1"># Setup members of cryo-EM mesh group...</span>
  865             <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Volume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  866             <span class="n">CryoEMVolumeID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMVolume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  867             <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Mesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  868             <span class="n">CryoEMMeshID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMMesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  869             <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  870             <span class="n">CryoEMSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s%s</span><span class="s2">CryoEMSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SelectionsGroupIDPrefix</span><span class="p">,</span> <span class="n">SelectionNameGroupID</span><span class="p">)</span>
  871     
  872             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMVolumeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMVolumeName</span>
  873             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshName</span>
  874             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMSurfaceID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMSurfaceName</span>
  875 
  876             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMVolumeName</span><span class="p">)</span>
  877             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMeshName</span><span class="p">)</span>
  878             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMSurfaceName</span><span class="p">)</span>
  879     
  880     <span class="c1"># Setup solvent and inorganic objects for chain...</span>
  881     <span class="k">for</span> <span class="n">NameID</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Solvent&quot;</span><span class="p">,</span> <span class="s2">&quot;Inorganic&quot;</span><span class="p">]:</span>
  882         <span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainGroupName</span><span class="p">,</span> <span class="n">NameID</span><span class="p">)</span>
  883         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">NameID</span><span class="p">]</span> <span class="o">=</span> <span class="n">Name</span>
  884         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  885 
  886 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForLigand</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">):</span>
  887     <span class="sd">&quot;&quot;&quot;Stetup groups and objects for ligand.&quot;&quot;&quot;</span>
  888 
  889     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  890     
  891     <span class="n">ChainGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroup&quot;</span><span class="p">]</span>
  892     
  893     <span class="c1"># Setup a chain level ligand group...</span>
  894     <span class="n">ChainLigandGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Ligand</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainGroupName</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">)</span>
  895     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainLigandGroupName</span>
  896     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainLigandGroupName</span><span class="p">)</span>
  897     
  898     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  899 
  900     <span class="c1"># Set up groups and objects for a specific ligand group...</span>
  901     <span class="k">for</span> <span class="n">GroupType</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Ligand&quot;</span><span class="p">,</span> <span class="s2">&quot;Pocket&quot;</span><span class="p">,</span> <span class="s2">&quot;Pocket_Solvent&quot;</span><span class="p">,</span> <span class="s2">&quot;Pocket_Inorganic&quot;</span><span class="p">]:</span>
  902         <span class="n">GroupID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">)</span>
  903         <span class="n">GroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainLigandGroupName</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">)</span>
  904                 
  905         <span class="n">GroupNameID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  906         <span class="n">GroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">GroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  907         
  908         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupNameID</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupName</span>
  909         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  910         
  911         <span class="n">GroupTypeObjectName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">)</span>
  912         <span class="n">GroupTypeObjectID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  913         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupTypeObjectID</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupTypeObjectName</span>
  914         
  915         <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.CryoEM&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  916         <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Volume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  917         <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Mesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  918         <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  919                 
  920         <span class="n">CryoEMMeshGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMeshGroup&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  921         <span class="n">CryoEMMeshGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMeshGroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  922         <span class="n">CryoEMVolumeID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMVolume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  923         <span class="n">CryoEMMeshID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  924         <span class="n">CryoEMSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  925         
  926         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshGroupName</span>
  927         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMVolumeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMVolumeName</span>
  928         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshName</span>
  929         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMSurfaceID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMSurfaceName</span>
  930         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  931         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMVolumeName</span><span class="p">)</span>
  932         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMeshName</span><span class="p">)</span>
  933         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMSurfaceName</span><span class="p">)</span>
  934                 
  935         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  936         <span class="n">NameIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">GroupTypeObjectID</span><span class="p">,</span> <span class="n">CryoEMMeshGroupID</span><span class="p">]</span>
  937         
  938         <span class="k">for</span> <span class="n">NameID</span> <span class="ow">in</span> <span class="n">NameIDs</span><span class="p">:</span>
  939             <span class="n">Name</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">NameID</span><span class="p">]</span>
  940             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  941         
  942         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Ligand$&quot;</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  943             <span class="c1"># No other object needed for Ligand group...</span>
  944             <span class="k">continue</span>
  945         
  946         <span class="n">PolarContactsName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Polar_Contacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  947         <span class="n">PolarContactsID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">PolarContacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  948         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">PolarContactsID</span><span class="p">]</span> <span class="o">=</span> <span class="n">PolarContactsName</span>
  949         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PolarContactsName</span><span class="p">)</span>
  950                 
  951         <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Pocket$&quot;</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  952             <span class="c1"># No other object needed for any other group besides Pocket...</span>
  953             <span class="k">continue</span>
  954         
  955         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketSurface&quot;</span><span class="p">]:</span>
  956             <span class="k">continue</span>
  957 
  958         <span class="n">HydrophobicContactsName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Hydrophobic_Contacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  959         <span class="n">HydrophobicContactsID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">HydrophobicContacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  960         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">HydrophobicContactsID</span><span class="p">]</span> <span class="o">=</span> <span class="n">HydrophobicContactsName</span>
  961         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HydrophobicContactsName</span><span class="p">)</span>
  962         
  963         <span class="n">HydrophobicSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  964         <span class="n">HydrophobicSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">HydrophobicSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  965         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">HydrophobicSurfaceID</span><span class="p">]</span> <span class="o">=</span> <span class="n">HydrophobicSurfaceName</span>
  966         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HydrophobicSurfaceName</span><span class="p">)</span>
  967 
  968 <span class="k">def</span> <span class="nf">ProcessDensityMapFiles</span><span class="p">():</span>
  969     <span class="sd">&quot;&quot;&quot;Process density map files.&quot;&quot;&quot;</span>
  970     
  971     <span class="n">DensityMapFiles</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFiles&quot;</span><span class="p">]</span>
  972     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">DensityMapFiles</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  973         <span class="n">ProcessAutoDensityMapFiles</span><span class="p">()</span>
  974     <span class="k">else</span><span class="p">:</span>
  975         <span class="n">ProcessSpecifiedDensityMapFiles</span><span class="p">()</span>
  976         
  977 <span class="k">def</span> <span class="nf">ProcessSpecifiedDensityMapFiles</span><span class="p">():</span>
  978     <span class="sd">&quot;&quot;&quot;Process specified density map files.&quot;&quot;&quot;</span>
  979     
  980     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  981     
  982     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing cryo-EM density file names...&quot;</span><span class="p">)</span>
  983     
  984     <span class="n">DensityMapFiles</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFiles&quot;</span><span class="p">])</span>
  985     <span class="k">if</span> <span class="ow">not</span> <span class="n">DensityMapFiles</span><span class="p">:</span>
  986         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No valid value specified using </span><span class="se">\&quot;</span><span class="s2">--densityMapFiles</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span><span class="p">)</span>
  987     
  988     <span class="n">DensityMapFilesWords</span> <span class="o">=</span> <span class="n">DensityMapFiles</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
  989     <span class="n">DensityMapFilesWordsCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DensityMapFilesWords</span><span class="p">)</span>
  990     
  991     <span class="n">InfilesNamesCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])</span>
  992     
  993     <span class="k">if</span> <span class="n">DensityMapFilesWordsCount</span> <span class="o">!=</span> <span class="n">InfilesNamesCount</span><span class="p">:</span>
  994         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of comma delimited cryo-EM density map files, </span><span class="si">%d</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">--DensityMapFiles</span><span class="se">\&quot;</span><span class="s2"> must be equal to the number of input files, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">-i, --infiles</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DensityMapFilesWordsCount</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">))</span>
  995     
  996     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">):</span>
  997         <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
  998         <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="n">DensityMapFilesWords</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span>
  999         
 1000         <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DensityMapFile</span><span class="p">):</span>
 1001             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The cryo-EM density ED map file, </span><span class="si">%s</span><span class="s2">, specified using option </span><span class="se">\&quot;</span><span class="s2">--DensityMapFiles</span><span class="se">\&quot;</span><span class="s2">, corresponding to input file, </span><span class="si">%s</span><span class="s2">,  doesn&#39;t exist.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DensityMapFile</span><span class="p">,</span> <span class="n">Infile</span><span class="p">))</span>
 1002         
 1003         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DensityMapFile</span><span class="p">)</span>
 1004     
 1005 <span class="k">def</span> <span class="nf">ProcessAutoDensityMapFiles</span><span class="p">():</span>
 1006     <span class="sd">&quot;&quot;&quot;Set up and process name of density map files.&quot;&quot;&quot;</span>
 1007     
 1008     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1009     <span class="n">InfilesNamesCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])</span>
 1010 
 1011     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Setting cryo-EM density file names...&quot;</span><span class="p">)</span>
 1012     
 1013     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">):</span>
 1014         <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
 1015         
 1016         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">RetrieveEMDBID</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1017         <span class="k">if</span> <span class="n">EMDBID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1018             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve EMDB ID from input file </span><span class="si">%s</span><span class="s2"> to automatically set density map file name. Use option </span><span class="se">\&quot;</span><span class="s2">-d, --densityMapFiles </span><span class="se">\&quot;</span><span class="s2"> to specify density map file name and try again.&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
 1019         
 1020         <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="bp">None</span>
 1021         <span class="n">MapFileRoot</span> <span class="o">=</span> <span class="s2">&quot;emd_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">EMDBID</span>
 1022         <span class="n">MapFile1</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.map.gz&quot;</span> <span class="o">%</span> <span class="n">MapFileRoot</span>
 1023         <span class="n">MapFile2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.map&quot;</span> <span class="o">%</span> <span class="n">MapFileRoot</span>
 1024         <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MapFile1</span><span class="p">):</span>
 1025             <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="n">MapFile1</span>
 1026         <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MapFile2</span><span class="p">):</span>
 1027             <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="n">MapFile2</span>
 1028         <span class="k">else</span><span class="p">:</span>
 1029             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Density map files </span><span class="si">%s</span><span class="s2"> or </span><span class="si">%s</span><span class="s2"> don&#39;t exist. Use option </span><span class="se">\&quot;</span><span class="s2">-d, --densityMapFiles </span><span class="se">\&quot;</span><span class="s2"> to specify density map file name and try again&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MapFile1</span><span class="p">,</span> <span class="n">MapFile2</span><span class="p">))</span>
 1030     
 1031         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Setting density map file name as </span><span class="si">%s</span><span class="s2"> for input file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DensityMapFile</span><span class="p">,</span> <span class="n">Infile</span><span class="p">))</span>
 1032         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DensityMapFile</span><span class="p">)</span>
 1033         
 1034 <span class="k">def</span> <span class="nf">RetrieveRecommededContourLevel</span><span class="p">(</span><span class="n">Infile</span><span class="p">):</span>
 1035     <span class="sd">&quot;&quot;&quot;Retrieve recommened contour level.&quot;&quot;&quot;</span>
 1036 
 1037     <span class="k">if</span> <span class="n">Infile</span> <span class="ow">in</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">]:</span>
 1038         <span class="n">RecommendedContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span>
 1039         <span class="k">return</span> <span class="n">RecommendedContourLevel</span>
 1040     
 1041     <span class="n">RecommendedContourLevel</span> <span class="o">=</span> <span class="bp">None</span>
 1042     <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">RetrieveEMDBID</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1043     <span class="k">if</span> <span class="n">EMDBID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1044         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve EMDB ID from input file </span><span class="si">%s</span><span class="s2"> to detect local header file already downloaded from EMDB server...&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
 1045         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecommendedContourLevel</span>
 1046         <span class="k">return</span> <span class="n">RecommendedContourLevel</span>
 1047 
 1048     <span class="n">MetadataHeaderFile</span> <span class="o">=</span> <span class="s2">&quot;emd-</span><span class="si">%s</span><span class="s2">.xml&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">EMDBID</span><span class="p">)</span>
 1049     <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MetadataHeaderFile</span><span class="p">):</span>
 1050         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to find a local header file, </span><span class="si">%s</span><span class="s2">, for EMDB ID </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MetadataHeaderFile</span><span class="p">,</span> <span class="n">EMDBID</span><span class="p">))</span>
 1051         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecommendedContourLevel</span>
 1052         <span class="k">return</span> <span class="n">RecommendedContourLevel</span>
 1053 
 1054     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving recommeded contour level from header file, </span><span class="si">%s</span><span class="s2">, for input file, </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MetadataHeaderFile</span><span class="p">,</span> <span class="n">Infile</span><span class="p">))</span>
 1055 
 1056     <span class="n">ContourLevel</span> <span class="o">=</span> <span class="bp">None</span>
 1057     <span class="n">Source</span> <span class="o">=</span> <span class="bp">None</span>
 1058     <span class="n">XMLTree</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">MetadataHeaderFile</span><span class="p">)</span>
 1059     <span class="n">XMLRoot</span> <span class="o">=</span> <span class="n">XMLTree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
 1060 
 1061     <span class="n">MapElement</span> <span class="o">=</span> <span class="n">XMLTree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">)</span>
 1062     <span class="k">if</span> <span class="n">MapElement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 1063         <span class="n">ContourLevelElement</span> <span class="o">=</span> <span class="n">MapElement</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;contourLevel&quot;</span><span class="p">)</span>
 1064         <span class="k">if</span> <span class="n">ContourLevelElement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 1065             <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">ContourLevelElement</span><span class="o">.</span><span class="n">text</span>
 1066             <span class="n">Source</span> <span class="o">=</span> <span class="n">ContourLevelElement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">)</span>
 1067 
 1068     <span class="k">if</span> <span class="n">ContourLevel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
 1069         <span class="k">if</span> <span class="n">Source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1070             <span class="n">Source</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
 1071         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Retrieved recommended (Source: </span><span class="si">%s</span><span class="s2">) contour level </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Source</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">))</span>
 1072         <span class="n">RecommendedContourLevel</span> <span class="o">=</span> <span class="n">ContourLevel</span>
 1073     
 1074     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecommendedContourLevel</span>
 1075     
 1076     <span class="k">return</span> <span class="n">RecommendedContourLevel</span>
 1077 
 1078 <span class="k">def</span> <span class="nf">RetrieveEMDBID</span><span class="p">(</span><span class="n">Infile</span><span class="p">):</span>
 1079     <span class="sd">&quot;&quot;&quot;Retrieve EMDB ID from input file. &quot;&quot;&quot;</span>
 1080 
 1081     <span class="k">if</span> <span class="n">Infile</span> <span class="ow">in</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesEMDBIDs&quot;</span><span class="p">]:</span>
 1082         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesEMDBIDs&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span>
 1083         <span class="k">return</span> <span class="n">EMDBID</span>
 1084     
 1085     <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
 1086     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1087 
 1088     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^pdb$&quot;</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1089         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">RetriveEMDBIDFromPDBFile</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1090     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^cif$&quot;</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1091         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">RetriveEMDBIDFromCIFFile</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1092     <span class="k">else</span><span class="p">:</span>
 1093         <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
 1094 
 1095     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesEMDBIDs&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span> <span class="o">=</span> <span class="n">EMDBID</span>
 1096     
 1097     <span class="k">return</span> <span class="n">EMDBID</span>
 1098 
 1099 <span class="k">def</span> <span class="nf">RetriveEMDBIDFromPDBFile</span><span class="p">(</span><span class="n">Infile</span><span class="p">):</span>
 1100     <span class="sd">&quot;&quot;&quot;Retrieve EMDB ID from PDB file. &quot;&quot;&quot;</span>
 1101 
 1102     <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
 1103     <span class="n">InfileFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Infile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
 1104     <span class="k">if</span> <span class="n">InfileFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1105         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open input file: </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Infile</span><span class="p">))</span>
 1106 
 1107     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving EMDB ID from input file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
 1108     
 1109     <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
 1110     <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">InfileFH</span><span class="p">:</span>
 1111         <span class="n">Line</span> <span class="o">=</span> <span class="n">Line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
 1112         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^REMARK&quot;</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1113             <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;DB: EMDB&quot;</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1114                 <span class="k">for</span> <span class="n">Word</span> <span class="ow">in</span> <span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
 1115                     <span class="c1"># Retrieve string with EMD-</span>
 1116                     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;EMD-&quot;</span><span class="p">,</span> <span class="n">Word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1117                         <span class="n">Word</span> <span class="o">=</span> <span class="n">Word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 1118                         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;EMD-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">Word</span><span class="p">)</span>
 1119                         <span class="k">break</span>
 1120                 <span class="k">break</span>
 1121     <span class="n">InfileFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
 1122     
 1123     <span class="k">return</span> <span class="n">EMDBID</span>
 1124 
 1125 <span class="k">def</span> <span class="nf">RetriveEMDBIDFromCIFFile</span><span class="p">(</span><span class="n">Infile</span><span class="p">):</span>
 1126     <span class="sd">&quot;&quot;&quot;Retrieve EMDB ID from CIF file. &quot;&quot;&quot;</span>
 1127 
 1128     <span class="n">InfileFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Infile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
 1129     <span class="k">if</span> <span class="n">InfileFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1130         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open input file: </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Infile</span><span class="p">))</span>
 1131 
 1132     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving EMDB ID from input file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
 1133     
 1134     <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
 1135     <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">InfileFH</span><span class="p">:</span>
 1136         <span class="n">Line</span> <span class="o">=</span> <span class="n">Line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
 1137         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^EMDB  EMD&quot;</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1138             <span class="k">for</span> <span class="n">Word</span> <span class="ow">in</span> <span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
 1139                 <span class="c1"># Retrieve string with EMD-</span>
 1140                 <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;EMD-&quot;</span><span class="p">,</span> <span class="n">Word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1141                     <span class="n">Word</span> <span class="o">=</span> <span class="n">Word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 1142                     <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;EMD-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">Word</span><span class="p">)</span>
 1143                     <span class="k">break</span>
 1144             <span class="k">break</span>
 1145     <span class="n">InfileFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
 1146     
 1147     <span class="k">return</span> <span class="n">EMDBID</span>
 1148 
 1149 <span class="k">def</span> <span class="nf">RetrieveInfilesInfo</span><span class="p">():</span>
 1150     <span class="sd">&quot;&quot;&quot;Retrieve information for input files.&quot;&quot;&quot;</span>
 1151 
 1152     <span class="n">InfilesInfo</span> <span class="o">=</span> <span class="p">{}</span>
 1153     
 1154     <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1155     <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRoots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1156     <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1157     
 1158     <span class="k">for</span> <span class="n">Infile</span> <span class="ow">in</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">]:</span>
 1159         <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1160         <span class="n">InfileRoot</span> <span class="o">=</span> <span class="n">FileName</span>
 1161         
 1162         <span class="n">ChainsAndLigandInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">GetChainsAndLigandsInfo</span><span class="p">(</span><span class="n">Infile</span><span class="p">,</span> <span class="n">InfileRoot</span><span class="p">)</span>
 1163         
 1164         <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1165         <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRoots&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfileRoot</span><span class="p">)</span>
 1166         <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainsAndLigandInfo</span><span class="p">)</span>
 1167     
 1168     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">InfilesInfo</span>
 1169 
 1170 <span class="k">def</span> <span class="nf">RetrieveRefFileInfo</span><span class="p">():</span>
 1171     <span class="sd">&quot;&quot;&quot;Retrieve information for ref file.&quot;&quot;&quot;</span>
 1172 
 1173     <span class="n">RefFileInfo</span> <span class="o">=</span> <span class="p">{}</span>
 1174     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]:</span>
 1175         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefFileInfo</span>
 1176         <span class="k">return</span>
 1177 
 1178     <span class="n">RefFile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span>
 1179     
 1180     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">RefFile</span><span class="p">)</span>
 1181     <span class="n">RefFileRoot</span> <span class="o">=</span> <span class="n">FileName</span>
 1182     
 1183     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstInputFile$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignRefFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1184         <span class="n">ChainsAndLigandInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
 1185     <span class="k">else</span><span class="p">:</span>
 1186         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving chain and ligand information for alignment reference file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">RefFile</span><span class="p">)</span>
 1187         <span class="n">ChainsAndLigandInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">GetChainsAndLigandsInfo</span><span class="p">(</span><span class="n">RefFile</span><span class="p">,</span> <span class="n">RefFileRoot</span><span class="p">)</span>
 1188 
 1189     <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefFile</span>
 1190     <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;RefFileRoot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefFileRoot</span>
 1191     <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLObjectName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;AlignRef_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RefFileRoot</span>
 1192     <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainsAndLigandInfo</span>
 1193     
 1194     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefFileInfo</span>
 1195 
 1196 <span class="k">def</span> <span class="nf">ProcessChainAndLigandIDs</span><span class="p">():</span>
 1197     <span class="sd">&quot;&quot;&quot;Process specified chain and ligand IDs for infiles.&quot;&quot;&quot;</span>
 1198     
 1199     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1200     
 1201     <span class="k">for</span> <span class="n">FileIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])):</span>
 1202         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing specified chain and ligand IDs for input file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">])</span>
 1203         
 1204         <span class="n">ChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
 1205         <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">ProcessChainsAndLigandsOptionsInfo</span><span class="p">(</span><span class="n">ChainsAndLigandsInfo</span><span class="p">,</span> <span class="s2">&quot;-c, --chainIDs&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">],</span> <span class="s2">&quot;-l, --ligandIDs&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">])</span>
 1206         <span class="n">ProcessChainMeshesVolumesAndSurfacesOptions</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">)</span>
 1207         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">)</span>
 1208         
 1209         <span class="n">CheckPresenceOfValidLigandIDs</span><span class="p">(</span><span class="n">ChainsAndLigandsInfo</span><span class="p">,</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">)</span>
 1210         
 1211 <span class="k">def</span> <span class="nf">CheckPresenceOfValidLigandIDs</span><span class="p">(</span><span class="n">ChainsAndLigandsInfo</span><span class="p">,</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">):</span>
 1212     <span class="sd">&quot;&quot;&quot;Check presence of valid ligand IDs.&quot;&quot;&quot;</span>
 1213 
 1214     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Specified chain IDs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">])))</span>
 1215     
 1216     <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
 1217         <span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]):</span>
 1218             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Chain ID: </span><span class="si">%s</span><span class="s2">; Specified LigandIDs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainID</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">])))</span>
 1219         <span class="k">else</span><span class="p">:</span>
 1220             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Chain IDs: </span><span class="si">%s</span><span class="s2">; Specified LigandIDs: None&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainID</span><span class="p">))</span>
 1221             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;No valid ligand IDs found for chain ID, </span><span class="si">%s</span><span class="s2">. PyMOL groups and objects related to ligand and binding pockect won&#39;t be created.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainID</span><span class="p">))</span>
 1222 
 1223 <span class="k">def</span> <span class="nf">RetrieveFirstChainID</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">):</span>
 1224     <span class="sd">&quot;&quot;&quot;Get first chain ID.&quot;&quot;&quot;</span>
 1225     
 1226     <span class="n">ChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
 1227     
 1228     <span class="n">FirstChainID</span> <span class="o">=</span> <span class="bp">None</span>
 1229     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]):</span>
 1230         <span class="n">FirstChainID</span> <span class="o">=</span> <span class="n">ChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
 1231     
 1232     <span class="k">return</span> <span class="n">FirstChainID</span>
 1233 
 1234 <span class="k">def</span> <span class="nf">ProcessChainMeshesVolumesAndSurfacesOptions</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">):</span>
 1235     <span class="sd">&quot;&quot;&quot;Process options to create meshes and surfaces for chains.&quot;&quot;&quot;</span>
 1236 
 1237     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1238     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1239     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1240 
 1241     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableVolumeChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1242     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableMeshChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1243     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableSurfaceChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1244     
 1245     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainComplexGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1246     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainAloneGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1247     
 1248     <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
 1249         <span class="n">LigandsPresent</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">])</span> <span class="k">else</span> <span class="bp">False</span>
 1250 
 1251         <span class="c1"># Create and enable mesh  or volume in auto mode...</span>
 1252         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1253             <span class="n">MeshChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1254             <span class="n">EnableMeshChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1255         <span class="k">else</span><span class="p">:</span>
 1256             <span class="n">MeshChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1257             <span class="n">EnableMeshChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1258         
 1259         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1260             <span class="n">VolumeChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1261             <span class="n">EnableVolumeChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1262         <span class="k">else</span><span class="p">:</span>
 1263             <span class="n">VolumeChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1264             <span class="n">EnableVolumeChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1265         
 1266         <span class="k">if</span> <span class="n">MeshChainComplex</span> <span class="ow">and</span> <span class="n">EnableMeshChainComplex</span><span class="p">:</span>
 1267             <span class="n">EnableVolumeChainComplex</span> <span class="o">=</span> <span class="bp">False</span>
 1268         
 1269         <span class="c1"># Create and enable surface in auto mode based on the status of mesh and volume...</span>
 1270         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1271             <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1272             <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1273             
 1274             <span class="k">if</span> <span class="n">MeshChainComplex</span> <span class="ow">or</span> <span class="n">VolumeChainComplex</span><span class="p">:</span>
 1275                 <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span>
 1276                 <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span>
 1277         <span class="k">else</span><span class="p">:</span>
 1278             <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1279             <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1280         
 1281         <span class="k">if</span> <span class="p">(</span><span class="n">MeshChainComplex</span> <span class="ow">and</span> <span class="n">EnableMeshChainComplex</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">VolumeChainComplex</span> <span class="ow">or</span> <span class="n">EnableVolumeChainComplex</span><span class="p">):</span>
 1282             <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span>
 1283             
 1284         <span class="k">if</span> <span class="n">LigandsPresent</span><span class="p">:</span>
 1285             <span class="n">EnableChainComplexGroup</span> <span class="o">=</span> <span class="bp">False</span>
 1286             <span class="n">EnableChainAloneGroup</span> <span class="o">=</span> <span class="bp">True</span>
 1287         <span class="k">else</span><span class="p">:</span>
 1288             <span class="n">EnableChainComplexGroup</span> <span class="o">=</span> <span class="bp">True</span>
 1289             <span class="n">EnableChainAloneGroup</span> <span class="o">=</span> <span class="bp">False</span>
 1290 
 1291         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">VolumeChainComplex</span>
 1292         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">MeshChainComplex</span>
 1293         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">SurfaceChainComplex</span>
 1294         
 1295         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableVolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableVolumeChainComplex</span>
 1296         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableMeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableMeshChainComplex</span>
 1297         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableSurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableSurfaceChainComplex</span>
 1298         
 1299         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainComplexGroup&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableChainComplexGroup</span>
 1300         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainAloneGroup&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableChainAloneGroup</span>
 1301 
 1302 <span class="k">def</span> <span class="nf">ProcessChainSelections</span><span class="p">():</span>
 1303     <span class="sd">&quot;&quot;&quot;Process custom selections for chains. &quot;&quot;&quot;</span>
 1304 
 1305     <span class="n">ChainSelectionsInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">ProcessChainSelectionsOptionsInfo</span><span class="p">(</span><span class="s2">&quot;--selectionsChain&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SelectionsChain&quot;</span><span class="p">])</span>
 1306     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelectionsInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainSelectionsInfo</span>
 1307     
 1308     <span class="n">ChainSelections</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelectionsInfo&quot;</span><span class="p">][</span><span class="s2">&quot;Names&quot;</span><span class="p">])</span> <span class="k">else</span> <span class="bp">False</span>
 1309     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainSelections&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainSelections</span>
 1310     
 1311 <span class="k">def</span> <span class="nf">ProcessMeshLevel</span><span class="p">():</span>
 1312     <span class="sd">&quot;&quot;&quot;Process mesh level.&quot;&quot;&quot;</span>
 1313     
 1314     <span class="n">MeshLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevel&quot;</span><span class="p">]</span>
 1315     
 1316     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">MeshLevel</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1317         <span class="n">ProcessAutoMeshLevel</span><span class="p">()</span>
 1318     <span class="k">else</span><span class="p">:</span>
 1319         <span class="n">ProcessSpecifiedMeshLevel</span><span class="p">()</span>
 1320 
 1321 <span class="k">def</span> <span class="nf">ProcessAutoMeshLevel</span><span class="p">():</span>
 1322     <span class="sd">&quot;&quot;&quot;Process auto mesh level.&quot;&quot;&quot;</span>
 1323     
 1324     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1325     <span class="n">InfilesNamesCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])</span>
 1326     
 1327     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Setting mesh levels...&quot;</span><span class="p">)</span>
 1328     
 1329     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">):</span>
 1330         <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
 1331         
 1332         <span class="n">RecommededContourLevel</span> <span class="o">=</span> <span class="n">RetrieveRecommededContourLevel</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1333         <span class="k">if</span> <span class="n">RecommededContourLevel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1334             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve recommended mesh contour level from header. It&#39;s being set to 1.0. Use </span><span class="se">\&quot;</span><span class="s2">--meshLevel</span><span class="se">\&quot;</span><span class="s2"> option to specify a different contour mesh level.&quot;</span><span class="p">)</span>
 1335             <span class="n">MeshLevel</span> <span class="o">=</span> <span class="mf">1.0</span>
 1336         <span class="k">else</span><span class="p">:</span>
 1337             <span class="n">MeshLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">RecommededContourLevel</span><span class="p">)</span>
 1338         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MeshLevel</span><span class="p">)</span>
 1339         
 1340 <span class="k">def</span> <span class="nf">ProcessSpecifiedMeshLevel</span><span class="p">():</span>
 1341     <span class="sd">&quot;&quot;&quot;Process specified mesh level.&quot;&quot;&quot;</span>
 1342 
 1343     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing mesh levels...&quot;</span><span class="p">)</span>
 1344     
 1345     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1346     <span class="n">InfilesNamesCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])</span>
 1347     
 1348     <span class="n">MeshLevels</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevel&quot;</span><span class="p">])</span>
 1349     <span class="k">if</span> <span class="ow">not</span> <span class="n">MeshLevels</span><span class="p">:</span>
 1350         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No valid value specified using </span><span class="se">\&quot;</span><span class="s2">--meshLevel</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span><span class="p">)</span>
 1351     
 1352     <span class="n">MeshLevelWords</span> <span class="o">=</span> <span class="n">MeshLevels</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
 1353     <span class="n">MeshLevelWordsCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MeshLevelWords</span><span class="p">)</span>
 1354     
 1355     <span class="k">if</span> <span class="n">MeshLevelWordsCount</span> <span class="o">!=</span> <span class="n">InfilesNamesCount</span><span class="p">:</span>
 1356         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of comma delimited mesh levels, </span><span class="si">%d</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">--meshLevel</span><span class="se">\&quot;</span><span class="s2"> must be equal to the number of input files, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">-i, --infiles</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MeshLevelWordsCount</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">))</span>
 1357     
 1358     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">):</span>
 1359         <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
 1360         <span class="n">MeshLevel</span> <span class="o">=</span> <span class="n">MeshLevelWords</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span>
 1361         <span class="k">if</span> <span class="ow">not</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">IsFloat</span><span class="p">(</span><span class="n">MeshLevel</span><span class="p">):</span>
 1362             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The mesh level, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">--meshLevel</span><span class="se">\&quot;</span><span class="s2"> for input file, </span><span class="si">%s</span><span class="s2">, must be a float.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MeshLevel</span><span class="p">,</span> <span class="n">Infile</span><span class="p">))</span>
 1363         
 1364         <span class="n">MeshLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">MeshLevel</span><span class="p">)</span>
 1365         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MeshLevel</span><span class="p">)</span>
 1366     
 1367 <span class="k">def</span> <span class="nf">ProcessVolumeColorRamp</span><span class="p">():</span>
 1368     <span class="sd">&quot;&quot;&quot;Process volume color ramp.&quot;&quot;&quot;</span>
 1369     
 1370     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing volume color ramp...&quot;</span><span class="p">)</span>
 1371     
 1372     <span class="n">ColorRamp</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeColorRamp&quot;</span><span class="p">]</span>
 1373     <span class="n">ColorRampName</span> <span class="o">=</span> <span class="bp">None</span>
 1374     <span class="n">CreateColorRamp</span> <span class="o">=</span> <span class="bp">False</span>
 1375     <span class="n">ColorRampContourLevel</span> <span class="o">=</span> <span class="bp">None</span>
 1376     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">ColorRamp</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1377         <span class="n">FirstInfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
 1378         <span class="n">RecommededContourLevel</span> <span class="o">=</span> <span class="n">RetrieveRecommededContourLevel</span><span class="p">(</span><span class="n">FirstInfile</span><span class="p">)</span>
 1379         <span class="k">if</span> <span class="n">RecommededContourLevel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1380             <span class="n">ColorRampName</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
 1381             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve recommended contour level from header file corresponding to input file, </span><span class="si">%s</span><span class="s2">, to create a new ramp. Using PyMOL default volume color ramp.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FirstInfile</span><span class="p">))</span>
 1382         <span class="k">else</span><span class="p">:</span>
 1383             <span class="n">ColorRampName</span> <span class="o">=</span> <span class="s2">&quot;CryoEMAuto&quot;</span>
 1384             <span class="n">CreateColorRamp</span> <span class="o">=</span> <span class="bp">True</span>
 1385             <span class="n">ColorRampContourLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">RecommededContourLevel</span><span class="p">)</span>
 1386             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Setting up a  new volume color ramp, </span><span class="si">%s</span><span class="s2">, at recommended contour level, </span><span class="si">%.2f</span><span class="s2">, from input file, </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ColorRampName</span><span class="p">,</span> <span class="n">ColorRampContourLevel</span><span class="p">,</span> <span class="n">FirstInfile</span><span class="p">))</span>
 1387     <span class="k">else</span><span class="p">:</span>
 1388         <span class="n">ColorRampName</span> <span class="o">=</span> <span class="n">ColorRamp</span>
 1389         
 1390     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColorRamp</span>
 1391     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColorRampName</span>
 1392     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampCreate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CreateColorRamp</span>
 1393     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampContourLevel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColorRampContourLevel</span>
 1394 
 1395 <span class="k">def</span> <span class="nf">ProcessOptions</span><span class="p">():</span>
 1396     <span class="sd">&quot;&quot;&quot;Process and validate command line arguments and options.&quot;&quot;&quot;</span>
 1397     
 1398     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Processing options...&quot;</span><span class="p">)</span>
 1399     
 1400     <span class="c1"># Validate options...</span>
 1401     <span class="n">ValidateOptions</span><span class="p">()</span>
 1402     
 1403     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--align&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1404     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignMethod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignMethod&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
 1405     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignMode&quot;</span><span class="p">]</span>
 1406     
 1407     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AllowEmptyObjects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--allowEmptyObjects&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1408     
 1409     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorChainCartoonPutty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--BFactorChainCartoonPutty&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1410     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorColorPalette&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--BFactorColorPalette&quot;</span><span class="p">]</span>
 1411     
 1412     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infiles&quot;</span><span class="p">]</span>
 1413     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infileNames&quot;</span><span class="p">]</span>
 1414     
 1415     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesEMDBIDs&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{}</span>
 1416     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{}</span>
 1417 
 1418     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignRefFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">]</span>
 1419     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstInputFile$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1420         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
 1421     <span class="k">else</span><span class="p">:</span>
 1422         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">]</span>
 1423     
 1424     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--densityMapFiles&quot;</span><span class="p">]</span>
 1425     <span class="n">ProcessDensityMapFiles</span><span class="p">()</span>
 1426 
 1427     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">]</span>
 1428     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1429     
 1430     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">]</span>
 1431     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])</span>
 1432     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span> 
 1433     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^pml$&quot;</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1434         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span> 
 1435         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMEOutfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;.pml$&quot;</span><span class="p">,</span> <span class="s2">&quot;.pme&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])</span> 
 1436     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^pse$&quot;</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1437         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> 
 1438         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOutfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span> 
 1439         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;.pse$&quot;</span><span class="p">,</span> <span class="s2">&quot;.pml&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])</span> 
 1440         <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">]):</span>
 1441             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The intermediate output file to be generated, </span><span class="si">%s</span><span class="s2">, already exist. Use option </span><span class="se">\&quot;</span><span class="s2">--ov</span><span class="se">\&quot;</span><span class="s2"> or </span><span class="se">\&quot;</span><span class="s2">--overwrite</span><span class="se">\&quot;</span><span class="s2"> and try again.&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span> <span class="p">)</span>
 1442 
 1443     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;LabelFontID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--labelFontID&quot;</span><span class="p">])</span>
 1444     
 1445     <span class="c1"># Process mesh parameters...</span>
 1446     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshCarveRadius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshCarveRadius&quot;</span><span class="p">])</span>
 1447     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1448     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshChainComplex&quot;</span><span class="p">]</span>
 1449     
 1450     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshWidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshWidth&quot;</span><span class="p">])</span>
 1451     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshColor&quot;</span><span class="p">]</span>
 1452     
 1453     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshLevel&quot;</span><span class="p">]</span>
 1454     <span class="n">ProcessMeshLevel</span><span class="p">()</span>
 1455     
 1456     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1457     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceChainComplex&quot;</span><span class="p">]</span>
 1458     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceTransparency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceTransparency&quot;</span><span class="p">])</span>
 1459     
 1460     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsLigandColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsLigandColor&quot;</span><span class="p">]</span>
 1461     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsLigandHydrophobicColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsLigandHydrophobicColor&quot;</span><span class="p">]</span>
 1462     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsSolventColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsSolventColor&quot;</span><span class="p">]</span>
 1463     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsInorganicColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsInorganicColor&quot;</span><span class="p">]</span>
 1464     
 1465     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsCutoff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsCutoff&quot;</span><span class="p">])</span>
 1466     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketDistanceCutoff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketDistanceCutoff&quot;</span><span class="p">])</span>
 1467     
 1468     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketLabelColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketLabelColor&quot;</span><span class="p">]</span>
 1469     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketSurface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketSurface&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1470 
 1471     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SelectionsChain&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--selectionsChain&quot;</span><span class="p">]</span>
 1472     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SelectionsChainStyle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--selectionsChainStyle&quot;</span><span class="p">]</span>
 1473     <span class="n">ProcessChainSelections</span><span class="p">()</span>
 1474     
 1475     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeCarveRadius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeCarveRadius&quot;</span><span class="p">])</span>
 1476     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1477     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeChainComplex&quot;</span><span class="p">]</span>
 1478 
 1479     <span class="n">ProcessVolumeColorRamp</span><span class="p">()</span>
 1480 
 1481     <span class="n">RetrieveInfilesInfo</span><span class="p">()</span>
 1482     <span class="n">RetrieveRefFileInfo</span><span class="p">()</span>
 1483     
 1484     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--chainIDs&quot;</span><span class="p">]</span>
 1485     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--ligandIDs&quot;</span><span class="p">]</span>
 1486     
 1487     <span class="n">ProcessChainAndLigandIDs</span><span class="p">()</span>
 1488 
 1489 <span class="k">def</span> <span class="nf">RetrieveOptions</span><span class="p">():</span> 
 1490     <span class="sd">&quot;&quot;&quot;Retrieve command line arguments and options&quot;&quot;&quot;</span>
 1491     
 1492     <span class="c1"># Get options...</span>
 1493     <span class="k">global</span> <span class="n">Options</span>
 1494     <span class="n">Options</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">_docoptUsage_</span><span class="p">)</span>
 1495     
 1496     <span class="c1"># Set current working directory to the specified directory...</span>
 1497     <span class="n">WorkingDir</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--workingdir&quot;</span><span class="p">]</span>
 1498     <span class="k">if</span> <span class="n">WorkingDir</span><span class="p">:</span>
 1499         <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">WorkingDir</span><span class="p">)</span>
 1500     
 1501     <span class="c1"># Handle examples option...</span>
 1502     <span class="k">if</span> <span class="s2">&quot;--examples&quot;</span> <span class="ow">in</span> <span class="n">Options</span> <span class="ow">and</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--examples&quot;</span><span class="p">]:</span>
 1503         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetExamplesTextFromDocOptText</span><span class="p">(</span><span class="n">_docoptUsage_</span><span class="p">))</span>
 1504         <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
 1505 
 1506 <span class="k">def</span> <span class="nf">ValidateOptions</span><span class="p">():</span>
 1507     <span class="sd">&quot;&quot;&quot;Validate option values&quot;&quot;&quot;</span>
 1508     
 1509     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--align&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--align&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1510     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--alignMethod&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignMethod&quot;</span><span class="p">],</span> <span class="s2">&quot;align cealign super&quot;</span><span class="p">)</span>
 1511     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--alignMode&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignMode&quot;</span><span class="p">],</span> <span class="s2">&quot;FirstChain Complex&quot;</span><span class="p">)</span>
 1512     
 1513     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--allowEmptyObjects&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--allowEmptyObjects&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1514     
 1515     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--BFactorChainCartoonPutty&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--BFactorChainCartoonPutty&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1516 
 1517     <span class="c1"># Expand infiles to handle presence of multiple input files...</span>
 1518     <span class="n">InfileNames</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ExpandFileNames</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infiles&quot;</span><span class="p">],</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
 1519     <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">InfileNames</span><span class="p">):</span>
 1520         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No input files specified for </span><span class="se">\&quot;</span><span class="s2">-i, --infiles</span><span class="se">\&quot;</span><span class="s2"> option&quot;</span><span class="p">)</span>
 1521 
 1522     <span class="c1"># Validate file extensions...</span>
 1523     <span class="k">for</span> <span class="n">Infile</span> <span class="ow">in</span> <span class="n">InfileNames</span><span class="p">:</span>
 1524         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFilePath</span><span class="p">(</span><span class="s2">&quot;-i, --infiles&quot;</span><span class="p">,</span> <span class="n">Infile</span><span class="p">)</span>
 1525         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;-i, --infiles&quot;</span><span class="p">,</span> <span class="n">Infile</span><span class="p">,</span> <span class="s2">&quot;pdb cif&quot;</span><span class="p">)</span>
 1526         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionsDistinctFileNames</span><span class="p">(</span><span class="s2">&quot;-i, --infiles&quot;</span><span class="p">,</span> <span class="n">Infile</span><span class="p">,</span> <span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">])</span>
 1527     <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infileNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">InfileNames</span>
 1528     
 1529     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">],</span> <span class="s2">&quot;pml pse&quot;</span><span class="p">)</span>
 1530     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionsOutputFileOverwrite</span><span class="p">(</span><span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">],</span> <span class="s2">&quot;--overwrite&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">])</span>
 1531     
 1532     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--align&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1533         <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstInputFile$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1534             <span class="n">AlignRefFile</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">]</span>
 1535             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFilePath</span><span class="p">(</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">,</span> <span class="n">AlignRefFile</span><span class="p">)</span>
 1536             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">,</span> <span class="n">AlignRefFile</span><span class="p">,</span> <span class="s2">&quot;pdb cif&quot;</span><span class="p">)</span>
 1537             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionsDistinctFileNames</span><span class="p">(</span><span class="s2">&quot;--AlignRefFile&quot;</span><span class="p">,</span> <span class="n">AlignRefFile</span><span class="p">,</span> <span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">])</span>
 1538     
 1539     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1540     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionIntegerValue</span><span class="p">(</span><span class="s2">&quot;--labelFontID&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--labelFontID&quot;</span><span class="p">],</span> <span class="p">{})</span>
 1541 
 1542     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--meshCarveRadius&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshCarveRadius&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1543     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--meshComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1544     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--meshChainComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshChainComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no auto&quot;</span><span class="p">)</span>
 1545     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--meshWidth&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshWidth&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1546     
 1547     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1548     
 1549     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--pocketContactsCutoff&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsCutoff&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1550     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--pocketDistanceCutoff&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketDistanceCutoff&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1551     <span class="k">if</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsCutoff&quot;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketDistanceCutoff&quot;</span><span class="p">])):</span>
 1552         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The value, </span><span class="si">%s</span><span class="s2">, specified using option </span><span class="se">\&quot;</span><span class="s2">--pocketContactsCutoff</span><span class="se">\&quot;</span><span class="s2"> must be less than value, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">-pocketDistanceCutoff</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsCutoff&quot;</span><span class="p">],</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketDistanceCutoff&quot;</span><span class="p">]))</span>
 1553         
 1554     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--pocketSurface&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketSurface&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1555     
 1556     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--surfaceComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1557     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--surfaceChainComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceChainComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no auto&quot;</span><span class="p">)</span>
 1558     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--surfaceTransparency&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceTransparency&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
 1559     
 1560     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--volumeCarveRadius&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeCarveRadius&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1561     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--volumeComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1562     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--volumeChainComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeChainComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no auto&quot;</span><span class="p">)</span>
 1563     
 1564 <span class="c1"># Setup a usage string for docopt...</span>
 1565 <span class="n">_docoptUsage_</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
 1566 <span class="s2">PyMOLVisualizeCryoEMDensity.py - Visualize cryo-EM density</span>
 1567 
 1568 <span class="s2">Usage:</span>
 1569 <span class="s2">    PyMOLVisualizeCryoEMDensity.py  [--align &lt;yes or no&gt;] [--alignMethod &lt;align, cealign, super&gt;]</span>
 1570 <span class="s2">                                   [--alignMode &lt;FirstChain or Complex&gt;] [--alignRefFile &lt;filename&gt;]</span>
 1571 <span class="s2">                                   [--allowEmptyObjects &lt;yes or no&gt;] [--BFactorChainCartoonPutty &lt;yes or no&gt;]</span>
 1572 <span class="s2">                                   [--BFactorColorPalette &lt;text&gt; ] [--chainIDs &lt;First, All or ID1,ID2...&gt;]</span>
 1573 <span class="s2">                                   [--densityMapFiles &lt;file1,file2,file3,...&gt;]</span>
 1574 <span class="s2">                                   [--ligandIDs &lt;Largest, All or ID1,ID2...&gt;] [--labelFontID &lt;number&gt;]</span>
 1575 <span class="s2">                                   [--meshCarveRadius &lt;number&gt;] [--meshComplex &lt;yes or no&gt;]</span>
 1576 <span class="s2">                                   [--meshChainComplex &lt;yes, no, or auto&gt;] [--meshColor &lt;text&gt;]</span>
 1577 <span class="s2">                                   [--meshLevel &lt;number&gt;] [--meshWidth &lt;number&gt;] [--PMLOut &lt;yes or no&gt;]</span>
 1578 <span class="s2">                                   [--pocketContactsLigandColor &lt;text&gt;] [--pocketContactsLigandHydrophobicColor &lt;text&gt;]</span>
 1579 <span class="s2">                                   [--pocketContactsSolventColor &lt;text&gt;]  [--pocketContactsCutoff &lt;number&gt;]</span>
 1580 <span class="s2">                                   [--pocketContactsInorganicColor &lt;text&gt;] [--pocketDistanceCutoff &lt;number&gt;]</span>
 1581 <span class="s2">                                   [--pocketLabelColor &lt;text&gt;] [--pocketSurface &lt;yes or no&gt;]</span>
 1582 <span class="s2">                                   [--selectionsChain &lt;ObjectName,SelectionSpec,...&gt;] [--selectionsChainStyle &lt;DisplayStyle&gt;]</span>
 1583 <span class="s2">                                   [--surfaceComplex &lt;yes or no&gt;] [--surfaceChainComplex &lt;yes, no or auto&gt;]</span>
 1584 <span class="s2">                                   [--surfaceTransparency &lt;number&gt;] [--volumeCarveRadius &lt;number&gt;]</span>
 1585 <span class="s2">                                   [--volumeComplex &lt;yes or no&gt;] [--volumeChainComplex &lt;yes, no, or auto&gt;]</span>
 1586 <span class="s2">                                   [--volumeColorRamp &lt;text&gt;]   [--overwrite] [-w &lt;dir&gt;] -i &lt;infile1,infile2,...&gt; -o &lt;outfile&gt;</span>
 1587 <span class="s2">    PyMOLVisualizeCryoEMDensity.py -h | --help | -e | --examples</span>
 1588 
 1589 <span class="s2">Description:</span>
 1590 <span class="s2">    Generate PyMOL visualization files for viewing electron microscopy (EM) or</span>
 1591 <span class="s2">    cryo-EM density around chains, ligands, and ligand binding pockets in</span>
 1592 <span class="s2">    macromolecules including proteins and nucleic acids.</span>
 1593 
 1594 <span class="s2">    The supported input file formats are: Macromolecule - PDB (.pdb) or CIF(.cif),</span>
 1595 <span class="s2">    Cryo-EM Density - Collaborative Computational Project Number 4 (CCP4) ( .map)</span>
 1596 
 1597 <span class="s2">    The supported output file formats are: PyMOL script file (.pml), PyMOL session</span>
 1598 <span class="s2">    file (.pse)</span>
 1599 
 1600 <span class="s2">    The cryo-EM density and header files along with PDB files may be downloaded</span>
 1601 <span class="s2">    from appropriate servers using DownloadPDBFiles.pl script.</span>
 1602 
 1603 <span class="s2">    A variety of PyMOL groups and objects may be  created for visualization of</span>
 1604 <span class="s2">    cryo-EM density present in map files. These groups and objects correspond to</span>
 1605 <span class="s2">    maps, volumes, meshes, surfaces,chains, ligands, inorganics, ligand binding</span>
 1606 <span class="s2">    pockets, polar interactions, and pocket hydrophobic surfaces. A complete</span>
 1607 <span class="s2">    hierarchy of all possible PyMOL groups and objects is shown below:</span>
 1608 <span class="s2">    </span>
 1609 <span class="s2">        &lt;PDBFileRoot&gt;</span>
 1610 <span class="s2">            .Complex</span>
 1611 <span class="s2">                .Complex</span>
 1612 <span class="s2">                .CryoEM</span>
 1613 <span class="s2">                    .Map</span>
 1614 <span class="s2">                    .Volume</span>
 1615 <span class="s2">                    .Mesh</span>
 1616 <span class="s2">                    .Surface</span>
 1617 <span class="s2">            .Chain&lt;ID&gt;</span>
 1618 <span class="s2">                .Complex</span>
 1619 <span class="s2">                    .Complex</span>
 1620 <span class="s2">                    .CryoEM</span>
 1621 <span class="s2">                        .Volume</span>
 1622 <span class="s2">                        .Mesh</span>
 1623 <span class="s2">                        .Surface</span>
 1624 <span class="s2">                .Chain</span>
 1625 <span class="s2">                    .Chain</span>
 1626 <span class="s2">                    .BFactor</span>
 1627 <span class="s2">                    .Selections</span>
 1628 <span class="s2">                        .&lt;Name1&gt;</span>
 1629 <span class="s2">                            .Selection</span>
 1630 <span class="s2">                            .CryoEM</span>
 1631 <span class="s2">                                .Volume</span>
 1632 <span class="s2">                                .Mesh</span>
 1633 <span class="s2">                                .Surface</span>
 1634 <span class="s2">                        .&lt;Name2&gt;</span>
 1635 <span class="s2">                            ... ... ..</span>
 1636 <span class="s2">                .Solvent</span>
 1637 <span class="s2">                .Inorganic</span>
 1638 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1639 <span class="s2">                    .Ligand</span>
 1640 <span class="s2">                        .Ligand</span>
 1641 <span class="s2">                        .CryoEM</span>
 1642 <span class="s2">                            .Volume</span>
 1643 <span class="s2">                            .Mesh</span>
 1644 <span class="s2">                            .Surface</span>
 1645 <span class="s2">                    .Pocket</span>
 1646 <span class="s2">                        .Pocket</span>
 1647 <span class="s2">                        .CryoEM</span>
 1648 <span class="s2">                            .Volume</span>
 1649 <span class="s2">                            .Mesh</span>
 1650 <span class="s2">                            .Surface</span>
 1651 <span class="s2">                        .Polar_Contacts</span>
 1652 <span class="s2">                        .Hydrophobic_Contacts</span>
 1653 <span class="s2">                        .Surface</span>
 1654 <span class="s2">                    .Pocket_Solvent</span>
 1655 <span class="s2">                        .Pocket_Solvent</span>
 1656 <span class="s2">                        .CryoEM</span>
 1657 <span class="s2">                            .Volume</span>
 1658 <span class="s2">                            .Mesh</span>
 1659 <span class="s2">                            .Surface</span>
 1660 <span class="s2">                        .Polar_Contacts</span>
 1661 <span class="s2">                    .Pocket_Inorganic</span>
 1662 <span class="s2">                        .Pocket_Inorganic</span>
 1663 <span class="s2">                        .CryoEM</span>
 1664 <span class="s2">                            .Volume</span>
 1665 <span class="s2">                            .Mesh</span>
 1666 <span class="s2">                            .Surface</span>
 1667 <span class="s2">                        .Polar_Contacts</span>
 1668 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1669 <span class="s2">                    .Ligand</span>
 1670 <span class="s2">                        ... ... ...</span>
 1671 <span class="s2">                    .Pocket</span>
 1672 <span class="s2">                        ... ... ...</span>
 1673 <span class="s2">                    .Pocket_Solvent</span>
 1674 <span class="s2">                        ... ... ...</span>
 1675 <span class="s2">                    .Pocket_Inorganic</span>
 1676 <span class="s2">                        ... ... ...</span>
 1677 <span class="s2">            .Chain&lt;ID&gt;</span>
 1678 <span class="s2">                ... ... ...</span>
 1679 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1680 <span class="s2">                    ... ... ...</span>
 1681 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1682 <span class="s2">                    ... ... ...</span>
 1683 <span class="s2">            .Chain&lt;ID&gt;</span>
 1684 <span class="s2">                ... ... ...</span>
 1685 <span class="s2">        &lt;PDBFileRoot&gt;</span>
 1686 <span class="s2">            .Complex</span>
 1687 <span class="s2">                ... ... ...</span>
 1688 <span class="s2">            .Chain&lt;ID&gt;</span>
 1689 <span class="s2">                ... ... ...</span>
 1690 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1691 <span class="s2">                    ... ... ...</span>
 1692 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1693 <span class="s2">                    ... ... ...</span>
 1694 <span class="s2">            .Chain&lt;ID&gt;</span>
 1695 <span class="s2">                ... ... ...</span>
 1696 <span class="s2">    </span>
 1697 <span class="s2">    The meshes, volumes, and surfaces  are not created for complete complex in input</span>
 1698 <span class="s2">    files by default. A word to the wise: The creation of these mesh, volume, and surface</span>
 1699 <span class="s2">    objects may slow down loading of PML file and generation of PSE file, based on the</span>
 1700 <span class="s2">    size of input complex and map files. The generation of PSE file may also fail. In </span>
 1701 <span class="s2">    addition, you may want to interactively manipulate the contour level for meshes,</span>
 1702 <span class="s2">    volumes, and surfaces. The recommended value for contour level is automatically</span>
 1703 <span class="s2">    retrieved from header files available from EM density server. The recommended</span>
 1704 <span class="s2">    value may not always work.</span>
 1705 
 1706 <span class="s2">Options:</span>
 1707 <span class="s2">    -a, --align &lt;yes or no&gt;  [default: no]</span>
 1708 <span class="s2">        Align input files to a reference file before visualization along with</span>
 1709 <span class="s2">        available cryo-EM density map files.</span>
 1710 <span class="s2">    --alignMethod &lt;align, cealign, super&gt;  [default: super]</span>
 1711 <span class="s2">        Alignment methodology to use for aligning input files to a reference</span>
 1712 <span class="s2">        file.</span>
 1713 <span class="s2">    --alignMode &lt;FirstChain or Complex&gt;  [default: FirstChain]</span>
 1714 <span class="s2">        Portion of input and reference files to use for spatial alignment of</span>
 1715 <span class="s2">        input files against reference file.  Possible values: FirstChain or</span>
 1716 <span class="s2">        Complex.</span>
 1717 <span class="s2">        </span>
 1718 <span class="s2">        The FirstChain mode allows alignment of the first chain in each input</span>
 1719 <span class="s2">        file to the first chain in the reference file along with moving the rest</span>
 1720 <span class="s2">        of the complex to coordinate space of the reference file. The complete</span>
 1721 <span class="s2">        complex in each input file is aligned to the complete complex in reference</span>
 1722 <span class="s2">        file for the Complex mode.</span>
 1723 <span class="s2">    --alignRefFile &lt;filename&gt;  [default: FirstInputFile]</span>
 1724 <span class="s2">        Reference input file name. The default is to use the first input file</span>
 1725 <span class="s2">        name specified using &#39;-i, --infiles&#39; option.</span>
 1726 <span class="s2">    --allowEmptyObjects &lt;yes or no&gt;  [default: no]</span>
 1727 <span class="s2">        Allow creation of empty PyMOL objects corresponding to solvent and</span>
 1728 <span class="s2">        inorganic atom selections across chains, ligands, and ligand binding pockets</span>
 1729 <span class="s2">        in input file(s).</span>
 1730 <span class="s2">    -b, --BFactorChainCartoonPutty &lt;yes or no&gt;  [default: yes]</span>
 1731 <span class="s2">        A cartoon putty around individual chains colored by B factors. The minimum</span>
 1732 <span class="s2">        and maximum values for B factors are automatically detected. These values</span>
 1733 <span class="s2">        indicate spread of cryo-EM density around atoms. The &#39;blue_white_red&#39; color</span>
 1734 <span class="s2">        palette is deployed for coloring the cartoon putty.</span>
 1735 <span class="s2">    --BFactorColorPalette &lt;text&gt;  [default: blue_white_red]</span>
 1736 <span class="s2">        Color palette for coloring cartoon putty around chains generated using B</span>
 1737 <span class="s2">        factors. Any valid PyMOL color palette name is allowed. No validation is</span>
 1738 <span class="s2">        performed. The complete list of valid color palette names is a available</span>
 1739 <span class="s2">        at: pymolwiki.org/index.php/Spectrum. Examples: blue_white_red,</span>
 1740 <span class="s2">        blue_white_magenta, blue_red, green_white_red, green_red.</span>
 1741 <span class="s2">    -c, --chainIDs &lt;First, All or ID1,ID2...&gt;  [default: First]</span>
 1742 <span class="s2">        List of chain IDs to use for visualizing cryo-EM density. Possible values:</span>
 1743 <span class="s2">        First, All, or a comma delimited list of chain IDs. The default is to use the</span>
 1744 <span class="s2">        chain ID for the first chain in each input file.</span>
 1745 <span class="s2">    -d, --densityMapFiles &lt;file1,file2,file3,...&gt;  [default: auto]</span>
 1746 <span class="s2">        CryoEM density map file names. The EMDB ID is retrieved from PDB and CIF</span>
 1747 <span class="s2">        file to set the cryo-EM density file name during automatic detection of</span>
 1748 <span class="s2">        density files. The format of the file name is as follows:</span>
 1749 <span class="s2">        </span>
 1750 <span class="s2">            emd_&lt;EMDBID&gt;.map.gz or emd_&lt;EMDBID&gt;.map</span>
 1751 <span class="s2">         </span>
 1752 <span class="s2">        The density files must be present in the working directory.</span>
 1753 <span class="s2">    -e, --examples</span>
 1754 <span class="s2">        Print examples.</span>
 1755 <span class="s2">    -h, --help</span>
 1756 <span class="s2">        Print this help message.</span>
 1757 <span class="s2">    -i, --infiles &lt;infile1,infile2,infile3...&gt;</span>
 1758 <span class="s2">        Input file names.</span>
 1759 <span class="s2">    -l, --ligandIDs &lt;Largest, All or ID1,ID2...&gt;  [default: Largest]</span>
 1760 <span class="s2">        List of ligand IDs present in chains for visualizing cryo-EM density across</span>
 1761 <span class="s2">        ligands and ligand binding pockets. Possible values: Largest, All, or a comma</span>
 1762 <span class="s2">        delimited list of ligand IDs. The default is to use the largest ligand present</span>
 1763 <span class="s2">        in all or specified chains in each input file.</span>
 1764 <span class="s2">        </span>
 1765 <span class="s2">        Ligands are identified using organic selection operator available in PyMOL.</span>
 1766 <span class="s2">        It&#39;ll also  identify buffer molecules as ligands. The largest ligand contains</span>
 1767 <span class="s2">        the highest number of heavy atoms.</span>
 1768 <span class="s2">    --labelFontID &lt;number&gt;  [default: 7]</span>
 1769 <span class="s2">        Font ID for drawing labels. Default: 7 (Sans Bold). Valid values: 5 to 16.</span>
 1770 <span class="s2">        The specified value must be a valid PyMOL font ID. No validation is</span>
 1771 <span class="s2">        performed. The complete lists of valid font IDs is available at:</span>
 1772 <span class="s2">        pymolwiki.org/index.php/Label_font_id. Examples: 5 - Sans;</span>
 1773 <span class="s2">        7 - Sans Bold; 9 - Serif; 10 - Serif Bold.</span>
 1774 <span class="s2">    --meshCarveRadius &lt;number&gt;  [default: 1.6]</span>
 1775 <span class="s2">        Radius in Angstroms around atoms for including cryo-EM density.</span>
 1776 <span class="s2">    --meshComplex &lt;yes or no&gt;  [default: no]</span>
 1777 <span class="s2">        Create meshes for complete complex in each input file using corresponding</span>
 1778 <span class="s2">        density map file.</span>
 1779 <span class="s2">    --meshChainComplex &lt;yes, no, or auto&gt;  [default: auto]</span>
 1780 <span class="s2">        Create meshes for individual chain complex in each input file using</span>
 1781 <span class="s2">        corresponding density map file. By default, the meshes are automatically</span>
 1782 <span class="s2">        created for chain complexes without any ligands. </span>
 1783 <span class="s2">    --meshColor &lt;text&gt;  [default: blue]</span>
 1784 <span class="s2">        Line color for meshes corresponding to density maps.. The specified value</span>
 1785 <span class="s2">        must be valid color. No validation is performed.</span>
 1786 <span class="s2">    --meshLevel &lt;number1,number2,...&gt;  [default: auto]</span>
 1787 <span class="s2">        Comma delimited list of contour levels in sigma units for generating meshes</span>
 1788 <span class="s2">        for each input file using corresponding density map file. The default is to</span>
 1789 <span class="s2">        automatically retrieve the recommended contour levels for each input </span>
 1790 <span class="s2">        file. The header file emd-&lt;EMDBID&gt;.xml corresponding to an input file</span>
 1791 <span class="s2">        must be present in the working directory  to automatically retrieve</span>
 1792 <span class="s2">        recommended value for mesh contour level. Otherwise, the default contour</span>
 1793 <span class="s2">        level is set to 1.</span>
 1794 <span class="s2">        </span>
 1795 <span class="s2">        You may want to interactively manipulate the contour level for meshes and</span>
 1796 <span class="s2">        surfaces. The default recommended value may not always work.</span>
 1797 <span class="s2">    --meshWidth &lt;number&gt;  [default: 0.5]</span>
 1798 <span class="s2">        Line width for mesh lines corresponding to density maps.</span>
 1799 <span class="s2">    -o, --outfile &lt;outfile&gt;</span>
 1800 <span class="s2">        Output file name.</span>
 1801 <span class="s2">    -p, --PMLOut &lt;yes or no&gt;  [default: yes]</span>
 1802 <span class="s2">        Save PML file during generation of PSE file.</span>
 1803 <span class="s2">    --pocketContactsLigandColor &lt;text&gt;  [default: orange]</span>
 1804 <span class="s2">        Color for drawing polar contacts between ligand and pocket residues.</span>
 1805 <span class="s2">        The specified value must be valid color. No validation is performed.</span>
 1806 <span class="s2">    --pocketContactsLigandHydrophobicColor &lt;text&gt;  [default: purpleblue]</span>
 1807 <span class="s2">        Color for drawing hydrophobic contacts between ligand and pocket residues.</span>
 1808 <span class="s2">        The specified value must be valid color. No validation is performed. The</span>
 1809 <span class="s2">        hydrophobic contacts are shown between pairs of carbon atoms not</span>
 1810 <span class="s2">        connected to hydrogen bond donor or acceptors atoms as identified</span>
 1811 <span class="s2">        by PyMOL.</span>
 1812 <span class="s2">    --pocketContactsSolventColor &lt;text&gt;  [default: marine]</span>
 1813 <span class="s2">        Color for drawing polar contacts between solvent and pocket residues.</span>
 1814 <span class="s2">        The specified value must be valid color. No validation is performed.</span>
 1815 <span class="s2">    --pocketContactsInorganicColor &lt;text&gt;  [default: deepsalmon]</span>
 1816 <span class="s2">        Color for drawing polar contacts between inorganic and pocket residues.</span>
 1817 <span class="s2">        The specified value must be valid color. No validation is performed.</span>
 1818 <span class="s2">    --pocketContactsCutoff &lt;number&gt;  [default: 4.0]</span>
 1819 <span class="s2">        Distance in Angstroms for identifying polar and hyrdophobic contacts</span>
 1820 <span class="s2">        between atoms in pocket residues and ligands.</span>
 1821 <span class="s2">    --pocketDistanceCutoff &lt;number&gt;  [default: 5.0]</span>
 1822 <span class="s2">        Distance in Angstroms for identifying pocket residues around ligands.</span>
 1823 <span class="s2">    --pocketLabelColor &lt;text&gt;  [default: magenta]</span>
 1824 <span class="s2">        Color for drawing residue or atom level labels for a pocket. The specified</span>
 1825 <span class="s2">        value must be valid color. No validation is performed.</span>
 1826 <span class="s2">    --pocketSurface &lt;yes or no&gt;  [default: yes]</span>
 1827 <span class="s2">        Hydrophobic surface around pocket. The pocket surface is colored by</span>
 1828 <span class="s2">        hydrophobicity. It is only valid for proteins. The color of amino acids is</span>
 1829 <span class="s2">        set using the Eisenberg hydrophobicity scale. The color varies from red</span>
 1830 <span class="s2">        to white, red being the most hydrophobic amino acid.</span>
 1831 <span class="s2">    --selectionsChain &lt;ObjectName,SelectionSpec,...&gt;  [default: None]</span>
 1832 <span class="s2">        Custom selections for chains. It is a pairwise list of comma delimited values</span>
 1833 <span class="s2">        corresponding to PyMOL object names and selection specifications.  The</span>
 1834 <span class="s2">        selection specification must be a valid PyMOL specification. No validation is</span>
 1835 <span class="s2">        performed.</span>
 1836 <span class="s2">        </span>
 1837 <span class="s2">        The PyMOL objects are created for each chain corresponding to the</span>
 1838 <span class="s2">        specified selections. The display style for PyMOL objects is set using</span>
 1839 <span class="s2">        value of &#39;--selectionsChainStyle&#39; option.</span>
 1840 <span class="s2">        </span>
 1841 <span class="s2">        The specified selection specification is automatically appended to appropriate</span>
 1842 <span class="s2">        chain specification before creating PyMOL objects.</span>
 1843 <span class="s2">        </span>
 1844 <span class="s2">        For example, the following specification for &#39;--selectionsChain&#39; option will</span>
 1845 <span class="s2">        generate PyMOL objects for chains containing Cysteines and Serines:</span>
 1846 <span class="s2">            </span>
 1847 <span class="s2">            Cysteines,resn CYS,Serines,resn SER</span>
 1848 <span class="s2">            </span>
 1849 <span class="s2">    --selectionsChainStyle &lt;DisplayStyle&gt;  [default: sticks]</span>
 1850 <span class="s2">        Display style for PyMOL objects created for &#39;--selectionsChain&#39; option. It</span>
 1851 <span class="s2">        must be a valid PyMOL display style. No validation is performed.</span>
 1852 <span class="s2">    --surfaceComplex &lt;yes or no&gt;  [default: no]</span>
 1853 <span class="s2">        Create surfaces for complete complex in input file(s) corresponding to density</span>
 1854 <span class="s2">        map.</span>
 1855 <span class="s2">    --surfaceChainComplex &lt;yes, no or auto&gt;  [default: auto]</span>
 1856 <span class="s2">        Create surfaces for individual chain complexes in each input file using corresponding</span>
 1857 <span class="s2">        density map file. By default, the surfaces are automatically created for chain complexes</span>
 1858 <span class="s2">        without any ligands.</span>
 1859 <span class="s2">    --surfaceTransparency &lt;number&gt;  [default: 0.25]</span>
 1860 <span class="s2">        Surface transparency for molecular and cryo-EM density surfaces.</span>
 1861 <span class="s2">    --overwrite</span>
 1862 <span class="s2">        Overwrite existing files.</span>
 1863 <span class="s2">    --volumeCarveRadius &lt;number&gt;  [default: 1.6]</span>
 1864 <span class="s2">        Radius in Angstroms around atoms for including cryo-EM density.</span>
 1865 <span class="s2">    --volumeComplex &lt;yes or no&gt;  [default: no]</span>
 1866 <span class="s2">        Create volumes for complete complex in each input file using corresponding density</span>
 1867 <span class="s2">        map file.</span>
 1868 <span class="s2">    --volumeChainComplex &lt;yes, no, or auto&gt;  [default: auto]</span>
 1869 <span class="s2">        Create volumes for individual chain complex in each input file using corresponding</span>
 1870 <span class="s2">        density map file. By default, the volumes are automatically created for chain</span>
 1871 <span class="s2">        complexes without any ligands.</span>
 1872 <span class="s2">    --volumeColorRamp &lt;text&gt;  [default: auto]</span>
 1873 <span class="s2">        Name of a volume color ramp for density map files. The specified value must</span>
 1874 <span class="s2">        be a valid name. No validation is performed. The following volume color ramps</span>
 1875 <span class="s2">        are currently available in PyMOL: default, 2fofc, fofc, rainbow, and rainbow2.</span>
 1876 <span class="s2">        </span>
 1877 <span class="s2">        The default is to automatically create a new volume color ramp for the first</span>
 1878 <span class="s2">        input file using recommended contour level with an offset of 0.3 around this value.</span>
 1879 <span class="s2">        The header file emd-&lt;EMDBID&gt;.xml must be present in the working directory  to</span>
 1880 <span class="s2">        automatically retrieve recommended contour level and generate a  volume color ramp.</span>
 1881 <span class="s2">        Otherwise, PyMOL default volume color ramp is employed to color volumes.</span>
 1882 <span class="s2">        </span>
 1883 <span class="s2">        The volume color ramp automatically created for the first input file is used for all</span>
 1884 <span class="s2">        other input files.</span>
 1885 <span class="s2">    -w, --workingdir &lt;dir&gt;</span>
 1886 <span class="s2">        Location of working directory which defaults to the current directory.</span>
 1887 
 1888 <span class="s2">Examples:</span>
 1889 <span class="s2">    To download structure and cryo-EM data for 5K12, 5UMD, 5W81, and 5UAK</span>
 1890 <span class="s2">    before running the following examples, type:</span>
 1891 
 1892 <span class="s2">        % DownloadPDBFiles.pl --DensityMap yes 5K12,5UMD,5W81,5UAK</span>
 1893 
 1894 <span class="s2">    To visualize cryo-EM density at recommended contour level for the first</span>
 1895 <span class="s2">    chain complex in a PDB file using corresponding density map and header</span>
 1896 <span class="s2">    file, and generate a PML file type:</span>
 1897 
 1898 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -i 5K12.pdb -o 5K12.pml</span>
 1899 
 1900 <span class="s2">    To visualize cryo-EM density at recommended contour level for the first</span>
 1901 <span class="s2">    chain complex in a PDB file and highlighting densities for all cysteines and</span>
 1902 <span class="s2">    serines  using corresponding density map and header file, and generate</span>
 1903 <span class="s2">    a PML file type:</span>
 1904 
 1905 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -i 5K12.pdb -o 5K12.pml</span>
 1906 <span class="s2">          --selectionsChain &quot;Csysteines,resn cys,Serines,resn ser&quot;</span>
 1907 
 1908 <span class="s2">    To visualize electron density for the largest ligand in  chain K, and ligand</span>
 1909 <span class="s2">    binding pocket to highlight ligand interactions with pockect residues,</span>
 1910 <span class="s2">    solvents and inorganics, in a PDB and using corresponding map files, and</span>
 1911 <span class="s2">    generate a PML file, type:</span>
 1912 
 1913 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -c K -i 5UMD.cif -o 5UMD.pml</span>
 1914 
 1915 <span class="s2">    To visualize cryo-EM density for all  chains along with any solvents in a</span>
 1916 <span class="s2">    PDB file and using corresponding map files, and generate a PML file, type:</span>
 1917 
 1918 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -c all -i 5K12.pdb -o 5K12.pml</span>
 1919 
 1920 <span class="s2">    To visualize cryo-EM density at a specific contour level for the first chain</span>
 1921 <span class="s2">    complex along with volume and surface in a PDB file using corresponding</span>
 1922 <span class="s2">    to a specific density map file, and generate a PML file, type:</span>
 1923 
 1924 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -d emd_8194.map.gz --meshLevel 1.0</span>
 1925 <span class="s2">          --surfaceChainComplex yes --volumeChainComplex yes -i 5K12.pdb</span>
 1926 <span class="s2">          -o 5K12.pml</span>
 1927 
 1928 <span class="s2">    To align and visualize cryo-EM density at recommended contour levels for the</span>
 1929 <span class="s2">    largest ligand in the first chain along with pockets or the first chain complex</span>
 1930 <span class="s2">    in input files using corresponding maps and header files, type:</span>
 1931 
 1932 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -a yes -i &quot;5W81.pdb,5UAK.pdb&quot;</span>
 1933 <span class="s2">          -o SampleOut.pml</span>
 1934 
 1935 <span class="s2">    To align and visualize cryo-EM density at recommended contour levels for all</span>
 1936 <span class="s2">    chains and ligands in input files using specified density files, type:</span>
 1937 <span class="s2">    in input files using corresponding maps and header files, type:</span>
 1938 
 1939 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -a yes -i &quot;5W81.pdb,5UAK.pdb&quot;</span>
 1940 <span class="s2">          -o SampleOut.pml -c all -l all -d &quot;emd_8782.map.gz,emd_8516.map.gz&quot;</span>
 1941 
 1942 <span class="s2">Author:</span>
 1943 <span class="s2">    Manish Sud(msud@san.rr.com)</span>
 1944 
 1945 <span class="s2">See also:</span>
 1946 <span class="s2">    DownloadPDBFiles.pl, PyMOLVisualizeCavities.py,</span>
 1947 <span class="s2">    PyMOLVisualizeElectronDensity.py, PyMOLVisualizeInterfaces.py,</span>
 1948 <span class="s2">    PyMOLVisualizeMacromolecules.py, PyMOLVisualizeSurfaceAndBuriedResidues.py</span>
 1949 
 1950 <span class="s2">Copyright:</span>
 1951 <span class="s2">    Copyright (C) 2020 Manish Sud. All rights reserved.</span>
 1952 
 1953 <span class="s2">    The functionality available in this script is implemented using PyMOL, a</span>
 1954 <span class="s2">    molecular visualization system on an open source foundation originally</span>
 1955 <span class="s2">    developed by Warren DeLano.</span>
 1956 
 1957 <span class="s2">    This file is part of MayaChemTools.</span>
 1958 
 1959 <span class="s2">    MayaChemTools is free software; you can redistribute it and/or modify it under</span>
 1960 <span class="s2">    the terms of the GNU Lesser General Public License as published by the Free</span>
 1961 <span class="s2">    Software Foundation; either version 3 of the License, or (at your option) any</span>
 1962 <span class="s2">    later version.</span>
 1963 
 1964 <span class="s2">&quot;&quot;&quot;</span>
 1965 
 1966 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
 1967     <span class="n">main</span><span class="p">()</span>
</pre>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
