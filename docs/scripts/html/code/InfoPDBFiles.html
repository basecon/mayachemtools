<html>
<head>
<title>MayaChemTools:Code:InfoPDBFiles.pl</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
   1 #!/usr/bin/perl -w
   2 <span class="c">#</span>
   3 <span class="c"># File: InfoPDBFiles.pl</span>
   4 <span class="c"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
   5 <span class="c">#</span>
   6 <span class="c"># Copyright (C) 2020 Manish Sud. All rights reserved.</span>
   7 <span class="c">#</span>
   8 <span class="c"># This file is part of MayaChemTools.</span>
   9 <span class="c">#</span>
  10 <span class="c"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
  11 <span class="c"># the terms of the GNU Lesser General Public License as published by the Free</span>
  12 <span class="c"># Software Foundation; either version 3 of the License, or (at your option) any</span>
  13 <span class="c"># later version.</span>
  14 <span class="c">#</span>
  15 <span class="c"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
  16 <span class="c"># any warranty; without even the implied warranty of merchantability of fitness</span>
  17 <span class="c"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
  18 <span class="c"># details.</span>
  19 <span class="c">#</span>
  20 <span class="c"># You should have received a copy of the GNU Lesser General Public License</span>
  21 <span class="c"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
  22 <span class="c"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
  23 <span class="c"># Boston, MA, 02111-1307, USA.</span>
  24 <span class="c">#</span>
  25 
  26 <span class="k">use</span> <span class="w">strict</span><span class="sc">;</span>
  27 <span class="k">use</span> <span class="w">FindBin</span><span class="sc">;</span> <span class="k">use</span> <span class="w">lib</span> <span class="q">&quot;$FindBin::Bin/../lib&quot;</span><span class="sc">;</span>
  28 <span class="k">use</span> <span class="w">Getopt::Long</span><span class="sc">;</span>
  29 <span class="k">use</span> <span class="w">File::Basename</span><span class="sc">;</span>
  30 <span class="k">use</span> <span class="w">Text::ParseWords</span><span class="sc">;</span>
  31 <span class="k">use</span> <span class="w">Benchmark</span><span class="sc">;</span>
  32 <span class="k">use</span> <span class="w">FileUtil</span><span class="sc">;</span>
  33 <span class="k">use</span> <span class="w">TextUtil</span><span class="sc">;</span>
  34 <span class="k">use</span> <span class="w">PDBFileUtil</span><span class="sc">;</span>
  35 
  36 <span class="k">my</span><span class="s">(</span><span class="i">$ScriptName</span><span class="cm">,</span> <span class="i">%Options</span><span class="cm">,</span> <span class="i">$StartTime</span><span class="cm">,</span> <span class="i">$EndTime</span><span class="cm">,</span> <span class="i">$TotalTime</span><span class="s">)</span><span class="sc">;</span>
  37 
  38 <span class="c"># Autoflush STDOUT</span>
  39 <span class="i">$|</span> = <span class="n">1</span><span class="sc">;</span>
  40 
  41 <span class="c"># Starting message...</span>
  42 <span class="i">$ScriptName</span> = <span class="i">basename</span><span class="s">(</span><span class="i">$0</span><span class="s">)</span><span class="sc">;</span>
  43 <span class="k">print</span> <span class="q">&quot;\n$ScriptName: Starting...\n\n&quot;</span><span class="sc">;</span>
  44 <span class="i">$StartTime</span> = <span class="w">new</span> <span class="w">Benchmark</span><span class="sc">;</span>
  45 
  46 <span class="c"># Get the options and setup script...</span>
  47 <span class="i">SetupScriptUsage</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  48 <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">help</span>} || <span class="i">@ARGV</span> &lt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
  49   <span class="k">die</span> <span class="i">GetUsageFromPod</span><span class="s">(</span><span class="q">&quot;$FindBin::Bin/$ScriptName&quot;</span><span class="s">)</span><span class="sc">;</span>
  50 <span class="s">}</span>
  51 
  52 <span class="k">my</span><span class="s">(</span><span class="i">@PDBFilesList</span><span class="s">)</span><span class="sc">;</span>
  53 <span class="i">@PDBFilesList</span> = <span class="i">ExpandFileNames</span><span class="s">(</span>\<span class="i">@ARGV</span><span class="cm">,</span> <span class="q">&quot;pdb&quot;</span><span class="s">)</span><span class="sc">;</span>
  54 
  55 <span class="c"># Process options...</span>
  56 <span class="k">print</span> <span class="q">&quot;Processing options...\n&quot;</span><span class="sc">;</span>
  57 <span class="k">my</span><span class="s">(</span><span class="i">%OptionsInfo</span><span class="s">)</span><span class="sc">;</span>
  58 <span class="i">ProcessOptions</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  59 
  60 <span class="c"># Setup information about input files...</span>
  61 <span class="k">my</span><span class="s">(</span><span class="i">%PDBFilesInfo</span><span class="s">)</span><span class="sc">;</span>
  62 <span class="k">print</span> <span class="q">&quot;Checking input PDB file(s)...\n&quot;</span><span class="sc">;</span>
  63 <span class="i">RetrievePDBFilesInfo</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  64 
  65 <span class="c"># Process input files..</span>
  66 <span class="k">my</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
  67 <span class="k">if</span> <span class="s">(</span><span class="i">@PDBFilesList</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
  68   <span class="k">print</span> <span class="q">&quot;\nProcessing PDB files...\n&quot;</span><span class="sc">;</span>
  69 <span class="s">}</span>
  70 <span class="k">for</span> <span class="i">$FileIndex</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#PDBFilesList</span><span class="s">)</span> <span class="s">{</span>
  71   <span class="k">if</span> <span class="s">(</span><span class="i">$PDBFilesInfo</span>{<span class="w">FileOkay</span>}[<span class="i">$FileIndex</span>]<span class="s">)</span> <span class="s">{</span>
  72     <span class="k">print</span> <span class="q">&quot;\nProcessing file $PDBFilesList[$FileIndex]...\n&quot;</span><span class="sc">;</span>
  73     <span class="i">ListPDBFileInfo</span><span class="s">(</span><span class="i">$FileIndex</span><span class="s">)</span><span class="sc">;</span>
  74   <span class="s">}</span>
  75 <span class="s">}</span>
  76 <span class="i">ListTotalSizeOfFiles</span><span class="s">(</span><span class="s">)</span><span class="sc">;</span>
  77 
  78 <span class="k">print</span> <span class="q">&quot;\n$ScriptName:Done...\n\n&quot;</span><span class="sc">;</span>
  79 
  80 <span class="i">$EndTime</span> = <span class="w">new</span> <span class="w">Benchmark</span><span class="sc">;</span>
  81 <span class="i">$TotalTime</span> = <span class="w">timediff</span> <span class="s">(</span><span class="i">$EndTime</span><span class="cm">,</span> <span class="i">$StartTime</span><span class="s">)</span><span class="sc">;</span>
  82 <span class="k">print</span> <span class="q">&quot;Total time: &quot;</span><span class="cm">,</span> <span class="i">timestr</span><span class="s">(</span><span class="i">$TotalTime</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
  83 
  84 <span class="c">###############################################################################</span>
  85 
  86 <span class="c"># List appropriate information...</span>
<a name="ListPDBFileInfo-"></a>  87 <span class="k">sub </span><span class="m">ListPDBFileInfo</span> <span class="s">{</span>
  88   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
  89   <span class="k">my</span><span class="s">(</span><span class="i">$PDBFile</span><span class="cm">,</span> <span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
  90 
  91   <span class="i">$PDBFile</span> = <span class="i">$PDBFilesList</span>[<span class="i">$Index</span>]<span class="sc">;</span>
  92   <span class="i">$PDBRecordLinesRef</span> = <span class="i">ReadPDBFile</span><span class="s">(</span><span class="i">$PDBFile</span><span class="s">)</span><span class="sc">;</span>
  93 
  94   <span class="c"># Header informaton...</span>
  95   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">ListHeaderInfo</span>}<span class="s">)</span> <span class="s">{</span>
  96     <span class="i">ListHeaderInfo</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
  97   <span class="s">}</span>
  98 
  99   <span class="c"># Experiment informaton...</span>
 100   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">ListExperimentalTechniqueInfo</span>}<span class="s">)</span> <span class="s">{</span>
 101     <span class="i">ListExperimentalTechniqueInfo</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 102   <span class="s">}</span>
 103 
 104   <span class="c"># Total number of records...</span>
 105   <span class="k">my</span><span class="s">(</span><span class="i">$TotalRecordsCount</span><span class="s">)</span> = <span class="k">scalar</span> <span class="i">@</span>{<span class="i">$PDBRecordLinesRef</span>}<span class="sc">;</span>
 106   <span class="k">print</span> <span class="q">&quot;\nTotal number of records: $TotalRecordsCount\n&quot;</span><span class="sc">;</span>
 107 
 108   <span class="c"># List record type count information...</span>
 109   <span class="i">ListRecordTypesInfo</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 110 
 111   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CountChains</span>} || <span class="i">$OptionsInfo</span>{<span class="w">CountResiduesInChains</span>} || <span class="i">$OptionsInfo</span>{<span class="w">ResiduesFrequencyInChains</span>}<span class="s">)</span> <span class="s">{</span>
 112     <span class="i">ListChainsAndResiduesInfo</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 113   <span class="s">}</span>
 114   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CountResiduesAll</span>} || <span class="i">$OptionsInfo</span>{<span class="w">ResiduesFrequencyAll</span>}<span class="s">)</span> <span class="s">{</span>
 115     <span class="i">ListAllResiduesInfo</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 116   <span class="s">}</span>
 117   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">ResidueNumbersInfo</span>}<span class="s">)</span> <span class="s">{</span>
 118     <span class="i">ListResidueNumbersInfo</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 119   <span class="s">}</span>
 120   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CalculateBoundingBox</span>}<span class="s">)</span> <span class="s">{</span>
 121     <span class="i">ListBoundingBox</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 122   <span class="s">}</span>
 123 
 124   <span class="c"># File size and modification information...</span>
 125   <span class="k">print</span> <span class="q">&quot;\nFile size: &quot;</span><span class="cm">,</span> <span class="i">FormatFileSize</span><span class="s">(</span><span class="i">$PDBFilesInfo</span>{<span class="w">FileSize</span>}[<span class="i">$Index</span>]<span class="s">)</span><span class="cm">,</span> <span class="q">&quot; \n&quot;</span><span class="sc">;</span>
 126   <span class="k">print</span> <span class="q">&quot;Last modified: &quot;</span><span class="cm">,</span> <span class="i">$PDBFilesInfo</span>{<span class="w">FileLastModified</span>}[<span class="i">$Index</span>]<span class="cm">,</span> <span class="q">&quot; \n&quot;</span><span class="sc">;</span>
 127 <span class="s">}</span>
 128 
<a name="ListHeaderInfo-"></a> 129 <span class="k">sub </span><span class="m">ListHeaderInfo</span> <span class="s">{</span>
 130   <span class="k">my</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 131   <span class="k">my</span><span class="s">(</span><span class="i">$HeaderRecordLine</span><span class="cm">,</span> <span class="i">$Classification</span><span class="cm">,</span> <span class="i">$DepositionDate</span><span class="cm">,</span> <span class="i">$IDCode</span><span class="s">)</span><span class="sc">;</span>
 132 
 133   <span class="s">(</span><span class="i">$Classification</span><span class="cm">,</span> <span class="i">$DepositionDate</span><span class="cm">,</span> <span class="i">$IDCode</span><span class="s">)</span> = <span class="s">(</span><span class="k">undef</span><span class="s">)</span> x <span class="n">3</span><span class="sc">;</span>
 134   <span class="i">$HeaderRecordLine</span> = <span class="i">$PDBRecordLinesRef</span>-&gt;[<span class="n">0</span>]<span class="sc">;</span>
 135   <span class="k">if</span> <span class="s">(</span><span class="i">IsHeaderRecordType</span><span class="s">(</span><span class="i">$HeaderRecordLine</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 136     <span class="s">(</span><span class="i">$Classification</span><span class="cm">,</span> <span class="i">$DepositionDate</span><span class="cm">,</span> <span class="i">$IDCode</span><span class="s">)</span> = <span class="i">ParseHeaderRecordLine</span><span class="s">(</span><span class="i">$HeaderRecordLine</span><span class="s">)</span><span class="sc">;</span>
 137   <span class="s">}</span>
 138 
 139   <span class="i">$Classification</span> = <span class="i">IsEmpty</span><span class="s">(</span><span class="i">$Classification</span><span class="s">)</span> ? <span class="q">&#39;Not available&#39;</span> <span class="co">:</span> <span class="i">$Classification</span><span class="sc">;</span>
 140   <span class="i">$DepositionDate</span> = <span class="i">IsEmpty</span><span class="s">(</span><span class="i">$DepositionDate</span><span class="s">)</span> ? <span class="q">&#39;Not available&#39;</span> <span class="co">:</span> <span class="i">$DepositionDate</span><span class="sc">;</span>
 141   <span class="i">$IDCode</span> = <span class="i">IsEmpty</span><span class="s">(</span><span class="i">$IDCode</span><span class="s">)</span> ? <span class="q">&#39;Not available&#39;</span> <span class="co">:</span> <span class="i">$IDCode</span><span class="sc">;</span>
 142 
 143   <span class="k">print</span> <span class="q">&quot;\nClassification: $Classification\nID: $IDCode\nDeposition date: $DepositionDate\n&quot;</span><span class="sc">;</span>
 144 <span class="s">}</span>
 145 
 146 <span class="c"># List experimental technique information info...</span>
<a name="ListExperimentalTechniqueInfo-"></a> 147 <span class="k">sub </span><span class="m">ListExperimentalTechniqueInfo</span> <span class="s">{</span>
 148   <span class="k">my</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 149   <span class="k">my</span><span class="s">(</span><span class="i">$ExperimentalTechnique</span><span class="cm">,</span> <span class="i">$Resolution</span><span class="cm">,</span> <span class="i">$ResolutionUnits</span><span class="s">)</span><span class="sc">;</span>
 150 
 151   <span class="i">$ExperimentalTechnique</span> = <span class="i">GetExperimentalTechnique</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 152   <span class="k">print</span> <span class="q">&quot;\nExperimental technique: &quot;</span> . <span class="s">(</span><span class="i">$ExperimentalTechnique</span> ? <span class="i">$ExperimentalTechnique</span> <span class="co">:</span> <span class="q">&quot;Not available&quot;</span><span class="s">)</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 153 
 154   <span class="s">(</span><span class="i">$Resolution</span><span class="cm">,</span> <span class="i">$ResolutionUnits</span><span class="s">)</span> = <span class="i">GetExperimentalTechniqueResolution</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 155   <span class="k">print</span> <span class="q">&quot;Resolution: &quot;</span> . <span class="s">(</span><span class="i">$Resolution</span> ? <span class="q">&quot;$Resolution $ResolutionUnits&quot;</span> <span class="co">:</span> <span class="q">&quot;Not available&quot;</span><span class="s">)</span> . <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 156 
 157 <span class="s">}</span>
 158 
 159 <span class="c"># List record type info...</span>
<a name="ListRecordTypesInfo-"></a> 160 <span class="k">sub </span><span class="m">ListRecordTypesInfo</span> <span class="s">{</span>
 161   <span class="k">my</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 162   <span class="k">my</span><span class="s">(</span><span class="i">$RecordType</span><span class="cm">,</span> <span class="i">$RecordCount</span><span class="cm">,</span> <span class="i">$RecordTypesCountRef</span><span class="cm">,</span> <span class="i">@RecordTypeCountInfo</span><span class="s">)</span><span class="sc">;</span>
 163 
 164   <span class="i">$RecordTypesCountRef</span> = <span class="i">GetRecordTypesCount</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 165 
 166   <span class="i">@RecordTypeCountInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 167   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CountRecordType</span>} =~ <span class="q">/^All$/i</span><span class="s">)</span> <span class="s">{</span>
 168     <span class="k">for</span> <span class="i">$RecordType</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">RecordTypes</span>}}<span class="s">)</span> <span class="s">{</span>
 169       <span class="i">$RecordCount</span> = <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="i">$RecordType</span>}<span class="sc">;</span>
 170       <span class="k">push</span> <span class="i">@RecordTypeCountInfo</span><span class="cm">,</span> <span class="q">&quot;$RecordType - $RecordCount&quot;</span><span class="sc">;</span>
 171     <span class="s">}</span>
 172   <span class="s">}</span>
 173   <span class="k">else</span> <span class="s">{</span>
 174     <span class="k">for</span> <span class="i">$RecordType</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedRecordTypes</span>}}<span class="s">)</span> <span class="s">{</span>
 175       <span class="i">$RecordCount</span> = <span class="s">(</span><span class="k">exists</span> <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="i">$RecordType</span>}<span class="s">)</span> ? <span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="i">$RecordType</span>}<span class="s">)</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 176       <span class="k">push</span> <span class="i">@RecordTypeCountInfo</span><span class="cm">,</span> <span class="q">&quot;$RecordType - $RecordCount&quot;</span><span class="sc">;</span>
 177     <span class="s">}</span>
 178   <span class="s">}</span>
 179   <span class="k">print</span> <span class="q">&quot;Number of individual records: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@RecordTypeCountInfo</span><span class="cm">,</span> <span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 180 
 181   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CheckMasterRecord</span>}<span class="s">)</span> <span class="s">{</span>
 182     <span class="i">CheckMasterRecord</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span><span class="cm">,</span> <span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 183   <span class="s">}</span>
 184 <span class="s">}</span>
 185 
 186 <span class="c"># List information about residues and chains...</span>
<a name="ListChainsAndResiduesInfo-"></a> 187 <span class="k">sub </span><span class="m">ListChainsAndResiduesInfo</span> <span class="s">{</span>
 188   <span class="k">my</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 189   <span class="k">my</span><span class="s">(</span><span class="i">$ResidueName</span><span class="cm">,</span> <span class="i">$ResidueCount</span><span class="cm">,</span> <span class="i">$ChainCount</span><span class="cm">,</span> <span class="i">$ChainID</span><span class="cm">,</span> <span class="i">$CollectChainResiduesBeyondTER</span><span class="cm">,</span> <span class="i">$ChainsAndResiduesInfoRef</span><span class="s">)</span><span class="sc">;</span>
 190 
 191   <span class="i">$CollectChainResiduesBeyondTER</span> = <span class="n">1</span><span class="sc">;</span>
 192   <span class="i">$ChainsAndResiduesInfoRef</span> = <span class="i">GetChainsAndResidues</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="cm">,</span> <span class="q">&#39;AtomAndHetatm&#39;</span><span class="cm">,</span> <span class="i">$CollectChainResiduesBeyondTER</span><span class="s">)</span><span class="sc">;</span>
 193   <span class="i">$ChainCount</span> = <span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ChainIDs</span>}}<span class="sc">;</span>
 194   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CountChains</span>}<span class="s">)</span> <span class="s">{</span>
 195     <span class="k">print</span> <span class="q">&quot;\nNumber of chains: $ChainCount \n&quot;</span><span class="sc">;</span>
 196     <span class="k">my</span><span class="s">(</span><span class="i">$ChainID</span><span class="cm">,</span> <span class="i">@ChainIDsList</span><span class="s">)</span><span class="sc">;</span>
 197     <span class="i">@ChainIDsList</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 198     <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 199       <span class="k">push</span> <span class="i">@ChainIDsList</span><span class="cm">,</span> <span class="i">CleanupChainID</span><span class="s">(</span><span class="i">$ChainID</span><span class="s">)</span><span class="sc">;</span>
 200     <span class="s">}</span>
 201     <span class="k">print</span> <span class="q">&quot;Chain IDs: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@ChainIDsList</span><span class="cm">,</span> <span class="q">&#39;, &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span><span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 202   <span class="s">}</span>
 203 
 204   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CountResiduesInChains</span>}<span class="s">)</span> <span class="s">{</span>
 205     <span class="k">my</span><span class="s">(</span><span class="i">$TotalResiduesCount</span><span class="cm">,</span> <span class="i">$ResidueCountInfo</span><span class="cm">,</span> <span class="i">@ResiduesCountInfo</span><span class="s">)</span><span class="sc">;</span>
 206     <span class="i">@ResiduesCountInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 207     <span class="i">$TotalResiduesCount</span> = <span class="n">0</span><span class="sc">;</span>
 208     <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 209       <span class="i">$ResidueCount</span> = <span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">Residues</span>}{<span class="i">$ChainID</span>}}<span class="sc">;</span>
 210       <span class="i">$TotalResiduesCount</span> += <span class="i">$ResidueCount</span><span class="sc">;</span>
 211       <span class="i">$ResidueCountInfo</span> =  <span class="q">&quot;Chain ${ChainID} - ${ResidueCount}&quot;</span><span class="sc">;</span>
 212       <span class="k">push</span> <span class="i">@ResiduesCountInfo</span><span class="cm">,</span> <span class="i">$ResidueCountInfo</span><span class="sc">;</span>
 213     <span class="s">}</span>
 214     <span class="k">print</span> <span class="q">&quot;\nNumber of residues in chain(s): &quot;</span><span class="sc">;</span>
 215     <span class="k">if</span> <span class="s">(</span><span class="i">$ChainCount</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 216       <span class="k">print</span> <span class="q">&quot;Total - $TotalResiduesCount; &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@ResiduesCountInfo</span><span class="cm">,</span> <span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span><span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 217     <span class="s">}</span>
 218     <span class="k">else</span> <span class="s">{</span>
 219       <span class="k">print</span> <span class="q">&quot;$TotalResiduesCount\n&quot;</span><span class="sc">;</span>
 220     <span class="s">}</span>
 221 
 222     <span class="c"># List of residues in each chain...</span>
 223     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
 224       <span class="k">print</span> <span class="q">&quot;List of residues in chain(s): \n&quot;</span><span class="sc">;</span>
 225       <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 226         <span class="k">if</span> <span class="s">(</span><span class="i">$ChainCount</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 227           <span class="k">print</span> <span class="q">&quot;Chain &quot;</span><span class="cm">,</span> <span class="i">CleanupChainID</span><span class="s">(</span><span class="i">$ChainID</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;: &quot;</span><span class="sc">;</span>
 228         <span class="s">}</span>
 229         <span class="k">print</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">Residues</span>}{<span class="i">$ChainID</span>}}<span class="cm">,</span> <span class="q">&#39;, &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span><span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 230       <span class="s">}</span>
 231     <span class="s">}</span>
 232   <span class="s">}</span>
 233   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">ResiduesFrequencyInChains</span>}<span class="s">)</span> <span class="s">{</span>
 234     <span class="c"># Setup a hash using residue count as key for sorting the values...</span>
 235     <span class="k">my</span><span class="s">(</span><span class="i">%ResiduesCountToNameMap</span><span class="s">)</span><span class="sc">;</span>
 236     <span class="i">%ResiduesCountToNameMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 237     <span class="i">@</span>{<span class="i">$ResiduesCountToNameMap</span>{<span class="w">ChainIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 238     <span class="i">%</span>{<span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 239 
 240     <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 241       <span class="k">push</span> <span class="i">@</span>{<span class="i">$ResiduesCountToNameMap</span>{<span class="w">ChainIDs</span>}}<span class="cm">,</span> <span class="i">$ChainID</span><span class="sc">;</span>
 242       <span class="i">%</span>{<span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ChainID</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 243 
 244       <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="k">sort</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueCount</span>}{<span class="i">$ChainID</span>}}<span class="s">)</span> <span class="s">{</span>
 245         <span class="i">$ResidueCount</span> = <span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueCount</span>}{<span class="i">$ChainID</span>}{<span class="i">$ResidueName</span>}<span class="sc">;</span>
 246         <span class="c"># Setup count value for each chain...</span>
 247         <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ChainID</span>}{<span class="i">$ResidueCount</span>}<span class="s">)</span> <span class="s">{</span>
 248           <span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ChainID</span>}{<span class="i">$ResidueCount</span>} .= <span class="q">&quot;~${ResidueName}&quot;</span><span class="sc">;</span>
 249         <span class="s">}</span>
 250         <span class="k">else</span> <span class="s">{</span>
 251           <span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ChainID</span>}{<span class="i">$ResidueCount</span>} = <span class="i">$ResidueName</span><span class="sc">;</span>
 252         <span class="s">}</span>
 253       <span class="s">}</span>
 254     <span class="s">}</span>
 255     <span class="c"># Collect data for all the residues in all the chains...</span>
 256     <span class="k">my</span><span class="s">(</span><span class="i">%AllResiduesNameToCountMap</span><span class="cm">,</span> <span class="i">%AllResiduesCountToNameMap</span><span class="s">)</span><span class="sc">;</span>
 257     <span class="i">%AllResiduesNameToCountMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 258     <span class="i">%AllResiduesCountToNameMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 259     <span class="k">if</span> <span class="s">(</span><span class="i">$ChainCount</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 260       <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 261         <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueCount</span>}{<span class="i">$ChainID</span>}}<span class="s">)</span> <span class="s">{</span>
 262           <span class="i">$ResidueCount</span> = <span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueCount</span>}{<span class="i">$ChainID</span>}{<span class="i">$ResidueName</span>}<span class="sc">;</span>
 263           <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$AllResiduesNameToCountMap</span>{<span class="i">$ResidueName</span>}<span class="s">)</span> <span class="s">{</span>
 264             <span class="i">$AllResiduesNameToCountMap</span>{<span class="i">$ResidueName</span>} += <span class="i">$ResidueCount</span><span class="sc">;</span>
 265           <span class="s">}</span>
 266           <span class="k">else</span> <span class="s">{</span>
 267             <span class="i">$AllResiduesNameToCountMap</span>{<span class="i">$ResidueName</span>} = <span class="i">$ResidueCount</span><span class="sc">;</span>
 268           <span class="s">}</span>
 269         <span class="s">}</span>
 270       <span class="s">}</span>
 271       <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%AllResiduesNameToCountMap</span><span class="s">)</span> <span class="s">{</span>
 272         <span class="i">$ResidueCount</span> = <span class="i">$AllResiduesNameToCountMap</span>{<span class="i">$ResidueName</span>}<span class="sc">;</span>
 273         <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$AllResiduesCountToNameMap</span>{<span class="i">$ResidueCount</span>}<span class="s">)</span> <span class="s">{</span>
 274           <span class="i">$AllResiduesCountToNameMap</span>{<span class="i">$ResidueCount</span>} .= <span class="q">&quot;~${ResidueName}&quot;</span><span class="sc">;</span>
 275         <span class="s">}</span>
 276         <span class="k">else</span> <span class="s">{</span>
 277           <span class="i">$AllResiduesCountToNameMap</span>{<span class="i">$ResidueCount</span>} = <span class="i">$ResidueName</span><span class="sc">;</span>
 278         <span class="s">}</span>
 279       <span class="s">}</span>
 280     <span class="s">}</span>
 281 
 282     <span class="c"># Setup distribution data for individual chains and the grand total as well...</span>
 283     <span class="k">my</span><span class="s">(</span><span class="i">$ChainResidueCount</span><span class="cm">,</span> <span class="i">$PercentResidueCount</span><span class="cm">,</span> <span class="i">$TotalResidueCount</span><span class="cm">,</span> <span class="i">$ResidueNames</span><span class="cm">,</span> <span class="i">@ResidueNamesList</span><span class="cm">,</span> <span class="i">%ResiduesFrequencyInfoMap</span><span class="s">)</span><span class="sc">;</span>
 284     <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">ChainIDs</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 285     <span class="i">%</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">Frequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 286     <span class="i">%</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">PercentFrequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 287 
 288     <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">AllChainsFrequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 289     <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">AllChainsPercentFrequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 290 
 291     <span class="i">$TotalResidueCount</span> = <span class="n">0</span><span class="sc">;</span>
 292 
 293     <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ResiduesCountToNameMap</span>{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 294       <span class="k">push</span> <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">ChainIDs</span>}}<span class="cm">,</span> <span class="i">$ChainID</span><span class="sc">;</span>
 295       <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">Frequency</span>}{<span class="i">$ChainID</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 296       <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">PercentFrequency</span>}{<span class="i">$ChainID</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 297 
 298       <span class="i">$ChainResidueCount</span> = <span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">Residues</span>}{<span class="i">$ChainID</span>}}<span class="sc">;</span>
 299       <span class="i">$TotalResidueCount</span> += <span class="i">$ChainResidueCount</span><span class="sc">;</span>
 300 
 301       <span class="k">for</span> <span class="i">$ResidueCount</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span><span class="i">$b</span> &lt;=&gt; <span class="i">$a</span><span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ChainID</span>}}<span class="s">)</span> <span class="s">{</span>
 302         <span class="i">$ResidueNames</span> = <span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ChainID</span>}{<span class="i">$ResidueCount</span>}<span class="sc">;</span>
 303         <span class="i">@ResidueNamesList</span> = <span class="k">split</span> <span class="q">/~/</span><span class="cm">,</span> <span class="i">$ResidueNames</span><span class="sc">;</span>
 304         <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="i">@ResidueNamesList</span><span class="s">)</span> <span class="s">{</span>
 305           <span class="k">push</span> <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">Frequency</span>}{<span class="i">$ChainID</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${ResidueCount}&quot;</span><span class="sc">;</span>
 306           <span class="i">$PercentResidueCount</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.1f&quot;</span><span class="cm">,</span> <span class="s">(</span><span class="s">(</span><span class="i">$ResidueCount</span>/<span class="i">$ChainResidueCount</span><span class="s">)</span>*<span class="n">100</span><span class="s">)</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 307           <span class="k">push</span> <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">PercentFrequency</span>}{<span class="i">$ChainID</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${PercentResidueCount}%&quot;</span><span class="sc">;</span>
 308         <span class="s">}</span>
 309       <span class="s">}</span>
 310     <span class="s">}</span>
 311     <span class="k">if</span> <span class="s">(</span><span class="i">$ChainCount</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 312       <span class="k">for</span> <span class="i">$ResidueCount</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span><span class="i">$b</span> &lt;=&gt; <span class="i">$a</span><span class="s">}</span> <span class="k">keys</span> <span class="i">%AllResiduesCountToNameMap</span><span class="s">)</span> <span class="s">{</span>
 313         <span class="i">$ResidueNames</span> = <span class="i">$AllResiduesCountToNameMap</span>{<span class="i">$ResidueCount</span>}<span class="sc">;</span>
 314         <span class="i">@ResidueNamesList</span> = <span class="k">split</span> <span class="q">/~/</span><span class="cm">,</span> <span class="i">$ResidueNames</span><span class="sc">;</span>
 315         <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="i">@ResidueNamesList</span><span class="s">)</span> <span class="s">{</span>
 316           <span class="k">push</span> <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">AllChainsFrequency</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${ResidueCount}&quot;</span><span class="sc">;</span>
 317           <span class="i">$PercentResidueCount</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.1f&quot;</span><span class="cm">,</span> <span class="s">(</span><span class="s">(</span><span class="i">$ResidueCount</span>/<span class="i">$TotalResidueCount</span><span class="s">)</span>*<span class="n">100</span><span class="s">)</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 318           <span class="k">push</span> <span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">AllChainsPercentFrequency</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${PercentResidueCount}%&quot;</span><span class="sc">;</span>
 319         <span class="s">}</span>
 320       <span class="s">}</span>
 321     <span class="s">}</span>
 322 
 323     <span class="c"># List distribution of residues</span>
 324     <span class="k">print</span> <span class="q">&quot;\nDistribution of residues in chain(s): \n&quot;</span><span class="sc">;</span>
 325     <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 326       <span class="k">if</span> <span class="s">(</span><span class="i">$ChainCount</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 327         <span class="k">print</span> <span class="q">&quot;Chain &quot;</span><span class="cm">,</span> <span class="i">CleanupChainID</span><span class="s">(</span><span class="i">$ChainID</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;: &quot;</span><span class="sc">;</span>
 328       <span class="s">}</span>
 329       <span class="k">print</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">Frequency</span>}{<span class="i">$ChainID</span>}}<span class="cm">,</span> <span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 330     <span class="s">}</span>
 331     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 332       <span class="k">print</span> <span class="q">&quot;\nPercent distribution of residues in chain(s): \n&quot;</span><span class="sc">;</span>
 333       <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 334         <span class="k">if</span> <span class="s">(</span><span class="i">$ChainCount</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 335           <span class="k">print</span> <span class="q">&quot;Chain &quot;</span><span class="cm">,</span> <span class="i">CleanupChainID</span><span class="s">(</span><span class="i">$ChainID</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;: &quot;</span><span class="sc">;</span>
 336         <span class="s">}</span>
 337         <span class="k">print</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">PercentFrequency</span>}{<span class="i">$ChainID</span>}}<span class="cm">,</span> <span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 338       <span class="s">}</span>
 339     <span class="s">}</span>
 340     <span class="k">if</span> <span class="s">(</span><span class="i">$ChainCount</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 341       <span class="k">print</span> <span class="q">&quot;\nDistribution of residues across all chains: \n&quot;</span><span class="sc">;</span>
 342       <span class="k">print</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">AllChainsFrequency</span>}}<span class="cm">,</span> <span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 343 
 344       <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 345         <span class="k">print</span> <span class="q">&quot;\nPercent distribution of residues across all chains: \n&quot;</span><span class="sc">;</span>
 346         <span class="k">print</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ResiduesFrequencyInfoMap</span>{<span class="w">AllChainsPercentFrequency</span>}}<span class="cm">,</span> <span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 347       <span class="s">}</span>
 348     <span class="s">}</span>
 349   <span class="s">}</span>
 350 <span class="s">}</span>
 351 
 352 <span class="c"># List information about all the residues...</span>
<a name="ListAllResiduesInfo-"></a> 353 <span class="k">sub </span><span class="m">ListAllResiduesInfo</span> <span class="s">{</span>
 354   <span class="k">my</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 355   <span class="k">my</span><span class="s">(</span><span class="i">$TotalResidueCount</span><span class="cm">,</span> <span class="i">$AtomResiduesCount</span><span class="cm">,</span> <span class="i">$HetatmResiduesCount</span><span class="cm">,</span> <span class="i">$ResiduesInfoRef</span><span class="s">)</span><span class="sc">;</span>
 356 
 357   <span class="i">$ResiduesInfoRef</span> = <span class="i">GetAllResidues</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 358   <span class="i">$TotalResidueCount</span> = <span class="i">@</span>{<span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">ResidueNames</span>}}<span class="sc">;</span>
 359   <span class="i">$AtomResiduesCount</span> = <span class="i">@</span>{<span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">AtomResidueNames</span>}}<span class="sc">;</span>
 360   <span class="i">$HetatmResiduesCount</span> = <span class="i">@</span>{<span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">HetatmResidueNames</span>}}<span class="sc">;</span>
 361 
 362   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CountResiduesAll</span>}<span class="s">)</span> <span class="s">{</span>
 363     <span class="k">print</span> <span class="q">&quot;\nTotal number of residues: Total - $TotalResidueCount; ATOM residues - $AtomResiduesCount; HETATM residues - $HetatmResiduesCount\n&quot;</span><span class="sc">;</span>
 364 
 365     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
 366       <span class="k">print</span> <span class="q">&quot;List of residues: \n&quot;</span><span class="sc">;</span>
 367       <span class="k">if</span> <span class="s">(</span><span class="i">$AtomResiduesCount</span><span class="s">)</span> <span class="s">{</span>
 368         <span class="k">print</span> <span class="q">&quot;ATOM residues: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">AtomResidueNames</span>}}<span class="cm">,</span> <span class="q">&#39;, &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 369       <span class="s">}</span>
 370       <span class="k">if</span> <span class="s">(</span><span class="i">$HetatmResiduesCount</span><span class="s">)</span> <span class="s">{</span>
 371         <span class="k">print</span> <span class="q">&quot;HETATM residues: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">HetatmResidueNames</span>}}<span class="cm">,</span> <span class="q">&#39;, &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 372       <span class="s">}</span>
 373     <span class="s">}</span>
 374   <span class="s">}</span>
 375 
 376   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">ResiduesFrequencyAll</span>}<span class="s">)</span> <span class="s">{</span>
 377     <span class="k">my</span><span class="s">(</span><span class="i">$ResidueName</span><span class="cm">,</span> <span class="i">$ResidueCount</span><span class="s">)</span><span class="sc">;</span>
 378 
 379     <span class="c"># Setup a hash using residue count as key for sorting the values...</span>
 380     <span class="k">my</span><span class="s">(</span><span class="i">%ResiduesCountToNameMap</span><span class="cm">,</span> <span class="i">%AtomResiduesCountToNameMap</span><span class="cm">,</span> <span class="i">%HetatmResiduesCountToNameMap</span><span class="s">)</span><span class="sc">;</span>
 381     <span class="i">%ResiduesCountToNameMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 382     <span class="i">%</span>{<span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 383 
 384     <span class="i">%AtomResiduesCountToNameMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 385     <span class="i">%</span>{<span class="i">$AtomResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 386 
 387     <span class="i">%HetatmResiduesCountToNameMap</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 388     <span class="i">%</span>{<span class="i">$HetatmResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 389 
 390     <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">ResidueCount</span>}}<span class="s">)</span> <span class="s">{</span>
 391       <span class="i">$ResidueCount</span> = <span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">ResidueCount</span>}{<span class="i">$ResidueName</span>}<span class="sc">;</span>
 392       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>}<span class="s">)</span> <span class="s">{</span>
 393         <span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>} .= <span class="q">&quot;~${ResidueName}&quot;</span><span class="sc">;</span>
 394       <span class="s">}</span>
 395       <span class="k">else</span> <span class="s">{</span>
 396         <span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>} = <span class="i">$ResidueName</span><span class="sc">;</span>
 397       <span class="s">}</span>
 398     <span class="s">}</span>
 399 
 400     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 401       <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">AtomResidueCount</span>}}<span class="s">)</span> <span class="s">{</span>
 402         <span class="i">$ResidueCount</span> = <span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">AtomResidueCount</span>}{<span class="i">$ResidueName</span>}<span class="sc">;</span>
 403         <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$AtomResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>}<span class="s">)</span> <span class="s">{</span>
 404           <span class="i">$AtomResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>} .= <span class="q">&quot;~${ResidueName}&quot;</span><span class="sc">;</span>
 405         <span class="s">}</span>
 406         <span class="k">else</span> <span class="s">{</span>
 407           <span class="i">$AtomResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>} = <span class="i">$ResidueName</span><span class="sc">;</span>
 408         <span class="s">}</span>
 409       <span class="s">}</span>
 410       <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="k">keys</span> <span class="i">%</span>{<span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">HetatmResidueCount</span>}}<span class="s">)</span> <span class="s">{</span>
 411         <span class="i">$ResidueCount</span> = <span class="i">$ResiduesInfoRef</span>-&gt;{<span class="w">HetatmResidueCount</span>}{<span class="i">$ResidueName</span>}<span class="sc">;</span>
 412         <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$HetatmResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>}<span class="s">)</span> <span class="s">{</span>
 413           <span class="i">$HetatmResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>} .= <span class="q">&quot;~${ResidueName}&quot;</span><span class="sc">;</span>
 414         <span class="s">}</span>
 415         <span class="k">else</span> <span class="s">{</span>
 416           <span class="i">$HetatmResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>} = <span class="i">$ResidueName</span><span class="sc">;</span>
 417         <span class="s">}</span>
 418       <span class="s">}</span>
 419     <span class="s">}</span>
 420 
 421     <span class="c"># Setup distribution of residues info...</span>
 422     <span class="k">my</span><span class="s">(</span><span class="i">$ResidueNames</span><span class="cm">,</span> <span class="i">$PercentResidueCount</span><span class="cm">,</span> <span class="i">@ResidueNamesList</span><span class="cm">,</span> <span class="i">%ResiduesCountInfoMap</span><span class="cm">,</span> <span class="i">%AtomResiduesCountInfoMap</span><span class="cm">,</span> <span class="i">%HetatmResiduesCountInfoMap</span><span class="s">)</span><span class="sc">;</span>
 423 
 424     <span class="i">@</span>{<span class="i">$ResiduesCountInfoMap</span>{<span class="w">Frequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 425     <span class="i">@</span>{<span class="i">$ResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 426     <span class="k">for</span> <span class="i">$ResidueCount</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span><span class="i">$b</span> &lt;=&gt; <span class="i">$a</span><span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}}<span class="s">)</span> <span class="s">{</span>
 427       <span class="i">$PercentResidueCount</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.1f&quot;</span><span class="cm">,</span> <span class="s">(</span><span class="s">(</span><span class="i">$ResidueCount</span>/<span class="i">$TotalResidueCount</span><span class="s">)</span>*<span class="n">100</span><span class="s">)</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 428       <span class="i">$ResidueNames</span> = <span class="i">$ResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>}<span class="sc">;</span>
 429       <span class="i">@ResidueNamesList</span> = <span class="k">split</span> <span class="q">/~/</span><span class="cm">,</span> <span class="i">$ResidueNames</span><span class="sc">;</span>
 430       <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="i">@ResidueNamesList</span><span class="s">)</span> <span class="s">{</span>
 431         <span class="k">push</span> <span class="i">@</span>{<span class="i">$ResiduesCountInfoMap</span>{<span class="w">Frequency</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${ResidueCount}&quot;</span><span class="sc">;</span>
 432         <span class="k">push</span> <span class="i">@</span>{<span class="i">$ResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${PercentResidueCount}&quot;</span><span class="sc">;</span>
 433       <span class="s">}</span>
 434     <span class="s">}</span>
 435     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 436       <span class="i">@</span>{<span class="i">$AtomResiduesCountInfoMap</span>{<span class="w">Frequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 437       <span class="i">@</span>{<span class="i">$AtomResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 438       <span class="k">for</span> <span class="i">$ResidueCount</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span><span class="i">$b</span> &lt;=&gt; <span class="i">$a</span><span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$AtomResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}}<span class="s">)</span> <span class="s">{</span>
 439         <span class="i">$PercentResidueCount</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.1f&quot;</span><span class="cm">,</span> <span class="s">(</span><span class="s">(</span><span class="i">$ResidueCount</span>/<span class="i">$TotalResidueCount</span><span class="s">)</span>*<span class="n">100</span><span class="s">)</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 440         <span class="i">$ResidueNames</span> = <span class="i">$AtomResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>}<span class="sc">;</span>
 441         <span class="i">@ResidueNamesList</span> = <span class="k">split</span> <span class="q">/~/</span><span class="cm">,</span> <span class="i">$ResidueNames</span><span class="sc">;</span>
 442         <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="i">@ResidueNamesList</span><span class="s">)</span> <span class="s">{</span>
 443           <span class="k">push</span> <span class="i">@</span>{<span class="i">$AtomResiduesCountInfoMap</span>{<span class="w">Frequency</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${ResidueCount}&quot;</span><span class="sc">;</span>
 444           <span class="k">push</span> <span class="i">@</span>{<span class="i">$AtomResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${PercentResidueCount}&quot;</span><span class="sc">;</span>
 445         <span class="s">}</span>
 446       <span class="s">}</span>
 447       <span class="i">@</span>{<span class="i">$HetatmResiduesCountInfoMap</span>{<span class="w">Frequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 448       <span class="i">@</span>{<span class="i">$HetatmResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 449       <span class="k">for</span> <span class="i">$ResidueCount</span> <span class="s">(</span><span class="k">sort</span> <span class="s">{</span><span class="i">$b</span> &lt;=&gt; <span class="i">$a</span><span class="s">}</span> <span class="k">keys</span> <span class="i">%</span>{<span class="i">$HetatmResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}}<span class="s">)</span> <span class="s">{</span>
 450         <span class="i">$PercentResidueCount</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.1f&quot;</span><span class="cm">,</span> <span class="s">(</span><span class="s">(</span><span class="i">$ResidueCount</span>/<span class="i">$TotalResidueCount</span><span class="s">)</span>*<span class="n">100</span><span class="s">)</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 451         <span class="i">$ResidueNames</span> = <span class="i">$HetatmResiduesCountToNameMap</span>{<span class="w">ResidueNames</span>}{<span class="i">$ResidueCount</span>}<span class="sc">;</span>
 452         <span class="i">@ResidueNamesList</span> = <span class="k">split</span> <span class="q">/~/</span><span class="cm">,</span> <span class="i">$ResidueNames</span><span class="sc">;</span>
 453         <span class="k">for</span> <span class="i">$ResidueName</span> <span class="s">(</span><span class="i">@ResidueNamesList</span><span class="s">)</span> <span class="s">{</span>
 454           <span class="k">push</span> <span class="i">@</span>{<span class="i">$HetatmResiduesCountInfoMap</span>{<span class="w">Frequency</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${ResidueCount}&quot;</span><span class="sc">;</span>
 455           <span class="k">push</span> <span class="i">@</span>{<span class="i">$HetatmResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}}<span class="cm">,</span> <span class="q">&quot;${ResidueName} - ${PercentResidueCount}&quot;</span><span class="sc">;</span>
 456         <span class="s">}</span>
 457       <span class="s">}</span>
 458     <span class="s">}</span>
 459 
 460     <span class="c"># List distribution of residues</span>
 461     <span class="k">print</span> <span class="q">&quot;\nDistribution of residues: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ResiduesCountInfoMap</span>{<span class="w">Frequency</span>}}<span class="cm">,</span><span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 462     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 463       <span class="k">print</span> <span class="q">&quot;\nPercent distribution of residues: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$ResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}}<span class="cm">,</span><span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 464     <span class="s">}</span>
 465 
 466     <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 467       <span class="k">print</span> <span class="q">&quot;\nDistribution of ATOM residues: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$AtomResiduesCountInfoMap</span>{<span class="w">Frequency</span>}}<span class="cm">,</span><span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 468       <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 469         <span class="k">print</span> <span class="q">&quot;\nPercent distribution of ATOM residues: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$AtomResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}}<span class="cm">,</span><span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 470       <span class="s">}</span>
 471 
 472       <span class="k">print</span> <span class="q">&quot;\nDistribution of HETATM residues: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$HetatmResiduesCountInfoMap</span>{<span class="w">Frequency</span>}}<span class="cm">,</span><span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 473       <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} &gt;= <span class="n">2</span><span class="s">)</span> <span class="s">{</span>
 474         <span class="k">print</span> <span class="q">&quot;\nPercent distribution of HETATM residues: &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@</span>{<span class="i">$HetatmResiduesCountInfoMap</span>{<span class="w">PercentFrequency</span>}}<span class="cm">,</span><span class="q">&#39;; &#39;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 475       <span class="s">}</span>
 476     <span class="s">}</span>
 477   <span class="s">}</span>
 478 <span class="s">}</span>
 479 
 480 <span class="c"># List information about residue numbers for each chain...</span>
<a name="ListResidueNumbersInfo-"></a> 481 <span class="k">sub </span><span class="m">ListResidueNumbersInfo</span> <span class="s">{</span>
 482   <span class="k">my</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 483   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$ResidueCount</span><span class="cm">,</span> <span class="i">$StartResidueNum</span><span class="cm">,</span> <span class="i">$EndResidueNum</span><span class="cm">,</span> <span class="i">$ChainID</span><span class="cm">,</span> <span class="i">$CollectChainResiduesBeyondTER</span><span class="cm">,</span> <span class="i">$ChainsAndResiduesInfoRef</span><span class="cm">,</span> <span class="i">$ResidueNum</span><span class="cm">,</span> <span class="i">$PreviousResidueNum</span><span class="cm">,</span> <span class="i">$ResidueName</span><span class="cm">,</span> <span class="i">$PreviousResidueName</span><span class="cm">,</span> <span class="i">$GapResiduePairsCount</span><span class="cm">,</span> <span class="i">$GapLength</span><span class="cm">,</span> <span class="i">$DescendingOrderResiduePairsCount</span><span class="cm">,</span> <span class="i">@DescendingOrderResiduePairs</span><span class="cm">,</span> <span class="i">@GapResiduePairs</span><span class="s">)</span><span class="sc">;</span>
 484 
 485   <span class="i">$CollectChainResiduesBeyondTER</span> = <span class="n">0</span><span class="sc">;</span>
 486   <span class="i">$ChainsAndResiduesInfoRef</span> = <span class="i">GetChainsAndResidues</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="cm">,</span> <span class="q">&#39;AtomAndHetatm&#39;</span><span class="cm">,</span> <span class="i">$CollectChainResiduesBeyondTER</span><span class="s">)</span><span class="sc">;</span>
 487 
 488   <span class="k">print</span> <span class="q">&quot;\nATOM/HETATM residue numbers information for chains:\n&quot;</span><span class="sc">;</span>
 489 
 490   <span class="k">for</span> <span class="i">$ChainID</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ChainIDs</span>}}<span class="s">)</span> <span class="s">{</span>
 491     <span class="k">print</span> <span class="q">&quot;\nChain ID - &quot;</span><span class="cm">,</span>  <span class="i">CleanupChainID</span><span class="s">(</span><span class="i">$ChainID</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;&quot;</span><span class="sc">;</span>
 492 
 493     <span class="i">$ResidueCount</span> = <span class="i">@</span>{<span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueNumbers</span>}{<span class="i">$ChainID</span>}}<span class="sc">;</span>
 494 
 495     <span class="c"># Start and end residue numbers...</span>
 496     <span class="i">$StartResidueNum</span> = <span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueNumbers</span>}{<span class="i">$ChainID</span>}[<span class="n">0</span>]<span class="sc">;</span>
 497     <span class="i">$EndResidueNum</span> = <span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueNumbers</span>}{<span class="i">$ChainID</span>}[<span class="i">$ResidueCount</span> - <span class="n">1</span>]<span class="sc">;</span>
 498     <span class="k">print</span> <span class="q">&quot;; Number of residues: $ResidueCount; Start residue number - $StartResidueNum; End residue number - $EndResidueNum\n&quot;</span><span class="sc">;</span>
 499 
 500     <span class="c"># Identify any gaps in residue numbers or non-ascending order residue numbers...</span>
 501     <span class="i">$GapResiduePairsCount</span> = <span class="n">0</span><span class="sc">;</span>
 502     <span class="i">$DescendingOrderResiduePairsCount</span> = <span class="n">0</span><span class="sc">;</span>
 503 
 504     <span class="i">@DescendingOrderResiduePairs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 505     <span class="i">@GapResiduePairs</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 506 
 507     <span class="j">RESIDUE:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">1</span> .. <span class="s">(</span><span class="i">$ResidueCount</span> - <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 508       <span class="i">$ResidueNum</span> = <span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueNumbers</span>}{<span class="i">$ChainID</span>}[<span class="i">$Index</span>]<span class="sc">;</span>
 509       <span class="i">$PreviousResidueNum</span> = <span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">ResidueNumbers</span>}{<span class="i">$ChainID</span>}[<span class="i">$Index</span> - <span class="n">1</span>]<span class="sc">;</span>
 510 
 511       <span class="i">$ResidueName</span> = <span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">Residues</span>}{<span class="i">$ChainID</span>}[<span class="i">$Index</span>]<span class="sc">;</span>
 512       <span class="i">$PreviousResidueName</span> = <span class="i">$ChainsAndResiduesInfoRef</span>-&gt;{<span class="w">Residues</span>}{<span class="i">$ChainID</span>}[<span class="i">$Index</span> - <span class="n">1</span>]<span class="sc">;</span>
 513 
 514       <span class="k">if</span> <span class="s">(</span><span class="i">$ResidueNum</span> == <span class="s">(</span><span class="i">$PreviousResidueNum</span> + <span class="n">1</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 515         <span class="c"># All is good...</span>
 516         <span class="k">next</span> <span class="j">RESIDUE</span><span class="sc">;</span>
 517       <span class="s">}</span>
 518 
 519       <span class="c"># Are residue in descending order?</span>
 520       <span class="k">if</span> <span class="s">(</span><span class="i">$ResidueNum</span> &lt; <span class="i">$PreviousResidueNum</span><span class="s">)</span> <span class="s">{</span>
 521         <span class="i">$DescendingOrderResiduePairsCount</span>++<span class="sc">;</span>
 522         <span class="k">push</span> <span class="i">@DescendingOrderResiduePairs</span><span class="cm">,</span> <span class="q">&quot;&lt;${PreviousResidueName}${PreviousResidueNum} - ${ResidueName}${ResidueNum}&gt;&quot;</span><span class="sc">;</span>
 523       <span class="s">}</span>
 524 
 525       <span class="c"># Track gaps in residue pairs...</span>
 526       <span class="i">$GapResiduePairsCount</span>++<span class="sc">;</span>
 527       <span class="i">$GapLength</span> = <span class="k">abs</span><span class="s">(</span><span class="i">$ResidueNum</span> - <span class="i">$PreviousResidueNum</span><span class="s">)</span> - <span class="n">1</span><span class="sc">;</span>
 528 
 529       <span class="k">push</span> <span class="i">@GapResiduePairs</span><span class="cm">,</span> <span class="q">&quot;&lt;${PreviousResidueName}${PreviousResidueNum} - ${ResidueName}${ResidueNum}; $GapLength&gt;&quot;</span><span class="sc">;</span>
 530     <span class="s">}</span>
 531 
 532     <span class="c"># Print gaps information...</span>
 533     <span class="k">print</span> <span class="q">&quot;Gaps in residue numbers: &quot;</span><span class="cm">,</span> <span class="i">$GapResiduePairsCount</span> ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;None&quot;</span><span class="sc">;</span>
 534     <span class="k">if</span> <span class="s">(</span><span class="i">$GapResiduePairsCount</span><span class="s">)</span> <span class="s">{</span>
 535       <span class="k">print</span> <span class="q">&quot;; Number of gap residue number pairs: $GapResiduePairsCount; Gap residue pairs: &lt;StartRes-EndRes; GapLength&gt; - &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@GapResiduePairs</span><span class="cm">,</span> <span class="q">&quot;; &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 536     <span class="s">}</span>
 537     <span class="k">print</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 538 
 539     <span class="c"># Print descending residue order information...</span>
 540     <span class="k">print</span> <span class="q">&quot;Residue numbers in descending order: &quot;</span><span class="cm">,</span> <span class="i">$DescendingOrderResiduePairsCount</span> ? <span class="q">&quot;Yes&quot;</span> <span class="co">:</span> <span class="q">&quot;None&quot;</span><span class="sc">;</span>
 541     <span class="k">if</span> <span class="s">(</span><span class="i">$DescendingOrderResiduePairsCount</span><span class="s">)</span> <span class="s">{</span>
 542       <span class="k">print</span> <span class="q">&quot;; Number of descending residue number pairs: $DescendingOrderResiduePairsCount; Descending residue number pairs: &lt;StartRes-EndRes&gt; &quot;</span><span class="cm">,</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@DescendingOrderResiduePairs</span><span class="cm">,</span> <span class="q">&quot;; &quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="sc">;</span>
 543     <span class="s">}</span>
 544     <span class="k">print</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 545   <span class="s">}</span>
 546 <span class="s">}</span>
 547 
 548 <span class="c"># List min/max XYZ coordinates for ATOM/HETATM records...</span>
<a name="ListBoundingBox-"></a> 549 <span class="k">sub </span><span class="m">ListBoundingBox</span> <span class="s">{</span>
 550   <span class="k">my</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 551   <span class="k">my</span><span class="s">(</span><span class="i">$XMin</span><span class="cm">,</span> <span class="i">$YMin</span><span class="cm">,</span> <span class="i">$ZMin</span><span class="cm">,</span> <span class="i">$XMax</span><span class="cm">,</span> <span class="i">$YMax</span><span class="cm">,</span> <span class="i">$ZMax</span><span class="cm">,</span> <span class="i">$XSize</span><span class="cm">,</span> <span class="i">$YSize</span><span class="cm">,</span> <span class="i">$ZSize</span><span class="s">)</span><span class="sc">;</span>
 552 
 553   <span class="s">(</span><span class="i">$XMin</span><span class="cm">,</span> <span class="i">$YMin</span><span class="cm">,</span> <span class="i">$ZMin</span><span class="cm">,</span> <span class="i">$XMax</span><span class="cm">,</span> <span class="i">$YMax</span><span class="cm">,</span> <span class="i">$ZMax</span><span class="s">)</span> = <span class="i">GetMinMaxCoords</span><span class="s">(</span><span class="i">$PDBRecordLinesRef</span><span class="s">)</span><span class="sc">;</span>
 554   <span class="i">$XSize</span> = <span class="k">abs</span><span class="s">(</span><span class="i">$XMax</span> - <span class="i">$XMin</span><span class="s">)</span><span class="sc">;</span>
 555   <span class="i">$YSize</span> = <span class="k">abs</span><span class="s">(</span><span class="i">$YMax</span> - <span class="i">$YMin</span><span class="s">)</span><span class="sc">;</span>
 556   <span class="i">$ZSize</span> = <span class="k">abs</span><span class="s">(</span><span class="i">$ZMax</span> - <span class="i">$ZMin</span><span class="s">)</span><span class="sc">;</span>
 557 
 558   <span class="i">$XMin</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$XMin</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span> <span class="i">$XMax</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$XMax</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 559   <span class="i">$YMin</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$YMin</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span> <span class="i">$YMax</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$YMax</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 560   <span class="i">$ZMin</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$ZMin</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span> <span class="i">$ZMax</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$ZMax</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 561 
 562   <span class="i">$XSize</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$XSize</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 563   <span class="i">$YSize</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$YSize</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 564   <span class="i">$ZSize</span> = <span class="k">sprintf</span><span class="s">(</span><span class="q">&quot;%.3f&quot;</span><span class="cm">,</span> <span class="i">$ZSize</span><span class="s">)</span> + <span class="n">0</span><span class="sc">;</span>
 565 
 566   <span class="k">print</span> <span class="q">&quot;\nBounding box coordinates: &lt;XMin, XMax&gt; - &lt;$XMin, $XMax&gt;; &lt;YMin, YMax&gt; - &lt;$YMin, $YMax&gt;; &lt;ZMin, ZMax&gt; - &lt;$ZMin, $ZMax&gt;;\n&quot;</span><span class="sc">;</span>
 567   <span class="k">print</span> <span class="q">&quot;Bounding box size in angstroms: XSize - $XSize; YSize - $YSize; ZSize - $ZSize\n&quot;</span><span class="sc">;</span>
 568 
 569 <span class="s">}</span>
 570 
 571 <span class="c"># Check master record counts against actual record counts...</span>
<a name="CheckMasterRecord-"></a> 572 <span class="k">sub </span><span class="m">CheckMasterRecord</span> <span class="s">{</span>
 573   <span class="k">my</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span><span class="cm">,</span> <span class="i">$PDBRecordLinesRef</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 574 
 575   <span class="c"># Get master record information...</span>
 576   <span class="k">my</span><span class="s">(</span><span class="i">$NumOfRemarkRecords</span><span class="cm">,</span> <span class="i">$NumOfHetRecords</span><span class="cm">,</span> <span class="i">$NumOfHelixRecords</span><span class="cm">,</span> <span class="i">$NumOfSheetRecords</span><span class="cm">,</span> <span class="i">$NumOfTurnRecords</span><span class="cm">,</span> <span class="i">$NumOfSiteRecords</span><span class="cm">,</span> <span class="i">$NumOfTransformationsRecords</span><span class="cm">,</span> <span class="i">$NumOfAtomAndHetatmRecords</span><span class="cm">,</span> <span class="i">$NumOfTerRecords</span><span class="cm">,</span> <span class="i">$NumOfConectRecords</span><span class="cm">,</span> <span class="i">$NumOfSeqresRecords</span><span class="s">)</span> = <span class="s">(</span><span class="k">undef</span><span class="s">)</span> x <span class="n">11</span><span class="sc">;</span>
 577   <span class="k">my</span><span class="s">(</span><span class="i">$RecordLine</span><span class="cm">,</span> <span class="i">$MasterRecordFound</span><span class="s">)</span><span class="sc">;</span>
 578   <span class="i">$MasterRecordFound</span> = <span class="n">0</span><span class="sc">;</span>
 579 
 580   <span class="j">LINE:</span> <span class="k">for</span> <span class="i">$RecordLine</span> <span class="s">(</span><span class="i">@</span>{<span class="i">$PDBRecordLinesRef</span>}<span class="s">)</span> <span class="s">{</span>
 581       <span class="k">if</span> <span class="s">(</span><span class="i">IsMasterRecordType</span><span class="s">(</span><span class="i">$RecordLine</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 582         <span class="s">(</span><span class="i">$NumOfRemarkRecords</span><span class="cm">,</span> <span class="i">$NumOfHetRecords</span><span class="cm">,</span> <span class="i">$NumOfHelixRecords</span><span class="cm">,</span> <span class="i">$NumOfSheetRecords</span><span class="cm">,</span> <span class="i">$NumOfTurnRecords</span><span class="cm">,</span> <span class="i">$NumOfSiteRecords</span><span class="cm">,</span> <span class="i">$NumOfTransformationsRecords</span><span class="cm">,</span> <span class="i">$NumOfAtomAndHetatmRecords</span><span class="cm">,</span> <span class="i">$NumOfTerRecords</span><span class="cm">,</span> <span class="i">$NumOfConectRecords</span><span class="cm">,</span> <span class="i">$NumOfSeqresRecords</span><span class="s">)</span> = <span class="i">ParseMasterRecordLine</span><span class="s">(</span><span class="i">$RecordLine</span><span class="s">)</span><span class="sc">;</span>
 583         <span class="i">$MasterRecordFound</span> = <span class="n">1</span><span class="sc">;</span>
 584         <span class="k">last</span> <span class="j">LINE</span><span class="sc">;</span>
 585       <span class="s">}</span>
 586   <span class="s">}</span>
 587   <span class="k">if</span> <span class="s">(</span>!<span class="i">$MasterRecordFound</span><span class="s">)</span> <span class="s">{</span>
 588     <span class="k">print</span> <span class="q">&quot;\nWarning: MASTER record is missing.\n&quot;</span><span class="sc">;</span>
 589     <span class="k">return</span><span class="sc">;</span>
 590   <span class="s">}</span>
 591   <span class="k">my</span><span class="s">(</span><span class="i">@MasterRecordValidationInfo</span><span class="s">)</span><span class="sc">;</span>
 592   <span class="i">@MasterRecordValidationInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 593   <span class="i">$NumOfRemarkRecords</span> += <span class="n">0</span><span class="sc">;</span>
 594   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">REMARK</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfRemarkRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">REMARK</span>}<span class="s">)</span> <span class="s">{</span>
 595     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of REMARK records, $NumOfRemarkRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{REMARK}.&quot;</span><span class="sc">;</span>
 596   <span class="s">}</span>
 597   <span class="i">$NumOfHetRecords</span> += <span class="n">0</span><span class="sc">;</span>
 598   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">HET</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfHetRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">HET</span>}<span class="s">)</span> <span class="s">{</span>
 599     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of HET records, $NumOfHetRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{HET}.&quot;</span><span class="sc">;</span>
 600   <span class="s">}</span>
 601   <span class="i">$NumOfHelixRecords</span> += <span class="n">0</span><span class="sc">;</span>
 602   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">HELIX</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfHelixRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">HELIX</span>}<span class="s">)</span> <span class="s">{</span>
 603     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of HELIX records, $NumOfHelixRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{HELIX}.&quot;</span><span class="sc">;</span>
 604   <span class="s">}</span>
 605   <span class="i">$NumOfSheetRecords</span> += <span class="n">0</span><span class="sc">;</span>
 606   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">SHEET</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfSheetRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">SHEET</span>}<span class="s">)</span> <span class="s">{</span>
 607     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of SHEET records, $NumOfSheetRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{SHEET}.&quot;</span><span class="sc">;</span>
 608   <span class="s">}</span>
 609   <span class="i">$NumOfTurnRecords</span> += <span class="n">0</span><span class="sc">;</span>
 610   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">TURN</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfTurnRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">TURN</span>}<span class="s">)</span> <span class="s">{</span>
 611     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of TURN records, $NumOfTurnRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{REMARK}.&quot;</span><span class="sc">;</span>
 612   <span class="s">}</span>
 613   <span class="i">$NumOfSiteRecords</span> += <span class="n">0</span><span class="sc">;</span>
 614   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">SITE</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfSiteRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">SITE</span>}<span class="s">)</span> <span class="s">{</span>
 615     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of SITE records, $NumOfSiteRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{SITE}.&quot;</span><span class="sc">;</span>
 616   <span class="s">}</span>
 617 
 618   <span class="i">$NumOfTransformationsRecords</span> += <span class="n">0</span><span class="sc">;</span>
 619   <span class="k">my</span><span class="s">(</span><span class="i">$RecordsCount</span><span class="cm">,</span> <span class="i">$ID</span><span class="cm">,</span> <span class="i">$RecordID</span><span class="cm">,</span> <span class="i">$RecordLabel</span><span class="s">)</span><span class="sc">;</span>
 620   <span class="i">$RecordsCount</span> = <span class="n">0</span><span class="sc">;</span>
 621   <span class="k">for</span> <span class="i">$RecordLabel</span> <span class="s">(</span><span class="q">&#39;ORIGX&#39;</span><span class="cm">,</span> <span class="q">&#39;SCALE&#39;</span><span class="cm">,</span> <span class="q">&#39;MTRIX&#39;</span><span class="s">)</span> <span class="s">{</span>
 622     <span class="k">for</span> <span class="i">$ID</span> <span class="s">(</span><span class="n">1</span> .. <span class="n">3</span><span class="s">)</span> <span class="s">{</span>
 623       <span class="i">$RecordID</span> = <span class="q">&quot;${RecordLabel}${ID}&quot;</span><span class="sc">;</span>
 624       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="i">$RecordID</span>}<span class="s">)</span> <span class="s">{</span>
 625         <span class="i">$RecordsCount</span> += <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="i">$RecordID</span>}<span class="sc">;</span>
 626       <span class="s">}</span>
 627     <span class="s">}</span>
 628   <span class="s">}</span>
 629   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfTransformationsRecords</span> != <span class="i">$RecordsCount</span><span class="s">)</span> <span class="s">{</span>
 630     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of transformation records (ORIGXn+SCALEn+MTRIXn), $NumOfTransformationsRecords, specified in MASTER record doen&#39;t match its explict count, $RecordsCount.&quot;</span><span class="sc">;</span>
 631   <span class="s">}</span>
 632 
 633   <span class="i">$RecordsCount</span> = <span class="n">0</span><span class="sc">;</span>
 634   <span class="k">for</span> <span class="i">$RecordLabel</span> <span class="s">(</span><span class="q">&#39;ATOM&#39;</span><span class="cm">,</span> <span class="q">&#39;HETATM&#39;</span><span class="s">)</span> <span class="s">{</span>
 635       <span class="k">if</span> <span class="s">(</span><span class="k">exists</span> <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="i">$RecordLabel</span>}<span class="s">)</span> <span class="s">{</span>
 636         <span class="i">$RecordsCount</span> += <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="i">$RecordLabel</span>}<span class="sc">;</span>
 637       <span class="s">}</span>
 638   <span class="s">}</span>
 639   <span class="i">$NumOfAtomAndHetatmRecords</span> += <span class="n">0</span><span class="sc">;</span>
 640   <span class="k">if</span> <span class="s">(</span><span class="i">$NumOfAtomAndHetatmRecords</span> != <span class="i">$RecordsCount</span><span class="s">)</span> <span class="s">{</span>
 641     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of ATOM + HETATM records, $NumOfAtomAndHetatmRecords, specified in MASTER record doen&#39;t match its explict count, $RecordsCount.&quot;</span><span class="sc">;</span>
 642   <span class="s">}</span>
 643   <span class="i">$NumOfTerRecords</span> += <span class="n">0</span><span class="sc">;</span>
 644   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">TER</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfTerRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">TER</span>}<span class="s">)</span> <span class="s">{</span>
 645     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of TER records, $NumOfTerRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{TER}.&quot;</span><span class="sc">;</span>
 646   <span class="s">}</span>
 647   <span class="i">$NumOfConectRecords</span> += <span class="n">0</span><span class="sc">;</span>
 648   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">CONECT</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfConectRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">CONECT</span>}<span class="s">)</span> <span class="s">{</span>
 649     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of CONECT records, $NumOfConectRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{CONECT}.&quot;</span><span class="sc">;</span>
 650   <span class="s">}</span>
 651   <span class="i">$NumOfSeqresRecords</span> += <span class="n">0</span><span class="sc">;</span>
 652   <span class="k">if</span> <span class="s">(</span><span class="k">exists</span><span class="s">(</span><span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">SEQRES</span>}<span class="s">)</span> &amp;&amp; <span class="i">$NumOfSeqresRecords</span> != <span class="i">$RecordTypesCountRef</span>-&gt;{<span class="w">Count</span>}{<span class="w">SEQRES</span>}<span class="s">)</span> <span class="s">{</span>
 653     <span class="k">push</span> <span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;Number of SITE records, $NumOfSeqresRecords, specified in MASTER record doen&#39;t match its explict count, $RecordTypesCountRef-&gt;{Count}{SEQRES}.&quot;</span><span class="sc">;</span>
 654   <span class="s">}</span>
 655 
 656   <span class="k">if</span> <span class="s">(</span><span class="i">@MasterRecordValidationInfo</span><span class="s">)</span> <span class="s">{</span>
 657     <span class="k">print</span> <span class="q">&quot;\nMASTER record validation: Count mismatches found:\n&quot;</span><span class="sc">;</span>
 658     <span class="k">print</span> <span class="i">JoinWords</span><span class="s">(</span>\<span class="i">@MasterRecordValidationInfo</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="cm">,</span> <span class="n">0</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 659   <span class="s">}</span>
 660   <span class="k">else</span> <span class="s">{</span>
 661     <span class="k">print</span> <span class="q">&quot;\nMASTER record validation: Count values match with the explicit count of the corresponding records.\n&quot;</span><span class="sc">;</span>
 662   <span class="s">}</span>
 663 <span class="s">}</span>
 664 
 665 <span class="c"># Total size of all the files...</span>
<a name="ListTotalSizeOfFiles-"></a> 666 <span class="k">sub </span><span class="m">ListTotalSizeOfFiles</span> <span class="s">{</span>
 667   <span class="k">my</span><span class="s">(</span><span class="i">$FileOkayCount</span><span class="cm">,</span> <span class="i">$TotalSize</span><span class="cm">,</span> <span class="i">$Index</span><span class="s">)</span><span class="sc">;</span>
 668 
 669   <span class="i">$FileOkayCount</span> = <span class="n">0</span><span class="sc">;</span>
 670   <span class="i">$TotalSize</span> = <span class="n">0</span><span class="sc">;</span>
 671 
 672   <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#PDBFilesList</span><span class="s">)</span> <span class="s">{</span>
 673     <span class="k">if</span> <span class="s">(</span><span class="i">$PDBFilesInfo</span>{<span class="w">FileOkay</span>}[<span class="i">$Index</span>]<span class="s">)</span> <span class="s">{</span>
 674       <span class="i">$FileOkayCount</span>++<span class="sc">;</span>
 675       <span class="i">$TotalSize</span> += <span class="i">$PDBFilesInfo</span>{<span class="w">FileSize</span>}[<span class="i">$Index</span>]<span class="sc">;</span>
 676     <span class="s">}</span>
 677   <span class="s">}</span>
 678   <span class="k">if</span> <span class="s">(</span><span class="i">$FileOkayCount</span> &gt; <span class="n">1</span><span class="s">)</span> <span class="s">{</span>
 679     <span class="k">print</span> <span class="q">&quot;\nTotal size of $FileOkayCount files: &quot;</span><span class="cm">,</span> <span class="i">FormatFileSize</span><span class="s">(</span><span class="i">$TotalSize</span><span class="s">)</span><span class="cm">,</span> <span class="q">&quot;\n&quot;</span><span class="sc">;</span>
 680   <span class="s">}</span>
 681 
 682 <span class="s">}</span>
 683 
 684 <span class="c"># Empty chain IDs are replaced with &quot;None[1-9]&quot;. But for displaying purposes, take out any</span>
 685 <span class="c"># numbers from label...</span>
<a name="CleanupChainID-"></a> 686 <span class="k">sub </span><span class="m">CleanupChainID</span> <span class="s">{</span>
 687   <span class="k">my</span><span class="s">(</span><span class="i">$ChainID</span><span class="s">)</span> = <span class="i">@_</span><span class="sc">;</span>
 688 
 689   <span class="k">if</span> <span class="s">(</span><span class="i">$ChainID</span> =~ <span class="q">/^None/i</span><span class="s">)</span> <span class="s">{</span>
 690     <span class="k">return</span> <span class="q">&#39;None&#39;</span><span class="sc">;</span>
 691   <span class="s">}</span>
 692   <span class="k">return</span> <span class="i">$ChainID</span><span class="sc">;</span>
 693 <span class="s">}</span>
 694 
 695 <span class="c"># Process option values...</span>
<a name="ProcessOptions-"></a> 696 <span class="k">sub </span><span class="m">ProcessOptions</span> <span class="s">{</span>
 697   <span class="i">%OptionsInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 698 
 699   <span class="c"># Setup record types to count...</span>
 700   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">count</span>}<span class="s">)</span> <span class="s">{</span>
 701     <span class="i">$OptionsInfo</span>{<span class="w">CountRecordType</span>} = <span class="i">$Options</span>{<span class="w">count</span>}<span class="sc">;</span>
 702   <span class="s">}</span>
 703   <span class="k">else</span> <span class="s">{</span>
 704     <span class="i">$OptionsInfo</span>{<span class="w">CountRecordType</span>} = <span class="i">$Options</span>{<span class="w">all</span>} ? <span class="q">&#39;All&#39;</span> <span class="co">:</span> <span class="q">&#39;ATOM,HETATM&#39;</span><span class="sc">;</span>
 705   <span class="s">}</span>
 706   <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedRecordTypes</span>}} =<span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 707   <span class="k">if</span> <span class="s">(</span><span class="i">$OptionsInfo</span>{<span class="w">CountRecordType</span>} !~ <span class="q">/^All$/i</span><span class="s">)</span> <span class="s">{</span>
 708     <span class="k">my</span><span class="s">(</span><span class="i">@RecordTypes</span><span class="s">)</span><span class="sc">;</span>
 709     <span class="i">@RecordTypes</span> = <span class="k">split</span> <span class="q">/\,/</span><span class="cm">,</span> <span class="i">$OptionsInfo</span>{<span class="w">CountRecordType</span>}<span class="sc">;</span>
 710     <span class="k">push</span> <span class="i">@</span>{<span class="i">$OptionsInfo</span>{<span class="w">SpecifiedRecordTypes</span>}}<span class="cm">,</span> <span class="i">@RecordTypes</span><span class="sc">;</span>
 711   <span class="s">}</span>
 712   <span class="i">$OptionsInfo</span>{<span class="w">CountChains</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">chains</span>} || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 713   <span class="i">$OptionsInfo</span>{<span class="w">CheckMasterRecord</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">mastercheck</span>} || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 714 
 715   <span class="c"># Residue count is the default. So $Options{residues} is simply ignored.</span>
 716   <span class="k">my</span><span class="s">(</span><span class="i">$CountResidues</span><span class="s">)</span> = <span class="n">1</span><span class="sc">;</span>
 717   <span class="i">$OptionsInfo</span>{<span class="w">CountResiduesInChains</span>} = <span class="s">(</span><span class="s">(</span><span class="i">$CountResidues</span> || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> &amp;&amp; <span class="i">$Options</span>{<span class="w">residuesmode</span>} =~ <span class="q">/^(InChains|Both)$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 718   <span class="i">$OptionsInfo</span>{<span class="w">CountResiduesAll</span>} = <span class="s">(</span><span class="s">(</span><span class="i">$CountResidues</span> || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> &amp;&amp; <span class="i">$Options</span>{<span class="w">residuesmode</span>} =~ <span class="q">/^(All|Both)$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 719 
 720   <span class="i">$OptionsInfo</span>{<span class="w">ResiduesFrequencyInChains</span>} = <span class="s">(</span><span class="s">(</span><span class="i">$Options</span>{<span class="w">frequency</span>} || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> &amp;&amp; <span class="i">$Options</span>{<span class="w">residuesmode</span>} =~ <span class="q">/^(InChains|Both)$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 721   <span class="i">$OptionsInfo</span>{<span class="w">ResiduesFrequencyAll</span>} = <span class="s">(</span><span class="s">(</span><span class="i">$Options</span>{<span class="w">frequency</span>} || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> &amp;&amp; <span class="i">$Options</span>{<span class="w">residuesmode</span>} =~ <span class="q">/^(All|Both)$/i</span><span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 722 
 723   <span class="i">$OptionsInfo</span>{<span class="w">ResidueNumbersInfo</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">residuenumbers</span>} || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span>  ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 724 
 725   <span class="i">$OptionsInfo</span>{<span class="w">CalculateBoundingBox</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">boundingbox</span>} || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 726 
 727   <span class="i">$OptionsInfo</span>{<span class="w">ListHeaderInfo</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">header</span>} || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 728   <span class="i">$OptionsInfo</span>{<span class="w">DetailLevel</span>} = <span class="i">$Options</span>{<span class="w">detail</span>}<span class="sc">;</span>
 729 
 730   <span class="i">$OptionsInfo</span>{<span class="w">ListExperimentalTechniqueInfo</span>} = <span class="s">(</span><span class="i">$Options</span>{<span class="w">experiment</span>} || <span class="i">$Options</span>{<span class="w">all</span>}<span class="s">)</span> ? <span class="n">1</span> <span class="co">:</span> <span class="n">0</span><span class="sc">;</span>
 731 
 732 <span class="s">}</span>
 733 
 734 <span class="c"># Retrieve information about PDB files...</span>
<a name="RetrievePDBFilesInfo-"></a> 735 <span class="k">sub </span><span class="m">RetrievePDBFilesInfo</span> <span class="s">{</span>
 736   <span class="k">my</span><span class="s">(</span><span class="i">$Index</span><span class="cm">,</span> <span class="i">$PDBFile</span><span class="cm">,</span> <span class="i">$ModifiedTimeString</span><span class="cm">,</span> <span class="i">$ModifiedDateString</span><span class="s">)</span><span class="sc">;</span>
 737 
 738   <span class="i">%PDBFilesInfo</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 739   <span class="i">@</span>{<span class="i">$PDBFilesInfo</span>{<span class="w">FileOkay</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 740   <span class="i">@</span>{<span class="i">$PDBFilesInfo</span>{<span class="w">FileSize</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 741   <span class="i">@</span>{<span class="i">$PDBFilesInfo</span>{<span class="w">FileLastModified</span>}} = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 742 
 743   <span class="j">FILELIST:</span> <span class="k">for</span> <span class="i">$Index</span> <span class="s">(</span><span class="n">0</span> .. <span class="i">$#PDBFilesList</span><span class="s">)</span> <span class="s">{</span>
 744     <span class="i">$PDBFilesInfo</span>{<span class="w">FileOkay</span>}[<span class="i">$Index</span>] = <span class="n">0</span><span class="sc">;</span>
 745     <span class="i">$PDBFilesInfo</span>{<span class="w">FileSize</span>}[<span class="i">$Index</span>] = <span class="n">0</span><span class="sc">;</span>
 746     <span class="i">$PDBFilesInfo</span>{<span class="w">FileLastModified</span>}[<span class="i">$Index</span>] = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 747 
 748     <span class="i">$PDBFile</span> = <span class="i">$PDBFilesList</span>[<span class="i">$Index</span>]<span class="sc">;</span>
 749     <span class="k">if</span> <span class="s">(</span>!<span class="s">(</span><span class="k">-e</span> <span class="i">$PDBFile</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 750       <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring file $PDBFile: It doesn&#39;t exist\n&quot;</span><span class="sc">;</span>
 751       <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 752     <span class="s">}</span>
 753     <span class="k">if</span> <span class="s">(</span>!<span class="i">CheckFileType</span><span class="s">(</span><span class="i">$PDBFile</span><span class="cm">,</span> <span class="q">&quot;pdb&quot;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 754       <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring file $PDBFile: It&#39;s not a PDB file\n&quot;</span><span class="sc">;</span>
 755       <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 756     <span class="s">}</span>
 757     <span class="k">if</span> <span class="s">(</span>! <span class="k">open</span> <span class="w">PDBFILE</span><span class="cm">,</span> <span class="q">&quot;$PDBFile&quot;</span><span class="s">)</span> <span class="s">{</span>
 758       <span class="k">warn</span> <span class="q">&quot;Warning: Ignoring file $PDBFile: Couldn&#39;t open it: $! \n&quot;</span><span class="sc">;</span>
 759       <span class="k">next</span> <span class="j">FILELIST</span><span class="sc">;</span>
 760     <span class="s">}</span>
 761     <span class="k">close</span> <span class="w">PDBFILE</span><span class="sc">;</span>
 762 
 763     <span class="i">$PDBFilesInfo</span>{<span class="w">FileOkay</span>}[<span class="i">$Index</span>] = <span class="n">1</span><span class="sc">;</span>
 764     <span class="i">$PDBFilesInfo</span>{<span class="w">FileSize</span>}[<span class="i">$Index</span>] = <span class="i">FileSize</span><span class="s">(</span><span class="i">$PDBFile</span><span class="s">)</span><span class="sc">;</span>
 765     <span class="s">(</span><span class="i">$ModifiedTimeString</span><span class="cm">,</span> <span class="i">$ModifiedDateString</span><span class="s">)</span> = <span class="i">FormattedFileModificationTimeAndDate</span><span class="s">(</span><span class="i">$PDBFile</span><span class="s">)</span><span class="sc">;</span>
 766     <span class="i">$PDBFilesInfo</span>{<span class="w">FileLastModified</span>}[<span class="i">$Index</span>] = <span class="q">&quot;$ModifiedTimeString; $ModifiedDateString&quot;</span><span class="sc">;</span>
 767   <span class="s">}</span>
 768 <span class="s">}</span>
 769 
 770 
 771 <span class="c"># Setup script usage  and retrieve command line arguments specified using various options...</span>
<a name="SetupScriptUsage-"></a> 772 <span class="k">sub </span><span class="m">SetupScriptUsage</span> <span class="s">{</span>
 773 
 774   <span class="c"># Retrieve all the options...</span>
 775   <span class="i">%Options</span> = <span class="s">(</span><span class="s">)</span><span class="sc">;</span>
 776   <span class="i">$Options</span>{<span class="w">count</span>} = <span class="q">&#39;&#39;</span><span class="sc">;</span>
 777   <span class="i">$Options</span>{<span class="w">detail</span>} = <span class="n">1</span><span class="sc">;</span>
 778   <span class="i">$Options</span>{<span class="w">residuesmode</span>} = <span class="q">&#39;Both&#39;</span><span class="sc">;</span>
 779 
 780   <span class="k">if</span> <span class="s">(</span>!<span class="i">GetOptions</span><span class="s">(</span>\<span class="i">%Options</span><span class="cm">,</span> <span class="q">&quot;all|a&quot;</span><span class="cm">,</span> <span class="q">&quot;boundingbox|b&quot;</span><span class="cm">,</span> <span class="q">&quot;count|c=s&quot;</span><span class="cm">,</span> <span class="q">&quot;chains&quot;</span><span class="cm">,</span> <span class="q">&quot;detail|d=i&quot;</span><span class="cm">,</span> <span class="q">&quot;experiment|e&quot;</span><span class="cm">,</span> <span class="q">&quot;frequency|f&quot;</span><span class="cm">,</span> <span class="q">&quot;mastercheck|m&quot;</span><span class="cm">,</span> <span class="q">&quot;header&quot;</span><span class="cm">,</span> <span class="q">&quot;help|h&quot;</span><span class="cm">,</span> <span class="q">&quot;residues&quot;</span><span class="cm">,</span> <span class="q">&quot;residuesmode=s&quot;</span><span class="cm">,</span> <span class="q">&quot;residuenumbers&quot;</span><span class="cm">,</span> <span class="q">&quot;workingdir|w=s&quot;</span><span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 781     <span class="k">die</span> <span class="q">&quot;\nTo get a list of valid options and their values, use \&quot;$ScriptName -h\&quot; or\n\&quot;perl -S $ScriptName -h\&quot; command and try again...\n&quot;</span><span class="sc">;</span>
 782   <span class="s">}</span>
 783   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">workingdir</span>}<span class="s">)</span> <span class="s">{</span>
 784     <span class="k">if</span> <span class="s">(</span>! <span class="k">-d</span> <span class="i">$Options</span>{<span class="w">workingdir</span>}<span class="s">)</span> <span class="s">{</span>
 785       <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{workingdir}, for option \&quot;-w --workingdir\&quot; is not a directory name.\n&quot;</span><span class="sc">;</span>
 786     <span class="s">}</span>
 787     <span class="k">chdir</span> <span class="i">$Options</span>{<span class="w">workingdir</span>} <span class="k">or</span> <span class="k">die</span> <span class="q">&quot;Error: Couldn&#39;t chdir $Options{workingdir}: $! \n&quot;</span><span class="sc">;</span>
 788   <span class="s">}</span>
 789   <span class="k">if</span> <span class="s">(</span>!<span class="i">IsPositiveInteger</span><span class="s">(</span><span class="i">$Options</span>{<span class="w">detail</span>}<span class="s">)</span><span class="s">)</span> <span class="s">{</span>
 790     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{detail}, for option \&quot;-d --detail\&quot; is not valid. Allowed values: &gt; 0\n&quot;</span><span class="sc">;</span>
 791   <span class="s">}</span>
 792   <span class="k">if</span> <span class="s">(</span><span class="i">$Options</span>{<span class="w">residuesmode</span>} !~ <span class="q">/^(InChains|All|Both)$/i</span><span class="s">)</span> <span class="s">{</span>
 793     <span class="k">die</span> <span class="q">&quot;Error: The value specified, $Options{residuesmode}, for option \&quot;--ResiduesMode\&quot; is not valid. Allowed values: InChains, All, or Both\n&quot;</span><span class="sc">;</span>
 794   <span class="s">}</span>
 795 <span class="s">}</span>
 796 
<a name="EOF-"></a></pre>
<p>&nbsp;</p>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
